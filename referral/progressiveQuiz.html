<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supply Theory Mastery Quiz</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;900&family=Lexend:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --emerald-50: #ecfdf5;
            --emerald-100: #d1fae5;
            --emerald-500: #10b981;
            --emerald-600: #059669;
            --emerald-700: #047857;
            --emerald-800: #065f46;
            --emerald-900: #064e3b;
            --amber-400: #fbbf24;
            --amber-500: #f59e0b;
            --amber-600: #d97706;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --red-500: #ef4444;
            --red-600: #dc2626;
        }

        .dark {
            --emerald-50: #064e3b;
            --emerald-100: #065f46;
            --gray-50: #111827;
            --gray-100: #1f2937;
            --gray-200: #374151;
            --gray-300: #4b5563;
            --gray-700: #d1d5db;
            --gray-800: #e5e7eb;
            --gray-900: #f9fafb;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Lexend', sans-serif;
            background: linear-gradient(135deg, var(--emerald-50) 0%, var(--gray-50) 100%);
            min-height: 100vh;
            color: var(--gray-900);
            padding: 20px;
            transition: background 0.3s ease;
        }

        .dark body {
            background: linear-gradient(135deg, #0a1f1a 0%, #0f1419 100%);
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            animation: fadeInDown 0.6s ease;
        }

        .header h1 {
            font-family: 'Outfit', sans-serif;
            font-weight: 900;
            font-size: clamp(2rem, 5vw, 3.5rem);
            background: linear-gradient(135deg, var(--emerald-600) 0%, var(--emerald-800) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            letter-spacing: -0.02em;
        }

        .header p {
            font-size: 18px;
            color: var(--gray-700);
            font-weight: 300;
        }

        .level-indicator {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            animation: fadeIn 0.6s ease 0.2s both;
        }

        .level-badge {
            padding: 12px 24px;
            border-radius: 50px;
            font-family: 'Outfit', sans-serif;
            font-weight: 600;
            font-size: 16px;
            border: 2px solid var(--gray-300);
            background: var(--gray-100);
            color: var(--gray-700);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .level-badge.unlocked {
            background: linear-gradient(135deg, var(--emerald-600) 0%, var(--emerald-700) 100%);
            border-color: var(--emerald-600);
            color: white;
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.4);
        }

        .level-badge.active {
            background: linear-gradient(135deg, var(--amber-500) 0%, var(--amber-600) 100%);
            border-color: var(--amber-500);
            color: white;
            box-shadow: 0 4px 20px rgba(245, 158, 11, 0.4);
            animation: pulse 2s infinite;
        }

        .progress-bar-container {
            background: var(--gray-200);
            border-radius: 50px;
            height: 12px;
            margin-bottom: 30px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
            animation: fadeIn 0.6s ease 0.3s both;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--emerald-500) 0%, var(--emerald-600) 100%);
            border-radius: 50px;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
        }

        .quiz-card {
            background: white;
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.08);
            margin-bottom: 20px;
            animation: fadeInUp 0.6s ease 0.4s both;
            border: 1px solid var(--gray-200);
        }

        .dark .quiz-card {
            background: #1a2332;
            border-color: #2d3748;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .question-number {
            font-family: 'Outfit', sans-serif;
            font-weight: 700;
            color: var(--emerald-600);
            font-size: 18px;
        }

        .score-display {
            font-family: 'Outfit', sans-serif;
            font-weight: 600;
            color: var(--gray-700);
            font-size: 18px;
        }

        .question-text {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 30px;
            line-height: 1.5;
            color: var(--gray-900);
        }

        .answers-grid {
            display: grid;
            gap: 15px;
            margin-bottom: 25px;
        }

        .answer-option {
            padding: 20px 24px;
            border: 2px solid var(--gray-300);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--gray-50);
            font-size: 18px;
            font-weight: 400;
            position: relative;
            overflow: hidden;
        }

        .answer-option:hover {
            border-color: var(--emerald-500);
            background: var(--emerald-50);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.15);
        }

        .answer-option.selected {
            border-color: var(--emerald-600);
            background: var(--emerald-100);
            font-weight: 600;
        }

        .answer-option.correct {
            border-color: var(--emerald-600);
            background: var(--emerald-500);
            color: white;
            animation: correctPulse 0.5s ease;
        }

        .answer-option.incorrect {
            border-color: var(--red-600);
            background: var(--red-500);
            color: white;
            animation: shake 0.5s ease;
        }

        .answer-option.disabled {
            pointer-events: none;
            opacity: 0.6;
        }

        .btn {
            padding: 16px 40px;
            border: none;
            border-radius: 50px;
            font-family: 'Outfit', sans-serif;
            font-weight: 700;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--emerald-600) 0%, var(--emerald-700) 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
            padding: 20px;
        }

        .modal {
            background: white;
            padding: 50px;
            border-radius: 24px;
            max-width: 500px;
            width: 100%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: scaleIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }

        .dark .modal {
            background: #1a2332;
        }

        .modal::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, var(--emerald-500) 0%, var(--amber-500) 100%);
        }

        .modal-icon {
            font-size: 80px;
            margin-bottom: 20px;
            animation: bounce 0.6s ease 0.3s both;
        }

        .modal h2 {
            font-family: 'Outfit', sans-serif;
            font-weight: 900;
            font-size: 32px;
            margin-bottom: 15px;
            color: var(--gray-900);
        }

        .modal p {
            font-size: 18px;
            color: var(--gray-700);
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-item {
            padding: 20px;
            background: var(--gray-50);
            border-radius: 16px;
            border: 2px solid var(--gray-200);
        }

        .dark .stat-item {
            background: #0f1419;
            border-color: #2d3748;
        }

        .stat-value {
            font-family: 'Outfit', sans-serif;
            font-weight: 900;
            font-size: 36px;
            color: var(--emerald-600);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: var(--gray-700);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 600;
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: var(--emerald-500);
            position: absolute;
            animation: confettiFall 3s linear forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        @keyframes confettiFall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        @media (max-width: 768px) {
            .quiz-card {
                padding: 25px;
            }

            .question-text {
                font-size: 19px;
            }

            .answer-option {
                padding: 16px 20px;
                font-size: 16px;
            }

            .modal {
                padding: 35px 25px;
            }

            .modal h2 {
                font-size: 26px;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Supply Theory Mastery</h1>
            <p>Progress through levels by mastering supply economics</p>
        </div>

        <div class="level-indicator" id="levelIndicator">
            <div class="level-badge active" data-level="5">Level 1: 5Q</div>
            <div class="level-badge" data-level="10">Level 2: 10Q</div>
            <div class="level-badge" data-level="20">Level 3: 20Q</div>
            <div class="level-badge" data-level="40">Level 4: 40Q</div>
        </div>

        <div class="progress-bar-container">
            <div class="progress-bar" id="progressBar" style="width: 0%"></div>
        </div>

        <div class="quiz-card" id="quizCard">
            <div class="question-header">
                <div class="question-number" id="questionNumber">Question 1 of 5</div>
                <div class="score-display" id="scoreDisplay">Score: 0/0</div>
            </div>

            <div class="question-text" id="questionText"></div>

            <div class="answers-grid" id="answersGrid"></div>

            <div class="button-group">
                <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()" disabled>Next Question</button>
            </div>
        </div>
    </div>

    <script>
        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // All 40 questions about Theory of Supply
        const allQuestions = [
            // Questions 1-5 (Level 1)
            {
                question: "What is the law of supply?",
                answers: [
                    "As price increases, quantity supplied decreases",
                    "As price increases, quantity supplied increases",
                    "Price and quantity supplied are not related",
                    "As demand increases, supply increases"
                ],
                correct: 1
            },
            {
                question: "Which factor would cause a movement along the supply curve?",
                answers: [
                    "Change in production costs",
                    "Change in technology",
                    "Change in the price of the good itself",
                    "Change in number of sellers"
                ],
                correct: 2
            },
            {
                question: "What does the supply curve typically show?",
                answers: [
                    "The relationship between price and demand",
                    "The relationship between price and quantity supplied",
                    "The relationship between income and consumption",
                    "The relationship between demand and quantity"
                ],
                correct: 1
            },
            {
                question: "If the price of raw materials increases, what happens to supply?",
                answers: [
                    "Supply increases (shifts right)",
                    "Supply decreases (shifts left)",
                    "Supply remains constant",
                    "Movement along the supply curve"
                ],
                correct: 1
            },
            {
                question: "A normal supply curve slopes:",
                answers: [
                    "Downward from left to right",
                    "Upward from left to right",
                    "Horizontally",
                    "Vertically"
                ],
                correct: 1
            },

            // Questions 6-10 (Level 2 addition)
            {
                question: "Which of the following would shift the supply curve to the right?",
                answers: [
                    "Increase in production costs",
                    "Improvement in technology",
                    "Decrease in number of sellers",
                    "Increase in taxes on producers"
                ],
                correct: 1
            },
            {
                question: "What is meant by 'quantity supplied'?",
                answers: [
                    "The amount producers are willing to sell at all prices",
                    "The amount producers are willing and able to sell at a specific price",
                    "The total amount produced in a year",
                    "The amount consumers want to buy"
                ],
                correct: 1
            },
            {
                question: "If sellers expect future prices to rise, what happens to current supply?",
                answers: [
                    "Current supply increases",
                    "Current supply decreases",
                    "No change in current supply",
                    "Supply becomes perfectly elastic"
                ],
                correct: 1
            },
            {
                question: "What is a subsidy's effect on supply?",
                answers: [
                    "Decreases supply (shifts left)",
                    "Increases supply (shifts right)",
                    "No effect on supply",
                    "Creates movement along supply curve"
                ],
                correct: 1
            },
            {
                question: "Which represents a change in supply (not quantity supplied)?",
                answers: [
                    "Price of the product changes",
                    "Technology improves",
                    "Consumers buy more",
                    "Market reaches equilibrium"
                ],
                correct: 1
            },

            // Questions 11-20 (Level 3 addition)
            {
                question: "What is producer surplus?",
                answers: [
                    "The difference between price paid and willingness to pay",
                    "The difference between market price and minimum price producers are willing to accept",
                    "The total revenue of producers",
                    "The profit after all costs are deducted"
                ],
                correct: 1
            },
            {
                question: "If wages of workers increase, what happens to supply?",
                answers: [
                    "Supply increases",
                    "Supply decreases",
                    "No change",
                    "Supply becomes perfectly inelastic"
                ],
                correct: 1
            },
            {
                question: "What does elasticity of supply measure?",
                answers: [
                    "How much demand changes with price",
                    "How responsive quantity supplied is to price changes",
                    "How quickly producers can enter the market",
                    "The steepness of the demand curve"
                ],
                correct: 1
            },
            {
                question: "When supply is perfectly inelastic, the supply curve is:",
                answers: [
                    "Horizontal",
                    "Vertical",
                    "Upward sloping",
                    "Downward sloping"
                ],
                correct: 1
            },
            {
                question: "Joint supply occurs when:",
                answers: [
                    "Two firms produce the same product",
                    "Production of one good automatically produces another",
                    "Two goods are consumed together",
                    "Supply curves intersect"
                ],
                correct: 1
            },
            {
                question: "What happens to supply if the number of sellers in a market increases?",
                answers: [
                    "Supply decreases",
                    "Supply increases",
                    "No change in supply",
                    "Demand increases"
                ],
                correct: 1
            },
            {
                question: "A tax on producers will:",
                answers: [
                    "Shift supply curve to the right",
                    "Shift supply curve to the left",
                    "Not affect the supply curve",
                    "Only affect demand"
                ],
                correct: 1
            },
            {
                question: "In the short run, supply is generally:",
                answers: [
                    "More elastic than in the long run",
                    "Less elastic than in the long run",
                    "Perfectly elastic",
                    "The same as in the long run"
                ],
                correct: 1
            },
            {
                question: "What is composite supply?",
                answers: [
                    "Supply from multiple sources",
                    "Supply of complementary goods",
                    "Supply that includes both goods and services",
                    "Supply curve with multiple segments"
                ],
                correct: 0
            },
            {
                question: "If producers become more efficient, the supply curve:",
                answers: [
                    "Shifts left",
                    "Shifts right",
                    "Becomes steeper",
                    "Becomes flatter"
                ],
                correct: 1
            },

            // Questions 21-40 (Level 4 addition)
            {
                question: "What determines the slope of the supply curve?",
                answers: [
                    "Consumer preferences",
                    "Producer responsiveness to price changes",
                    "Government regulations only",
                    "Market size"
                ],
                correct: 1
            },
            {
                question: "Competitive supply refers to:",
                answers: [
                    "Products that compete for the same resources",
                    "Products sold by competing firms",
                    "Products with similar prices",
                    "Products in perfect competition"
                ],
                correct: 0
            },
            {
                question: "What is the relationship between price and quantity supplied in the law of supply?",
                answers: [
                    "Inverse relationship",
                    "Direct (positive) relationship",
                    "No relationship",
                    "Exponential relationship"
                ],
                correct: 1
            },
            {
                question: "A perfectly elastic supply curve is:",
                answers: [
                    "Vertical",
                    "Horizontal",
                    "Upward sloping at 45 degrees",
                    "Downward sloping"
                ],
                correct: 1
            },
            {
                question: "What is individual supply?",
                answers: [
                    "Supply of a single unit",
                    "Supply from one producer",
                    "Supply to one consumer",
                    "Supply in a monopoly"
                ],
                correct: 1
            },
            {
                question: "Market supply is:",
                answers: [
                    "The sum of all individual supplies",
                    "The average of all individual supplies",
                    "The highest individual supply",
                    "Supply in a specific location"
                ],
                correct: 0
            },
            {
                question: "What happens to supply if production becomes more expensive?",
                answers: [
                    "Supply increases",
                    "Supply decreases",
                    "Quantity supplied increases",
                    "No change occurs"
                ],
                correct: 1
            },
            {
                question: "Which factor does NOT shift the supply curve?",
                answers: [
                    "Change in technology",
                    "Change in input prices",
                    "Change in the good's own price",
                    "Change in number of sellers"
                ],
                correct: 2
            },
            {
                question: "When supply increases, the supply curve:",
                answers: [
                    "Shifts to the left",
                    "Shifts to the right",
                    "Becomes steeper",
                    "Rotates clockwise"
                ],
                correct: 1
            },
            {
                question: "What is the main determinant of supply in the short run?",
                answers: [
                    "Variable costs and capacity constraints",
                    "Long-term contracts",
                    "Future expectations only",
                    "Historical data"
                ],
                correct: 0
            },
            {
                question: "Excess supply occurs when:",
                answers: [
                    "Price is below equilibrium",
                    "Price is above equilibrium",
                    "Demand equals supply",
                    "Markets are in equilibrium"
                ],
                correct: 1
            },
            {
                question: "What is the opportunity cost principle in supply?",
                answers: [
                    "The cost of the next best alternative forgone",
                    "The total cost of production",
                    "The market price of inputs",
                    "The accounting cost"
                ],
                correct: 0
            },
            {
                question: "Natural disasters that damage production facilities will:",
                answers: [
                    "Increase supply",
                    "Decrease supply",
                    "Not affect supply",
                    "Only affect demand"
                ],
                correct: 1
            },
            {
                question: "In the long run, supply is:",
                answers: [
                    "More elastic than short run",
                    "Less elastic than short run",
                    "Always perfectly inelastic",
                    "Always perfectly elastic"
                ],
                correct: 0
            },
            {
                question: "What is the minimum price producers need to supply a good called?",
                answers: [
                    "Market price",
                    "Equilibrium price",
                    "Reservation price",
                    "Ceiling price"
                ],
                correct: 2
            },
            {
                question: "If the price of a substitute in production rises, what happens to the supply of the original good?",
                answers: [
                    "Increases",
                    "Decreases",
                    "Remains unchanged",
                    "Becomes perfectly elastic"
                ],
                correct: 1
            },
            {
                question: "What does a backward-bending supply curve indicate?",
                answers: [
                    "Normal supply behavior",
                    "Beyond a certain point, higher prices lead to less quantity supplied",
                    "Supply is perfectly elastic",
                    "Production costs are increasing"
                ],
                correct: 1
            },
            {
                question: "Government regulations that increase production requirements will:",
                answers: [
                    "Shift supply right",
                    "Shift supply left",
                    "Not affect supply",
                    "Only affect demand"
                ],
                correct: 1
            },
            {
                question: "What is the supply schedule?",
                answers: [
                    "A graph showing supply",
                    "A table showing quantities supplied at different prices",
                    "The time it takes to produce goods",
                    "A production timeline"
                ],
                correct: 1
            },
            {
                question: "Which describes the relationship between individual and market supply?",
                answers: [
                    "They are identical",
                    "Market supply is the horizontal sum of individual supplies",
                    "Individual supply is larger than market supply",
                    "They are inversely related"
                ],
                correct: 1
            }
        ];

        // Game state
        let currentLevel = 5; // Start with 5 questions
        let unlockedLevel = 5;
        let currentQuestionIndex = 0;
        let score = 0;
        let totalAnswered = 0;
        let selectedAnswer = null;
        let currentQuestions = [];

        // Initialize game
        function initGame() {
            loadGameState();
            updateLevelIndicator();
            startLevel();
        }

        // Save game state (in-memory only in iframe environment)
        function saveGameState() {
            // Game state is maintained in memory during the session
            // In iframe environment, state persists only while page is loaded
        }

        // Load game state (in-memory only in iframe environment)
        function loadGameState() {
            // Initial state is set by variable initialization
            // State persists in memory during the session
        }

        // Update level indicator badges
        function updateLevelIndicator() {
            const badges = document.querySelectorAll('.level-badge');
            badges.forEach(badge => {
                const level = parseInt(badge.dataset.level);
                badge.classList.remove('active', 'unlocked');

                if (level === currentLevel) {
                    badge.classList.add('active');
                } else if (level <= unlockedLevel && level < currentLevel) {
                    badge.classList.add('unlocked');
                }
            });
        }

        // Start a level
        function startLevel() {
            currentQuestionIndex = 0;
            score = 0;
            totalAnswered = 0;

            // Get questions for current level
            currentQuestions = allQuestions.slice(0, currentLevel);

            // Shuffle questions
            currentQuestions = shuffleArray([...currentQuestions]);

            displayQuestion();
        }

        // Shuffle array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Display current question
        function displayQuestion() {
            const question = currentQuestions[currentQuestionIndex];
            selectedAnswer = null;

            document.getElementById('questionNumber').textContent = `Question ${currentQuestionIndex + 1} of ${currentLevel}`;
            document.getElementById('scoreDisplay').textContent = `Score: ${score}/${totalAnswered}`;
            document.getElementById('questionText').textContent = question.question;

            // Update progress bar
            const progress = (currentQuestionIndex / currentLevel) * 100;
            document.getElementById('progressBar').style.width = progress + '%';

            // Display answers
            const answersGrid = document.getElementById('answersGrid');
            answersGrid.innerHTML = '';

            question.answers.forEach((answer, index) => {
                const answerDiv = document.createElement('div');
                answerDiv.className = 'answer-option';
                answerDiv.textContent = answer;
                answerDiv.onclick = () => selectAnswer(index);
                answersGrid.appendChild(answerDiv);
            });

            document.getElementById('nextBtn').disabled = true;
        }

        // Select an answer
        function selectAnswer(index) {
            if (selectedAnswer !== null) return; // Already answered

            selectedAnswer = index;
            const question = currentQuestions[currentQuestionIndex];
            const answerOptions = document.querySelectorAll('.answer-option');

            answerOptions.forEach(option => option.classList.add('disabled'));

            if (index === question.correct) {
                answerOptions[index].classList.add('correct');
                score++;
            } else {
                answerOptions[index].classList.add('incorrect');
                answerOptions[question.correct].classList.add('correct');
            }

            totalAnswered++;
            document.getElementById('nextBtn').disabled = false;
        }

        // Next question
        function nextQuestion() {
            currentQuestionIndex++;

            if (currentQuestionIndex < currentLevel) {
                displayQuestion();
            } else {
                endLevel();
            }
        }

        // End level and show results
        function endLevel() {
            const percentage = (score / currentLevel) * 100;
            const isPerfectScore = score === currentLevel;

            // Update progress bar to 100%
            document.getElementById('progressBar').style.width = '100%';

            // Determine next level
            let nextLevel = null;
            let canUnlock = false;

            if (isPerfectScore) {
                if (currentLevel === 5) {
                    nextLevel = 10;
                    canUnlock = true;
                } else if (currentLevel === 10) {
                    nextLevel = 20;
                    canUnlock = true;
                } else if (currentLevel === 20) {
                    nextLevel = 40;
                    canUnlock = true;
                }

                if (canUnlock && nextLevel && nextLevel > unlockedLevel) {
                    unlockedLevel = nextLevel;
                    saveGameState();
                }
            }

            showResultModal(isPerfectScore, nextLevel, canUnlock);
        }

        // Show result modal
        function showResultModal(isPerfectScore, nextLevel, canUnlock) {
            const overlay = document.createElement('div');
            overlay.className = 'modal-overlay';

            let icon = '';
            let title = '';
            let message = '';
            let buttons = '';

            if (isPerfectScore && canUnlock && nextLevel) {
                icon = 'üèÜ';
                title = 'Perfect Score!';
                message = `Congratulations! You've unlocked Level ${nextLevel === 10 ? '2' : nextLevel === 20 ? '3' : '4'} with ${nextLevel} questions!`;
                buttons = `
                    <button class="btn btn-primary" onclick="advanceToLevel(${nextLevel})">Continue to Level ${nextLevel === 10 ? '2' : nextLevel === 20 ? '3' : '4'}</button>
                    <button class="btn btn-primary" onclick="retryLevel()" style="background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);">Retry Current Level</button>
                `;
                createConfetti();
            } else if (isPerfectScore && !canUnlock) {
                icon = 'üéâ';
                title = 'Perfect Score!';
                message = `Amazing! You've mastered all ${currentLevel} questions! You're a supply theory expert!`;
                buttons = `
                    <button class="btn btn-primary" onclick="retryLevel()">Play Again</button>
                `;
                createConfetti();
            } else {
                icon = 'üìö';
                title = 'Keep Learning!';
                message = `You scored ${score}/${currentLevel}. You need a perfect score to unlock the next level. Review the concepts and try again!`;
                buttons = `
                    <button class="btn btn-primary" onclick="retryLevel()">Try Again</button>
                `;
            }

            overlay.innerHTML = `
                <div class="modal">
                    <div class="modal-icon">${icon}</div>
                    <h2>${title}</h2>
                    <p>${message}</p>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value">${score}</div>
                            <div class="stat-label">Correct</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${currentLevel - score}</div>
                            <div class="stat-label">Incorrect</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${Math.round((score/currentLevel)*100)}%</div>
                            <div class="stat-label">Score</div>
                        </div>
                    </div>
                    <div class="button-group">
                        ${buttons}
                    </div>
                </div>
            `;

            document.body.appendChild(overlay);
        }

        // Create confetti effect
        function createConfetti() {
            const colors = ['#10b981', '#f59e0b', '#3b82f6', '#ec4899', '#8b5cf6'];
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 3 + 's';
                    document.body.appendChild(confetti);

                    setTimeout(() => confetti.remove(), 3000);
                }, i * 30);
            }
        }

        // Advance to next level
        function advanceToLevel(level) {
            currentLevel = level;
            saveGameState();
            closeModal();
            updateLevelIndicator();
            startLevel();
        }

        // Retry current level
        function retryLevel() {
            closeModal();
            startLevel();
        }

        // Close modal
        function closeModal() {
            const modal = document.querySelector('.modal-overlay');
            if (modal) {
                modal.remove();
            }
        }

        // Initialize game on load
        initGame();
    </script>
</body>
</html>
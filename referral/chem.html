<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PubChem Molecule Comparison Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        'roboto': ['Roboto', 'sans-serif'],
                    },
                    colors: {
                        primary: {
                            50: '#ecfeff',
                            100: '#cffafe',
                            200: '#a5f3fc',
                            300: '#67e8f9',
                            400: '#22d3ee',
                            500: '#06b6d4',
                            600: '#0891b2',
                            700: '#0e7490',
                            800: '#155e75',
                            900: '#164e63',
                        },
                        secondary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
        }

        .loading-spinner {
            border: 3px solid rgba(6, 182, 212, 0.3);
            border-radius: 50%;
            border-top: 3px solid #06b6d4;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .molecule-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .molecule-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(6, 182, 212, 0.15);
        }

        .property-row {
            transition: background-color 0.2s;
        }

        .property-row:hover {
            background-color: rgba(6, 182, 212, 0.05);
        }

        .dark .property-row:hover {
            background-color: rgba(6, 182, 212, 0.1);
        }

        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-cyan-50 to-blue-50 dark:from-gray-900 dark:to-gray-800 min-h-screen">
    <!-- Header -->
    <header class="bg-white dark:bg-gray-800 shadow-md">
        <div class="container mx-auto px-4 py-6">
            <h1 class="text-3xl md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-primary-600 to-secondary-600">
                ðŸ§ª Molecule Comparison Tool
            </h1>
            <p class="text-gray-600 dark:text-gray-300 mt-2 text-base">Compare chemical compounds from PubChem database</p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Search Section -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 mb-8 fade-in">
            <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-100 mb-4">Add Compound to Compare</h2>
            <div class="flex flex-col md:flex-row gap-4">
                <input
                    type="text"
                    id="searchInput"
                    placeholder="Enter compound name (e.g., aspirin, caffeine, glucose)"
                    class="flex-1 px-4 py-3 text-base border-2 border-primary-300 dark:border-primary-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:text-gray-100 transition"
                >
                <button
                    id="searchBtn"
                    class="px-8 py-3 bg-gradient-to-r from-primary-600 to-secondary-600 text-white font-medium rounded-lg hover:from-primary-700 hover:to-secondary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 transition transform hover:scale-105 active:scale-95"
                >
                    Add Compound
                </button>
            </div>
            <div id="searchStatus" class="mt-4 text-base"></div>
        </div>

        <!-- Comparison Grid -->
        <div id="comparisonGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Molecule cards will be added here -->
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="text-center py-16 fade-in">
            <div class="text-6xl mb-4">ðŸ”¬</div>
            <h3 class="text-2xl font-semibold text-gray-700 dark:text-gray-300 mb-2">Loading Example...</h3>
            <p class="text-gray-500 dark:text-gray-400 text-lg">Please wait</p>
        </div>
    </main>

    <script>
        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const searchStatus = document.getElementById('searchStatus');
        const comparisonGrid = document.getElementById('comparisonGrid');
        const emptyState = document.getElementById('emptyState');

        let compounds = [];

        // Enter key support
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchBtn.click();
            }
        });

        // Search button click handler
        searchBtn.addEventListener('click', async () => {
            const query = searchInput.value.trim();
            if (!query) {
                showStatus('Please enter a compound name', 'error');
                return;
            }

            await searchCompound(query);
        });

        // Show status message
        function showStatus(message, type = 'info') {
            const colors = {
                info: 'text-primary-600 dark:text-primary-400',
                error: 'text-red-600 dark:text-red-400',
                success: 'text-green-600 dark:text-green-400'
            };
            searchStatus.innerHTML = `<p class="${colors[type]} font-medium">${message}</p>`;
        }

        // Search for compound in PubChem
        async function searchCompound(name) {
            showStatus('Searching for compound...', 'info');
            searchBtn.disabled = true;
            searchBtn.innerHTML = '<div class="loading-spinner mx-auto"></div>';

            try {
                // First, get the CID from compound name
                const cidResponse = await fetch(
                    `https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/name/${encodeURIComponent(name)}/cids/JSON`
                );

                if (!cidResponse.ok) {
                    throw new Error('Compound not found');
                }

                const cidData = await cidResponse.json();
                const cid = cidData.IdentifierList.CID[0];

                // Check if compound already added
                if (compounds.some(c => c.cid === cid)) {
                    showStatus('This compound is already in the comparison', 'error');
                    return;
                }

                // Get compound properties
                const propsResponse = await fetch(
                    `https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/${cid}/property/MolecularFormula,MolecularWeight,IUPACName,CanonicalSMILES,IsomericSMILES,InChI,InChIKey,XLogP,ExactMass,MonoisotopicMass,TPSA,Complexity,Charge,HBondDonorCount,HBondAcceptorCount,RotatableBondCount/JSON`
                );

                const propsData = await propsResponse.json();
                const properties = propsData.PropertyTable.Properties[0];

                // Get synonyms (common names)
                const synonymsResponse = await fetch(
                    `https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/${cid}/synonyms/JSON`
                );
                const synonymsData = await synonymsResponse.json();
                const synonyms = synonymsData.InformationList.Information[0].Synonym.slice(0, 3);

                const compound = {
                    cid: cid,
                    name: synonyms[0],
                    synonyms: synonyms,
                    ...properties
                };

                compounds.push(compound);
                renderCompounds();
                searchInput.value = '';
                showStatus(`Successfully added ${compound.name}`, 'success');

            } catch (error) {
                showStatus(`Error: ${error.message}. Please try another compound.`, 'error');
            } finally {
                searchBtn.disabled = false;
                searchBtn.innerHTML = 'Add Compound';
            }
        }

        // Remove compound
        function removeCompound(cid) {
            compounds = compounds.filter(c => c.cid !== cid);
            renderCompounds();
            if (compounds.length === 0) {
                showStatus('', 'info');
            }
        }

        // Render all compounds
        function renderCompounds() {
            if (compounds.length === 0) {
                emptyState.style.display = 'block';
                comparisonGrid.innerHTML = '';
                return;
            }

            emptyState.style.display = 'none';

            comparisonGrid.innerHTML = compounds.map(compound => `
                <div class="molecule-card bg-white dark:bg-gray-800 rounded-2xl shadow-lg overflow-hidden fade-in">
                    <!-- Header -->
                    <div class="bg-gradient-to-r from-primary-600 to-secondary-600 p-4">
                        <div class="flex justify-between items-start">
                            <h3 class="text-xl font-bold text-white break-words flex-1">${compound.name}</h3>
                            <button
                                onclick="removeCompound(${compound.cid})"
                                class="ml-2 text-white hover:text-red-200 transition text-2xl leading-none"
                                title="Remove compound"
                            >Ã—</button>
                        </div>
                        <p class="text-primary-100 text-sm mt-1">CID: ${compound.cid}</p>
                    </div>

                    <!-- Structure Image -->
                    <div class="p-4 bg-gray-50 dark:bg-gray-700 flex justify-center">
                        <img
                            src="https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/${compound.cid}/PNG"
                            alt="${compound.name} structure"
                            class="max-w-full h-48 object-contain"
                            onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%23999%22%3ENo Image%3C/text%3E%3C/svg%3E'"
                        />
                    </div>

                    <!-- Properties -->
                    <div class="p-4">
                        <h4 class="font-semibold text-lg text-gray-800 dark:text-gray-100 mb-3">Properties</h4>
                        <div class="space-y-2 text-sm">
                            ${renderProperty('Molecular Formula', compound.MolecularFormula)}
                            ${renderProperty('Molecular Weight', compound.MolecularWeight ? `${parseFloat(compound.MolecularWeight).toFixed(2)} g/mol` : 'N/A')}
                            ${renderProperty('Exact Mass', compound.ExactMass ? `${parseFloat(compound.ExactMass).toFixed(4)} g/mol` : 'N/A')}
                            ${renderProperty('XLogP', compound.XLogP ?? 'N/A')}
                            ${renderProperty('H-Bond Donors', compound.HBondDonorCount ?? 'N/A')}
                            ${renderProperty('H-Bond Acceptors', compound.HBondAcceptorCount ?? 'N/A')}
                            ${renderProperty('Rotatable Bonds', compound.RotatableBondCount ?? 'N/A')}
                            ${renderProperty('TPSA', compound.TPSA ? `${parseFloat(compound.TPSA).toFixed(2)} Å²` : 'N/A')}
                            ${renderProperty('Complexity', compound.Complexity ? parseFloat(compound.Complexity).toFixed(1) : 'N/A')}
                            ${renderProperty('Charge', compound.Charge ?? '0')}
                        </div>

                        <!-- Synonyms -->
                        ${compound.synonyms && compound.synonyms.length > 1 ? `
                            <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                                <h5 class="font-semibold text-sm text-gray-700 dark:text-gray-300 mb-2">Also Known As:</h5>
                                <div class="flex flex-wrap gap-2">
                                    ${compound.synonyms.slice(1).map(syn => `
                                        <span class="px-2 py-1 bg-primary-100 dark:bg-primary-900 text-primary-700 dark:text-primary-300 rounded-full text-xs">
                                            ${syn.length > 20 ? syn.substring(0, 20) + '...' : syn}
                                        </span>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}

                        <!-- IUPAC Name -->
                        ${compound.IUPACName ? `
                            <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                                <h5 class="font-semibold text-sm text-gray-700 dark:text-gray-300 mb-1">IUPAC Name:</h5>
                                <p class="text-xs text-gray-600 dark:text-gray-400 break-words">${compound.IUPACName}</p>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        // Helper function to render a property row
        function renderProperty(label, value) {
            return `
                <div class="property-row flex justify-between py-2 px-3 rounded">
                    <span class="font-medium text-gray-700 dark:text-gray-300">${label}:</span>
                    <span class="text-gray-600 dark:text-gray-400 text-right">${value}</span>
                </div>
            `;
        }

        // Load an example compound on startup
        async function loadExampleCompound() {
            await searchCompound('caffeine');
        }

        // Initial render and load example
        renderCompounds();
        loadExampleCompound();
    </script>
</body>
</html>


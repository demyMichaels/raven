<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game State Snapshot - Random Pointer Cloning</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes pulse-glow {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
        .pulse-glow {
            animation: pulse-glow 2s ease-in-out infinite;
        }

        .arrow {
            stroke-width: 2;
            fill: none;
            transition: all 0.3s;
        }

        .arrow-next {
            stroke: #5D5CDE;
        }

        .arrow-random {
            stroke: #EF4444;
            stroke-dasharray: 5, 5;
        }

        .node-card {
            transition: all 0.3s;
        }

        .node-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(93, 92, 222, 0.3);
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen transition-colors">
    <!-- Dark mode setup -->
    <script>
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>

    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 dark:text-white mb-3">üéÆ Game State Snapshot System</h1>
            <p class="text-lg text-gray-600 dark:text-gray-300 mb-2">Deep Cloning with Random Pointers Algorithm</p>
            <p class="text-base text-gray-500 dark:text-gray-400">Modify game objects, save snapshots, and restore previous states</p>
        </div>

        <!-- Algorithm Explanation -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-4">üìã How It Works</h2>
            <div class="grid md:grid-cols-2 gap-4">
                <div class="space-y-3">
                    <div class="flex items-start">
                        <span class="bg-primary text-white rounded-full w-8 h-8 flex items-center justify-center font-bold mr-3 flex-shrink-0">1</span>
                        <div>
                            <h3 class="font-semibold text-gray-800 dark:text-white">First Scan - Create Nodes</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-300">Create new node Y for each original node X, store pair (X, Y) in hash table</p>
                        </div>
                    </div>
                    <div class="flex items-start">
                        <span class="bg-primary text-white rounded-full w-8 h-8 flex items-center justify-center font-bold mr-3 flex-shrink-0">2</span>
                        <div>
                            <h3 class="font-semibold text-gray-800 dark:text-white">Second Scan - Set Pointers</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-300">Use hash table to set next and random pointers in the cloned list</p>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                    <h3 class="font-semibold text-gray-800 dark:text-white mb-2">Legend</h3>
                    <div class="space-y-2 text-sm">
                        <div class="flex items-center">
                            <div class="w-12 h-0.5 bg-primary mr-2"></div>
                            <span class="text-gray-700 dark:text-gray-300">Next Pointer (sequential)</span>
                        </div>
                        <div class="flex items-center">
                            <div class="w-12 h-0.5 bg-red-500 mr-2" style="border-top: 2px dashed"></div>
                            <span class="text-gray-700 dark:text-gray-300">Random Pointer (arbitrary)</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Control Panel -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-4">üéØ Game Controls</h2>
            <div class="flex flex-wrap gap-3">
                <button onclick="createSnapshot()" class="bg-primary hover:bg-purple-700 text-white font-semibold py-3 px-6 rounded-lg transition-all transform hover:scale-105 shadow-md">
                    üíæ Save Snapshot
                </button>
                <button onclick="restoreSnapshot()" id="restoreBtn" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-3 px-6 rounded-lg transition-all transform hover:scale-105 shadow-md disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    ‚Ü©Ô∏è Restore Snapshot
                </button>
                <button onclick="randomizeState()" class="bg-orange-500 hover:bg-orange-600 text-white font-semibold py-3 px-6 rounded-lg transition-all transform hover:scale-105 shadow-md">
                    üé≤ Randomize State
                </button>
                <button onclick="resetGame()" class="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-3 px-6 rounded-lg transition-all transform hover:scale-105 shadow-md">
                    üîÑ Reset Game
                </button>
            </div>
            <div id="snapshotInfo" class="mt-4 text-sm text-gray-600 dark:text-gray-400"></div>
        </div>

        <!-- Game State Visualization -->
        <div class="grid lg:grid-cols-2 gap-6 mb-6">
            <!-- Current State -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-4">
                    üéÆ Current Game State
                </h2>
                <div id="currentState" class="space-y-4"></div>
            </div>

            <!-- Snapshot State -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-4">
                    üì∏ Saved Snapshot
                </h2>
                <div id="snapshotState" class="space-y-4">
                    <p class="text-gray-500 dark:text-gray-400 text-center py-8">No snapshot saved yet</p>
                </div>
            </div>
        </div>

        <!-- Algorithm Visualization -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
            <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-4">üîç Algorithm Hash Table (Last Snapshot)</h2>
            <div id="hashTable" class="overflow-x-auto">
                <p class="text-gray-500 dark:text-gray-400 text-center py-8">Create a snapshot to see the hash table</p>
            </div>
        </div>
    </div>

    <script>
        // Game Node class
        class GameNode {
            constructor(type, name, health, x, y) {
                this.type = type; // 'player', 'enemy', 'item', 'location'
                this.name = name;
                this.health = health;
                this.x = x;
                this.y = y;
                this.next = null;
                this.random = null; // Can point to any node (ally, enemy, location, etc.)
            }

            clone() {
                const newNode = new GameNode(this.type, this.name, this.health, this.x, this.y);
                return newNode;
            }
        }

        // Game State Manager
        let gameHead = null;
        let snapshotHead = null;
        let lastHashTable = null;

        // Initialize game
        function initializeGame() {
            // Create interconnected game objects
            const player = new GameNode('player', 'Hero', 100, 50, 50);
            const enemy1 = new GameNode('enemy', 'Goblin', 50, 120, 80);
            const enemy2 = new GameNode('enemy', 'Orc', 80, 200, 60);
            const item = new GameNode('item', 'Health Potion', 0, 150, 120);
            const location = new GameNode('location', 'Castle', 0, 100, 100);

            // Set next pointers (sequential)
            player.next = enemy1;
            enemy1.next = enemy2;
            enemy2.next = item;
            item.next = location;
            location.next = null;

            // Set random pointers (arbitrary relationships)
            player.random = location; // Player's target location
            enemy1.random = player; // Goblin targets player
            enemy2.random = player; // Orc targets player
            item.random = player; // Potion is for player
            location.random = enemy2; // Boss at castle

            gameHead = player;
            renderCurrentState();
        }

        // Deep clone algorithm using hash table
        function cloneLinkedListWithRandomPointers(head) {
            if (!head) return null;

            const hashTable = new Map();
            lastHashTable = hashTable; // Store for visualization

            // First scan: Create new nodes and store in hash table
            let current = head;
            while (current) {
                const newNode = current.clone();
                hashTable.set(current, newNode);
                current = current.next;
            }

            // Second scan: Set next and random pointers
            current = head;
            while (current) {
                const clonedNode = hashTable.get(current);
                clonedNode.next = current.next ? hashTable.get(current.next) : null;
                clonedNode.random = current.random ? hashTable.get(current.random) : null;
                current = current.next;
            }

            return hashTable.get(head);
        }

        // Create snapshot
        function createSnapshot() {
            if (!gameHead) {
                showNotification('No game state to snapshot!', 'error');
                return;
            }

            snapshotHead = cloneLinkedListWithRandomPointers(gameHead);
            document.getElementById('restoreBtn').disabled = false;

            renderSnapshotState();
            renderHashTable();

            const snapshotTime = new Date().toLocaleTimeString();
            document.getElementById('snapshotInfo').innerHTML = `
                <div class="bg-green-100 dark:bg-green-900 border border-green-400 text-green-700 dark:text-green-300 px-4 py-3 rounded">
                    ‚úÖ Snapshot created at ${snapshotTime}
                </div>
            `;

            showNotification('Snapshot saved successfully!', 'success');
        }

        // Restore snapshot
        function restoreSnapshot() {
            if (!snapshotHead) {
                showNotification('No snapshot to restore!', 'error');
                return;
            }

            gameHead = cloneLinkedListWithRandomPointers(snapshotHead);
            renderCurrentState();
            showNotification('Game state restored!', 'success');
        }

        // Randomize current state
        function randomizeState() {
            let current = gameHead;
            while (current) {
                if (current.type !== 'location') {
                    current.health = Math.floor(Math.random() * 100) + 1;
                }
                current.x = Math.floor(Math.random() * 250) + 20;
                current.y = Math.floor(Math.random() * 150) + 20;
                current = current.next;
            }
            renderCurrentState();
            showNotification('Game state randomized!', 'info');
        }

        // Reset game
        function resetGame() {
            initializeGame();
            snapshotHead = null;
            lastHashTable = null;
            document.getElementById('restoreBtn').disabled = true;
            document.getElementById('snapshotInfo').innerHTML = '';
            document.getElementById('hashTable').innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8">Create a snapshot to see the hash table</p>';
            renderSnapshotState();
            showNotification('Game reset!', 'info');
        }

        // Render current state
        function renderCurrentState() {
            renderState(gameHead, 'currentState');
        }

        // Render snapshot state
        function renderSnapshotState() {
            if (!snapshotHead) {
                document.getElementById('snapshotState').innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8">No snapshot saved yet</p>';
                return;
            }
            renderState(snapshotHead, 'snapshotState');
        }

        // Render state helper
        function renderState(head, elementId) {
            const container = document.getElementById(elementId);
            if (!head) {
                container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8">No game state</p>';
                return;
            }

            let html = '';
            let current = head;
            let index = 0;
            const nodes = [];

            // Collect all nodes
            while (current) {
                nodes.push(current);
                current = current.next;
            }

            // Render nodes
            nodes.forEach((node, idx) => {
                const icon = getNodeIcon(node.type);
                const color = getNodeColor(node.type);
                const nextLabel = node.next ? node.next.name : 'null';
                const randomLabel = node.random ? node.random.name : 'null';

                html += `
                    <div class="node-card bg-gradient-to-br ${color} rounded-lg p-4 shadow-md border-2 border-gray-200 dark:border-gray-600">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center">
                                <span class="text-3xl mr-3">${icon}</span>
                                <div>
                                    <h3 class="font-bold text-gray-800 dark:text-white text-lg">${node.name}</h3>
                                    <span class="text-xs text-gray-600 dark:text-gray-300 uppercase">${node.type}</span>
                                </div>
                            </div>
                            ${node.type !== 'location' && node.type !== 'item' ? `
                                <div class="text-right">
                                    <div class="text-sm font-semibold text-gray-700 dark:text-gray-300">HP</div>
                                    <div class="text-xl font-bold text-gray-900 dark:text-white">${node.health}</div>
                                </div>
                            ` : ''}
                        </div>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div class="bg-white dark:bg-gray-700 rounded p-2">
                                <div class="text-xs text-gray-500 dark:text-gray-400">Position</div>
                                <div class="font-semibold text-gray-800 dark:text-white">(${node.x}, ${node.y})</div>
                            </div>
                            <div class="bg-white dark:bg-gray-700 rounded p-2">
                                <div class="text-xs text-gray-500 dark:text-gray-400">Next ‚Üí</div>
                                <div class="font-semibold text-primary">${nextLabel}</div>
                            </div>
                        </div>
                        <div class="mt-2 bg-white dark:bg-gray-700 rounded p-2">
                            <div class="text-xs text-gray-500 dark:text-gray-400">Random Link ‚§ø</div>
                            <div class="font-semibold text-red-500">${randomLabel}</div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Render hash table
        function renderHashTable() {
            if (!lastHashTable) return;

            let html = '<div class="overflow-x-auto"><table class="w-full text-sm">';
            html += '<thead class="bg-gray-100 dark:bg-gray-700"><tr>';
            html += '<th class="px-4 py-3 text-left text-gray-700 dark:text-gray-300 font-semibold">Original Node (X)</th>';
            html += '<th class="px-4 py-3 text-left text-gray-700 dark:text-gray-300 font-semibold">Cloned Node (Y)</th>';
            html += '<th class="px-4 py-3 text-left text-gray-700 dark:text-gray-300 font-semibold">Y.next</th>';
            html += '<th class="px-4 py-3 text-left text-gray-700 dark:text-gray-300 font-semibold">Y.random</th>';
            html += '</tr></thead><tbody>';

            let current = gameHead;
            while (current) {
                const cloned = lastHashTable.get(current);
                const icon = getNodeIcon(current.type);

                html += '<tr class="border-b border-gray-200 dark:border-gray-600">';
                html += `<td class="px-4 py-3 text-gray-800 dark:text-white">${icon} ${current.name} (HP: ${current.health})</td>`;
                html += `<td class="px-4 py-3 text-gray-800 dark:text-white">${icon} ${cloned.name} (HP: ${cloned.health})</td>`;
                html += `<td class="px-4 py-3 text-primary font-semibold">${cloned.next ? cloned.next.name : 'null'}</td>`;
                html += `<td class="px-4 py-3 text-red-500 font-semibold">${cloned.random ? cloned.random.name : 'null'}</td>`;
                html += '</tr>';

                current = current.next;
            }

            html += '</tbody></table></div>';
            document.getElementById('hashTable').innerHTML = html;
        }

        // Helper functions
        function getNodeIcon(type) {
            const icons = {
                'player': 'ü¶∏',
                'enemy': 'üëæ',
                'item': 'üíä',
                'location': 'üè∞'
            };
            return icons[type] || '‚ùì';
        }

        function getNodeColor(type) {
            const colors = {
                'player': 'from-blue-100 to-blue-200 dark:from-blue-900 dark:to-blue-800',
                'enemy': 'from-red-100 to-red-200 dark:from-red-900 dark:to-red-800',
                'item': 'from-green-100 to-green-200 dark:from-green-900 dark:to-green-800',
                'location': 'from-purple-100 to-purple-200 dark:from-purple-900 dark:to-purple-800'
            };
            return colors[type] || 'from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-600';
        }

        function showNotification(message, type) {
            // Custom notification instead of alert()
            const notification = document.createElement('div');
            const colors = {
                'success': 'bg-green-500',
                'error': 'bg-red-500',
                'info': 'bg-blue-500'
            };

            notification.className = `fixed top-4 right-4 ${colors[type]} text-white px-6 py-4 rounded-lg shadow-lg z-50 transform transition-all duration-300`;
            notification.textContent = message;
            notification.style.opacity = '0';
            notification.style.transform = 'translateY(-20px)';

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.opacity = '1';
                notification.style.transform = 'translateY(0)';
            }, 10);

            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateY(-20px)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Initialize on load
        window.addEventListener('load', () => {
            initializeGame();
        });
    </script>
</body>
</html>

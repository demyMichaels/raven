<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Gauntlet Run - Arsenal</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0a0a0c;
            --bg-panel: #12141a;
            --accent-orange: #ff6b2c;
            --accent-amber: #ffaa00;
            --accent-red: #ff3333;
            --text-primary: #e8e8e8;
            --text-secondary: #888899;
            --border-glow: rgba(255, 107, 44, 0.3);
            --grid-color: rgba(255, 170, 0, 0.08);
        }

        .dark {
            --bg-dark: #0a0a0c;
            --bg-panel: #12141a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Share Tech Mono', monospace;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .bg-grid {
            position: fixed;
            inset: 0;
            background-image:
                linear-gradient(var(--grid-color) 1px, transparent 1px),
                linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
            background-size: 40px 40px;
            pointer-events: none;
            z-index: 0;
        }

        .bg-vignette {
            position: fixed;
            inset: 0;
            background: radial-gradient(ellipse at center, transparent 0%, var(--bg-dark) 80%);
            pointer-events: none;
            z-index: 1;
        }

        .container {
            position: relative;
            z-index: 2;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0 40px;
            border-bottom: 1px solid var(--border-glow);
            margin-bottom: 30px;
        }

        .title {
            font-family: 'Orbitron', sans-serif;
            font-size: clamp(1.8rem, 5vw, 3rem);
            font-weight: 900;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            background: linear-gradient(135deg, var(--accent-orange) 0%, var(--accent-amber) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 60px rgba(255, 107, 44, 0.5);
            animation: titlePulse 3s ease-in-out infinite;
        }

        @keyframes titlePulse {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .subtitle {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 10px;
            letter-spacing: 0.3em;
        }

        .weapon-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }

        .weapon-tab {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.85rem;
            padding: 12px 24px;
            background: var(--bg-panel);
            border: 1px solid rgba(255, 107, 44, 0.2);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            position: relative;
            overflow: hidden;
        }

        .weapon-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 107, 44, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .weapon-tab:hover::before {
            left: 100%;
        }

        .weapon-tab:hover {
            border-color: var(--accent-orange);
            color: var(--text-primary);
        }

        .weapon-tab.active {
            background: linear-gradient(135deg, rgba(255, 107, 44, 0.2) 0%, rgba(255, 170, 0, 0.1) 100%);
            border-color: var(--accent-orange);
            color: var(--accent-amber);
            box-shadow: 0 0 30px rgba(255, 107, 44, 0.3), inset 0 0 20px rgba(255, 107, 44, 0.1);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: var(--bg-panel);
            border: 1px solid rgba(255, 107, 44, 0.15);
            padding: 25px;
            position: relative;
        }

        .panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, var(--accent-orange), var(--accent-amber), transparent);
        }

        .panel-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.75rem;
            color: var(--accent-orange);
            letter-spacing: 0.2em;
            margin-bottom: 20px;
            text-transform: uppercase;
        }

        .weapon-display {
            text-align: center;
            padding: 20px 0;
        }

        .weapon-name {
            font-family: 'Orbitron', sans-serif;
            font-size: clamp(1.5rem, 4vw, 2.2rem);
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .weapon-designation {
            font-size: 1rem;
            color: var(--accent-amber);
            margin-bottom: 25px;
        }

        .weapon-silhouette {
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
            position: relative;
        }

        .weapon-svg {
            max-width: 100%;
            height: 100%;
            filter: drop-shadow(0 0 20px rgba(255, 107, 44, 0.4));
            transition: transform 0.3s ease;
        }

        .weapon-svg:hover {
            transform: scale(1.05);
        }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-left: 2px solid var(--accent-orange);
        }

        .stat-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            letter-spacing: 0.15em;
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        .stat-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
            color: var(--accent-amber);
        }

        .stat-bar-container {
            margin-top: 8px;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            overflow: hidden;
        }

        .stat-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-orange), var(--accent-amber));
            transition: width 0.6s ease;
        }

        .role-description {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-left: 3px solid var(--accent-amber);
            margin-top: 20px;
        }

        .role-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem;
            color: var(--accent-amber);
            margin-bottom: 10px;
        }

        .role-text {
            font-size: 0.85rem;
            line-height: 1.6;
            color: var(--text-secondary);
        }

        .tradeoff {
            margin-top: 15px;
            padding: 10px;
            background: rgba(255, 51, 51, 0.1);
            border-left: 2px solid var(--accent-red);
        }

        .tradeoff-label {
            font-size: 0.7rem;
            color: var(--accent-red);
            letter-spacing: 0.1em;
            margin-bottom: 5px;
        }

        .tradeoff-text {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* Firing Range */
        .firing-range {
            height: 350px;
            background: linear-gradient(180deg, #0d0d10 0%, #151820 100%);
            border: 1px solid rgba(255, 107, 44, 0.1);
            position: relative;
            overflow: hidden;
            cursor: crosshair;
        }

        .range-grid {
            position: absolute;
            inset: 0;
            background-image:
                linear-gradient(rgba(255, 170, 0, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 170, 0, 0.03) 1px, transparent 1px);
            background-size: 25px 25px;
        }

        .crosshair {
            position: absolute;
            width: 40px;
            height: 40px;
            pointer-events: none;
            transform: translate(-50%, -50%);
            transition: transform 0.05s ease-out;
            z-index: 10;
        }

        .crosshair::before,
        .crosshair::after {
            content: '';
            position: absolute;
            background: var(--accent-orange);
            box-shadow: 0 0 10px var(--accent-orange);
        }

        .crosshair::before {
            width: 2px;
            height: 100%;
            left: 50%;
            transform: translateX(-50%);
        }

        .crosshair::after {
            height: 2px;
            width: 100%;
            top: 50%;
            transform: translateY(-50%);
        }

        .crosshair-dot {
            position: absolute;
            width: 6px;
            height: 6px;
            background: var(--accent-amber);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 10px var(--accent-amber);
        }

        .muzzle-flash {
            position: absolute;
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, rgba(255, 200, 100, 0.9) 0%, rgba(255, 107, 44, 0.5) 30%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
            opacity: 0;
            transform: translate(-50%, -50%);
            z-index: 5;
        }

        .muzzle-flash.fire {
            animation: flashBurst 0.08s ease-out;
        }

        @keyframes flashBurst {
            0% { opacity: 1; transform: translate(-50%, -50%) scale(0.5); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1.5); }
        }

        .bullet-trail {
            position: absolute;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-amber), transparent);
            transform-origin: left center;
            pointer-events: none;
            z-index: 4;
        }

        .impact {
            position: absolute;
            width: 20px;
            height: 20px;
            pointer-events: none;
            z-index: 6;
        }

        .impact::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle, var(--accent-amber) 0%, transparent 70%);
            border-radius: 50%;
            animation: impactFade 0.4s ease-out forwards;
        }

        @keyframes impactFade {
            0% { transform: scale(0.5); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }

        .screen-shake {
            animation: shake 0.1s ease-out;
        }

        @keyframes shake {
            0%, 100% { transform: translate(0, 0); }
            25% { transform: translate(-3px, 2px); }
            50% { transform: translate(3px, -2px); }
            75% { transform: translate(-2px, 3px); }
        }

        .screen-shake-heavy {
            animation: shakeHeavy 0.15s ease-out;
        }

        @keyframes shakeHeavy {
            0%, 100% { transform: translate(0, 0); }
            20% { transform: translate(-8px, 5px); }
            40% { transform: translate(8px, -5px); }
            60% { transform: translate(-5px, 8px); }
            80% { transform: translate(5px, -3px); }
        }

        .fire-button {
            display: block;
            width: 100%;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            background: linear-gradient(135deg, var(--accent-orange), var(--accent-red));
            border: none;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .fire-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .fire-button:hover::before {
            left: 100%;
        }

        .fire-button:hover {
            box-shadow: 0 0 30px rgba(255, 107, 44, 0.5);
            transform: translateY(-2px);
        }

        .fire-button:active {
            transform: translateY(0);
        }

        .fire-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .recoil-pattern {
            height: 150px;
            background: rgba(0, 0, 0, 0.3);
            margin-top: 20px;
            position: relative;
            border: 1px solid rgba(255, 107, 44, 0.1);
        }

        .recoil-canvas {
            width: 100%;
            height: 100%;
        }

        .ammo-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
        }

        .ammo-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            letter-spacing: 0.1em;
        }

        .ammo-count {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            color: var(--accent-amber);
        }

        .ammo-bar {
            flex: 1;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            overflow: hidden;
        }

        .ammo-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-red), var(--accent-orange), var(--accent-amber));
            transition: width 0.1s ease;
        }

        .controls-hint {
            text-align: center;
            padding: 10px;
            font-size: 0.75rem;
            color: var(--text-secondary);
            letter-spacing: 0.1em;
        }

        /* Pellet spread for shotgun */
        .pellet {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--accent-amber);
            border-radius: 50%;
            pointer-events: none;
        }

        /* Target dummies */
        .target {
            position: absolute;
            width: 50px;
            height: 80px;
            cursor: crosshair;
        }

        .target-body {
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #2a2a35 0%, #1a1a22 100%);
            border: 2px solid #3a3a45;
            clip-path: polygon(20% 0%, 80% 0%, 100% 20%, 100% 100%, 0% 100%, 0% 20%);
            transition: all 0.1s ease;
        }

        .target.hit .target-body {
            border-color: var(--accent-orange);
            box-shadow: 0 0 20px rgba(255, 107, 44, 0.5);
        }

        .target-weak {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 20px;
            background: var(--accent-red);
            border-radius: 50%;
            opacity: 0.7;
        }

        /* Recoil indicator */
        .recoil-indicator {
            position: absolute;
            bottom: 10px;
            right: 10px;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid var(--border-glow);
            font-size: 0.7rem;
            color: var(--text-secondary);
            z-index: 20;
        }

        .recoil-indicator span {
            color: var(--accent-amber);
        }

        footer {
            text-align: center;
            padding: 40px 20px;
            margin-top: 40px;
            border-top: 1px solid var(--border-glow);
        }

        .footer-text {
            font-size: 0.75rem;
            color: var(--text-secondary);
            letter-spacing: 0.1em;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .panel {
            animation: fadeIn 0.6s ease-out;
        }

        .weapon-selector .weapon-tab:nth-child(1) { animation-delay: 0.1s; }
        .weapon-selector .weapon-tab:nth-child(2) { animation-delay: 0.2s; }
        .weapon-selector .weapon-tab:nth-child(3) { animation-delay: 0.3s; }
    </style>
</head>
<body>
    <div class="bg-grid"></div>
    <div class="bg-vignette"></div>

    <div class="container">
        <header>
            <h1 class="title">The Gauntlet Run</h1>
            <p class="subtitle">Arsenal Systems Interface</p>
        </header>

        <div class="weapon-selector">
            <button class="weapon-tab active" data-weapon="anvil">The Anvil</button>
            <button class="weapon-tab" data-weapon="judge">The Judge</button>
            <button class="weapon-tab" data-weapon="sweeper">Room Sweeper</button>
        </div>

        <div class="main-content">
            <div class="panel">
                <div class="panel-title">// Weapon Specifications</div>

                <div class="weapon-display">
                    <div class="weapon-name" id="weaponName">GPMG</div>
                    <div class="weapon-designation" id="weaponDesignation">"The Anvil"</div>

                    <div class="weapon-silhouette" id="weaponSilhouette">
                        <!-- SVG will be inserted here -->
                    </div>
                </div>

                <div class="stat-grid">
                    <div class="stat-item">
                        <div class="stat-label">Mass</div>
                        <div class="stat-value" id="statMass">13.0 kg</div>
                        <div class="stat-bar-container">
                            <div class="stat-bar" id="barMass" style="width: 100%"></div>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Fire Rate</div>
                        <div class="stat-value" id="statFireRate">650 RPM</div>
                        <div class="stat-bar-container">
                            <div class="stat-bar" id="barFireRate" style="width: 68%"></div>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Muzzle Velocity</div>
                        <div class="stat-value" id="statVelocity">850 m/s</div>
                        <div class="stat-bar-container">
                            <div class="stat-bar" id="barVelocity" style="width: 100%"></div>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Ammo</div>
                        <div class="stat-value" id="statAmmo">7.62x51mm</div>
                        <div class="stat-bar-container">
                            <div class="stat-bar" id="barAmmo" style="width: 85%"></div>
                        </div>
                    </div>
                </div>

                <div class="role-description">
                    <div class="role-title" id="roleTitle">Area Denial & Anti-Armor</div>
                    <p class="role-text" id="roleText">
                        High mass reduces player turn speed by 30%. Chews through light cover and staggers heavy enemies.
                        Ideal for holding choke points or shredding stationary targets. High bullet speed means less leading of targets.
                    </p>
                    <div class="tradeoff">
                        <div class="tradeoff-label">⚠ Trade-off</div>
                        <p class="tradeoff-text" id="tradeoffText">You become a slower, commitment-heavy turret.</p>
                    </div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-title">// Firing Range Simulation</div>

                <div class="firing-range" id="firingRange">
                    <div class="range-grid"></div>
                    <div class="crosshair" id="crosshair">
                        <div class="crosshair-dot"></div>
                    </div>
                    <div class="muzzle-flash" id="muzzleFlash"></div>
                    <div class="target" id="target1" style="left: 70%; top: 30%;">
                        <div class="target-body"></div>
                        <div class="target-weak"></div>
                    </div>
                    <div class="target" id="target2" style="left: 30%; top: 50%;">
                        <div class="target-body"></div>
                        <div class="target-weak"></div>
                    </div>
                    <div class="target" id="target3" style="left: 55%; top: 65%;">
                        <div class="target-body"></div>
                        <div class="target-weak"></div>
                    </div>
                    <div class="recoil-indicator">
                        Recoil: <span id="recoilType">Slow Push</span>
                    </div>
                </div>

                <div class="ammo-display">
                    <div class="ammo-label">MAG</div>
                    <div class="ammo-count" id="ammoCount">100</div>
                    <div class="ammo-bar">
                        <div class="ammo-fill" id="ammoFill" style="width: 100%"></div>
                    </div>
                </div>

                <div class="controls-hint">
                    Click and hold to fire • Move mouse to aim
                </div>

                <button class="fire-button" id="reloadBtn">Reload Weapon</button>

                <div class="recoil-pattern">
                    <canvas class="recoil-canvas" id="recoilCanvas"></canvas>
                </div>
                <div class="panel-title" style="margin-top: 10px; text-align: center;">// Recoil Pattern Visualization</div>
            </div>
        </div>

        <footer>
            <p class="footer-text">GAUNTLET RUN ARSENAL INTERFACE v2.4.1 // CLASSIFIED</p>
        </footer>
    </div>

    <script>
        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Weapon Data
        const weapons = {
            anvil: {
                name: 'GPMG',
                designation: '"The Anvil"',
                mass: '13.0 kg',
                massPercent: 100,
                fireRate: '650 RPM',
                fireRatePercent: 68,
                velocity: '850 m/s',
                velocityPercent: 100,
                ammo: '7.62x51mm',
                ammoPercent: 85,
                maxAmmo: 100,
                fireDelay: 92, // ms between shots (650 RPM)
                recoilType: 'Slow Push',
                roleTitle: 'Area Denial & Anti-Armor',
                roleText: 'High mass reduces player turn speed by 30%. Chews through light cover and staggers heavy enemies. Ideal for holding choke points or shredding stationary targets. High bullet speed means less leading of targets.',
                tradeoff: 'You become a slower, commitment-heavy turret.',
                recoil: {
                    type: 'push',
                    magnitude: 2.5,
                    recovery: 0.015,
                    pattern: 'climb'
                },
                svg: `<svg class="weapon-svg" viewBox="0 0 300 80" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="10" y="25" width="200" height="30" rx="2" fill="#2a2a35" stroke="#ff6b2c" stroke-width="1.5"/>
                    <rect x="180" y="20" width="80" height="40" rx="3" fill="#1a1a22" stroke="#ff6b2c" stroke-width="1.5"/>
                    <rect x="250" y="30" width="40" height="20" rx="1" fill="#2a2a35" stroke="#ffaa00" stroke-width="1"/>
                    <rect x="60" y="55" width="30" height="25" rx="2" fill="#1a1a22" stroke="#ff6b2c" stroke-width="1"/>
                    <rect x="100" y="55" width="8" height="20" rx="1" fill="#2a2a35" stroke="#ff6b2c" stroke-width="1"/>
                    <rect x="30" y="50" width="60" height="15" rx="2" fill="#1a1a22" stroke="#ffaa00" stroke-width="1"/>
                    <circle cx="40" cy="57" r="8" fill="#0a0a0c" stroke="#ff6b2c" stroke-width="1"/>
                    <rect x="140" y="10" width="40" height="12" rx="1" fill="#2a2a35" stroke="#ffaa00" stroke-width="1"/>
                    <line x1="5" y1="40" x2="10" y2="40" stroke="#ffaa00" stroke-width="2"/>
                </svg>`
            },
            judge: {
                name: 'Mk23',
                designation: '"The Judge"',
                mass: '1.2 kg',
                massPercent: 9,
                fireRate: 'Semi-Auto',
                fireRatePercent: 25,
                velocity: '260 m/s',
                velocityPercent: 31,
                ammo: '.45 ACP',
                ammoPercent: 45,
                maxAmmo: 12,
                fireDelay: 250, // semi-auto delay
                recoilType: 'Fast Snap',
                roleTitle: 'Mobile Precision & Stagger',
                roleText: 'Low bullet velocity means you must lead fast-moving targets significantly. Low mass means agile movement. Each hit has high stopping power, interrupting enemy attacks. Perfect for snap-shooting leaping Stalkers or finishing armored foes at weak points.',
                tradeoff: 'Requires precision and prediction; poor for sustained fire.',
                recoil: {
                    type: 'snap',
                    magnitude: 15,
                    recovery: 0.12,
                    pattern: 'vertical'
                },
                svg: `<svg class="weapon-svg" viewBox="0 0 200 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="40" y="30" width="120" height="25" rx="2" fill="#2a2a35" stroke="#ff6b2c" stroke-width="1.5"/>
                    <rect x="150" y="25" width="35" height="35" rx="2" fill="#1a1a22" stroke="#ff6b2c" stroke-width="1.5"/>
                    <rect x="35" y="35" width="25" height="15" rx="1" fill="#1a1a22" stroke="#ffaa00" stroke-width="1"/>
                    <rect x="75" y="55" width="45" height="40" rx="3" fill="#2a2a35" stroke="#ff6b2c" stroke-width="1.5"/>
                    <rect x="80" y="60" width="35" height="30" rx="2" fill="#1a1a22"/>
                    <rect x="130" y="35" width="20" height="8" rx="1" fill="#0a0a0c" stroke="#ffaa00" stroke-width="0.5"/>
                    <circle cx="165" cy="42" r="4" fill="#0a0a0c" stroke="#ff6b2c" stroke-width="1"/>
                    <line x1="30" y1="42" x2="40" y2="42" stroke="#ffaa00" stroke-width="2"/>
                    <rect x="100" y="28" width="15" height="5" rx="1" fill="#ffaa00" opacity="0.5"/>
                </svg>`
            },
            sweeper: {
                name: 'KSG',
                designation: '"Room Sweeper"',
                mass: '3.8 kg',
                massPercent: 29,
                fireRate: 'Pump-Action',
                fireRatePercent: 15,
                velocity: '400 m/s',
                velocityPercent: 47,
                ammo: '12 Gauge',
                ammoPercent: 100,
                maxAmmo: 14,
                fireDelay: 600, // pump action delay
                recoilType: 'Brutal Shove',
                roleTitle: 'Extreme CQC & Environmental',
                roleText: 'Devastating at point-blank range. Can knock enemies off ledges or into hazards with sheer kinetic force. The pump-action rhythm creates a risk/reward loop.',
                tradeoff: 'One shot at a time; a miss is punishing. Useless at range.',
                recoil: {
                    type: 'shove',
                    magnitude: 35,
                    recovery: 0.2,
                    pattern: 'burst'
                },
                svg: `<svg class="weapon-svg" viewBox="0 0 250 90" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="20" y="30" width="180" height="28" rx="2" fill="#2a2a35" stroke="#ff6b2c" stroke-width="1.5"/>
                    <rect x="190" y="25" width="45" height="38" rx="3" fill="#1a1a22" stroke="#ff6b2c" stroke-width="1.5"/>
                    <rect x="15" y="35" width="30" height="18" rx="1" fill="#1a1a22" stroke="#ffaa00" stroke-width="1"/>
                    <rect x="100" y="58" width="40" height="28" rx="2" fill="#2a2a35" stroke="#ff6b2c" stroke-width="1.5"/>
                    <rect x="105" y="63" width="30" height="18" rx="1" fill="#1a1a22"/>
                    <rect x="50" y="48" width="50" height="10" rx="1" fill="#1a1a22" stroke="#ff6b2c" stroke-width="1"/>
                    <rect x="55" y="50" width="40" height="6" rx="1" fill="#2a2a35"/>
                    <rect x="150" y="20" width="25" height="8" rx="1" fill="#0a0a0c" stroke="#ffaa00" stroke-width="0.5"/>
                    <line x1="5" y1="44" x2="20" y2="44" stroke="#ffaa00" stroke-width="3"/>
                    <ellipse cx="12" cy="44" rx="4" ry="6" fill="#0a0a0c" stroke="#ff6b2c" stroke-width="1"/>
                </svg>`
            }
        };

        let currentWeapon = 'anvil';
        let ammo = weapons[currentWeapon].maxAmmo;
        let isFiring = false;
        let fireInterval = null;
        let recoilOffset = { x: 0, y: 0 };
        let crosshairPos = { x: 200, y: 175 };
        let canFire = true;
        let recoilPatternPoints = [];

        // DOM Elements
        const firingRange = document.getElementById('firingRange');
        const crosshair = document.getElementById('crosshair');
        const muzzleFlash = document.getElementById('muzzleFlash');
        const ammoCount = document.getElementById('ammoCount');
        const ammoFill = document.getElementById('ammoFill');
        const reloadBtn = document.getElementById('reloadBtn');
        const recoilCanvas = document.getElementById('recoilCanvas');
        const ctx = recoilCanvas.getContext('2d');

        // Initialize canvas
        function initCanvas() {
            const rect = recoilCanvas.getBoundingClientRect();
            recoilCanvas.width = rect.width;
            recoilCanvas.height = rect.height;
            drawRecoilPattern();
        }

        // Draw recoil pattern
        function drawRecoilPattern() {
            ctx.clearRect(0, 0, recoilCanvas.width, recoilCanvas.height);

            const centerX = recoilCanvas.width / 2;
            const centerY = recoilCanvas.height - 20;

            // Draw center point
            ctx.fillStyle = '#ffaa00';
            ctx.beginPath();
            ctx.arc(centerX, centerY, 4, 0, Math.PI * 2);
            ctx.fill();

            // Draw pattern points
            ctx.strokeStyle = 'rgba(255, 107, 44, 0.5)';
            ctx.lineWidth = 2;

            if (recoilPatternPoints.length > 1) {
                ctx.beginPath();
                ctx.moveTo(centerX + recoilPatternPoints[0].x, centerY + recoilPatternPoints[0].y);

                for (let i = 1; i < recoilPatternPoints.length; i++) {
                    ctx.lineTo(centerX + recoilPatternPoints[i].x, centerY + recoilPatternPoints[i].y);
                }
                ctx.stroke();

                // Draw points
                recoilPatternPoints.forEach((point, i) => {
                    const alpha = 0.3 + (i / recoilPatternPoints.length) * 0.7;
                    ctx.fillStyle = `rgba(255, 107, 44, ${alpha})`;
                    ctx.beginPath();
                    ctx.arc(centerX + point.x, centerY + point.y, 3, 0, Math.PI * 2);
                    ctx.fill();
                });
            }

            // Draw pattern label
            ctx.fillStyle = '#888899';
            ctx.font = '12px "Share Tech Mono", monospace';
            ctx.textAlign = 'center';
            ctx.fillText(weapons[currentWeapon].recoilType.toUpperCase(), centerX, 20);
        }

        // Switch weapon
        function switchWeapon(weaponId) {
            currentWeapon = weaponId;
            const weapon = weapons[weaponId];

            // Update tabs
            document.querySelectorAll('.weapon-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.weapon === weaponId);
            });

            // Update display
            document.getElementById('weaponName').textContent = weapon.name;
            document.getElementById('weaponDesignation').textContent = weapon.designation;
            document.getElementById('weaponSilhouette').innerHTML = weapon.svg;

            // Update stats
            document.getElementById('statMass').textContent = weapon.mass;
            document.getElementById('barMass').style.width = weapon.massPercent + '%';
            document.getElementById('statFireRate').textContent = weapon.fireRate;
            document.getElementById('barFireRate').style.width = weapon.fireRatePercent + '%';
            document.getElementById('statVelocity').textContent = weapon.velocity;
            document.getElementById('barVelocity').style.width = weapon.velocityPercent + '%';
            document.getElementById('statAmmo').textContent = weapon.ammo;
            document.getElementById('barAmmo').style.width = weapon.ammoPercent + '%';

            // Update role
            document.getElementById('roleTitle').textContent = weapon.roleTitle;
            document.getElementById('roleText').textContent = weapon.roleText;
            document.getElementById('tradeoffText').textContent = weapon.tradeoff;
            document.getElementById('recoilType').textContent = weapon.recoilType;

            // Reset ammo
            ammo = weapon.maxAmmo;
            updateAmmoDisplay();

            // Reset recoil pattern
            recoilPatternPoints = [];
            recoilOffset = { x: 0, y: 0 };
            drawRecoilPattern();
        }

        // Update ammo display
        function updateAmmoDisplay() {
            const weapon = weapons[currentWeapon];
            ammoCount.textContent = ammo;
            ammoFill.style.width = (ammo / weapon.maxAmmo * 100) + '%';

            if (ammo <= weapon.maxAmmo * 0.2) {
                ammoFill.style.background = 'var(--accent-red)';
            } else {
                ammoFill.style.background = 'linear-gradient(90deg, var(--accent-red), var(--accent-orange), var(--accent-amber))';
            }
        }

        // Apply recoil
        function applyRecoil() {
            const weapon = weapons[currentWeapon];
            const recoil = weapon.recoil;

            let recoilX = 0;
            let recoilY = 0;

            switch (recoil.type) {
                case 'push': // Slow, climbing push (MG)
                    recoilY = -recoil.magnitude;
                    recoilX = (Math.random() - 0.5) * 3;
                    break;
                case 'snap': // Fast, sharp snap (Pistol)
                    recoilY = -recoil.magnitude;
                    recoilX = (Math.random() - 0.5) * 5;
                    break;
                case 'shove': // Brutal, concussive shove (Shotgun)
                    recoilY = -recoil.magnitude;
                    recoilX = (Math.random() - 0.5) * 15;
                    break;
            }

            recoilOffset.x += recoilX;
            recoilOffset.y += recoilY;

            // Track pattern
            recoilPatternPoints.push({ x: recoilOffset.x * 2, y: recoilOffset.y * 2 });
            if (recoilPatternPoints.length > 30) {
                recoilPatternPoints.shift();
            }

            updateCrosshair();
            drawRecoilPattern();

            // Screen shake
            if (recoil.type === 'shove') {
                firingRange.classList.add('screen-shake-heavy');
                setTimeout(() => firingRange.classList.remove('screen-shake-heavy'), 150);
            } else {
                firingRange.classList.add('screen-shake');
                setTimeout(() => firingRange.classList.remove('screen-shake'), 100);
            }
        }

        // Recover recoil
        function recoverRecoil() {
            const weapon = weapons[currentWeapon];
            const recovery = weapon.recoil.recovery;

            recoilOffset.x *= (1 - recovery);
            recoilOffset.y *= (1 - recovery);

            if (Math.abs(recoilOffset.x) < 0.1) recoilOffset.x = 0;
            if (Math.abs(recoilOffset.y) < 0.1) recoilOffset.y = 0;

            updateCrosshair();
        }

        // Update crosshair position
        function updateCrosshair() {
            const x = crosshairPos.x + recoilOffset.x;
            const y = crosshairPos.y + recoilOffset.y;
            crosshair.style.left = x + 'px';
            crosshair.style.top = y + 'px';
        }

        // Fire weapon
        function fire() {
            if (ammo <= 0 || !canFire) return;

            const weapon = weapons[currentWeapon];
            ammo--;
            updateAmmoDisplay();

            // Muzzle flash
            const flashX = crosshairPos.x + recoilOffset.x;
            const flashY = crosshairPos.y + recoilOffset.y + 20;
            muzzleFlash.style.left = flashX + 'px';
            muzzleFlash.style.top = flashY + 'px';
            muzzleFlash.classList.remove('fire');
            void muzzleFlash.offsetWidth; // Trigger reflow
            muzzleFlash.classList.add('fire');

            // Create bullet trail(s)
            if (currentWeapon === 'sweeper') {
                // Shotgun pellets
                for (let i = 0; i < 8; i++) {
                    createBulletTrail(
                        flashX,
                        flashY,
                        crosshairPos.x + recoilOffset.x + (Math.random() - 0.5) * 80,
                        crosshairPos.y + recoilOffset.y + (Math.random() - 0.5) * 80
                    );
                }
            } else {
                createBulletTrail(flashX, flashY, crosshairPos.x + recoilOffset.x, crosshairPos.y + recoilOffset.y);
            }

            // Check target hits
            checkHits(crosshairPos.x + recoilOffset.x, crosshairPos.y + recoilOffset.y);

            // Apply recoil
            applyRecoil();

            // Fire rate limiting for semi-auto
            if (weapon.fireRate === 'Semi-Auto' || weapon.fireRate === 'Pump-Action') {
                canFire = false;
                setTimeout(() => { canFire = true; }, weapon.fireDelay);
            }
        }

        // Create bullet trail
        function createBulletTrail(startX, startY, endX, endY) {
            const trail = document.createElement('div');
            trail.className = 'bullet-trail';

            const angle = Math.atan2(endY - startY, endX - startX);
            const distance = Math.sqrt(Math.pow(endX - startX, 2) + Math.pow(endY - startY, 2));

            trail.style.left = startX + 'px';
            trail.style.top = startY + 'px';
            trail.style.width = distance + 'px';
            trail.style.transform = `rotate(${angle}rad)`;

            firingRange.appendChild(trail);

            setTimeout(() => trail.remove(), 100);

            // Impact effect
            setTimeout(() => {
                const impact = document.createElement('div');
                impact.className = 'impact';
                impact.style.left = endX + 'px';
                impact.style.top = endY + 'px';
                firingRange.appendChild(impact);
                setTimeout(() => impact.remove(), 400);
            }, 30);
        }

        // Check target hits
        function checkHits(x, y) {
            document.querySelectorAll('.target').forEach(target => {
                const rect = target.getBoundingClientRect();
                const rangeRect = firingRange.getBoundingClientRect();

                const targetX = target.offsetLeft;
                const targetY = target.offsetTop;
                const targetW = target.offsetWidth;
                const targetH = target.offsetHeight;

                // Expand hit area for shotgun
                const hitExpand = currentWeapon === 'sweeper' ? 40 : 0;

                if (x >= targetX - hitExpand && x <= targetX + targetW + hitExpand &&
                    y >= targetY - hitExpand && y <= targetY + targetH + hitExpand) {
                    target.classList.add('hit');
                    setTimeout(() => target.classList.remove('hit'), 200);
                }
            });
        }

        // Event Listeners
        document.querySelectorAll('.weapon-tab').forEach(tab => {
            tab.addEventListener('click', () => switchWeapon(tab.dataset.weapon));
        });

        firingRange.addEventListener('mousemove', (e) => {
            const rect = firingRange.getBoundingClientRect();
            crosshairPos.x = e.clientX - rect.left;
            crosshairPos.y = e.clientY - rect.top;
            updateCrosshair();
        });

        firingRange.addEventListener('mousedown', (e) => {
            if (e.button !== 0) return;
            isFiring = true;

            const weapon = weapons[currentWeapon];

            if (weapon.fireRate === 'Semi-Auto' || weapon.fireRate === 'Pump-Action') {
                fire();
            } else {
                fire();
                fireInterval = setInterval(fire, weapon.fireDelay);
            }
        });

        firingRange.addEventListener('mouseup', () => {
            isFiring = false;
            if (fireInterval) {
                clearInterval(fireInterval);
                fireInterval = null;
            }
        });

        firingRange.addEventListener('mouseleave', () => {
            isFiring = false;
            if (fireInterval) {
                clearInterval(fireInterval);
                fireInterval = null;
            }
        });

        // Touch support
        firingRange.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            const rect = firingRange.getBoundingClientRect();
            crosshairPos.x = touch.clientX - rect.left;
            crosshairPos.y = touch.clientY - rect.top;
            updateCrosshair();

            isFiring = true;
            const weapon = weapons[currentWeapon];

            if (weapon.fireRate === 'Semi-Auto' || weapon.fireRate === 'Pump-Action') {
                fire();
            } else {
                fire();
                fireInterval = setInterval(fire, weapon.fireDelay);
            }
        });

        firingRange.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            const rect = firingRange.getBoundingClientRect();
            crosshairPos.x = touch.clientX - rect.left;
            crosshairPos.y = touch.clientY - rect.top;
            updateCrosshair();
        });

        firingRange.addEventListener('touchend', () => {
            isFiring = false;
            if (fireInterval) {
                clearInterval(fireInterval);
                fireInterval = null;
            }
        });

        reloadBtn.addEventListener('click', () => {
            const weapon = weapons[currentWeapon];
            ammo = weapon.maxAmmo;
            updateAmmoDisplay();
            recoilPatternPoints = [];
            recoilOffset = { x: 0, y: 0 };
            updateCrosshair();
            drawRecoilPattern();
        });

        // Recoil recovery loop
        setInterval(recoverRecoil, 16);

        // Initialize
        window.addEventListener('resize', initCanvas);
        initCanvas();
        switchWeapon('anvil');
    </script>
</body>
</html>


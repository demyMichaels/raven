<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bird Flight Physics Simulator</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Fraunces:opsz,wght@9..144,300;9..144,600;9..144,800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f1f5f9;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #94a3b8;
            --accent-action: #ef4444;
            --accent-action-light: #fecaca;
            --accent-reaction: #10b981;
            --accent-reaction-light: #d1fae5;
            --accent-highlight: #0ea5e9;
            --accent-warm: #f59e0b;
            --sky-top: #7dd3fc;
            --sky-mid: #bae6fd;
            --sky-bottom: #f0f9ff;
            --cloud: rgba(255,255,255,0.9);
            --card-shadow: 0 4px 24px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.04);
            --card-border: rgba(0,0,0,0.04);
            --glow-action: rgba(239, 68, 68, 0.4);
            --glow-reaction: rgba(16, 185, 129, 0.4);
        }

        .dark {
            --bg-primary: #0c1222;
            --bg-secondary: #151d2e;
            --bg-tertiary: #1a2540;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --accent-action: #f87171;
            --accent-action-light: #7f1d1d;
            --accent-reaction: #34d399;
            --accent-reaction-light: #064e3b;
            --accent-highlight: #38bdf8;
            --accent-warm: #fbbf24;
            --sky-top: #0c4a6e;
            --sky-mid: #164e63;
            --sky-bottom: #0c1222;
            --cloud: rgba(255,255,255,0.08);
            --card-shadow: 0 4px 24px rgba(0,0,0,0.3), 0 1px 2px rgba(0,0,0,0.2);
            --card-border: rgba(255,255,255,0.05);
            --glow-action: rgba(248, 113, 113, 0.5);
            --glow-reaction: rgba(52, 211, 153, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Fraunces', Georgia, serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            transition: background 0.3s ease, color 0.3s ease;
        }

        .container {
            max-width: 960px;
            margin: 0 auto;
            padding: 16px;
        }

        header {
            text-align: center;
            padding: 24px 0 16px;
            position: relative;
        }

        .header-icon {
            font-size: 3rem;
            margin-bottom: 8px;
            display: block;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-6px); }
        }

        h1 {
            font-family: 'Fraunces', Georgia, serif;
            font-size: clamp(1.6rem, 5vw, 2.4rem);
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 4px;
            letter-spacing: -0.02em;
        }

        .subtitle {
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.15em;
        }

        .principle-box {
            background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
            border: 1px solid var(--card-border);
            border-radius: 16px;
            padding: 20px 24px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 16px;
            box-shadow: var(--card-shadow);
        }

        .principle-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--accent-highlight), #6366f1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .principle-icon svg {
            width: 24px;
            height: 24px;
        }

        .principle-content {
            flex: 1;
        }

        .principle-label {
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            color: var(--accent-highlight);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 2px;
        }

        .principle-text {
            font-size: 1rem;
            color: var(--text-primary);
            font-weight: 600;
            font-style: italic;
        }

        .simulation-wrapper {
            background: var(--bg-secondary);
            border-radius: 24px;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--card-border);
            overflow: hidden;
            margin-bottom: 16px;
        }

        .svg-container {
            width: 100%;
            height: 420px;
            display: block;
            position: relative;
            overflow: hidden;
        }

        #simulation-svg {
            width: 100%;
            height: 100%;
            display: block;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 24px;
            padding: 14px 20px;
            background: var(--bg-tertiary);
            border-top: 1px solid var(--card-border);
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            color: var(--text-secondary);
        }

        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .legend-dot.action { background: var(--accent-action); box-shadow: 0 0 8px var(--glow-action); }
        .legend-dot.reaction { background: var(--accent-reaction); box-shadow: 0 0 8px var(--glow-reaction); }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 16px 20px;
            justify-content: center;
            align-items: center;
            background: var(--bg-secondary);
            border-top: 1px solid var(--card-border);
        }

        .btn {
            font-family: 'Space Mono', monospace;
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-highlight), #6366f1);
            color: white;
            box-shadow: 0 2px 8px rgba(14, 165, 233, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(14, 165, 233, 0.4);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--card-border);
        }

        .btn-secondary:hover {
            background: var(--bg-primary);
            border-color: var(--accent-highlight);
        }

        .btn-secondary.active {
            background: linear-gradient(135deg, var(--accent-warm), #ea580c);
            color: white;
            border-color: transparent;
        }

        .slider-group {
            display: flex;
            align-items: center;
            gap: 10px;
            background: var(--bg-tertiary);
            padding: 8px 14px;
            border-radius: 10px;
            border: 1px solid var(--card-border);
        }

        .slider-label {
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .slider-value {
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            color: var(--accent-highlight);
            font-weight: 700;
            min-width: 24px;
            text-align: center;
        }

        input[type="range"] {
            -webkit-appearance: none;
            width: 80px;
            height: 6px;
            border-radius: 3px;
            background: var(--bg-primary);
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-highlight), #6366f1);
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(14, 165, 233, 0.4);
            transition: transform 0.2s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 14px;
            margin-bottom: 16px;
        }

        .info-card {
            background: var(--bg-secondary);
            border-radius: 18px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--card-border);
            position: relative;
            overflow: hidden;
        }

        .info-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
        }

        .info-card.action::before {
            background: linear-gradient(90deg, var(--accent-action), #f97316);
        }

        .info-card.reaction::before {
            background: linear-gradient(90deg, var(--accent-reaction), #06b6d4);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .card-icon-wrapper {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .action .card-icon-wrapper {
            background: var(--accent-action-light);
        }

        .reaction .card-icon-wrapper {
            background: var(--accent-reaction-light);
        }

        .card-icon-wrapper svg {
            width: 22px;
            height: 22px;
        }

        .action .card-icon-wrapper svg { color: var(--accent-action); }
        .reaction .card-icon-wrapper svg { color: var(--accent-reaction); }

        .card-title {
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .action .card-title { color: var(--accent-action); }
        .reaction .card-title { color: var(--accent-reaction); }

        .card-text {
            font-size: 0.95rem;
            color: var(--text-secondary);
            line-height: 1.65;
        }

        .card-text strong {
            color: var(--text-primary);
        }

        .physics-note {
            background: var(--bg-tertiary);
            border-radius: 14px;
            padding: 16px 20px;
            border: 1px solid var(--card-border);
        }

        .physics-note-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .physics-note-title {
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            color: var(--accent-warm);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .physics-note-text {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .physics-note-text code {
            font-family: 'Space Mono', monospace;
            background: var(--bg-secondary);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.85em;
            color: var(--accent-highlight);
        }

        @media (max-width: 640px) {
            .container {
                padding: 12px;
            }

            .svg-container {
                height: 360px;
            }

            .controls {
                gap: 8px;
                padding: 14px;
            }

            .btn {
                padding: 8px 14px;
                font-size: 12px;
            }

            .slider-group {
                width: 100%;
                justify-content: center;
            }

            .principle-box {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <span class="header-icon">ü¶Ö</span>
            <h1>Bird Flight Physics</h1>
            <p class="subtitle">Newton's Third Law Visualized</p>
        </header>

        <div class="principle-box">
            <div class="principle-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round">
                    <path d="M12 5v14M5 12h14M8 8l8 8M16 8l-8 8"/>
                </svg>
            </div>
            <div class="principle-content">
                <div class="principle-label">Newton's Third Law</div>
                <div class="principle-text">"For every action, there is an equal and opposite reaction"</div>
            </div>
        </div>

        <div class="simulation-wrapper">
            <div class="svg-container">
                <svg id="simulation-svg" viewBox="0 0 800 420" preserveAspectRatio="xMidYMid slice">
                    <defs>
                        <!-- Sky gradient -->
                        <linearGradient id="skyGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" class="sky-top"/>
                            <stop offset="50%" class="sky-mid"/>
                            <stop offset="100%" class="sky-bottom"/>
                        </linearGradient>

                        <!-- Action force gradient -->
                        <linearGradient id="actionGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" class="action-start"/>
                            <stop offset="100%" class="action-end"/>
                        </linearGradient>

                        <!-- Reaction force gradient -->
                        <linearGradient id="reactionGradient" x1="0%" y1="100%" x2="0%" y2="0%">
                            <stop offset="0%" class="reaction-start"/>
                            <stop offset="100%" class="reaction-end"/>
                        </linearGradient>

                        <!-- Bird body gradient -->
                        <linearGradient id="birdBodyGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" class="bird-body-light"/>
                            <stop offset="100%" class="bird-body-dark"/>
                        </linearGradient>

                        <!-- Wing gradient -->
                        <linearGradient id="wingGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" class="wing-light"/>
                            <stop offset="100%" class="wing-dark"/>
                        </linearGradient>

                        <!-- Glow filters -->
                        <filter id="actionGlow" x="-50%" y="-50%" width="200%" height="200%">
                            <feGaussianBlur stdDeviation="4" result="blur"/>
                            <feMerge>
                                <feMergeNode in="blur"/>
                                <feMergeNode in="SourceGraphic"/>
                            </feMerge>
                        </filter>

                        <filter id="reactionGlow" x="-50%" y="-50%" width="200%" height="200%">
                            <feGaussianBlur stdDeviation="5" result="blur"/>
                            <feMerge>
                                <feMergeNode in="blur"/>
                                <feMergeNode in="SourceGraphic"/>
                            </feMerge>
                        </filter>

                        <filter id="softShadow" x="-50%" y="-50%" width="200%" height="200%">
                            <feDropShadow dx="0" dy="4" stdDeviation="6" flood-opacity="0.15"/>
                        </filter>

                        <!-- Cloud filter -->
                        <filter id="cloudBlur">
                            <feGaussianBlur stdDeviation="2"/>
                        </filter>

                        <!-- Arrow marker -->
                        <marker id="actionArrowhead" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
                            <path d="M0,0 L12,6 L0,12 L3,6 Z" class="action-arrow-fill"/>
                        </marker>

                        <marker id="reactionArrowhead" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
                            <path d="M0,0 L12,6 L0,12 L3,6 Z" class="reaction-arrow-fill"/>
                        </marker>

                        <!-- Air particle -->
                        <radialGradient id="particleGradient">
                            <stop offset="0%" class="particle-center"/>
                            <stop offset="100%" class="particle-edge"/>
                        </radialGradient>
                    </defs>

                    <!-- Background -->
                    <rect width="100%" height="100%" fill="url(#skyGradient)"/>

                    <!-- Clouds group -->
                    <g id="clouds" opacity="0.7">
                        <g class="cloud" transform="translate(120, 60)">
                            <ellipse cx="0" cy="0" rx="45" ry="22" class="cloud-fill"/>
                            <ellipse cx="35" cy="-8" rx="35" ry="18" class="cloud-fill"/>
                            <ellipse cx="65" cy="0" rx="40" ry="20" class="cloud-fill"/>
                            <ellipse cx="30" cy="10" rx="30" ry="15" class="cloud-fill"/>
                        </g>
                        <g class="cloud" transform="translate(600, 80)">
                            <ellipse cx="0" cy="0" rx="50" ry="24" class="cloud-fill"/>
                            <ellipse cx="40" cy="-10" rx="38" ry="20" class="cloud-fill"/>
                            <ellipse cx="75" cy="0" rx="42" ry="22" class="cloud-fill"/>
                        </g>
                        <g class="cloud" transform="translate(380, 340)">
                            <ellipse cx="0" cy="0" rx="35" ry="18" class="cloud-fill"/>
                            <ellipse cx="28" cy="-6" rx="28" ry="14" class="cloud-fill"/>
                            <ellipse cx="50" cy="2" rx="30" ry="16" class="cloud-fill"/>
                        </g>
                    </g>

                    <!-- Air flow lines (decorative) -->
                    <g id="airFlowLines" opacity="0.3">
                    </g>

                    <!-- Particles container -->
                    <g id="particles"></g>

                    <!-- Force arrows container -->
                    <g id="forceArrows"></g>

                    <!-- Bird group -->
                    <g id="bird" filter="url(#softShadow)">
                        <!-- Tail -->
                        <path id="tail" d="M-45,0 Q-65,-15 -75,-20 L-65,0 L-75,20 Q-65,15 -45,0" fill="url(#wingGradient)"/>

                        <!-- Left wing -->
                        <g id="leftWing" transform-origin="0 0">
                            <path d="M0,0 Q-35,-8 -80,-5 Q-95,0 -80,8 Q-35,12 0,0" fill="url(#wingGradient)"/>
                            <path d="M-10,0 Q-45,0 -75,2" stroke-width="1.5" class="wing-detail" fill="none"/>
                            <path d="M-20,2 L-65,4" stroke-width="1" class="wing-detail" fill="none" opacity="0.5"/>
                        </g>

                        <!-- Right wing -->
                        <g id="rightWing" transform-origin="0 0">
                            <path d="M0,0 Q35,-8 80,-5 Q95,0 80,8 Q35,12 0,0" fill="url(#wingGradient)"/>
                            <path d="M10,0 Q45,0 75,2" stroke-width="1.5" class="wing-detail" fill="none"/>
                            <path d="M20,2 L65,4" stroke-width="1" class="wing-detail" fill="none" opacity="0.5"/>
                        </g>

                        <!-- Body -->
                        <ellipse cx="0" cy="0" rx="38" ry="20" fill="url(#birdBodyGradient)"/>

                        <!-- Belly highlight -->
                        <ellipse cx="5" cy="6" rx="22" ry="10" class="belly-highlight" opacity="0.4"/>

                        <!-- Head -->
                        <circle cx="32" cy="-6" r="18" fill="url(#birdBodyGradient)"/>

                        <!-- Eye white -->
                        <ellipse cx="38" cy="-10" rx="7" ry="6" fill="white"/>

                        <!-- Eye pupil -->
                        <circle cx="40" cy="-10" r="4" fill="#1a1a2e"/>

                        <!-- Eye highlight -->
                        <circle cx="41" cy="-11" r="1.5" fill="white"/>

                        <!-- Beak -->
                        <path d="M48,-6 L68,-3 L48,2 Q52,-2 48,-6" class="beak-fill"/>

                        <!-- Beak detail -->
                        <path d="M50,-2 L62,-1" stroke-width="1" class="beak-detail" fill="none"/>
                    </g>

                    <!-- Labels container -->
                    <g id="labels" font-family="'Space Mono', monospace"></g>

                    <!-- Info overlay -->
                    <g id="infoOverlay" opacity="0">
                        <rect x="20" y="20" width="200" height="60" rx="10" class="info-bg"/>
                        <text x="35" y="45" font-size="12" class="info-text">Wing downstroke creates lift</text>
                        <text x="35" y="62" font-size="10" class="info-subtext">Air pushed down ‚Üí Bird pushed up</text>
                    </g>
                </svg>
            </div>
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-dot action"></div>
                    <span>Action: Wing pushes air down</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot reaction"></div>
                    <span>Reaction: Air lifts bird up</span>
                </div>
            </div>
            <div class="controls">
                <button class="btn btn-primary" id="playPause">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" id="playPauseIcon">
                        <rect x="6" y="4" width="4" height="16"/>
                        <rect x="14" y="4" width="4" height="16"/>
                    </svg>
                    <span id="playPauseText">Pause</span>
                </button>
                <button class="btn btn-secondary" id="slowMo">
                    <span>üêå</span>
                    <span id="slowMoText">Slow Motion</span>
                </button>
                <button class="btn btn-secondary" id="showFlow">
                    <span>üí®</span>
                    <span>Air Flow</span>
                </button>
                <div class="slider-group">
                    <span class="slider-label">Power</span>
                    <input type="range" id="flapStrength" min="1" max="10" value="6">
                    <span class="slider-value" id="strengthValue">6</span>
                </div>
            </div>
        </div>

        <div class="cards-grid">
            <div class="info-card action">
                <div class="card-header">
                    <div class="card-icon-wrapper">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <path d="M12 5v14M7 14l5 5 5-5"/>
                        </svg>
                    </div>
                    <div class="card-title">Action Force</div>
                </div>
                <p class="card-text">
                    During the <strong>downstroke</strong>, the bird's wings push air molecules <strong>downward</strong>. The powerful flight muscles generate this force, accelerating the air beneath the wings.
                </p>
            </div>
            <div class="info-card reaction">
                <div class="card-header">
                    <div class="card-icon-wrapper">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                            <path d="M12 19V5M7 10l5-5 5 5"/>
                        </svg>
                    </div>
                    <div class="card-title">Reaction Force</div>
                </div>
                <p class="card-text">
                    The air responds by pushing back <strong>upward</strong> on the wings with an <strong>equal and opposite force</strong>. This reaction creates the lift that keeps the bird airborne!
                </p>
            </div>
        </div>

        <div class="physics-note">
            <div class="physics-note-header">
                <span>‚ö°</span>
                <span class="physics-note-title">Physics Insight</span>
            </div>
            <p class="physics-note-text">
                The force equation <code>F = ma</code> applies to both the air and the bird. When wings accelerate air downward, the reaction force accelerates the bird upward. A stronger wing beat (higher <code>a</code>) produces greater lift force!
            </p>
        </div>
    </div>

    <script>
        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            event.matches ? document.documentElement.classList.add('dark') : document.documentElement.classList.remove('dark');
        });

        // SVG Namespace
        const SVG_NS = "http://www.w3.org/2000/svg";

        // Get SVG elements
        const svg = document.getElementById('simulation-svg');
        const birdGroup = document.getElementById('bird');
        const leftWing = document.getElementById('leftWing');
        const rightWing = document.getElementById('rightWing');
        const particlesGroup = document.getElementById('particles');
        const forceArrowsGroup = document.getElementById('forceArrows');
        const labelsGroup = document.getElementById('labels');
        const airFlowLines = document.getElementById('airFlowLines');

        // State
        let isPlaying = true;
        let isSlowMo = false;
        let showAirFlow = false;
        let flapStrength = 6;
        let time = 0;
        let particles = [];
        let flowLines = [];

        // Bird state
        const bird = {
            x: 400,
            y: 200,
            baseY: 200,
            wingAngle: 0,
            flapPhase: 0,
            velocity: 0
        };

        // Update colors based on theme
        function updateThemeColors() {
            const isDark = document.documentElement.classList.contains('dark');
            const style = document.createElement('style');
            style.id = 'theme-styles';

            const existing = document.getElementById('theme-styles');
            if (existing) existing.remove();

            if (isDark) {
                style.textContent = `
                    .sky-top { stop-color: #0c4a6e; }
                    .sky-mid { stop-color: #164e63; }
                    .sky-bottom { stop-color: #0c1222; }
                    .cloud-fill { fill: rgba(255,255,255,0.08); }
                    .bird-body-light { stop-color: #fcd34d; }
                    .bird-body-dark { stop-color: #f59e0b; }
                    .wing-light { stop-color: #d97706; }
                    .wing-dark { stop-color: #b45309; }
                    .wing-detail { stroke: #fcd34d; }
                    .belly-highlight { fill: #fef3c7; }
                    .beak-fill { fill: #fb923c; }
                    .beak-detail { stroke: #fed7aa; }
                    .action-start { stop-color: #f87171; }
                    .action-end { stop-color: #dc2626; }
                    .reaction-start { stop-color: #34d399; }
                    .reaction-end { stop-color: #059669; }
                    .action-arrow-fill { fill: #f87171; }
                    .reaction-arrow-fill { fill: #34d399; }
                    .particle-center { stop-color: rgba(147, 197, 253, 0.8); }
                    .particle-edge { stop-color: rgba(147, 197, 253, 0); }
                    .flow-line { stroke: rgba(147, 197, 253, 0.4); }
                    .label-text { fill: #f1f5f9; }
                    .label-subtext { fill: #94a3b8; }
                    .info-bg { fill: rgba(21, 29, 46, 0.9); stroke: rgba(255,255,255,0.1); }
                    .info-text { fill: #f1f5f9; }
                    .info-subtext { fill: #94a3b8; }
                `;
            } else {
                style.textContent = `
                    .sky-top { stop-color: #7dd3fc; }
                    .sky-mid { stop-color: #bae6fd; }
                    .sky-bottom { stop-color: #f0f9ff; }
                    .cloud-fill { fill: rgba(255,255,255,0.9); }
                    .bird-body-light { stop-color: #fcd34d; }
                    .bird-body-dark { stop-color: #f59e0b; }
                    .wing-light { stop-color: #f59e0b; }
                    .wing-dark { stop-color: #d97706; }
                    .wing-detail { stroke: #fcd34d; }
                    .belly-highlight { fill: #fef3c7; }
                    .beak-fill { fill: #ea580c; }
                    .beak-detail { stroke: #fdba74; }
                    .action-start { stop-color: #ef4444; }
                    .action-end { stop-color: #b91c1c; }
                    .reaction-start { stop-color: #10b981; }
                    .reaction-end { stop-color: #047857; }
                    .action-arrow-fill { fill: #ef4444; }
                    .reaction-arrow-fill { fill: #10b981; }
                    .particle-center { stop-color: rgba(59, 130, 246, 0.7); }
                    .particle-edge { stop-color: rgba(59, 130, 246, 0); }
                    .flow-line { stroke: rgba(59, 130, 246, 0.3); }
                    .label-text { fill: #0f172a; }
                    .label-subtext { fill: #475569; }
                    .info-bg { fill: rgba(255, 255, 255, 0.95); stroke: rgba(0,0,0,0.1); }
                    .info-text { fill: #0f172a; }
                    .info-subtext { fill: #475569; }
                `;
            }
            document.head.appendChild(style);
        }

        // Create SVG element helper
        function createSVGElement(tag, attrs = {}) {
            const el = document.createElementNS(SVG_NS, tag);
            for (const [key, value] of Object.entries(attrs)) {
                el.setAttribute(key, value);
            }
            return el;
        }

        // Create particle
        function createParticle(x, y, vx, vy) {
            const particle = {
                x, y, vx, vy,
                life: 1,
                size: Math.random() * 6 + 3,
                element: createSVGElement('circle', {
                    r: Math.random() * 6 + 3,
                    fill: 'url(#particleGradient)'
                })
            };
            particlesGroup.appendChild(particle.element);
            particles.push(particle);
        }

        // Create air flow line
        function createFlowLines() {
            airFlowLines.innerHTML = '';
            flowLines = [];

            for (let i = 0; i < 12; i++) {
                const line = createSVGElement('path', {
                    class: 'flow-line',
                    fill: 'none',
                    'stroke-width': '2',
                    'stroke-linecap': 'round',
                    'stroke-dasharray': '8 4',
                    opacity: '0'
                });
                airFlowLines.appendChild(line);
                flowLines.push({
                    element: line,
                    offset: i * 60,
                    x: 100 + i * 60,
                    phase: Math.random() * Math.PI * 2
                });
            }
        }

        // Update flow lines
        function updateFlowLines(deltaTime) {
            if (!showAirFlow) {
                flowLines.forEach(fl => fl.element.setAttribute('opacity', '0'));
                return;
            }

            const speed = isSlowMo ? 0.3 : 1;
            flowLines.forEach((fl, i) => {
                fl.phase += deltaTime * 0.002 * speed;

                const baseY = 180 + Math.sin(fl.phase + i * 0.5) * 30;
                const waveY = Math.sin(fl.phase * 2) * 15;

                const startX = fl.x;
                const endX = fl.x + 50;
                const midX = (startX + endX) / 2;

                const d = `M${startX},${baseY} Q${midX},${baseY + waveY} ${endX},${baseY}`;
                fl.element.setAttribute('d', d);
                fl.element.setAttribute('opacity', (0.3 + Math.sin(fl.phase) * 0.2).toString());
            });
        }

        // Update particles
        function updateParticles(deltaTime) {
            const speed = isSlowMo ? 0.3 : 1;

            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.x += p.vx * deltaTime * 0.05 * speed;
                p.y += p.vy * deltaTime * 0.05 * speed;
                p.life -= deltaTime * 0.002 * speed;

                p.element.setAttribute('cx', p.x);
                p.element.setAttribute('cy', p.y);
                p.element.setAttribute('opacity', p.life * 0.8);
                p.element.setAttribute('r', p.size * p.life);

                if (p.life <= 0) {
                    p.element.remove();
                    particles.splice(i, 1);
                }
            }
        }

        // Draw force arrows
        function drawForceArrows() {
            forceArrowsGroup.innerHTML = '';
            labelsGroup.innerHTML = '';

            const forceMagnitude = (Math.sin(bird.flapPhase) + 1) * 0.5 * flapStrength * 6;

            if (forceMagnitude > 8) {
                const arrowOpacity = Math.min(1, (forceMagnitude - 8) / 20);

                // Left action arrow (downward)
                const leftActionArrow = createSVGElement('line', {
                    x1: bird.x - 55,
                    y1: bird.y + 15,
                    x2: bird.x - 55,
                    y2: bird.y + 15 + forceMagnitude,
                    stroke: 'url(#actionGradient)',
                    'stroke-width': '4',
                    'stroke-linecap': 'round',
                    'marker-end': 'url(#actionArrowhead)',
                    filter: 'url(#actionGlow)',
                    opacity: arrowOpacity
                });
                forceArrowsGroup.appendChild(leftActionArrow);

                // Right action arrow (downward)
                const rightActionArrow = createSVGElement('line', {
                    x1: bird.x + 55,
                    y1: bird.y + 15,
                    x2: bird.x + 55,
                    y2: bird.y + 15 + forceMagnitude,
                    stroke: 'url(#actionGradient)',
                    'stroke-width': '4',
                    'stroke-linecap': 'round',
                    'marker-end': 'url(#actionArrowhead)',
                    filter: 'url(#actionGlow)',
                    opacity: arrowOpacity
                });
                forceArrowsGroup.appendChild(rightActionArrow);

                // Reaction arrow (upward - centered, larger)
                const reactionArrow = createSVGElement('line', {
                    x1: bird.x,
                    y1: bird.y - 30,
                    x2: bird.x,
                    y2: bird.y - 30 - forceMagnitude * 1.3,
                    stroke: 'url(#reactionGradient)',
                    'stroke-width': '6',
                    'stroke-linecap': 'round',
                    'marker-end': 'url(#reactionArrowhead)',
                    filter: 'url(#reactionGlow)',
                    opacity: arrowOpacity
                });
                forceArrowsGroup.appendChild(reactionArrow);

                // Labels with background
                if (arrowOpacity > 0.5) {
                    // Action label
                    const actionLabelBg = createSVGElement('rect', {
                        x: bird.x - 55 - 38,
                        y: bird.y + forceMagnitude + 25,
                        width: 76,
                        height: 22,
                        rx: 4,
                        fill: 'var(--accent-action)',
                        opacity: arrowOpacity * 0.9
                    });
                    labelsGroup.appendChild(actionLabelBg);

                    const actionLabel = createSVGElement('text', {
                        x: bird.x - 55,
                        y: bird.y + forceMagnitude + 40,
                        'text-anchor': 'middle',
                        'font-size': '11',
                        'font-weight': 'bold',
                        fill: 'white',
                        opacity: arrowOpacity
                    });
                    actionLabel.textContent = 'ACTION ‚Üì';
                    labelsGroup.appendChild(actionLabel);

                    // Reaction label
                    const reactionLabelBg = createSVGElement('rect', {
                        x: bird.x - 48,
                        y: bird.y - forceMagnitude * 1.3 - 55,
                        width: 96,
                        height: 22,
                        rx: 4,
                        fill: 'var(--accent-reaction)',
                        opacity: arrowOpacity * 0.9
                    });
                    labelsGroup.appendChild(reactionLabelBg);

                    const reactionLabel = createSVGElement('text', {
                        x: bird.x,
                        y: bird.y - forceMagnitude * 1.3 - 40,
                        'text-anchor': 'middle',
                        'font-size': '11',
                        'font-weight': 'bold',
                        fill: 'white',
                        opacity: arrowOpacity
                    });
                    reactionLabel.textContent = 'REACTION ‚Üë';
                    labelsGroup.appendChild(reactionLabel);
                }
            }
        }

        // Update bird animation
        function updateBird(deltaTime) {
            const speed = isSlowMo ? 0.25 : 1;
            const flapSpeed = 0.006 * speed * (flapStrength / 5);

            bird.flapPhase += deltaTime * flapSpeed;
            bird.wingAngle = Math.sin(bird.flapPhase) * 35; // degrees

            // Bird bobbing motion
            const lift = Math.sin(bird.flapPhase) * flapStrength * 0.7;
            bird.velocity += (lift - bird.velocity * 0.1) * 0.08 * speed;
            bird.y = bird.baseY - bird.velocity * 2.5;

            // Update bird position and wing rotation
            birdGroup.setAttribute('transform', `translate(${bird.x}, ${bird.y})`);
            leftWing.setAttribute('transform', `rotate(${-bird.wingAngle})`);
            rightWing.setAttribute('transform', `rotate(${bird.wingAngle})`);

            // Create particles on downstroke
            if (Math.sin(bird.flapPhase) > 0.2 && particles.length < 40) {
                const particleSpeed = flapStrength * 1.5;
                // Left wing particles
                createParticle(
                    bird.x - 45 + Math.random() * 30,
                    bird.y + 15,
                    (Math.random() - 0.5) * 1.5,
                    particleSpeed + Math.random() * 2
                );
                // Right wing particles
                createParticle(
                    bird.x + 15 + Math.random() * 30,
                    bird.y + 15,
                    (Math.random() - 0.5) * 1.5,
                    particleSpeed + Math.random() * 2
                );
            }
        }

        // Animation loop
        let lastTime = 0;
        function animate(currentTime) {
            const deltaTime = Math.min(currentTime - lastTime, 50); // Cap delta
            lastTime = currentTime;

            if (isPlaying) {
                updateBird(deltaTime);
                updateParticles(deltaTime);
                updateFlowLines(deltaTime);
                drawForceArrows();
            }

            requestAnimationFrame(animate);
        }

        // Event listeners
        document.getElementById('playPause').addEventListener('click', function() {
            isPlaying = !isPlaying;
            const icon = document.getElementById('playPauseIcon');
            const text = document.getElementById('playPauseText');

            if (isPlaying) {
                icon.innerHTML = '<rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/>';
                text.textContent = 'Pause';
            } else {
                icon.innerHTML = '<path d="M8,5 L19,12 L8,19 Z"/>';
                text.textContent = 'Play';
            }
        });

        document.getElementById('slowMo').addEventListener('click', function() {
            isSlowMo = !isSlowMo;
            const text = document.getElementById('slowMoText');
            this.classList.toggle('active');

            if (isSlowMo) {
                this.querySelector('span:first-child').textContent = 'üöÄ';
                text.textContent = 'Normal';
            } else {
                this.querySelector('span:first-child').textContent = 'üêå';
                text.textContent = 'Slow Motion';
            }
        });

        document.getElementById('showFlow').addEventListener('click', function() {
            showAirFlow = !showAirFlow;
            this.classList.toggle('active');
        });

        document.getElementById('flapStrength').addEventListener('input', function() {
            flapStrength = parseInt(this.value);
            document.getElementById('strengthValue').textContent = flapStrength;
        });

        // Handle theme changes
        const observer = new MutationObserver(updateThemeColors);
        observer.observe(document.documentElement, { attributes: true, attributeFilter: ['class'] });

        // Initialize
        updateThemeColors();
        createFlowLines();
        birdGroup.setAttribute('transform', `translate(${bird.x}, ${bird.y})`);
        animate(0);
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-8LYQ579PW8"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-8LYQ579PW8');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raven-JAMB</title>

    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
    tailwind.config = {
        darkMode: 'class',
        theme: {
            extend: {
                colors: {
                    primary: {
                        DEFAULT: "#0F2C59",
                        50: "#f0f3f8",
                        100: "#d6e1ee",
                        500: "#0F2C59",
                        600: "#0a2549",
                        700: "#081e39",
                    },
                    accent: {
                        DEFAULT: "#009F9D",
                        50: "#e6f7f7",
                        100: "#b3ebea",
                        500: "#009F9D",
                        600: "#008280",
                        700: "#006663",
                    },
                    neutral: {
                        25: "#FEFEFE",
                        50: "#F8F9FA",
                        100: "#F1F3F4",
                        200: "#E8EAED",
                        300: "#DADCE0",
                        400: "#BDC1C6",
                        500: "#9AA0A6",
                        600: "#80868B",
                        700: "#5F6368",
                        800: "#2D3748",
                        900: "#1F2937",
                    },
                    premium: {
                        DEFAULT: "#D2C1A7",
                        50: "#fbf9f6",
                        100: "#f4efe6",
                        500: "#D2C1A7",
                        600: "#c4b095",
                        700: "#b69f83",
                    },
                    data: {
                        DEFAULT: "#5A7B9E",
                        50: "#f2f5f9",
                        100: "#e1e9f2",
                        500: "#5A7B9E",
                        600: "#4d6a87",
                        700: "#405970",
                    },
                    success: "#22c55e",
                    warning: "#f59e0b",
                    error: "#ef4444",
                },
            }
        }
    }
    </script>

    <style>
        .fade-in {
            animation: fadeIn 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(16px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .material-card {
            transition: box-shadow 0.28s cubic-bezier(0.4, 0.0, 0.2, 1);
        }

        .material-card:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .material-button {
            transition: all 0.15s cubic-bezier(0.4, 0.0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .material-button:active {
            transform: scale(0.98);
        }

        .hidden-content {
            display: none !important;
        }

        .headline-4 { font-size: 1.75rem; font-weight: 400; line-height: 1.235; letter-spacing: 0.25px; }
        .headline-5 { font-size: 1.25rem; font-weight: 400; line-height: 1.334; letter-spacing: 0; }
        .headline-6 { font-size: 1.125rem; font-weight: 500; line-height: 1.6; letter-spacing: 0.15px; }
        .subtitle-1 { font-size: 1rem; font-weight: 400; line-height: 1.75; letter-spacing: 0.15px; }
        .subtitle-2 { font-size: 0.875rem; font-weight: 500; line-height: 1.57; letter-spacing: 0.1px; }
        .body-1 { font-size: 1rem; font-weight: 400; line-height: 1.5; letter-spacing: 0.5px; }
        .body-2 { font-size: 0.875rem; font-weight: 400; line-height: 1.43; letter-spacing: 0.25px; }
        .button-text { font-size: 0.875rem; font-weight: 500; line-height: 1.75; letter-spacing: 1.25px; text-transform: uppercase; }
        .caption { font-size: 0.75rem; font-weight: 400; line-height: 1.66; letter-spacing: 0.4px; }

        .subject-checkbox {
            display: none;
        }

        .subject-label {
            cursor: pointer;
            padding: 12px 16px;
            border: 2px solid #DADCE0;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .subject-checkbox:checked + .subject-label {
            background-color: #009F9D;
            border-color: #009F9D;
            color: white;
        }

        .subject-checkbox:disabled + .subject-label {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .dark .subject-label {
            border-color: #5F6368;
        }

        .dark .subject-checkbox:checked + .subject-label {
            background-color: #009F9D;
            border-color: #009F9D;
        }

        .modal-backdrop {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            padding: 1rem;
        }

        .modal-content {
            max-height: 90vh;
            overflow-y: auto;
        }
    </style>
</head>

<body class="bg-neutral-50 dark:bg-neutral-900 font-sans transition-colors duration-200">
    <!-- Material Design App Bar -->
    <header id="mainHeader" class="bg-white dark:bg-neutral-800 shadow-lg sticky top-0 z-50" style="display: none;">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center space-x-3 sm:space-x-4">
                    <div class="w-8 h-8 sm:w-10 sm:h-10 bg-primary rounded-lg flex items-center justify-center shadow-lg">
                        <span class="text-white font-medium text-sm sm:text-lg">R</span>
                    </div>
                    <div>
                        <h1 class="headline-6 text-neutral-800 dark:text-white">Raven</h1>
                    </div>
                </div>

                <div class="flex items-center space-x-2 sm:space-x-3">
                    <button id="logoutBtn" class="hidden material-button px-3 py-2 bg-error text-white rounded-lg text-sm" onclick="logout()">
                        Logout
                    </button>
                    <div id="userAvatar" class="w-8 h-8 sm:w-10 sm:h-10 bg-accent rounded-full flex items-center justify-center shadow-lg">
                        <span class="text-white font-medium text-xs sm:text-sm" id="userInitials">U</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8">
        <!-- Landing Page -->
        <section id="landingSection" class="hidden-content">
            <div class="min-h-screen flex items-center justify-center">
                <div class="material-card bg-white dark:bg-neutral-800 rounded-2xl p-8 max-w-md w-full shadow-xl text-center">
                    <div class="mb-6">
                        <div class="w-20 h-20 bg-primary rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg">
                            <span class="material-icons text-4xl text-white">school</span>
                        </div>
                        <h2 class="headline-4 text-neutral-800 dark:text-white mb-2">Welcome to Raven</h2>
                        <p class="body-1 text-neutral-600 dark:text-neutral-400">Your gateway to JAMB success</p>
                    </div>
                    <div class="space-y-3">
                        <button onclick="showSection(loginSection)" class="material-button w-full px-6 py-3 bg-primary text-white rounded-xl shadow-lg hover:shadow-xl">
                            <span class="button-text">Login</span>
                        </button>
                        <button onclick="showSection(registerSection)" class="material-button w-full px-6 py-3 border-2 border-primary text-primary rounded-xl hover:bg-primary/10">
                            <span class="button-text">Register</span>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Login Form -->
        <section id="loginSection" class="hidden-content">
            <div class="min-h-screen flex items-center justify-center">
                <div class="material-card bg-white dark:bg-neutral-800 rounded-2xl p-8 max-w-md w-full shadow-xl">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 bg-primary rounded-xl flex items-center justify-center mx-auto mb-4">
                            <span class="material-icons text-3xl text-white">person</span>
                        </div>
                        <h2 class="headline-4 text-neutral-800 dark:text-white mb-2">Login to Your Account</h2>
                        <p class="body-2 text-neutral-600 dark:text-neutral-400">Access your courses and continue learning</p>
                    </div>
                    <form id="loginForm" class="space-y-4">
                        <div>
                            <label class="block subtitle-2 text-neutral-700 dark:text-neutral-300 mb-2">Email Address</label>
                            <input type="email" id="loginEmail" required class="w-full px-4 py-3 border border-neutral-300 dark:border-neutral-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-neutral-700 dark:text-white" placeholder="Enter your email" style="font-size: 16px;">
                        </div>
                        <div>
                            <label class="block subtitle-2 text-neutral-700 dark:text-neutral-300 mb-2">Password</label>
                            <input type="password" id="loginPassword" required class="w-full px-4 py-3 border border-neutral-300 dark:border-neutral-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary dark:bg-neutral-700 dark:text-white" placeholder="Enter your password" style="font-size: 16px;">
                        </div>
                        <button type="submit" class="material-button w-full px-6 py-3 bg-primary text-white rounded-xl shadow-lg hover:shadow-xl">
                            <span class="button-text">Login</span>
                        </button>
                    </form>
                    <div class="text-center mt-4">
                        <p class="body-2 text-neutral-600 dark:text-neutral-400">Don't have an account? <a href="#" onclick="showSection(registerSection); return false;" class="text-primary font-medium">Register here</a></p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Register Form -->
        <section id="registerSection" class="hidden-content">
            <div class="min-h-screen flex items-center justify-center">
                <div class="material-card bg-white dark:bg-neutral-800 rounded-2xl p-8 max-w-2xl w-full shadow-xl">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 bg-accent rounded-xl flex items-center justify-center mx-auto mb-4">
                            <span class="material-icons text-3xl text-white">person_add</span>
                        </div>
                        <h2 class="headline-4 text-neutral-800 dark:text-white mb-2">Create an Account</h2>
                        <p class="body-2 text-neutral-600 dark:text-neutral-400">Join thousands of students learning with us</p>
                    </div>
                    <form id="registerForm" class="space-y-4">
                        <div>
                            <label class="block subtitle-2 text-neutral-700 dark:text-neutral-300 mb-2">Full Name</label>
                            <input type="text" id="registerName" required class="w-full px-4 py-3 border border-neutral-300 dark:border-neutral-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent dark:bg-neutral-700 dark:text-white" placeholder="Enter your full name" style="font-size: 16px;">
                        </div>
                        <div>
                            <label class="block subtitle-2 text-neutral-700 dark:text-neutral-300 mb-2">Email Address</label>
                            <input type="email" id="registerEmail" required class="w-full px-4 py-3 border border-neutral-300 dark:border-neutral-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent dark:bg-neutral-700 dark:text-white" placeholder="Enter your email" style="font-size: 16px;">
                        </div>
                        <div>
                            <label class="block subtitle-2 text-neutral-700 dark:text-neutral-300 mb-2">Institute of Choice</label>
                            <select id="registerInstitute" required class="w-full px-4 py-3 border border-neutral-300 dark:border-neutral-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent dark:bg-neutral-700 dark:text-white" style="font-size: 16px;">
                                <option value="">Select your target institution</option>
                                <option value="UNILAG">University of Lagos (UNILAG)</option>
                                <option value="UI">University of Ibadan (UI)</option>
                                <option value="OAU">Obafemi Awolowo University (OAU)</option>
                                <option value="UNILORIN">University of Ilorin (UNILORIN)</option>
                                <option value="FUTA">Federal University of Technology, Akure (FUTA)</option>
                                <option value="UNIBEN">University of Benin (UNIBEN)</option>
                                <option value="UNN">University of Nigeria, Nsukka (UNN)</option>
                                <option value="COVENANT">Covenant University</option>
                                <option value="OTHER">Other</option>
                            </select>
                        </div>
                        <div>
                            <label class="block subtitle-2 text-neutral-700 dark:text-neutral-300 mb-2">Target Score (JAMB)</label>
                            <input type="number" id="registerTargetScore" required min="180" max="400" class="w-full px-4 py-3 border border-neutral-300 dark:border-neutral-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent dark:bg-neutral-700 dark:text-white" placeholder="e.g., 320" style="font-size: 16px;">
                        </div>

                        <!-- Subject Selection -->
                        <div>
                            <label class="block subtitle-2 text-neutral-700 dark:text-neutral-300 mb-2">
                                Select 4 Subjects (English is compulsory)
                                <span class="caption text-accent ml-2" id="subjectCount">0/4 selected</span>
                            </label>
                            <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                                <div>
                                    <input type="checkbox" id="subject_English" name="subjects" value="English" class="subject-checkbox" checked disabled>
                                    <label for="subject_English" class="subject-label block text-center">
                                        <span class="material-icons text-sm">check_circle</span>
                                        <div class="text-sm mt-1">English</div>
                                    </label>
                                </div>
                                <div>
                                    <input type="checkbox" id="subject_Mathematics" name="subjects" value="Mathematics" class="subject-checkbox">
                                    <label for="subject_Mathematics" class="subject-label block text-center">Mathematics</label>
                                </div>
                                <div>
                                    <input type="checkbox" id="subject_Physics" name="subjects" value="Physics" class="subject-checkbox">
                                    <label for="subject_Physics" class="subject-label block text-center">Physics</label>
                                </div>
                                <div>
                                    <input type="checkbox" id="subject_Chemistry" name="subjects" value="Chemistry" class="subject-checkbox">
                                    <label for="subject_Chemistry" class="subject-label block text-center">Chemistry</label>
                                </div>
                                <div>
                                    <input type="checkbox" id="subject_Biology" name="subjects" value="Biology" class="subject-checkbox">
                                    <label for="subject_Biology" class="subject-label block text-center">Biology</label>
                                </div>
                                <div>
                                    <input type="checkbox" id="subject_Economics" name="subjects" value="Economics" class="subject-checkbox">
                                    <label for="subject_Economics" class="subject-label block text-center">Economics</label>
                                </div>
                                <div>
                                    <input type="checkbox" id="subject_Accounting" name="subjects" value="Accounting" class="subject-checkbox">
                                    <label for="subject_Accounting" class="subject-label block text-center">Accounting</label>
                                </div>
                                <div>
                                    <input type="checkbox" id="subject_Agriculture" name="subjects" value="Agriculture" class="subject-checkbox">
                                    <label for="subject_Agriculture" class="subject-label block text-center">Agriculture</label>
                                </div>
                                <div>
                                    <input type="checkbox" id="subject_Art" name="subjects" value="Art" class="subject-checkbox">
                                    <label for="subject_Art" class="subject-label block text-center">Art</label>
                                </div>
                                <div>
                                    <input type="checkbox" id="subject_Commerce" name="subjects" value="Commerce" class="subject-checkbox">
                                    <label for="subject_Commerce" class="subject-label block text-center">Commerce</label>
                                </div>
                                <div>
                                    <input type="checkbox" id="subject_Computer" name="subjects" value="Computer" class="subject-checkbox">
                                    <label for="subject_Computer" class="subject-label block text-center">Computer</label>
                                </div>
                                <div>
                                    <input type="checkbox" id="subject_CRS" name="subjects" value="CRS" class="subject-checkbox">
                                    <label for="subject_CRS" class="subject-label block text-center">CRS</label>
                                </div>
                                <div>
                                    <input type="checkbox" id="subject_Geography" name="subjects" value="Geography" class="subject-checkbox">
                                    <label for="subject_Geography" class="subject-label block text-center">Geography</label>
                                </div>
                                <div>
                                    <input type="checkbox" id="subject_Government" name="subjects" value="Government" class="subject-checkbox">
                                    <label for="subject_Government" class="subject-label block text-center">Government</label>
                                </div>
                                <div>
                                    <input type="checkbox" id="subject_History" name="subjects" value="History" class="subject-checkbox">
                                    <label for="subject_History" class="subject-label block text-center">History</label>
                                </div>
                                <div>
                                    <input type="checkbox" id="subject_HomeEconomics" name="subjects" value="Home Economics" class="subject-checkbox">
                                    <label for="subject_HomeEconomics" class="subject-label block text-center">Home Economics</label>
                                </div>
                                <div>
                                    <input type="checkbox" id="subject_IslamicStudies" name="subjects" value="Islamic Studies" class="subject-checkbox">
                                    <label for="subject_IslamicStudies" class="subject-label block text-center">Islamic Studies</label>
                                </div>
                                <div>
                                    <input type="checkbox" id="subject_Literature" name="subjects" value="Literature" class="subject-checkbox">
                                    <label for="subject_Literature" class="subject-label block text-center">Literature</label>
                                </div>
                                <div>
                                    <input type="checkbox" id="subject_PHE" name="subjects" value="PHE" class="subject-checkbox">
                                    <label for="subject_PHE" class="subject-label block text-center">PHE</label>
                                </div>
                                <div>
                                    <input type="checkbox" id="subject_Music" name="subjects" value="Music" class="subject-checkbox">
                                    <label for="subject_Music" class="subject-label block text-center">Music</label>
                                </div>
                            </div>
                        </div>

                        <div>
                            <label class="block subtitle-2 text-neutral-700 dark:text-neutral-300 mb-2">Password</label>
                            <input type="password" id="registerPassword" required class="w-full px-4 py-3 border border-neutral-300 dark:border-neutral-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent dark:bg-neutral-700 dark:text-white" placeholder="Create a password" style="font-size: 16px;">
                        </div>
                        <div>
                            <label class="block subtitle-2 text-neutral-700 dark:text-neutral-300 mb-2">Confirm Password</label>
                            <input type="password" id="registerConfirmPassword" required class="w-full px-4 py-3 border border-neutral-300 dark:border-neutral-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent dark:bg-neutral-700 dark:text-white" placeholder="Confirm your password" style="font-size: 16px;">
                        </div>
                        <button type="submit" class="material-button w-full px-6 py-3 bg-accent text-white rounded-xl shadow-lg hover:shadow-xl">
                            <span class="button-text">Register</span>
                        </button>
                    </form>
                    <div class="text-center mt-4">
                        <p class="body-2 text-neutral-600 dark:text-neutral-400">Already have an account? <a href="#" onclick="showSection(loginSection); return false;" class="text-accent font-medium">Login here</a></p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Activation Code Page -->
        <section id="activationSection" class="hidden-content">
            <div class="min-h-screen flex items-center justify-center">
                <div class="material-card bg-white dark:bg-neutral-800 rounded-2xl p-8 max-w-md w-full shadow-xl">
                    <div class="text-center mb-8">
                        <div class="w-20 h-20 bg-accent rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg">
                            <span class="material-icons text-4xl text-white">vpn_key</span>
                        </div>
                        <h2 class="headline-4 text-neutral-800 dark:text-white mb-2">Activate Your Account</h2>
                        <p class="body-1 text-neutral-600 dark:text-neutral-400">Enter your activation code to get started</p>
                    </div>

                    <form id="activationForm" class="space-y-4">
                        <div>
                            <label class="block subtitle-2 text-neutral-700 dark:text-neutral-300 mb-2">Activation Code</label>
                            <input type="text" id="activationCode" required class="w-full px-4 py-3 border border-neutral-300 dark:border-neutral-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent dark:bg-neutral-700 dark:text-white text-center text-lg tracking-wider font-mono uppercase" placeholder="XXXX-XXXX-XXXX" style="font-size: 16px;" maxlength="14">
                            <p class="caption text-neutral-500 dark:text-neutral-400 mt-2">Enter the 12-character code you received</p>
                        </div>
                        <button type="submit" class="material-button w-full px-6 py-3 bg-accent text-white rounded-xl shadow-lg hover:shadow-xl">
                            <span class="button-text">Activate Account</span>
                        </button>
                    </form>
                </div>
            </div>
        </section>

        <!-- Dashboard Page -->
        <section id="dashboardSection" class="hidden-content">
            <div class="bg-gradient-to-r from-primary to-primary-700 rounded-2xl p-8 text-white mb-8 shadow-xl">
                <h2 class="headline-4 mb-4">Hey, <span id="dashboardUserName">Student</span>!</h2>
                <p class="subtitle-1 text-primary-100 mb-6">Ready to ace your JAMB exam? Your learning journey starts here.</p>
                <div class="flex flex-wrap gap-4">
                    <div class="bg-white/10 backdrop-blur-sm rounded-lg px-4 py-3">
                        <p class="caption text-primary-100">Active Until</p>
                        <p class="subtitle-1" id="activationExpiry">-</p>
                    </div>
                    <div class="bg-white/10 backdrop-blur-sm rounded-lg px-4 py-3">
                        <p class="caption text-primary-100">Institute</p>
                        <p class="subtitle-1" id="instituteDisplay">-</p>
                    </div>
                    <div class="bg-white/10 backdrop-blur-sm rounded-lg px-4 py-3">
                        <p class="caption text-primary-100">Target Score</p>
                        <p class="subtitle-1" id="targetScoreDisplay">-</p>
                    </div>
                </div>
            </div>

            <div class="material-card bg-white dark:bg-neutral-800 rounded-2xl p-6 shadow-xl">
                <h3 class="headline-5 mb-4 text-neutral-800 dark:text-white">Your Subjects</h3>
                <div class="grid grid-cols-2 sm:grid-cols-4 gap-4" id="userSubjectsList">
                    <!-- Will be populated dynamically -->
                </div>
            </div>
        </section>
    </main>

    <script>
        /* eslint-disable no-restricted-globals */
        // Global variables
        let allUsers = JSON.parse(localStorage.getItem('raven_users')) || [];
        let activationCodes = JSON.parse(localStorage.getItem('raven_activation_codes')) || [];
        let currentUser = null;

        // DOM Elements
        const landingSection = document.getElementById('landingSection');
        const loginSection = document.getElementById('loginSection');
        const registerSection = document.getElementById('registerSection');
        const activationSection = document.getElementById('activationSection');
        const dashboardSection = document.getElementById('dashboardSection');
        const mainHeader = document.getElementById('mainHeader');
        const logoutBtn = document.getElementById('logoutBtn');

        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            initializeSubjectSelection();
            checkExistingSession();
        });

        // Subject selection logic
        function initializeSubjectSelection() {
            const checkboxes = document.querySelectorAll('input[name="subjects"]');
            const countDisplay = document.getElementById('subjectCount');

            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', () => {
                    const checked = document.querySelectorAll('input[name="subjects"]:checked');
                    countDisplay.textContent = `${checked.length}/4 selected`;

                    // Disable unchecked boxes if 4 are selected
                    if (checked.length >= 4) {
                        checkboxes.forEach(cb => {
                            if (!cb.checked && cb.id !== 'subject_English') {
                                cb.disabled = true;
                            }
                        });
                    } else {
                        checkboxes.forEach(cb => {
                            if (cb.id !== 'subject_English') {
                                cb.disabled = false;
                            }
                        });
                    }
                });
            });
        }

        // Check if user is already logged in
        function checkExistingSession() {
            const userEmail = localStorage.getItem('currentUserEmail');
            if (userEmail) {
                const user = allUsers.find(u => u.email === userEmail);
                if (user) {
                    currentUser = user;
                    if (user.isActive && new Date(user.activationExpiry) > new Date()) {
                        updateUserDisplay(user);
                        renderDashboard();
                        showSection(dashboardSection);
                    } else if (user.isActive) {
                        // Expired activation
                        user.isActive = false;
                        saveUsers();
                        showSection(activationSection);
                        showMaterialToast('Your activation has expired. Please enter a new code.', 'warning');
                    } else {
                        showSection(activationSection);
                    }
                } else {
                    showSection(landingSection);
                }
            } else {
                showSection(landingSection);
            }
        }

        // Show/Hide Sections
        function showSection(section) {
            [landingSection, loginSection, registerSection, activationSection, dashboardSection].forEach(s => {
                s.classList.add('hidden-content');
            });

            section.classList.remove('hidden-content');

            if (section === dashboardSection) {
                mainHeader.style.display = 'block';
            } else {
                mainHeader.style.display = 'none';
            }

            window.scrollTo(0, 0);
        }

        // Login Form Handler
        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            const user = allUsers.find(u => u.email === email && u.password === password);

            if (user) {
                localStorage.setItem('currentUserEmail', email);
                currentUser = user;

                if (user.isActive && new Date(user.activationExpiry) > new Date()) {
                    updateUserDisplay(user);
                    renderDashboard();
                    showSection(dashboardSection);
                    showMaterialToast('Welcome back! ðŸŽ“', 'success');
                } else if (user.isActive && new Date(user.activationExpiry) <= new Date()) {
                    user.isActive = false;
                    saveUsers();
                    showSection(activationSection);
                    showMaterialToast('Your activation has expired. Please enter a new code.', 'warning');
                } else {
                    showSection(activationSection);
                    showMaterialToast('Please activate your account', 'info');
                }
            } else {
                showMaterialToast('Invalid email or password!', 'error');
            }
        });

        // Register Form Handler
        document.getElementById('registerForm').addEventListener('submit', (e) => {
            e.preventDefault();

            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const institute = document.getElementById('registerInstitute').value;
            const targetScore = document.getElementById('registerTargetScore').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;

            // Get selected subjects
            const selectedSubjects = Array.from(document.querySelectorAll('input[name="subjects"]:checked'))
                .map(cb => cb.value);

            if (selectedSubjects.length !== 4) {
                showMaterialToast('Please select exactly 4 subjects (including English)', 'error');
                return;
            }

            if (password !== confirmPassword) {
                showMaterialToast('Passwords do not match!', 'error');
                return;
            }

            if (allUsers.find(user => user.email === email)) {
                showMaterialToast('User with this email already exists!', 'error');
                return;
            }

            // Create user object
            const newUser = {
                id: allUsers.length > 0 ? Math.max(...allUsers.map(u => u.id || 0)) + 1 : 1,
                name: name,
                email: email,
                password: password,
                institute: institute,
                targetScore: parseInt(targetScore),
                subjects: selectedSubjects,
                registrationDate: new Date().toISOString(),
                isActive: false,
                activationExpiry: null,
                activationCode: null,
            };

            allUsers.push(newUser);
            saveUsers();

            localStorage.setItem('currentUserEmail', email);
            currentUser = newUser;

            showSection(activationSection);
            showMaterialToast('Account created successfully! Please activate your account.', 'success');
        });

        // Activation Form Handler
        document.getElementById('activationForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const code = document.getElementById('activationCode').value.trim().toUpperCase();

            const codeObj = activationCodes.find(c => c.code === code && !c.used);

            if (codeObj) {
                // Mark code as used
                codeObj.used = true;
                codeObj.usedBy = currentUser.email;
                codeObj.usedDate = new Date().toISOString();
                saveCodes();

                // Calculate expiry date
                const now = new Date();
                let expiryDate;
                if (codeObj.duration === 'trial') {
                    expiryDate = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000); // 7 days
                } else if (codeObj.duration === 'monthly') {
                    expiryDate = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000); // 30 days
                }

                // Activate user
                currentUser.isActive = true;
                currentUser.activationCode = code;
                currentUser.activationExpiry = expiryDate.toISOString();
                currentUser.activationDuration = codeObj.duration;

                const userIndex = allUsers.findIndex(u => u.email === currentUser.email);
                if (userIndex !== -1) {
                    allUsers[userIndex] = currentUser;
                    saveUsers();
                }

                updateUserDisplay(currentUser);
                renderDashboard();
                showSection(dashboardSection);

                const durationText = codeObj.duration === 'trial' ? '7-day trial' : '30-day';
                showMaterialToast(`Account activated! Your ${durationText} access is now active ðŸŽ“`, 'success');
            } else {
                showMaterialToast('Invalid or already used activation code!', 'error');
            }
        });

        // Render Dashboard
        function renderDashboard() {
            if (!currentUser) return;

            document.getElementById('dashboardUserName').textContent = currentUser.name.split(' ')[0];
            document.getElementById('instituteDisplay').textContent = currentUser.institute || '-';
            document.getElementById('targetScoreDisplay').textContent = currentUser.targetScore || '-';

            if (currentUser.activationExpiry) {
                const expiryDate = new Date(currentUser.activationExpiry);
                document.getElementById('activationExpiry').textContent = expiryDate.toLocaleDateString();
            }

            // Display user subjects
            const subjectsList = document.getElementById('userSubjectsList');
            const subjectIcons = {
                'English': 'menu_book',
                'Mathematics': 'calculate',
                'Physics': 'science',
                'Chemistry': 'biotech',
                'Biology': 'eco',
                'Economics': 'trending_up',
                'Accounting': 'account_balance',
                'Agriculture': 'agriculture',
                'Art': 'palette',
                'Commerce': 'store',
                'Computer': 'computer',
                'CRS': 'church',
                'Geography': 'public',
                'Government': 'gavel',
                'History': 'history_edu',
                'Home Economics': 'home',
                'Islamic Studies': 'mosque',
                'Literature': 'auto_stories',
                'PHE': 'sports',
                'Music': 'music_note'
            };

            subjectsList.innerHTML = currentUser.subjects.map(subject => `
                <div class="material-card bg-primary/10 rounded-lg p-4 text-center">
                    <span class="material-icons text-primary text-3xl mb-2">${subjectIcons[subject] || 'book'}</span>
                    <p class="subtitle-2 text-neutral-800 dark:text-white">${subject}</p>
                </div>
            `).join('');
        }

        // Update user display
        function updateUserDisplay(user) {
            const initials = user.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
            document.getElementById('userInitials').textContent = initials;
            logoutBtn.classList.remove('hidden');
        }

        // Logout functionality
        function logout() {
            localStorage.removeItem('currentUserEmail');
            currentUser = null;
            logoutBtn.classList.add('hidden');
            showSection(landingSection);
            showMaterialToast('Logged out successfully', 'info');
        }

        // Helper functions
        function saveUsers() {
            localStorage.setItem('raven_users', JSON.stringify(allUsers));
        }

        function saveCodes() {
            localStorage.setItem('raven_activation_codes', JSON.stringify(activationCodes));
        }

        // Material Design Toast System
        function showMaterialToast(message, type = 'info') {
            const toastContainer = document.getElementById('toast-container') || createToastContainer();

            const toast = document.createElement('div');
            const iconMap = {
                success: 'check_circle',
                error: 'error',
                warning: 'warning',
                info: 'info'
            };

            const colorMap = {
                success: 'bg-success text-white',
                error: 'bg-error text-white',
                warning: 'bg-warning text-white',
                info: 'bg-accent text-white'
            };

            toast.className = `material-card flex items-center space-x-3 px-6 py-4 rounded-2xl shadow-xl ${colorMap[type]} transform translate-y-2 opacity-0 transition-all duration-300 mb-4`;

            toast.innerHTML = `
                <span class="material-icons">${iconMap[type]}</span>
                <span class="subtitle-2 flex-1">${message}</span>
                <button onclick="this.parentElement.remove()" class="material-icons hover:bg-white/10 rounded-full p-1">close</button>
            `;

            toastContainer.appendChild(toast);

            setTimeout(() => {
                toast.classList.remove('translate-y-2', 'opacity-0');
            }, 100);

            setTimeout(() => {
                if (toast.parentElement) {
                    toast.classList.add('translate-y-2', 'opacity-0');
                    setTimeout(() => toast.remove(), 300);
                }
            }, 3000);
        }

        function createToastContainer() {
            const container = document.createElement('div');
            container.id = 'toast-container';
            container.className = 'fixed bottom-6 left-6 z-50 max-w-sm';
            document.body.appendChild(container);
            return container;
        }

        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
        /* eslint-enable no-restricted-globals */
    </script>
</body>
</html>
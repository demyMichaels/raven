<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Quiz Master</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                    }
                }
            }
        }
    </script>
    <style>
        .loading-spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #5D5CDE;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .pulse-glow {
            animation: pulse-glow 2s infinite;
        }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 5px #5D5CDE; }
            50% { box-shadow: 0 0 20px #5D5CDE, 0 0 30px #5D5CDE; }
        }
        .correct-answer {
            background: linear-gradient(135deg, #10B981, #059669);
            animation: celebrate 0.6s ease-in-out;
        }
        .wrong-answer {
            background: linear-gradient(135deg, #EF4444, #DC2626);
            animation: shake 0.6s ease-in-out;
        }
        @keyframes celebrate {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .speaking {
            background: linear-gradient(45deg, #5D5CDE, #8B5CF6);
            color: white;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 min-h-screen transition-colors duration-200">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-900 dark:text-white mb-2">🎧 Audio Quiz Master</h1>
            <p class="text-gray-600 dark:text-gray-400">Interactive quiz with natural voice narration using Web Speech API</p>
        </div>

        <!-- Browser Compatibility Check -->
        <div id="compatibilityWarning" class="bg-yellow-100 dark:bg-yellow-900 border border-yellow-400 dark:border-yellow-600 text-yellow-700 dark:text-yellow-300 px-4 py-3 rounded mb-6 hidden">
            <div class="flex items-center">
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
                <p><strong>Note:</strong> Your browser may not support speech synthesis. Please use Chrome, Firefox, Safari, or Edge for the best experience.</p>
            </div>
        </div>

        <!-- Voice Settings Card -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-6 border border-gray-200 dark:border-gray-700">
            <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4 flex items-center">
                <svg class="w-6 h-6 mr-2 text-primary" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                </svg>
                Voice Settings
            </h2>
            <div class="grid md:grid-cols-3 gap-4">
                <div>
                    <label for="voiceSelect" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Narrator Voice
                    </label>
                    <select id="voiceSelect" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                        <option value="">Loading voices...</option>
                    </select>
                </div>
                <div>
                    <label for="rateSlider" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Speech Rate: <span id="rateValue">1.0</span>x
                    </label>
                    <input type="range" id="rateSlider" min="0.5" max="2" step="0.1" value="1" 
                           class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700">
                </div>
                <div>
                    <label for="pitchSlider" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Pitch: <span id="pitchValue">1.0</span>
                    </label>
                    <input type="range" id="pitchSlider" min="0.5" max="2" step="0.1" value="1" 
                           class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700">
                </div>
            </div>
            <div class="mt-4 flex gap-3">
                <button id="testVoiceBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors duration-200 flex items-center gap-2">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/>
                    </svg>
                    Test Voice
                </button>
                <button id="stopSpeechBtn" class="bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded-md transition-colors duration-200 hidden">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z" clip-rule="evenodd"/>
                    </svg>
                    Stop Speech
                </button>
            </div>
        </div>

        <!-- Quiz Card -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden">
            <!-- Quiz Header -->
            <div class="bg-gradient-to-r from-primary to-purple-600 p-6 text-white">
                <div class="flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold">General Knowledge Quiz</h2>
                        <p class="opacity-90">Test your knowledge with audio narration</p>
                    </div>
                    <div class="text-right">
                        <div class="text-sm opacity-90">Question</div>
                        <div class="text-2xl font-bold"><span id="currentQuestion">1</span>/<span id="totalQuestions">10</span></div>
                    </div>
                </div>
                <div class="mt-4 bg-white bg-opacity-20 rounded-full h-2">
                    <div id="progressBar" class="bg-white h-2 rounded-full transition-all duration-300" style="width: 10%"></div>
                </div>
            </div>

            <!-- Quiz Content -->
            <div class="p-6">
                <!-- Question Section -->
                <div id="questionSection" class="mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-semibold text-gray-900 dark:text-white">Question <span id="questionNumber">1</span></h3>
                        <div class="flex gap-2">
                            <button id="readQuestionBtn" class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md transition-all duration-200 flex items-center gap-2">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M18 3a1 1 0 00-1.196-.98l-10 2A1 1 0 006 5v9.114A4.369 4.369 0 005 14c-1.657 0-3 .895-3 2s1.343 2 3 2 3-.895 3-2V7.82l8-1.6v5.894A4.369 4.369 0 0015 12c-1.657 0-3 .895-3 2s1.343 2 3 2 3-.895 3-2V3z"/>
                                </svg>
                                <span id="readQuestionBtnText">Read Question</span>
                                <div id="readQuestionSpinner" class="loading-spinner hidden"></div>
                            </button>
                            <button id="autoReadToggle" class="bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 px-3 rounded-md transition-colors duration-200" title="Auto-read questions">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div id="questionText" class="text-lg text-gray-700 dark:text-gray-300 bg-gray-50 dark:bg-gray-700 p-4 rounded-lg border-l-4 border-primary">
                        Loading question...
                    </div>
                </div>

                <!-- Options Section -->
                <div id="optionsSection" class="mb-6">
                    <h4 class="text-lg font-medium text-gray-900 dark:text-white mb-3">Choose your answer:</h4>
                    <div id="optionsContainer" class="space-y-3">
                        <!-- Options will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Control Buttons -->
                <div id="controlButtons" class="flex flex-wrap gap-3 justify-center">
                    <button id="nextBtn" class="bg-primary hover:bg-primary/90 disabled:bg-gray-400 disabled:cursor-not-allowed text-white font-medium py-3 px-6 rounded-md transition-all duration-200 hidden">
                        Next Question →
                    </button>
                    <button id="restartBtn" class="bg-gray-600 hover:bg-gray-700 text-white font-medium py-2 px-4 rounded-md transition-colors duration-200 hidden">
                        Restart Quiz
                    </button>
                    <button id="finishBtn" class="bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-6 rounded-md transition-colors duration-200 hidden">
                        Finish Quiz
                    </button>
                </div>

                <!-- Results Section -->
                <div id="resultsSection" class="hidden text-center">
                    <div class="bg-gradient-to-r from-green-400 to-green-600 text-white p-6 rounded-lg">
                        <h3 class="text-2xl font-bold mb-2">🎉 Quiz Complete!</h3>
                        <p class="text-xl">Your Score: <span id="finalScore" class="font-bold">0</span>/10</p>
                        <p id="scoreMessage" class="mt-2 opacity-90"></p>
                        <button id="readResultsBtn" class="mt-4 bg-white bg-opacity-20 hover:bg-opacity-30 text-white font-medium py-2 px-4 rounded-md transition-colors duration-200">
                            Read Results Aloud
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Messages -->
        <div id="statusMessage" class="mt-4 p-3 rounded-md hidden">
            <p id="statusText"></p>
        </div>

        <!-- Instructions -->
        <div class="mt-8 bg-gray-50 dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-3">Features & Instructions</h3>
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <h4 class="font-medium text-gray-900 dark:text-white mb-2">🎵 Voice Features:</h4>
                    <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                        <li>• Choose from your browser's available voices</li>
                        <li>• Adjust speech rate (0.5x to 2x speed)</li>
                        <li>• Control pitch for different voice tones</li>
                        <li>• Test voices before starting the quiz</li>
                        <li>• Auto-read feature for hands-free quizzing</li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-medium text-gray-900 dark:text-white mb-2">🎯 Quiz Features:</h4>
                    <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                        <li>• 10 general knowledge questions</li>
                        <li>• Visual progress tracking</li>
                        <li>• Immediate feedback with animations</li>
                        <li>• Score tracking and performance messages</li>
                        <li>• Full keyboard and screen reader support</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Quiz questions database
        const quizQuestions = [
            {
                question: "What is the capital of France?",
                options: ["London", "Berlin", "Paris", "Madrid"],
                correct: 2
            },
            {
                question: "Which planet is known as the Red Planet?",
                options: ["Venus", "Mars", "Jupiter", "Saturn"],
                correct: 1
            },
            {
                question: "What is the largest mammal in the world?",
                options: ["African Elephant", "Blue Whale", "Giraffe", "Hippopotamus"],
                correct: 1
            },
            {
                question: "In what year did World War II end?",
                options: ["1944", "1945", "1946", "1947"],
                correct: 1
            },
            {
                question: "What is the chemical symbol for gold?",
                options: ["Go", "Gd", "Au", "Ag"],
                correct: 2
            },
            {
                question: "Which ocean is the largest?",
                options: ["Atlantic Ocean", "Indian Ocean", "Arctic Ocean", "Pacific Ocean"],
                correct: 3
            },
            {
                question: "Who painted the Mona Lisa?",
                options: ["Vincent van Gogh", "Leonardo da Vinci", "Pablo Picasso", "Michelangelo"],
                correct: 1
            },
            {
                question: "What is the smallest country in the world?",
                options: ["Monaco", "Vatican City", "San Marino", "Liechtenstein"],
                correct: 1
            },
            {
                question: "Which element has the atomic number 1?",
                options: ["Helium", "Hydrogen", "Lithium", "Carbon"],
                correct: 1
            },
            {
                question: "In which continent is the Sahara Desert located?",
                options: ["Asia", "Australia", "Africa", "South America"],
                correct: 2
            }
        ];

        // Speech API using Web Speech API
        class WebSpeechAPI {
            constructor() {
                this.synth = window.speechSynthesis;
                this.voices = [];
                this.currentUtterance = null;
                this.loadVoices();
                
                // Handle voices loading (some browsers load them asynchronously)
                if (this.synth.onvoiceschanged !== undefined) {
                    this.synth.onvoiceschanged = () => this.loadVoices();
                }
            }

            loadVoices() {
                this.voices = this.synth.getVoices();
                this.populateVoiceSelect();
            }

            populateVoiceSelect() {
                const voiceSelect = document.getElementById('voiceSelect');
                if (!voiceSelect || this.voices.length === 0) return;

                voiceSelect.innerHTML = '';
                
                // Group voices by language for better organization
                const groupedVoices = {};
                this.voices.forEach((voice, index) => {
                    const lang = voice.lang.split('-')[0];
                    if (!groupedVoices[lang]) groupedVoices[lang] = [];
                    groupedVoices[lang].push({ voice, index });
                });

                // Add English voices first, then others
                const englishVoices = groupedVoices['en'] || [];
                englishVoices.forEach(({ voice, index }) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = `${voice.name} (${voice.lang})`;
                    if (voice.default) option.selected = true;
                    voiceSelect.appendChild(option);
                });

                // Add other languages
                Object.keys(groupedVoices).forEach(lang => {
                    if (lang === 'en') return;
                    const langVoices = groupedVoices[lang];
                    if (langVoices.length > 0) {
                        const optgroup = document.createElement('optgroup');
                        optgroup.label = `${lang.toUpperCase()} Voices`;
                        langVoices.forEach(({ voice, index }) => {
                            const option = document.createElement('option');
                            option.value = index;
                            option.textContent = `${voice.name} (${voice.lang})`;
                            optgroup.appendChild(option);
                        });
                        voiceSelect.appendChild(optgroup);
                    }
                });

                // If no voices loaded, show a message
                if (this.voices.length === 0) {
                    const option = document.createElement('option');
                    option.textContent = 'No voices available';
                    voiceSelect.appendChild(option);
                }
            }

            speak(text, options = {}) {
                return new Promise((resolve, reject) => {
                    if (!this.synth) {
                        reject(new Error('Speech synthesis not supported'));
                        return;
                    }

                    // Stop any current speech
                    this.stop();

                    const utterance = new SpeechSynthesisUtterance(text);
                    
                    // Set voice
                    const voiceIndex = options.voiceIndex || document.getElementById('voiceSelect').value;
                    if (voiceIndex && this.voices[voiceIndex]) {
                        utterance.voice = this.voices[voiceIndex];
                    }

                    // Set rate and pitch
                    utterance.rate = options.rate || parseFloat(document.getElementById('rateSlider').value);
                    utterance.pitch = options.pitch || parseFloat(document.getElementById('pitchSlider').value);
                    utterance.volume = 1;

                    // Event handlers
                    utterance.onend = () => {
                        this.currentUtterance = null;
                        resolve();
                    };
                    
                    utterance.onerror = (event) => {
                        this.currentUtterance = null;
                        reject(new Error(`Speech synthesis error: ${event.error}`));
                    };

                    this.currentUtterance = utterance;
                    this.synth.speak(utterance);
                });
            }

            stop() {
                if (this.synth && this.synth.speaking) {
                    this.synth.cancel();
                }
                this.currentUtterance = null;
            }

            isSpeaking() {
                return this.synth && this.synth.speaking;
            }
        }

        // Quiz Application Class
        class AudioQuiz {
            constructor() {
                this.speechAPI = new WebSpeechAPI();
                this.currentQuestionIndex = 0;
                this.score = 0;
                this.answered = false;
                this.autoRead = false;
                
                this.initializeElements();
                this.setupEventListeners();
                this.checkBrowserSupport();
                this.loadQuestion();
                this.setupDarkMode();
            }

            initializeElements() {
                this.voiceSelect = document.getElementById('voiceSelect');
                this.rateSlider = document.getElementById('rateSlider');
                this.pitchSlider = document.getElementById('pitchSlider');
                this.rateValue = document.getElementById('rateValue');
                this.pitchValue = document.getElementById('pitchValue');
                this.testVoiceBtn = document.getElementById('testVoiceBtn');
                this.stopSpeechBtn = document.getElementById('stopSpeechBtn');
                this.questionText = document.getElementById('questionText');
                this.optionsContainer = document.getElementById('optionsContainer');
                this.readQuestionBtn = document.getElementById('readQuestionBtn');
                this.readQuestionBtnText = document.getElementById('readQuestionBtnText');
                this.readQuestionSpinner = document.getElementById('readQuestionSpinner');
                this.autoReadToggle = document.getElementById('autoReadToggle');
                this.nextBtn = document.getElementById('nextBtn');
                this.restartBtn = document.getElementById('restartBtn');
                this.finishBtn = document.getElementById('finishBtn');
                this.currentQuestion = document.getElementById('currentQuestion');
                this.totalQuestions = document.getElementById('totalQuestions');
                this.questionNumber = document.getElementById('questionNumber');
                this.progressBar = document.getElementById('progressBar');
                this.resultsSection = document.getElementById('resultsSection');
                this.finalScore = document.getElementById('finalScore');
                this.scoreMessage = document.getElementById('scoreMessage');
                this.readResultsBtn = document.getElementById('readResultsBtn');
                this.statusMessage = document.getElementById('statusMessage');
                this.statusText = document.getElementById('statusText');

                this.totalQuestions.textContent = quizQuestions.length;
            }

            setupEventListeners() {
                this.testVoiceBtn.addEventListener('click', () => this.testVoice());
                this.stopSpeechBtn.addEventListener('click', () => this.stopSpeech());
                this.readQuestionBtn.addEventListener('click', () => this.readCurrentQuestion());
                this.autoReadToggle.addEventListener('click', () => this.toggleAutoRead());
                this.nextBtn.addEventListener('click', () => this.nextQuestion());
                this.restartBtn.addEventListener('click', () => this.restartQuiz());
                this.finishBtn.addEventListener('click', () => this.finishQuiz());
                this.readResultsBtn.addEventListener('click', () => this.readResults());
                
                // Slider event listeners
                this.rateSlider.addEventListener('input', () => {
                    this.rateValue.textContent = this.rateSlider.value;
                });
                
                this.pitchSlider.addEventListener('input', () => {
                    this.pitchValue.textContent = this.pitchSlider.value;
                });

                // Stop speech when voices change
                this.voiceSelect.addEventListener('change', () => this.stopSpeech());
            }

            setupDarkMode() {
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.documentElement.classList.add('dark');
                }
                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                    if (event.matches) {
                        document.documentElement.classList.add('dark');
                    } else {
                        document.documentElement.classList.remove('dark');
                    }
                });
            }

            checkBrowserSupport() {
                if (!('speechSynthesis' in window)) {
                    document.getElementById('compatibilityWarning').classList.remove('hidden');
                    this.showStatus('Speech synthesis is not supported in your browser. Please use Chrome, Firefox, Safari, or Edge.', 'error');
                }
            }

            toggleAutoRead() {
                this.autoRead = !this.autoRead;
                this.autoReadToggle.classList.toggle('bg-green-600', this.autoRead);
                this.autoReadToggle.classList.toggle('bg-purple-600', !this.autoRead);
                this.autoReadToggle.title = this.autoRead ? 'Auto-read: ON' : 'Auto-read: OFF';
                
                this.showStatus(this.autoRead ? 'Auto-read enabled' : 'Auto-read disabled', 'info');
            }

            async testVoice() {
                const testText = "Hello! This is a test of the selected voice. You can adjust the rate and pitch using the sliders above.";
                await this.speakText(testText);
            }

            async speakText(text) {
                try {
                    this.setSpeakingState(true);
                    await this.speechAPI.speak(text);
                } catch (error) {
                    console.error('Speech error:', error);
                    this.showStatus(`Speech error: ${error.message}`, 'error');
                } finally {
                    this.setSpeakingState(false);
                }
            }

            stopSpeech() {
                this.speechAPI.stop();
                this.setSpeakingState(false);
            }

            setSpeakingState(speaking) {
                this.stopSpeechBtn.classList.toggle('hidden', !speaking);
                this.readQuestionBtn.classList.toggle('speaking', speaking);
                
                if (speaking) {
                    this.readQuestionBtnText.textContent = 'Speaking...';
                    this.readQuestionSpinner.classList.remove('hidden');
                } else {
                    this.readQuestionBtnText.textContent = 'Read Question';
                    this.readQuestionSpinner.classList.add('hidden');
                }
            }

            loadQuestion() {
                const question = quizQuestions[this.currentQuestionIndex];
                this.questionText.textContent = question.question;
                this.questionNumber.textContent = this.currentQuestionIndex + 1;
                this.currentQuestion.textContent = this.currentQuestionIndex + 1;
                
                // Update progress bar
                const progress = ((this.currentQuestionIndex + 1) / quizQuestions.length) * 100;
                this.progressBar.style.width = `${progress}%`;
                
                // Clear previous options
                this.optionsContainer.innerHTML = '';
                
                // Create option buttons
                question.options.forEach((option, index) => {
                    const button = document.createElement('button');
                    button.className = 'w-full text-left p-4 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors duration-200 bg-white dark:bg-gray-700 text-gray-900 dark:text-white';
                    button.innerHTML = `
                        <div class="flex items-center">
                            <span class="bg-primary text-white rounded-full w-8 h-8 flex items-center justify-center text-sm font-medium mr-3">
                                ${String.fromCharCode(65 + index)}
                            </span>
                            <span class="text-base">${option}</span>
                        </div>
                    `;
                    
                    button.addEventListener('click', () => this.selectAnswer(index, button));
                    this.optionsContainer.appendChild(button);
                });
                
                this.answered = false;
                this.nextBtn.classList.add('hidden');
                this.finishBtn.classList.add('hidden');

                // Auto-read if enabled
                if (this.autoRead && this.currentQuestionIndex > 0) {
                    setTimeout(() => this.readCurrentQuestion(), 1000);
                }
            }

            async readCurrentQuestion() {
                const question = quizQuestions[this.currentQuestionIndex];
                const optionsText = question.options.map((option, index) => 
                    `Option ${String.fromCharCode(65 + index)}: ${option}`
                ).join('. ');
                
                const fullText = `Question ${this.currentQuestionIndex + 1}: ${question.question}. The options are: ${optionsText}`;
                
                await this.speakText(fullText);
            }

            selectAnswer(selectedIndex, buttonElement) {
                if (this.answered) return;
                
                this.stopSpeech(); // Stop any current speech
                this.answered = true;
                const question = quizQuestions[this.currentQuestionIndex];
                const isCorrect = selectedIndex === question.correct;
                
                if (isCorrect) {
                    this.score++;
                    buttonElement.classList.add('correct-answer');
                    this.showStatus('Correct! Well done! 🎉', 'success');
                    if (this.autoRead) {
                        setTimeout(() => this.speakText('Correct! Well done!'), 500);
                    }
                } else {
                    buttonElement.classList.add('wrong-answer');
                    // Show correct answer
                    const correctButton = this.optionsContainer.children[question.correct];
                    correctButton.classList.add('correct-answer');
                    this.showStatus(`Incorrect. The correct answer was: ${question.options[question.correct]}`, 'error');
                    if (this.autoRead) {
                        setTimeout(() => this.speakText(`Incorrect. The correct answer was: ${question.options[question.correct]}`), 500);
                    }
                }
                
                // Disable all option buttons
                Array.from(this.optionsContainer.children).forEach(btn => {
                    btn.disabled = true;
                    btn.classList.add('cursor-not-allowed', 'opacity-75');
                });
                
                // Show appropriate next button
                if (this.currentQuestionIndex < quizQuestions.length - 1) {
                    this.nextBtn.classList.remove('hidden');
                } else {
                    this.finishBtn.classList.remove('hidden');
                }
            }

            nextQuestion() {
                this.currentQuestionIndex++;
                this.loadQuestion();
                this.hideStatus();
            }

            finishQuiz() {
                this.showResults();
            }

            showResults() {
                document.getElementById('questionSection').classList.add('hidden');
                document.getElementById('optionsSection').classList.add('hidden');
                document.getElementById('controlButtons').classList.add('hidden');
                
                this.finalScore.textContent = this.score;
                
                let message = '';
                const percentage = (this.score / quizQuestions.length) * 100;
                
                if (percentage >= 90) {
                    message = 'Outstanding! You\'re a quiz master! 🏆';
                } else if (percentage >= 70) {
                    message = 'Great job! You know your stuff! 👏';
                } else if (percentage >= 50) {
                    message = 'Not bad! Keep learning! 📚';
                } else {
                    message = 'Keep practicing! You\'ll improve! 💪';
                }
                
                this.scoreMessage.textContent = message;
                this.resultsSection.classList.remove('hidden');
                this.restartBtn.classList.remove('hidden');

                // Auto-read results if enabled
                if (this.autoRead) {
                    setTimeout(() => this.readResults(), 1000);
                }
            }

            async readResults() {
                const percentage = (this.score / quizQuestions.length) * 100;
                const resultsText = `Quiz complete! You scored ${this.score} out of ${quizQuestions.length}, which is ${Math.round(percentage)} percent. ${this.scoreMessage.textContent}`;
                await this.speakText(resultsText);
            }

            restartQuiz() {
                this.currentQuestionIndex = 0;
                this.score = 0;
                this.answered = false;
                
                document.getElementById('questionSection').classList.remove('hidden');
                document.getElementById('optionsSection').classList.remove('hidden');
                document.getElementById('controlButtons').classList.remove('hidden');
                this.resultsSection.classList.add('hidden');
                this.restartBtn.classList.add('hidden');
                
                this.loadQuestion();
                this.hideStatus();
                this.stopSpeech();
            }

            showStatus(message, type) {
                this.statusText.textContent = message;
                this.statusMessage.className = `mt-4 p-3 rounded-md ${
                    type === 'success' ? 'bg-green-100 dark:bg-green-900/20 text-green-700 dark:text-green-300 border border-green-300 dark:border-green-700' :
                    type === 'error' ? 'bg-red-100 dark:bg-red-900/20 text-red-700 dark:text-red-300 border border-red-300 dark:border-red-700' :
                    'bg-blue-100 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 border border-blue-300 dark:border-blue-700'
                }`;
                this.statusMessage.classList.remove('hidden');
                
                if (type === 'success' || type === 'info') {
                    setTimeout(() => this.hideStatus(), 3000);
                }
            }

            hideStatus() {
                this.statusMessage.classList.add('hidden');
            }
        }

        // Initialize the quiz when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            // Small delay to ensure voices are loaded
            setTimeout(() => {
                window.quiz = new AudioQuiz();
            }, 100);
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MnO₄⁻ Reduction Visualizer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #f0f0f0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #00b4d8;
        }

        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #00b4d8, #90e0ef);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 10px rgba(0, 180, 216, 0.3);
        }

        .subtitle {
            font-size: 1.2rem;
            color: #90e0ef;
            margin-bottom: 20px;
        }

        .reaction-box {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(0, 180, 216, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            text-align: center;
            font-size: 1.4rem;
        }

        .reaction-equation {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }

        .chemical {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .mno4 { background: rgba(155, 0, 255, 0.2); border: 2px solid #9b00ff; }
        .hplus { background: rgba(255, 50, 50, 0.2); border: 2px solid #ff3232; }
        .electron { background: rgba(255, 215, 0, 0.2); border: 2px solid #ffd700; }
        .mn2plus { background: rgba(0, 180, 216, 0.2); border: 2px solid #00b4d8; }
        .h2o { background: rgba(0, 150, 255, 0.2); border: 2px solid #0096ff; }

        .arrow {
            font-size: 2rem;
            color: #00b4d8;
        }

        .simulation-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 40px;
        }

        .visualization-container {
            width: 100%;
            height: 400px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .control-panel {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(90deg, #00b4d8, #0077b6);
            color: white;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #f0f0f0;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(0, 0, 0, 0.3);
        }

        .btn:active {
            transform: translateY(1px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .electron-counter {
            font-size: 1.8rem;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .electron-dot {
            display: inline-block;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle at 30% 30%, #ffd700, #ff9800);
            border-radius: 50%;
            box-shadow: 0 0 10px #ffd700;
        }

        .oxidation-state {
            position: absolute;
            font-size: 1.2rem;
            font-weight: bold;
            color: #ffd700;
            background: rgba(0, 0, 0, 0.7);
            padding: 5px 10px;
            border-radius: 5px;
            z-index: 10;
        }

        .molecule {
            position: absolute;
            transition: all 1.5s ease;
        }

        .manganese {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.5rem;
            color: white;
        }

        .oxygen {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }

        .electron-visual {
            position: absolute;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #ffd700, #ff9800);
            box-shadow: 0 0 10px #ffd700;
            z-index: 5;
        }

        .water-molecule {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .hydrogen {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #ff3232, #b30000);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
        }

        .info-panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            border-left: 5px solid #00b4d8;
        }

        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .step {
            text-align: center;
            flex: 1;
            padding: 15px;
            min-width: 150px;
            border-bottom: 3px solid rgba(255, 255, 255, 0.1);
            opacity: 0.5;
            transition: all 0.3s ease;
        }

        .step.active {
            opacity: 1;
            border-bottom: 3px solid #00b4d8;
        }

        .step-number {
            display: inline-block;
            width: 30px;
            height: 30px;
            background: #00b4d8;
            border-radius: 50%;
            line-height: 30px;
            margin-bottom: 10px;
            font-weight: bold;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #90e0ef;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .reaction-equation {
                flex-direction: column;
            }
            
            .arrow {
                transform: rotate(90deg);
                margin: 10px 0;
            }
            
            .control-panel {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 300px;
                justify-content: center;
            }
            
            .step-indicator {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-atom"></i> MnO₄⁻ Reduction Visualizer</h1>
            <p class="subtitle">Interactive simulation of permanganate reduction in acidic medium</p>
        </header>

        <div class="reaction-box">
            <p>Balanced Half-Reaction:</p>
            <div class="reaction-equation">
                <div class="chemical mno4">MnO₄⁻</div>
                <div>+</div>
                <div class="chemical hplus">8H⁺</div>
                <div>+</div>
                <div class="chemical electron">5e⁻</div>
                <div class="arrow">→</div>
                <div class="chemical mn2plus">Mn²⁺</div>
                <div>+</div>
                <div class="chemical h2o">4H₂O</div>
            </div>
            <p>Follow the steps below to visualize how 5 electrons reduce Mn from +7 to +2</p>
        </div>

        <div class="simulation-area">
            <div class="electron-counter">
                <span>Electrons gained: </span>
                <span id="electron-count">0</span>
                <span>/5</span>
                <div class="electron-dot"></div>
            </div>

            <div class="visualization-container" id="visualization">
                <!-- Visualization elements will be added by JavaScript -->
            </div>

            <div class="control-panel">
                <button class="btn btn-primary" id="prev-btn">
                    <i class="fas fa-step-backward"></i> Previous Step
                </button>
                <button class="btn btn-primary" id="reset-btn">
                    <i class="fas fa-redo"></i> Reset Simulation
                </button>
                <button class="btn btn-primary" id="next-btn">
                    Next Step <i class="fas fa-step-forward"></i>
                </button>
                <button class="btn btn-secondary" id="auto-btn">
                    <i class="fas fa-play"></i> Auto-Play
                </button>
            </div>
        </div>

        <div class="step-indicator">
            <div class="step active" id="step1">
                <div class="step-number">1</div>
                <div>Initial State: MnO₄⁻</div>
                <div>Mn Oxidation: +7</div>
            </div>
            <div class="step" id="step2">
                <div class="step-number">2</div>
                <div>Electron 1 Added</div>
                <div>Mn Oxidation: +6</div>
            </div>
            <div class="step" id="step3">
                <div class="step-number">3</div>
                <div>Electron 2 Added</div>
                <div>Mn Oxidation: +5</div>
            </div>
            <div class="step" id="step4">
                <div class="step-number">4</div>
                <div>Electron 3 Added</div>
                <div>Mn Oxidation: +4</div>
            </div>
            <div class="step" id="step5">
                <div class="step-number">5</div>
                <div>Electron 4 Added</div>
                <div>Mn Oxidation: +3</div>
            </div>
            <div class="step" id="step6">
                <div class="step-number">6</div>
                <div>Electron 5 Added</div>
                <div>Mn Oxidation: +2</div>
            </div>
        </div>

        <div class="info-panel" id="info-text">
            <h3><i class="fas fa-info-circle"></i> Step 1: Initial State</h3>
            <p>In MnO₄⁻ (permanganate ion), manganese has an oxidation state of +7. Oxygen atoms have oxidation state of -2 each. The ion has an overall charge of -1.</p>
            <p><strong>Calculation:</strong> Mn + 4(-2) = -1 → Mn - 8 = -1 → Mn = +7</p>
        </div>
    </div>

    <footer>
        <p>Educational Tool for Visualizing Redox Reactions | Designed for Chemistry Learners</p>
    </footer>

    <script>
        // State management
        let currentStep = 1;
        let autoPlayInterval = null;
        
        // DOM Elements
        const visualizationContainer = document.getElementById('visualization');
        const electronCountElement = document.getElementById('electron-count');
        const infoTextElement = document.getElementById('info-text');
        const stepElements = [
            document.getElementById('step1'),
            document.getElementById('step2'),
            document.getElementById('step3'),
            document.getElementById('step4'),
            document.getElementById('step5'),
            document.getElementById('step6')
        ];
        
        // Button elements
        const prevBtn = document.getElementById('prev-btn');
        const resetBtn = document.getElementById('reset-btn');
        const nextBtn = document.getElementById('next-btn');
        const autoBtn = document.getElementById('auto-btn');
        
        // Step information
        const stepInfo = [
            {
                title: "Step 1: Initial State",
                content: "In MnO₄⁻ (permanganate ion), manganese has an oxidation state of +7. Oxygen atoms have oxidation state of -2 each. The ion has an overall charge of -1.<br><br><strong>Calculation:</strong> Mn + 4(-2) = -1 → Mn - 8 = -1 → Mn = +7"
            },
            {
                title: "Step 2: First Electron Added",
                content: "The first electron arrives and reduces Mn from +7 to +6. Each electron reduces the oxidation state by 1. The Mn-O bonds begin to weaken slightly as Mn gains electron density."
            },
            {
                title: "Step 3: Second Electron Added",
                content: "The second electron reduces Mn from +6 to +5. With each electron gained, manganese becomes less positively charged. Hydrogen ions (H⁺) start to approach oxygen atoms."
            },
            {
                title: "Step 4: Third Electron Added",
                content: "The third electron reduces Mn from +5 to +4. Manganese is now at an oxidation state of +4. Hydrogen ions bond with oxygen atoms to form water molecules."
            },
            {
                title: "Step 5: Fourth Electron Added",
                content: "The fourth electron reduces Mn from +4 to +3. Only one more electron is needed! Two water molecules have formed and drifted away from the manganese ion."
            },
            {
                title: "Step 6: Fifth Electron Added - Final State",
                content: "The fifth electron reduces Mn from +3 to +2. The reduction is complete! All four oxygen atoms have formed water molecules with hydrogen ions. Manganese is now Mn²⁺ with oxidation state +2.<br><br><strong>Key Takeaway:</strong> MnO₄⁻ to Mn²⁺ always requires 5 electrons in acidic medium."
            }
        ];
        
        // Initialize the visualization
        function initVisualization() {
            visualizationContainer.innerHTML = '';
            createMnO4Molecule();
            createElectronSources();
            updateStepIndicator();
            updateInfoPanel();
            updateButtons();
        }
        
        // Create the initial MnO4- molecule
        function createMnO4Molecule() {
            // Clear container first
            visualizationContainer.innerHTML = '';
            
            // Create manganese atom
            const manganese = document.createElement('div');
            manganese.className = 'molecule manganese';
            manganese.id = 'manganese';
            manganese.innerHTML = 'Mn';
            manganese.style.left = '50%';
            manganese.style.top = '50%';
            manganese.style.transform = 'translate(-50%, -50%)';
            manganese.style.background = 'radial-gradient(circle at 30% 30%, #9b00ff, #5a00b3)';
            visualizationContainer.appendChild(manganese);
            
            // Create oxidation state display for Mn
            const mnOxState = document.createElement('div');
            mnOxState.className = 'oxidation-state';
            mnOxState.id = 'mn-ox-state';
            mnOxState.textContent = '+7';
            mnOxState.style.left = 'calc(50% - 30px)';
            mnOxState.style.top = 'calc(50% - 50px)';
            visualizationContainer.appendChild(mnOxState);
            
            // Create oxygen atoms
            const oxygenPositions = [
                {left: 'calc(50% - 80px)', top: '50%'}, // Left
                {left: '50%', top: 'calc(50% - 80px)'}, // Top
                {left: 'calc(50% + 80px)', top: '50%'}, // Right
                {left: '50%', top: 'calc(50% + 80px)'}  // Bottom
            ];
            
            for (let i = 0; i < 4; i++) {
                const oxygen = document.createElement('div');
                oxygen.className = 'molecule oxygen';
                oxygen.id = `oxygen-${i}`;
                oxygen.innerHTML = 'O';
                oxygen.style.left = oxygenPositions[i].left;
                oxygen.style.top = oxygenPositions[i].top;
                oxygen.style.transform = 'translate(-50%, -50%)';
                oxygen.style.background = 'radial-gradient(circle at 30% 30%, #ff3232, #b30000)';
                oxygen.style.transition = 'all 1.5s ease';
                visualizationContainer.appendChild(oxygen);
                
                // Create bond lines (visual representation)
                const bond = document.createElement('div');
                bond.className = 'bond';
                bond.style.position = 'absolute';
                bond.style.height = '2px';
                bond.style.width = '40px';
                bond.style.background = 'rgba(255, 255, 255, 0.5)';
                bond.style.left = '50%';
                bond.style.top = '50%';
                bond.style.transformOrigin = '0 0';
                
                // Calculate angle for each bond
                let angle = 0;
                if (i === 0) angle = 180; // Left
                if (i === 1) angle = -90; // Top
                if (i === 2) angle = 0;   // Right
                if (i === 3) angle = 90;  // Bottom
                
                bond.style.transform = `translate(-50%, -50%) rotate(${angle}deg) translateX(30px)`;
                visualizationContainer.appendChild(bond);
                
                // Create oxidation state for oxygen
                const oxState = document.createElement('div');
                oxState.className = 'oxidation-state';
                oxState.textContent = '-2';
                oxState.style.fontSize = '0.9rem';
                oxState.style.left = `calc(${oxygenPositions[i].left} + ${i === 0 ? '-30' : i === 2 ? '30' : '0'}px)`;
                oxState.style.top = `calc(${oxygenPositions[i].top} + ${i === 1 ? '-30' : i === 3 ? '30' : '0'}px)`;
                visualizationContainer.appendChild(oxState);
            }
            
            // Create hydrogen ions (H+) - initially hidden
            for (let i = 0; i < 8; i++) {
                const hydrogen = document.createElement('div');
                hydrogen.className = 'molecule hydrogen';
                hydrogen.id = `hydrogen-${i}`;
                hydrogen.innerHTML = 'H⁺';
                hydrogen.style.position = 'absolute';
                hydrogen.style.left = `${10 + (i % 4) * 25}%`;
                hydrogen.style.top = `${10 + Math.floor(i / 4) * 20}%`;
                hydrogen.style.opacity = '0.7';
                hydrogen.style.transition = 'all 2s ease';
                visualizationContainer.appendChild(hydrogen);
            }
        }
        
        // Create electron sources (left side)
        function createElectronSources() {
            for (let i = 0; i < 5; i++) {
                const electronSource = document.createElement('div');
                electronSource.className = 'electron-source';
                electronSource.style.position = 'absolute';
                electronSource.style.left = '10%';
                electronSource.style.top = `${20 + i * 15}%`;
                electronSource.style.width = '30px';
                electronSource.style.height = '30px';
                electronSource.style.borderRadius = '50%';
                electronSource.style.border = '2px dashed rgba(255, 215, 0, 0.5)';
                electronSource.style.display = 'flex';
                electronSource.style.alignItems = 'center';
                electronSource.style.justifyContent = 'center';
                electronSource.style.color = '#ffd700';
                electronSource.innerHTML = 'e⁻';
                electronSource.style.fontSize = '0.8rem';
                visualizationContainer.appendChild(electronSource);
            }
        }
        
        // Update step indicator
        function updateStepIndicator() {
            stepElements.forEach((step, index) => {
                if (index === currentStep - 1) {
                    step.classList.add('active');
                } else {
                    step.classList.remove('active');
                }
            });
        }
        
        // Update information panel
        function updateInfoPanel() {
            electronCountElement.textContent = Math.min(currentStep - 1, 5);
            
            if (currentStep <= stepInfo.length) {
                infoTextElement.innerHTML = `
                    <h3><i class="fas fa-info-circle"></i> ${stepInfo[currentStep - 1].title}</h3>
                    <p>${stepInfo[currentStep - 1].content}</p>
                `;
            }
        }
        
        // Update button states
        function updateButtons() {
            prevBtn.disabled = currentStep === 1;
            nextBtn.disabled = currentStep === 6;
            
            if (autoPlayInterval) {
                autoBtn.innerHTML = '<i class="fas fa-pause"></i> Pause';
            } else {
                autoBtn.innerHTML = '<i class="fas fa-play"></i> Auto-Play';
            }
        }
        
        // Move to a specific step
        function goToStep(step) {
            if (step < 1 || step > 6) return;
            
            currentStep = step;
            updateStepIndicator();
            updateInfoPanel();
            updateButtons();
            
            // Clear any existing animations
            visualizationContainer.innerHTML = '';
            
            // Recreate visualization for the current step
            createMnO4Molecule();
            createElectronSources();
            
            // Apply transformations based on step
            applyStepTransformations();
        }
        
        // Apply visual transformations for the current step
        function applyStepTransformations() {
            const manganese = document.getElementById('manganese');
            const mnOxState = document.getElementById('mn-ox-state');
            
            if (!manganese || !mnOxState) return;
            
            // Update manganese oxidation state and color
            const oxidationStates = ['+7', '+6', '+5', '+4', '+3', '+2'];
            const colors = [
                'radial-gradient(circle at 30% 30%, #9b00ff, #5a00b3)',
                'radial-gradient(circle at 30% 30%, #8a00e6, #4a0099)',
                'radial-gradient(circle at 30% 30%, #7a00cc, #3a0080)',
                'radial-gradient(circle at 30% 30%, #6a00b3, #2a0066)',
                'radial-gradient(circle at 30% 30%, #5a0099, #1a004d)',
                'radial-gradient(circle at 30% 30%, #4a0080, #0a0033)'
            ];
            
            mnOxState.textContent = oxidationStates[currentStep - 1];
            manganese.style.background = colors[currentStep - 1];
            
            // Show electrons added
            for (let i = 0; i < Math.min(currentStep - 1, 5); i++) {
                createElectronAnimation(i);
            }
            
            // Move oxygen atoms and form water molecules
            if (currentStep >= 3) {
                formWaterMolecules();
            }
            
            // Move hydrogen ions
            moveHydrogenIons();
        }
        
        // Create electron animation
        function createElectronAnimation(electronIndex) {
            // Create electron
            const electron = document.createElement('div');
            electron.className = 'electron-visual';
            electron.id = `electron-${electronIndex}`;
            
            // Position electron near manganese
            electron.style.left = `calc(50% - ${30 + electronIndex * 10}px)`;
            electron.style.top = `calc(50% - ${20 + electronIndex * 5}px)`;
            
            visualizationContainer.appendChild(electron);
            
            // Animate electron arrival
            setTimeout(() => {
                electron.style.transition = 'all 1s ease';
                electron.style.left = `calc(50% - ${15 + electronIndex * 5}px)`;
                electron.style.top = `calc(50% - ${10 + electronIndex * 3}px)`;
                
                // Make electron orbit manganese
                setTimeout(() => {
                    electron.style.transition = 'all 2s linear';
                    electron.style.transform = `rotate(${electronIndex * 72}deg) translateX(40px) rotate(-${electronIndex * 72}deg)`;
                }, 1000);
            }, 100);
        }
        
        // Form water molecules
        function formWaterMolecules() {
            const oxygenIds = ['oxygen-0', 'oxygen-1', 'oxygen-2', 'oxygen-3'];
            
            oxygenIds.forEach((oxygenId, index) => {
                const oxygen = document.getElementById(oxygenId);
                if (!oxygen) return;
                
                // Move oxygen to form water molecules
                const waterPositions = [
                    {left: '15%', top: '80%'}, // Bottom left
                    {left: '85%', top: '20%'}, // Top right
                    {left: '15%', top: '20%'}, // Top left
                    {left: '85%', top: '80%'}  // Bottom right
                ];
                
                // Only move oxygen if enough electrons have been added
                if (currentStep >= 3 + index) {
                    oxygen.style.left = waterPositions[index].left;
                    oxygen.style.top = waterPositions[index].top;
                    oxygen.style.background = 'radial-gradient(circle at 30% 30%, #0096ff, #0056b3)';
                    
                    // Add hydrogen atoms to form water
                    createWaterMolecule(index, waterPositions[index]);
                }
            });
        }
        
        // Create water molecule
        function createWaterMolecule(waterIndex, position) {
            // Create water molecule container
            const waterMolecule = document.createElement('div');
            waterMolecule.className = 'water-molecule';
            waterMolecule.style.position = 'absolute';
            waterMolecule.style.left = position.left;
            waterMolecule.style.top = position.top;
            waterMolecule.style.transform = 'translate(-50%, -50%)';
            waterMolecule.style.opacity = currentStep >= 3 + waterIndex ? '1' : '0';
            waterMolecule.style.transition = 'opacity 1s ease';
            
            // Create hydrogen atoms
            const h1 = document.createElement('div');
            h1.className = 'hydrogen';
            h1.innerHTML = 'H';
            h1.style.background = 'radial-gradient(circle at 30% 30%, #ff3232, #b30000)';
            
            const h2 = document.createElement('div');
            h2.className = 'hydrogen';
            h2.innerHTML = 'H';
            h2.style.background = 'radial-gradient(circle at 30% 30%, #ff3232, #b30000)';
            
            // Create oxygen atom for water
            const o = document.createElement('div');
            o.className = 'oxygen';
            o.innerHTML = 'O';
            o.style.background = 'radial-gradient(circle at 30% 30%, #0096ff, #0056b3)';
            
            // Arrange in water molecule shape (H-O-H)
            waterMolecule.appendChild(h1);
            waterMolecule.appendChild(o);
            waterMolecule.appendChild(h2);
            
            visualizationContainer.appendChild(waterMolecule);
        }
        
        // Move hydrogen ions toward oxygen
        function moveHydrogenIons() {
            for (let i = 0; i < 8; i++) {
                const hydrogen = document.getElementById(`hydrogen-${i}`);
                if (!hydrogen) continue;
                
                // Each water molecule gets 2 hydrogen ions
                const waterIndex = Math.floor(i / 2);
                const waterPositions = [
                    {left: '15%', top: '80%'},
                    {left: '85%', top: '20%'},
                    {left: '15%', top: '20%'},
                    {left: '85%', top: '80%'}
                ];
                
                if (waterIndex < 4 && currentStep >= 3 + waterIndex) {
                    // Move hydrogen to water molecule position
                    const offset = i % 2 === 0 ? -20 : 20;
                    hydrogen.style.left = `calc(${waterPositions[waterIndex].left} + ${offset}px)`;
                    hydrogen.style.top = waterPositions[waterIndex].top;
                    hydrogen.style.opacity = '1';
                }
            }
        }
        
        // Auto-play function
        function autoPlay() {
            if (autoPlayInterval) {
                clearInterval(autoPlayInterval);
                autoPlayInterval = null;
                updateButtons();
                return;
            }
            
            autoPlayInterval = setInterval(() => {
                if (currentStep < 6) {
                    goToStep(currentStep + 1);
                } else {
                    clearInterval(autoPlayInterval);
                    autoPlayInterval = null;
                    updateButtons();
                }
            }, 3000);
            
            updateButtons();
        }
        
        // Event listeners
        prevBtn.addEventListener('click', () => goToStep(currentStep - 1));
        nextBtn.addEventListener('click', () => goToStep(currentStep + 1));
        resetBtn.addEventListener('click', () => goToStep(1));
        autoBtn.addEventListener('click', autoPlay);
        
        // Initialize the visualization
        window.addEventListener('load', () => {
            initVisualization();
            goToStep(1);
        });
    </script>
</body>
</html>
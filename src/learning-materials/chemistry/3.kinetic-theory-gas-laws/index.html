<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kinetic Theory & Gas Laws - Education App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE'
                    }
                }
            }
        }
    </script>
    <style>
        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
        }
        
        .video-thumbnail {
            background-size: cover;
            background-position: center;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .video-thumbnail:hover {
            transform: scale(1.02);
        }
        
        .play-button {
            background: rgba(0,0,0,0.8);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .play-button:hover {
            background: rgba(0,0,0,0.9);
            transform: scale(1.1);
        }
        
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        
        .dark .skeleton {
            background: linear-gradient(90deg, #374151 25%, #4b5563 50%, #374151 75%);
            background-size: 200% 100%;
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 transition-colors duration-300">
    <!-- Dark mode detection -->
    <script>
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            document.documentElement.classList.add(event.matches ? 'dark' : '');
            document.documentElement.classList.remove(event.matches ? '' : 'dark');
        });
    </script>

    <div class="min-h-screen">
        <!-- Header -->
        <header class="bg-primary text-white p-6">
            <div class="max-w-6xl mx-auto">
                <h1 class="text-3xl font-bold mb-2">Kinetic Theory of Matter and Gas Laws</h1>
                <p class="text-primary-100 opacity-90">Interactive learning with curated video content</p>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-6xl mx-auto p-6">
            <!-- Quick Actions -->
            <div class="mb-6 flex flex-wrap gap-3">
                <button id="adminToggle" class="bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 px-4 py-2 rounded-lg text-gray-700 dark:text-gray-300 transition-colors text-base">
                    üìù Edit Video Links
                </button>
                <button id="loadAllVideos" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors text-base">
                    üé¨ Load All Videos
                </button>
                <div class="text-sm text-gray-500 dark:text-gray-400 flex items-center">
                    <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                    Fast loading mode enabled
                </div>
            </div>

            <!-- Admin Panel -->
            <div id="adminPanel" class="hidden bg-gray-50 dark:bg-gray-800 p-6 rounded-lg mb-6 border border-gray-200 dark:border-gray-700">
                <h2 class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200">Video Link Management</h2>
                <div class="mb-4 flex flex-wrap gap-2">
                    <button id="exportData" class="bg-primary hover:bg-primary-600 text-white px-4 py-2 rounded text-base">Export Data</button>
                    <button id="importData" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded text-base">Import Data</button>
                    <input type="file" id="fileInput" accept=".json" class="hidden">
                </div>
                <textarea id="dataEditor" class="w-full h-64 p-4 border border-gray-300 dark:border-gray-600 rounded-lg font-mono text-sm bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-200 text-base" placeholder="Video data will appear here..."></textarea>
                <div class="mt-4 flex flex-wrap gap-2">
                    <button id="saveChanges" class="bg-primary hover:bg-primary-600 text-white px-6 py-2 rounded text-base">Save Changes</button>
                    <button id="resetData" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded text-base">Reset to Default</button>
                </div>
            </div>

            <!-- Performance Notice -->
            <section class="mb-6">
                <div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-lg border border-green-200 dark:border-green-800">
                    <div class="flex items-start">
                        <span class="text-green-600 dark:text-green-400 mr-2">‚ö°</span>
                        <div>
                            <h3 class="font-semibold text-green-800 dark:text-green-300 mb-1">Fast Loading Mode</h3>
                            <p class="text-green-700 dark:text-green-300 text-sm">
                                Videos load instantly as thumbnails. Click any thumbnail to load the full video player. 
                                Use quality buttons for <strong>üì± Low</strong>, <strong>üíª Auto</strong>, or <strong>üñ•Ô∏è High</strong> quality.
                            </p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Learning Objectives -->
            <section class="mb-8">
                <h2 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-200">Learning Objectives</h2>
                <div class="bg-blue-50 dark:bg-blue-900/20 p-6 rounded-lg border border-blue-200 dark:border-blue-800">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">After studying this topic, candidates should be able to:</p>
                    <ul class="list-disc pl-6 space-y-2 text-gray-700 dark:text-gray-300">
                        <li>Apply the theory to distinguish between solids, liquids and gases</li>
                        <li>Deduce reasons for change of state</li>
                        <li>Draw inferences based on molecular motion</li>
                        <li>Deduce gas laws from given expressions/statements</li>
                        <li>Interpret graphical representations related to these laws</li>
                        <li>Perform simple calculations based on these laws, equations and relationships</li>
                    </ul>
                </div>
            </section>

            <!-- Content Sections -->
            <div id="contentContainer">
                <!-- Loading skeleton -->
                <div class="video-grid">
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md border border-gray-200 dark:border-gray-700 overflow-hidden">
                        <div class="aspect-video skeleton"></div>
                        <div class="p-4">
                            <div class="h-4 skeleton rounded mb-2"></div>
                            <div class="h-3 skeleton rounded w-1/2"></div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Video data structure - unchanged for compatibility
        let videoData = {
            "kineticTheory": {
                "title": "3(a) Phenomena Supporting Kinetic Theory",
                "description": "Understanding molecular motion through state changes and Brownian movement",
                "topics": [
                    {
                        "name": "Melting, Boiling, Freezing, Vaporization & Condensation",
                        "videos": [
                            {"title": "Kinetic Theory Basics", "url": "https://youtu.be/QQsybALJoew?feature=shared", "type": "concept"},
                            {"title": "Molecular Motion Explained", "url": "https://youtu.be/Yv_vDQerOBk?si=ZyHD9k8UELOU9rFe", "type": "concept"},
                            {"title": "States of Matter", "url": "https://youtu.be/LTfHaWFhBBw?si=q2A2o02JixZ-SKvZ", "type": "concept"},
                            {"title": "Phase Changes", "url": "https://youtu.be/oc0ypeDELb0?si=HwlgYuuzdPj6va7", "type": "concept"},
                            {"title": "Brownian Movement", "url": "https://youtu.be/mGlw2ZQ_VJE?si=knLPPkauMgaBmJfJ", "type": "concept"},
                            {"title": "Molecular Behavior", "url": "https://youtu.be/4m5JnJBq2AU?si=yjCGHlmapgmhI2Zh", "type": "concept"},
                            {"title": "Advanced Concepts", "url": "https://youtu.be/z6vwS0fue6E?si=cVxb3FzJyODtFHdJ", "type": "concept"}
                        ]
                    },
                    {
                        "name": "Additional Materials",
                        "videos": [
                            {"title": "Supplementary Content 1", "url": "https://youtu.be/LiXut4P0drg?si=x-YvdeFGy_amYirI", "type": "supplementary"},
                            {"title": "Supplementary Content 2", "url": "https://youtu.be/V9VKvxHI5TU?si=5OuxS5muwTxxEGN4", "type": "supplementary"},
                            {"title": "Supplementary Content 3", "url": "https://youtu.be/3hoaSr6_NMI?si=4fjPLqJsrgXTUz-W", "type": "supplementary"}
                        ]
                    }
                ]
            },
            "gasLaws": {
                "title": "3(b) Gas Laws",
                "description": "Understanding Boyle's, Charles', Graham's, Dalton's laws and the ideal gas equation",
                "topics": [
                    {
                        "name": "Boyle's Law",
                        "videos": [
                            {"title": "Boyle's Law Theory", "url": "https://youtu.be/YQmv272-4yU?si=z1IluSTZk3_RF9mz", "type": "theory"},
                            {"title": "Boyle's Law Explained", "url": "https://youtu.be/N5xft2fIqQU?si=8uVXKNK_r2K-e4xj", "type": "theory"},
                            {"title": "Boyle's Law Lab ü•º", "url": "https://youtu.be/OKTGTlZfM1o?si=GnliSQ9dPF54qJ2y", "type": "lab"}
                        ]
                    },
                    {
                        "name": "Charles' Law",
                        "videos": [
                            {"title": "Charles' Law Animation üé•", "url": "https://youtu.be/twCcSsHmMgI?si=cbIoCRucvjVRpKQL", "type": "animation"},
                            {"title": "Charles' Law Lab ü•º", "url": "https://youtu.be/oEZbkXB3y1Q?si=XQFXMnjAJsXW1IVU", "type": "lab"},
                            {"title": "Charles' Law Calculations üßÆ", "url": "https://youtu.be/uZ2d79NFx2w?si=f9CK1uXLhr81uZL3", "type": "calculation"}
                        ]
                    },
                    {
                        "name": "Graham's Law",
                        "videos": [
                            {"title": "Graham's Law Theory üé•", "url": "https://youtu.be/LKK-MDl9ntM?si=2Tc_FfNu28N7go0n", "type": "theory"},
                            {"title": "Graham's Law Applications", "url": "https://youtu.be/M9pHnzf5cdk?si=7nCm20ckQvsJWoeQ", "type": "theory"},
                            {"title": "Graham's Law Calculations üßÆ", "url": "https://youtu.be/U5J_Rl0G_J8?si=K0WmC_TYcEYDI7S7", "type": "calculation"}
                        ]
                    },
                    {
                        "name": "Other Gas Laws",
                        "videos": [
                            {"title": "Dalton's Law (Partial Pressure)", "url": "https://youtu.be/jbmOcH1fFKs?si=HRPR_-_pmeK918nn", "type": "theory"},
                            {"title": "Combined Gas Law", "url": "https://youtu.be/pFaYMR2UAGE?si=gEmgnQctzimYtWyl", "type": "theory"},
                            {"title": "Ideal Gas Equation (PV = nRT)", "url": "https://youtu.be/robEY-idcLU?si=JanvOJkc9fEvwyAr", "type": "theory"},
                            {"title": "Molar Volume", "url": "https://youtu.be/UCmYSIjOnUA?si=v4080HCUDd0V_sMC", "type": "concept"},
                            {"title": "Vapour Density & Molecular Mass", "url": "https://youtu.be/HjgO52j7ugE?si=jrmUqPVuNcrTk05a", "type": "concept"}
                        ]
                    }
                ]
            }
        };

        // Performance optimizations
        const typeColors = {
            'concept': 'bg-blue-100 dark:bg-blue-900/20 border-blue-300 dark:border-blue-700 text-blue-800 dark:text-blue-300',
            'theory': 'bg-green-100 dark:bg-green-900/20 border-green-300 dark:border-green-700 text-green-800 dark:text-green-300',
            'lab': 'bg-purple-100 dark:bg-purple-900/20 border-purple-300 dark:border-purple-700 text-purple-800 dark:text-purple-300',
            'animation': 'bg-orange-100 dark:bg-orange-900/20 border-orange-300 dark:border-orange-700 text-orange-800 dark:text-orange-300',
            'calculation': 'bg-red-100 dark:bg-red-900/20 border-red-300 dark:border-red-700 text-red-800 dark:text-red-300',
            'supplementary': 'bg-gray-100 dark:bg-gray-900/20 border-gray-300 dark:border-gray-700 text-gray-800 dark:text-gray-300'
        };

        // Memoized video ID extraction
        const videoIdCache = new Map();
        function getVideoId(url) {
            if (videoIdCache.has(url)) return videoIdCache.get(url);
            
            const match = url.match(/(?:youtu\.be\/|youtube\.com\/(?:watch\?v=|embed\/))([^&\n?#]+)/);
            const id = match ? match[1] : null;
            videoIdCache.set(url, id);
            return id;
        }

        // Fast thumbnail-based video card
        function createVideoCard(video, index) {
            const videoId = getVideoId(video.url);
            const typeClass = typeColors[video.type] || typeColors['concept'];
            const thumbnailUrl = videoId ? `https://img.youtube.com/vi/${videoId}/hqdefault.jpg` : '';
            
            return `
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md border border-gray-200 dark:border-gray-700 overflow-hidden hover:shadow-lg transition-shadow fade-in">
                    <div class="aspect-video bg-gray-100 dark:bg-gray-700 relative video-thumbnail" 
                         style="background-image: url('${thumbnailUrl}')"
                         data-video-id="${videoId}"
                         data-video-url="${video.url}"
                         data-video-title="${video.title}"
                         onclick="loadVideo(this)">
                        ${videoId ? `
                            <div class="absolute inset-0 flex items-center justify-center">
                                <div class="play-button">
                                    <svg class="w-6 h-6 text-white ml-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M8 5v10l8-5-8-5z"/>
                                    </svg>
                                </div>
                            </div>
                            <div class="absolute bottom-2 right-2 bg-black bg-opacity-70 text-white text-xs px-2 py-1 rounded">
                                Click to load
                            </div>
                        ` : `
                            <div class="w-full h-full flex items-center justify-center text-gray-500 dark:text-gray-400">
                                <span>Invalid URL</span>
                            </div>
                        `}
                    </div>
                    <div class="p-4">
                        <h4 class="font-semibold text-gray-800 dark:text-gray-200 mb-2">${video.title}</h4>
                        <span class="inline-block px-2 py-1 text-xs rounded-full border ${typeClass}">
                            ${video.type}
                        </span>
                        <div class="mt-3 space-y-2">
                            <div class="flex flex-wrap gap-1">
                                <a href="https://www.youtube.com/watch?v=${videoId}&vq=small" target="_blank" 
                                   class="text-xs bg-red-100 hover:bg-red-200 dark:bg-red-900/20 dark:hover:bg-red-900/40 text-red-700 dark:text-red-300 px-2 py-1 rounded border border-red-300 dark:border-red-700">
                                    üì± Low
                                </a>
                                <a href="https://www.youtube.com/watch?v=${videoId}" target="_blank" 
                                   class="text-xs bg-blue-100 hover:bg-blue-200 dark:bg-blue-900/20 dark:hover:bg-blue-900/40 text-blue-700 dark:text-blue-300 px-2 py-1 rounded border border-blue-300 dark:border-blue-700">
                                    üíª Auto
                                </a>
                                <a href="https://www.youtube.com/watch?v=${videoId}&vq=hd720" target="_blank" 
                                   class="text-xs bg-green-100 hover:bg-green-200 dark:bg-green-900/20 dark:hover:bg-green-900/40 text-green-700 dark:text-green-300 px-2 py-1 rounded border border-green-300 dark:border-green-700">
                                    üñ•Ô∏è High
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Lazy load video iframe
        function loadVideo(element) {
            const videoId = element.dataset.videoId;
            const title = element.dataset.videoTitle;
            
            if (!videoId) return;
            
            element.innerHTML = `
                <iframe 
                    src="https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0&modestbranding=1&playsinline=1" 
                    class="w-full h-full" 
                    frameborder="0" 
                    allowfullscreen
                    title="${title}">
                </iframe>
            `;
            element.onclick = null;
            element.style.backgroundImage = 'none';
        }

        // Load all videos at once (for users who want immediate access)
        function loadAllVideos() {
            const thumbnails = document.querySelectorAll('.video-thumbnail[data-video-id]');
            thumbnails.forEach(thumbnail => {
                if (thumbnail.onclick) {
                    loadVideo(thumbnail);
                }
            });
            
            const button = document.getElementById('loadAllVideos');
            button.textContent = '‚úÖ All Videos Loaded';
            button.disabled = true;
            button.className = button.className.replace('bg-blue-500 hover:bg-blue-600', 'bg-gray-400 cursor-not-allowed');
        }

        // Fast rendering with requestAnimationFrame
        function renderContent() {
            const container = document.getElementById('contentContainer');
            let html = '';

            Object.entries(videoData).forEach(([sectionKey, section]) => {
                html += `
                    <section class="mb-12">
                        <h2 class="text-2xl font-bold mb-2 text-gray-800 dark:text-gray-200">${section.title}</h2>
                        <p class="text-gray-600 dark:text-gray-400 mb-6">${section.description}</p>
                `;

                section.topics.forEach(topic => {
                    html += `
                        <div class="mb-8">
                            <h3 class="text-xl font-semibold mb-4 text-gray-700 dark:text-gray-300">${topic.name}</h3>
                            <div class="video-grid">
                `;
                    
                    topic.videos.forEach((video, index) => {
                        html += createVideoCard(video, index);
                    });
                    
                    html += `
                            </div>
                        </div>
                    `;
                });

                html += '</section>';
            });

            // Use requestAnimationFrame for smooth rendering
            requestAnimationFrame(() => {
                container.innerHTML = html;
            });
        }

        // Custom modal (performance optimized)
        function showCustomModal(title, message, onConfirm = null) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-md w-full mx-4">
                    <h3 class="text-lg font-semibold mb-2 text-gray-800 dark:text-gray-200">${title}</h3>
                    <p class="text-gray-600 dark:text-gray-400 mb-4">${message}</p>
                    <div class="flex justify-end space-x-3">
                        <button class="cancel-btn px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded text-base">Cancel</button>
                        ${onConfirm ? '<button class="confirm-btn px-4 py-2 bg-primary text-white hover:bg-primary-600 rounded text-base">Confirm</button>' : ''}
                    </div>
                </div>
            `;

            modal.querySelector('.cancel-btn').onclick = () => modal.remove();
            if (onConfirm) {
                modal.querySelector('.confirm-btn').onclick = () => {
                    modal.remove();
                    onConfirm();
                };
            }

            document.body.appendChild(modal);
        }

        // Event listeners (delegated for performance)
        document.addEventListener('DOMContentLoaded', () => {
            // Admin panel toggle
            document.getElementById('adminToggle').addEventListener('click', () => {
                const panel = document.getElementById('adminPanel');
                panel.classList.toggle('hidden');
                if (!panel.classList.contains('hidden')) {
                    document.getElementById('dataEditor').value = JSON.stringify(videoData, null, 2);
                }
            });

            // Load all videos button
            document.getElementById('loadAllVideos').addEventListener('click', loadAllVideos);

            // Admin functionality
            document.getElementById('exportData').addEventListener('click', () => {
                const dataStr = JSON.stringify(videoData, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'video-data.json';
                a.click();
                URL.revokeObjectURL(url);
            });

            document.getElementById('importData').addEventListener('click', () => {
                document.getElementById('fileInput').click();
            });

            document.getElementById('fileInput').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const newData = JSON.parse(e.target.result);
                            document.getElementById('dataEditor').value = JSON.stringify(newData, null, 2);
                        } catch (error) {
                            showCustomModal('Error', 'Invalid JSON file. Please check the file format.');
                        }
                    };
                    reader.readAsText(file);
                }
            });

            document.getElementById('saveChanges').addEventListener('click', () => {
                try {
                    const newData = JSON.parse(document.getElementById('dataEditor').value);
                    videoData = newData;
                    renderContent();
                    showCustomModal('Success', 'Video data updated successfully!');
                } catch (error) {
                    showCustomModal('Error', 'Invalid JSON format. Please check your syntax.');
                }
            });

            document.getElementById('resetData').addEventListener('click', () => {
                showCustomModal('Confirm Reset', 'Are you sure you want to reset to default data? This will lose all current changes.', () => {
                    location.reload();
                });
            });

            // Initial render
            renderContent();
        });
    </script>
</body>
</html>

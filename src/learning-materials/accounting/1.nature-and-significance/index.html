<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accounting Learning Platform - Home</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .progress-bar {
            transition: width 0.5s ease-in-out;
        }
        .module-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .module-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800 dark:text-white text-center mb-4">
                Accounting Learning Platform
            </h1>
            <p class="text-center text-gray-600 dark:text-gray-300 mb-6">
                Master the fundamentals of accounting and bookkeeping
            </p>

            <!-- Overall Progress -->
            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-lg font-semibold text-gray-700 dark:text-gray-200">Overall Progress</h2>
                    <span class="text-2xl font-bold text-indigo-600 dark:text-indigo-400" id="overallProgress">0%</span>
                </div>
                <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-6 overflow-hidden">
                    <div id="overallProgressBar" class="progress-bar bg-gradient-to-r from-indigo-500 to-purple-600 h-6 rounded-full flex items-center justify-end px-2" style="width: 0%">
                        <span class="text-white text-xs font-semibold" id="progressText"></span>
                    </div>
                </div>
                <div class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                    <div>
                        <div class="text-2xl font-bold text-indigo-600 dark:text-indigo-400" id="completedModules">0</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">Completed</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-yellow-600 dark:text-yellow-400" id="inProgressModules">0</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">In Progress</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-green-600 dark:text-green-400" id="averageScore">0%</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">Avg. Score</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-purple-600 dark:text-purple-400" id="totalQuizzes">0</div>
                        <div class="text-sm text-gray-600 dark:text-gray-400">Quizzes Taken</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Learning Objectives -->
        <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-6">Learning Objectives</h2>
        <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3" id="moduleContainer">
            <!-- Module cards will be inserted here by JavaScript -->
        </div>

        <!-- Performance Insights -->
        <div class="mt-8 bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6" id="insightsSection" style="display: none;">
            <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-4">Performance Insights</h2>
            <div id="insightsContent" class="space-y-3"></div>
        </div>

        <!-- Reset Progress Button -->
        <div class="mt-8 text-center">
            <button onclick="resetProgress()" class="px-6 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm transition">
                Reset All Progress
            </button>
        </div>
    </div>

    <script>
        // Dark mode support
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Storage solution compatible with iframe environment
        class StorageManager {
            constructor() {
                this.storage = {};
                this.storageKey = 'accountingLearningProgress';
                this.loadFromCookie();
            }

            loadFromCookie() {
                const cookies = document.cookie.split(';');
                for (let cookie of cookies) {
                    const [name, value] = cookie.trim().split('=');
                    if (name === this.storageKey) {
                        try {
                            this.storage = JSON.parse(decodeURIComponent(value));
                        } catch (e) {
                            this.storage = {};
                        }
                        break;
                    }
                }
            }

            saveToCookie() {
                const expires = new Date();
                expires.setFullYear(expires.getFullYear() + 1); // 1 year expiry
                document.cookie = `${this.storageKey}=${encodeURIComponent(JSON.stringify(this.storage))}; expires=${expires.toUTCString()}; path=/; SameSite=Strict`;
            }

            getItem(key) {
                return this.storage[key] || null;
            }

            setItem(key, value) {
                this.storage[key] = value;
                this.saveToCookie();
            }

            removeItem(key) {
                delete this.storage[key];
                this.saveToCookie();
            }

            clear() {
                this.storage = {};
                this.saveToCookie();
            }
        }

        const storage = new StorageManager();

        // Learning modules data
        const modules = [
            {
                id: 'lo1',
                title: 'LO 1: Bookkeeping vs Accounting',
                file: 'bkvsacc.html',
                description: 'Understand the objectives and differences between bookkeeping and accounting'
            },
            {
                id: 'lo2',
                title: 'LO 2: History of Accounting',
                file: 'history.html',
                description: 'Explore the evolution and historical development of accounting practices'
            },
            {
                id: 'lo3',
                title: 'LO 3: Principles & Concepts',
                file: 'principles.html',
                description: 'Learn fundamental accounting principles, concepts, and conventions'
            },
            {
                id: 'lo4',
                title: 'LO 4: Role of Accounting',
                file: 'role.html',
                description: 'Discover the role of accounting records and information in business'
            },
            {
                id: 'lo5',
                title: 'LO 5: Branches of Accounting',
                file: 'branches.html',
                description: 'Explore different branches and specializations in accounting'
            }
        ];

        // Get progress data from storage
        function getProgress(moduleId) {
            const data = storage.getItem(`progress_${moduleId}`);
            return data ? JSON.parse(data) : { completed: false, score: 0, quizTaken: false, lastVisited: null };
        }

        // Calculate overall statistics
        function calculateStats() {
            let completed = 0;
            let inProgress = 0;
            let totalScore = 0;
            let quizzesTaken = 0;

            modules.forEach(module => {
                const progress = getProgress(module.id);
                if (progress.completed) {
                    completed++;
                }
                if (progress.lastVisited && !progress.completed) {
                    inProgress++;
                }
                if (progress.quizTaken) {
                    quizzesTaken++;
                    totalScore += progress.score;
                }
            });

            const overallProgress = Math.round((completed / modules.length) * 100);
            const averageScore = quizzesTaken > 0 ? Math.round(totalScore / quizzesTaken) : 0;

            return { completed, inProgress, overallProgress, averageScore, quizzesTaken };
        }

        // Update dashboard
        function updateDashboard() {
            const stats = calculateStats();

            // Update overall progress
            document.getElementById('overallProgress').textContent = stats.overallProgress + '%';
            document.getElementById('overallProgressBar').style.width = stats.overallProgress + '%';
            document.getElementById('progressText').textContent = stats.overallProgress >= 10 ? stats.overallProgress + '%' : '';

            // Update stats
            document.getElementById('completedModules').textContent = stats.completed;
            document.getElementById('inProgressModules').textContent = stats.inProgress;
            document.getElementById('averageScore').textContent = stats.averageScore + '%';
            document.getElementById('totalQuizzes').textContent = stats.quizzesTaken;

            // Update insights
            updateInsights(stats);
        }

        // Generate insights
        function updateInsights(stats) {
            const insights = [];

            if (stats.completed === modules.length) {
                insights.push({ type: 'success', message: '🎉 Congratulations! You\'ve completed all learning objectives!' });
            } else if (stats.completed > 0) {
                insights.push({ type: 'info', message: `Great progress! You've completed ${stats.completed} out of ${modules.length} modules.` });
            }

            if (stats.averageScore >= 80) {
                insights.push({ type: 'success', message: '✨ Excellent performance! Your average score is above 80%.' });
            } else if (stats.averageScore >= 60 && stats.quizzesTaken > 0) {
                insights.push({ type: 'warning', message: '📚 Good effort! Review the material to improve your scores above 80%.' });
            } else if (stats.quizzesTaken > 0) {
                insights.push({ type: 'warning', message: '💪 Keep practicing! Review the lessons and retake quizzes to improve.' });
            }

            if (stats.inProgress > 0) {
                insights.push({ type: 'info', message: `You have ${stats.inProgress} module${stats.inProgress > 1 ? 's' : ''} in progress. Keep going!` });
            }

            if (insights.length > 0) {
                const insightsSection = document.getElementById('insightsSection');
                const insightsContent = document.getElementById('insightsContent');
                insightsSection.style.display = 'block';

                insightsContent.innerHTML = insights.map(insight => {
                    const colors = {
                        success: 'bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 border-green-300 dark:border-green-700',
                        warning: 'bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 border-yellow-300 dark:border-yellow-700',
                        info: 'bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 border-blue-300 dark:border-blue-700'
                    };
                    return `<div class="p-4 rounded-lg border ${colors[insight.type]}">${insight.message}</div>`;
                }).join('');
            }
        }

        // Render module cards
        function renderModules() {
            const container = document.getElementById('moduleContainer');

            container.innerHTML = modules.map(module => {
                const progress = getProgress(module.id);
                const statusClass = progress.completed ? 'bg-green-500' : (progress.lastVisited ? 'bg-yellow-500' : 'bg-gray-300 dark:bg-gray-600');
                const statusText = progress.completed ? 'Completed' : (progress.lastVisited ? 'In Progress' : 'Not Started');
                const statusIcon = progress.completed ? '✓' : (progress.lastVisited ? '⋯' : '○');

                return `
                    <a href="${module.file}" class="module-card block bg-white dark:bg-gray-800 rounded-lg shadow-md hover:shadow-xl p-6 transition">
                        <div class="flex items-start justify-between mb-3">
                            <h3 class="text-lg font-bold text-gray-800 dark:text-white flex-1">${module.title}</h3>
                            <span class="${statusClass} text-white text-xs px-2 py-1 rounded-full font-semibold ml-2">${statusIcon}</span>
                        </div>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">${module.description}</p>

                        ${progress.quizTaken ? `
                            <div class="mb-3">
                                <div class="flex justify-between text-sm mb-1">
                                    <span class="text-gray-600 dark:text-gray-400">Quiz Score</span>
                                    <span class="font-semibold ${progress.score >= 80 ? 'text-green-600 dark:text-green-400' : 'text-yellow-600 dark:text-yellow-400'}">${progress.score}%</span>
                                </div>
                                <div class="w-full bg-gray-200 dark:bg-gray-600 rounded-full h-2">
                                    <div class="progress-bar ${progress.score >= 80 ? 'bg-green-500' : 'bg-yellow-500'} h-2 rounded-full" style="width: ${progress.score}%"></div>
                                </div>
                            </div>
                        ` : ''}

                        <div class="flex items-center justify-between">
                            <span class="text-xs text-gray-500 dark:text-gray-400">${statusText}</span>
                            ${progress.lastVisited ? `<span class="text-xs text-gray-400 dark:text-gray-500">Last: ${new Date(progress.lastVisited).toLocaleDateString()}</span>` : ''}
                        </div>
                    </a>
                `;
            }).join('');
        }

        // Reset progress
        function resetProgress() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full">
                    <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-3">Reset Progress?</h3>
                    <p class="text-gray-600 dark:text-gray-300 mb-6">This will delete all your progress, scores, and quiz results. This action cannot be undone.</p>
                    <div class="flex justify-end space-x-3">
                        <button class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition" onclick="this.closest('.fixed').remove()">Cancel</button>
                        <button class="px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded transition" onclick="confirmReset()">Reset All</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function confirmReset() {
            modules.forEach(module => {
                storage.removeItem(`progress_${module.id}`);
            });
            document.querySelector('.fixed').remove();
            renderModules();
            updateDashboard();
        }

        // Initialize
        renderModules();
        updateDashboard();
    </script>
</body>
</html>
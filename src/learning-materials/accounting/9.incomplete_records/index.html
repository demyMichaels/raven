<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Incomplete Records Mastery - Interactive Learning</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        'primary-dark': '#4847B8',
                        'bg-light': '#FFFFFF',
                        'bg-dark': '#181818',
                        'card-light': '#F9FAFB',
                        'card-dark': '#242424'
                    },
                    animation: {
                        'bounce-subtle': 'bounce-subtle 0.6s ease-in-out',
                        'slide-up': 'slide-up 0.4s ease-out',
                        'fade-in': 'fade-in 0.3s ease-in',
                        'celebrate': 'celebrate 0.6s ease-out',
                        'shake': 'shake 0.5s ease-in-out'
                    },
                    keyframes: {
                        'bounce-subtle': {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' }
                        },
                        'slide-up': {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        },
                        'fade-in': {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        'celebrate': {
                            '0%, 100%': { transform: 'scale(1)' },
                            '50%': { transform: 'scale(1.1)' }
                        },
                        'shake': {
                            '0%, 100%': { transform: 'translateX(0)' },
                            '25%': { transform: 'translateX(-10px)' },
                            '75%': { transform: 'translateX(10px)' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom scrollbar for dark mode */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: #5D5CDE;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #4847B8;
        }

        /* Smooth transitions */
        * {
            transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease;
        }

        /* Formula styling */
        .formula {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, rgba(93, 92, 222, 0.1) 0%, rgba(93, 92, 222, 0.05) 100%);
            border-left: 4px solid #5D5CDE;
        }

        /* Accounting table styling */
        .accounting-table {
            border-collapse: collapse;
            width: 100%;
        }
        .accounting-table th,
        .accounting-table td {
            text-align: left;
            padding: 0.75rem 0.5rem;
            border-bottom: 1px solid #E5E7EB;
        }
        .dark .accounting-table th,
        .dark .accounting-table td {
            border-bottom: 1px solid #374151;
        }
        .accounting-table th {
            font-weight: 600;
            background-color: rgba(93, 92, 222, 0.1);
        }

        /* Progress bar animation */
        .progress-fill {
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Input focus states */
        input:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(93, 92, 222, 0.3);
        }

        /* Celebration confetti effect */
        @keyframes confetti-fall {
            to {
                transform: translateY(100vh) rotate(360deg);
            }
        }
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: #5D5CDE;
            animation: confetti-fall 3s linear forwards;
            pointer-events: none;
        }
    </style>
</head>
<body class="bg-white dark:bg-bg-dark text-gray-900 dark:text-gray-100 min-h-screen">
    <!-- App Container -->
    <div id="app" class="max-w-2xl mx-auto px-4 py-6 pb-24">
        <!-- Header with Progress -->
        <header class="mb-6 animate-slide-up">
            <div class="flex items-center justify-between mb-4">
                <h1 class="text-xl font-bold text-primary">üìö Incomplete Records Mastery</h1>
                <button id="themeToggle" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                    <span class="text-2xl">üåô</span>
                </button>
            </div>

            <!-- Progress Bar -->
            <div class="bg-gray-200 dark:bg-gray-700 rounded-full h-3 overflow-hidden">
                <div id="progressBar" class="progress-fill h-full bg-gradient-to-r from-primary to-purple-500 rounded-full" style="width: 0%"></div>
            </div>
            <p class="text-sm text-gray-600 dark:text-gray-400 mt-2 text-center">
                <span id="progressText">Step 0 of 15</span> ‚Ä¢ <span id="progressPercent">0%</span>
            </p>
        </header>

        <!-- Main Content Area -->
        <main id="mainContent" class="animate-fade-in">
            <!-- Screens will be dynamically inserted here -->
        </main>

        <!-- Navigation Buttons -->
        <nav class="fixed bottom-0 left-0 right-0 bg-white dark:bg-bg-dark border-t border-gray-200 dark:border-gray-700 p-4 shadow-lg">
            <div class="max-w-2xl mx-auto flex gap-3">
                <button id="prevBtn" class="flex-1 px-6 py-3 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg font-semibold hover:bg-gray-300 dark:hover:bg-gray-600 transition-all disabled:opacity-50 disabled:cursor-not-allowed text-base" disabled>
                    ‚Üê Previous
                </button>
                <button id="nextBtn" class="flex-1 px-6 py-3 bg-primary text-white rounded-lg font-semibold hover:bg-primary-dark transition-all disabled:opacity-50 disabled:cursor-not-allowed text-base">
                    Next ‚Üí
                </button>
            </div>
        </nav>
    </div>

    <!-- Custom Modal Container -->
    <div id="modalContainer"></div>

    <script>
        // ==================== DARK MODE SETUP ====================
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Theme toggle
        const themeToggle = document.getElementById('themeToggle');
        themeToggle.addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
            themeToggle.querySelector('span').textContent =
                document.documentElement.classList.contains('dark') ? '‚òÄÔ∏è' : 'üåô';
        });

        // ==================== UTILITY FUNCTIONS ====================
        function showCustomAlert(message, type = 'info') {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 animate-fade-in';

            const icons = {
                success: '‚úÖ',
                error: '‚ùå',
                info: '‚ÑπÔ∏è',
                warning: '‚ö†Ô∏è'
            };

            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-sm w-full mx-4 animate-slide-up overflow-hidden">
                    <div class="p-6">
                        <div class="text-5xl text-center mb-4">${icons[type]}</div>
                        <p class="text-gray-700 dark:text-gray-300 text-center text-base leading-relaxed">${message}</p>
                    </div>
                    <button class="w-full px-6 py-4 bg-primary text-white font-semibold hover:bg-primary-dark transition-colors text-base" onclick="this.closest('.fixed').remove()">
                        Got it!
                    </button>
                </div>
            `;
            document.body.appendChild(modal);

            // Auto-dismiss after 3 seconds for success messages
            if (type === 'success') {
                setTimeout(() => modal.remove(), 3000);
            }
        }

        function createConfetti() {
            const colors = ['#5D5CDE', '#EC4899', '#F59E0B', '#10B981', '#3B82F6'];
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 0.5 + 's';
                    confetti.style.width = (Math.random() * 10 + 5) + 'px';
                    confetti.style.height = confetti.style.width;
                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 30);
            }
        }

        function formatCurrency(num) {
            return '‚Ç¶' + num.toLocaleString('en-NG');
        }

        // ==================== APP STATE ====================
        let currentScreen = 0;
        let userAnswers = {};
        let screenStates = {};

        const totalScreens = 15;

        // ==================== SCREEN DEFINITIONS ====================
        const screens = [
            // SCREEN 0: Welcome & Mission Setting
            {
                id: 'welcome',
                title: 'üéØ Your Mission',
                content: `
                    <div class="space-y-6">
                        <div class="text-center mb-8">
                            <div class="text-6xl mb-4 animate-bounce-subtle">üéì</div>
                            <h2 class="text-2xl font-bold mb-3 text-primary">Welcome, Future Accountant!</h2>
                            <p class="text-lg text-gray-600 dark:text-gray-400">Let's master Incomplete Records together</p>
                        </div>

                        <div class="bg-gradient-to-br from-primary/10 to-purple-500/10 rounded-2xl p-6 border-2 border-primary/30">
                            <h3 class="font-semibold text-lg mb-3 flex items-center gap-2">
                                <span>üéØ</span> Your Learning Journey
                            </h3>
                            <div class="space-y-3">
                                <div class="flex items-start gap-3">
                                    <span class="text-2xl">üß©</span>
                                    <div>
                                        <p class="font-medium">Understand the Problem</p>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Why do businesses have incomplete records?</p>
                                    </div>
                                </div>
                                <div class="flex items-start gap-3">
                                    <span class="text-2xl">üîß</span>
                                    <div>
                                        <p class="font-medium">Master the Tools</p>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Learn to calculate missing figures</p>
                                    </div>
                                </div>
                                <div class="flex items-start gap-3">
                                    <span class="text-2xl">üí™</span>
                                    <div>
                                        <p class="font-medium">Practice & Apply</p>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Solve real exam-style problems</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-xl p-5 border-l-4 border-yellow-500">
                            <p class="text-sm font-medium mb-2 flex items-center gap-2">
                                <span>üí°</span> Learning Strategy
                            </p>
                            <p class="text-sm text-gray-700 dark:text-gray-300">
                                We'll break this complex topic into <strong>bite-sized pieces</strong>.
                                Each screen focuses on ONE concept. Take your time, and don't rush!
                            </p>
                        </div>

                        <div class="text-center pt-4">
                            <p class="text-gray-500 dark:text-gray-400 text-sm mb-2">Ready to begin?</p>
                            <p class="text-2xl">üëá</p>
                        </div>
                    </div>
                `,
                validate: () => true
            },

            // SCREEN 1: Understanding Incomplete Records
            {
                id: 'concept-intro',
                title: 'üîç What Are Incomplete Records?',
                content: `
                    <div class="space-y-6">
                        <div class="bg-card-light dark:bg-card-dark rounded-2xl p-6">
                            <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                                <span>üìñ</span> The Real-World Problem
                            </h3>
                            <p class="text-base leading-relaxed mb-4">
                                Imagine a small shop owner who keeps receipts in a shoebox üì¶.
                                They don't use double-entry accounting. How can we prepare their financial statements?
                            </p>
                            <div class="bg-red-50 dark:bg-red-900/20 rounded-xl p-4 border-l-4 border-red-500">
                                <p class="text-sm font-semibold mb-2">‚ùå The Challenge:</p>
                                <ul class="text-sm space-y-1 list-disc list-inside">
                                    <li>No proper journals or ledgers</li>
                                    <li>No trial balance available</li>
                                    <li>Missing vital transaction records</li>
                                    <li>Can't prepare normal Trading & P&L Account</li>
                                </ul>
                            </div>
                        </div>

                        <div class="bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-2xl p-6 border-2 border-green-500/30">
                            <h3 class="text-lg font-bold mb-3 flex items-center gap-2">
                                <span>‚úÖ</span> The Solution: Statement of Affairs
                            </h3>
                            <p class="text-base leading-relaxed mb-4">
                                We use a clever approach: compare what the business owns and owes at two points in time!
                            </p>

                            <div class="bg-white dark:bg-gray-800 rounded-lg p-4 mb-4">
                                <p class="font-semibold mb-2 text-primary">The Magic Formula:</p>
                                <div class="formula p-4 rounded-lg">
                                    <p class="text-sm mb-1">Closing Capital (Assets - Liabilities)</p>
                                    <p class="text-sm mb-1">Less: Opening Capital</p>
                                    <p class="text-sm mb-1">Less: Additional Capital</p>
                                    <p class="text-sm mb-1">Add: Drawings</p>
                                    <p class="text-sm font-bold border-t border-gray-300 dark:border-gray-600 pt-2 mt-2">= Net Profit / (Loss)</p>
                                </div>
                            </div>

                            <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4">
                                <p class="text-sm flex items-start gap-2">
                                    <span>üí°</span>
                                    <span><strong>Key Insight:</strong> If the business is worth more at the end of the year (after accounting for drawings and additional capital), it must have made a profit!</span>
                                </p>
                            </div>
                        </div>

                        <div class="text-center">
                            <p class="text-sm text-gray-600 dark:text-gray-400">Let's see this in action! ‚Üí</p>
                        </div>
                    </div>
                `,
                validate: () => true
            },

            // SCREEN 2: Simple Example - Data Presentation
            {
                id: 'example-data',
                title: 'üìä Let\'s Work Through an Example',
                content: `
                    <div class="space-y-6">
                        <div class="bg-primary/10 rounded-2xl p-6 border-2 border-primary/30">
                            <h3 class="text-lg font-bold mb-3">üéØ Your Task:</h3>
                            <p class="text-base mb-4">
                                Mr. Ade runs a small grocery shop. He gives you this information:
                            </p>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-card-light dark:bg-card-dark rounded-xl p-4">
                                <p class="text-sm font-semibold mb-3 text-center border-b border-gray-300 dark:border-gray-600 pb-2">
                                    üìÖ Start of Year (Jan 1)
                                </p>
                                <table class="w-full text-sm">
                                    <tr><td class="py-1">Cash</td><td class="text-right font-mono">‚Ç¶5,000</td></tr>
                                    <tr><td class="py-1">Stock</td><td class="text-right font-mono">‚Ç¶20,000</td></tr>
                                    <tr><td class="py-1">Debtors</td><td class="text-right font-mono">‚Ç¶8,000</td></tr>
                                    <tr class="border-t border-gray-300 dark:border-gray-600">
                                        <td class="py-1 font-semibold">Assets</td>
                                        <td class="text-right font-mono font-semibold">‚Ç¶33,000</td>
                                    </tr>
                                    <tr><td class="py-1">Creditors</td><td class="text-right font-mono">(‚Ç¶10,000)</td></tr>
                                    <tr class="border-t border-gray-300 dark:border-gray-600">
                                        <td class="py-1 font-bold">Capital</td>
                                        <td class="text-right font-mono font-bold">‚Ç¶23,000</td>
                                    </tr>
                                </table>
                            </div>

                            <div class="bg-card-light dark:bg-card-dark rounded-xl p-4">
                                <p class="text-sm font-semibold mb-3 text-center border-b border-gray-300 dark:border-gray-600 pb-2">
                                    üìÖ End of Year (Dec 31)
                                </p>
                                <table class="w-full text-sm">
                                    <tr><td class="py-1">Cash</td><td class="text-right font-mono">‚Ç¶7,000</td></tr>
                                    <tr><td class="py-1">Stock</td><td class="text-right font-mono">‚Ç¶25,000</td></tr>
                                    <tr><td class="py-1">Debtors</td><td class="text-right font-mono">‚Ç¶12,000</td></tr>
                                    <tr class="border-t border-gray-300 dark:border-gray-600">
                                        <td class="py-1 font-semibold">Assets</td>
                                        <td class="text-right font-mono font-semibold">‚Ç¶44,000</td>
                                    </tr>
                                    <tr><td class="py-1">Creditors</td><td class="text-right font-mono">(‚Ç¶8,000)</td></tr>
                                    <tr class="border-t border-gray-300 dark:border-gray-600">
                                        <td class="py-1 font-bold">Capital</td>
                                        <td class="text-right font-mono font-bold">‚Ç¶36,000</td>
                                    </tr>
                                </table>
                            </div>
                        </div>

                        <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-xl p-5 border-l-4 border-yellow-500">
                            <p class="text-sm font-semibold mb-2">üìù Additional Information:</p>
                            <ul class="text-sm space-y-1 list-disc list-inside">
                                <li>Mr. Ade withdrew <strong>‚Ç¶5,000</strong> for personal use during the year</li>
                                <li>No additional capital was introduced</li>
                            </ul>
                        </div>

                        <div class="bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-xl p-5">
                            <p class="text-sm font-semibold mb-2 flex items-center gap-2">
                                <span>ü§î</span> Question to Think About:
                            </p>
                            <p class="text-base">
                                Did Mr. Ade's business make a <strong>profit</strong> or a <strong>loss</strong> this year?
                            </p>
                        </div>
                    </div>
                `,
                validate: () => true
            },

            // SCREEN 3: Guided Calculation - Step 1
            {
                id: 'calc-step1',
                title: 'üßÆ Step 1: Find the Change in Capital',
                content: `
                    <div class="space-y-6">
                        <div class="bg-primary/10 rounded-xl p-5 border-l-4 border-primary">
                            <p class="text-base font-semibold mb-2">üéØ What we're doing:</p>
                            <p class="text-sm">Comparing the business's net worth at the start vs. end of the year</p>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                            <h3 class="font-bold mb-4 text-center">Capital Calculation</h3>

                            <div class="space-y-4">
                                <div class="flex justify-between items-center p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                    <span class="font-semibold">Closing Capital (Dec 31)</span>
                                    <span class="font-mono text-lg font-bold text-green-600 dark:text-green-400">‚Ç¶36,000</span>
                                </div>

                                <div class="flex justify-center">
                                    <span class="text-3xl">‚ûñ</span>
                                </div>

                                <div class="flex justify-between items-center p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                                    <span class="font-semibold">Opening Capital (Jan 1)</span>
                                    <span class="font-mono text-lg font-bold text-blue-600 dark:text-blue-400">‚Ç¶23,000</span>
                                </div>

                                <div class="flex justify-center">
                                    <span class="text-3xl">=</span>
                                </div>

                                <div class="border-t-4 border-primary pt-4">
                                    <div class="bg-gradient-to-r from-primary/20 to-purple-500/20 rounded-lg p-4">
                                        <p class="text-sm text-center mb-2">Increase in Capital</p>
                                        <p class="text-3xl font-bold text-center font-mono">‚Ç¶13,000</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-blue-50 dark:bg-blue-900/20 rounded-xl p-5 border-l-4 border-blue-500">
                            <p class="text-sm font-semibold mb-2 flex items-center gap-2">
                                <span>üí°</span> What This Means:
                            </p>
                            <p class="text-sm">
                                The business's net worth increased by ‚Ç¶13,000. But wait! This doesn't account for the
                                <strong class="text-primary">‚Ç¶5,000 drawings</strong> Mr. Ade took out.
                            </p>
                        </div>

                        <div class="text-center">
                            <p class="text-sm text-gray-600 dark:text-gray-400">Let's adjust for drawings next ‚Üí</p>
                        </div>
                    </div>
                `,
                validate: () => true
            },

            // SCREEN 4: Guided Calculation - Step 2
            {
                id: 'calc-step2',
                title: 'üßÆ Step 2: Adjust for Drawings',
                content: `
                    <div class="space-y-6">
                        <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-xl p-5 border-l-4 border-yellow-500">
                            <p class="text-base font-semibold mb-2">ü§î Think About It:</p>
                            <p class="text-sm">
                                Mr. Ade withdrew ‚Ç¶5,000 for personal use. This <strong>reduced</strong> the business capital.
                                But the business <em>still</em> grew from ‚Ç¶23,000 to ‚Ç¶36,000!
                            </p>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                            <h3 class="font-bold mb-4 text-center">Full Profit Calculation</h3>

                            <div class="space-y-3">
                                <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                    <span>Increase in Capital</span>
                                    <span class="font-mono font-bold">‚Ç¶13,000</span>
                                </div>

                                <div class="flex justify-center">
                                    <span class="text-2xl">‚ûï</span>
                                </div>

                                <div class="flex justify-between items-center p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg">
                                    <span>Drawings (money taken out)</span>
                                    <span class="font-mono font-bold">‚Ç¶5,000</span>
                                </div>

                                <div class="flex justify-center">
                                    <span class="text-2xl">=</span>
                                </div>

                                <div class="border-t-4 border-green-500 pt-4">
                                    <div class="bg-gradient-to-r from-green-100 to-emerald-100 dark:from-green-900/40 dark:to-emerald-900/40 rounded-lg p-5">
                                        <p class="text-sm text-center mb-2 font-semibold">‚úÖ NET PROFIT FOR THE YEAR</p>
                                        <p class="text-4xl font-bold text-center font-mono text-green-600 dark:text-green-400">‚Ç¶18,000</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gradient-to-r from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 rounded-xl p-5">
                            <p class="text-sm font-semibold mb-3 flex items-center gap-2">
                                <span>üéì</span> Key Learning:
                            </p>
                            <p class="text-sm leading-relaxed">
                                The <strong>‚Ç¶18,000 profit</strong> is the <em>real</em> increase in wealth. The business earned this much,
                                but ‚Ç¶5,000 was withdrawn, leaving a net capital increase of ‚Ç¶13,000.
                            </p>
                        </div>

                        <div class="text-center bg-primary/10 rounded-xl p-4">
                            <p class="font-semibold text-primary mb-2">üéØ Formula Summary:</p>
                            <div class="text-sm font-mono bg-white dark:bg-gray-800 rounded p-3 inline-block">
                                Profit = (Closing Capital - Opening Capital) + Drawings
                            </div>
                        </div>
                    </div>
                `,
                validate: () => true
            },

            // SCREEN 5: Interactive Practice Question 1
            {
                id: 'practice1',
                title: '‚úçÔ∏è Your Turn: Practice Question',
                content: `
                    <div class="space-y-6">
                        <div class="bg-primary/10 rounded-xl p-5 border-2 border-primary/30">
                            <h3 class="font-bold mb-3 flex items-center gap-2">
                                <span>üéØ</span> Apply What You've Learned
                            </h3>
                            <p class="text-sm">Use the same formula to solve this problem:</p>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                            <h4 class="font-semibold mb-4">üìã Scenario:</h4>
                            <p class="text-sm mb-4">
                                Mrs. Bola's business information:
                            </p>
                            <ul class="text-sm space-y-2 mb-4">
                                <li class="flex justify-between p-2 bg-gray-50 dark:bg-gray-700 rounded">
                                    <span>Opening Capital (Jan 1):</span>
                                    <span class="font-mono font-bold">‚Ç¶45,000</span>
                                </li>
                                <li class="flex justify-between p-2 bg-gray-50 dark:bg-gray-700 rounded">
                                    <span>Closing Capital (Dec 31):</span>
                                    <span class="font-mono font-bold">‚Ç¶62,000</span>
                                </li>
                                <li class="flex justify-between p-2 bg-gray-50 dark:bg-gray-700 rounded">
                                    <span>Drawings during the year:</span>
                                    <span class="font-mono font-bold">‚Ç¶8,000</span>
                                </li>
                                <li class="flex justify-between p-2 bg-gray-50 dark:bg-gray-700 rounded">
                                    <span>Additional Capital:</span>
                                    <span class="font-mono font-bold">‚Ç¶0</span>
                                </li>
                            </ul>

                            <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4 mb-4">
                                <p class="text-sm font-semibold mb-2">‚ùì Question:</p>
                                <p class="text-sm">What is the <strong>Net Profit</strong> for the year?</p>
                            </div>

                            <div class="space-y-3">
                                <label class="block">
                                    <span class="text-sm font-medium mb-2 block">üí≠ Show Your Working (Optional):</span>
                                    <textarea id="working1" rows="3" class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-700 rounded-lg border-2 border-gray-300 dark:border-gray-600 text-base" placeholder="Type your calculation steps here..."></textarea>
                                </label>

                                <label class="block">
                                    <span class="text-sm font-medium mb-2 block">‚úçÔ∏è Your Answer:</span>
                                    <div class="flex gap-2">
                                        <span class="text-2xl">‚Ç¶</span>
                                        <input type="number" id="answer1" class="flex-1 px-4 py-3 bg-gray-50 dark:bg-gray-700 rounded-lg border-2 border-gray-300 dark:border-gray-600 text-base font-mono" placeholder="Enter amount...">
                                    </div>
                                </label>

                                <button id="checkAnswer1" class="w-full px-6 py-4 bg-gradient-to-r from-primary to-purple-500 text-white rounded-lg font-semibold hover:shadow-lg transition-all text-base">
                                    Check Answer ‚úì
                                </button>

                                <div id="feedback1" class="hidden"></div>
                            </div>
                        </div>

                        <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4">
                            <p class="text-xs text-gray-600 dark:text-gray-400">
                                üí° <strong>Hint:</strong> Remember the formula: (Closing Capital - Opening Capital) - Additional Capital + Drawings
                            </p>
                        </div>
                    </div>
                `,
                validate: () => {
                    const answer = parseFloat(document.getElementById('answer1').value);
                    return !isNaN(answer) && answer === 25000;
                },
                onMount: () => {
                    document.getElementById('checkAnswer1').addEventListener('click', () => {
                        const answer = parseFloat(document.getElementById('answer1').value);
                        const feedback = document.getElementById('feedback1');

                        if (isNaN(answer)) {
                            feedback.className = 'mt-4 p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border-l-4 border-yellow-500 animate-shake';
                            feedback.innerHTML = `
                                <p class="text-sm font-semibold mb-1">‚ö†Ô∏è Please enter a number</p>
                                <p class="text-xs">Type your answer in the box above.</p>
                            `;
                            feedback.classList.remove('hidden');
                            return;
                        }

                        if (answer === 25000) {
                            feedback.className = 'mt-4 p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border-l-4 border-green-500 animate-celebrate';
                            feedback.innerHTML = `
                                <p class="text-sm font-semibold mb-2 flex items-center gap-2">
                                    <span class="text-2xl">üéâ</span> Excellent! You got it right!
                                </p>
                                <p class="text-xs mb-3">
                                    <strong>Working:</strong><br>
                                    Closing Capital (‚Ç¶62,000) - Opening Capital (‚Ç¶45,000) = ‚Ç¶17,000<br>
                                    Add: Drawings (‚Ç¶8,000)<br>
                                    <strong>Net Profit = ‚Ç¶25,000</strong>
                                </p>
                                <p class="text-xs text-green-700 dark:text-green-300">
                                    You've mastered the basic formula! Click Next to continue ‚Üí
                                </p>
                            `;
                            feedback.classList.remove('hidden');
                            createConfetti();
                            screenStates[currentScreen] = { completed: true };
                            document.getElementById('nextBtn').disabled = false;
                        } else {
                            feedback.className = 'mt-4 p-4 bg-red-50 dark:bg-red-900/20 rounded-lg border-l-4 border-red-500 animate-shake';
                            let hint = '';
                            if (answer === 17000) {
                                hint = '<p class="text-xs mt-2">üí° You calculated the increase in capital correctly, but forgot to add back the drawings!</p>';
                            }
                            feedback.innerHTML = `
                                <p class="text-sm font-semibold mb-1">‚ùå Not quite right</p>
                                <p class="text-xs">Expected: ‚Ç¶25,000 | You entered: ‚Ç¶${answer.toLocaleString()}</p>
                                ${hint}
                                <p class="text-xs mt-2">Try again! Review the formula if needed.</p>
                            `;
                            feedback.classList.remove('hidden');
                        }
                    });

                    // Enable next button if already completed
                    if (screenStates[currentScreen]?.completed) {
                        document.getElementById('nextBtn').disabled = false;
                    } else {
                        document.getElementById('nextBtn').disabled = true;
                    }
                }
            },

            // SCREEN 6: Additional Capital Concept
            {
                id: 'additional-capital',
                title: 'üí∞ Dealing with Additional Capital',
                content: `
                    <div class="space-y-6">
                        <div class="bg-primary/10 rounded-xl p-5 border-l-4 border-primary">
                            <h3 class="font-bold mb-2">üéØ New Scenario:</h3>
                            <p class="text-sm">What if the owner puts MORE money into the business during the year?</p>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                            <h4 class="font-semibold mb-4 text-center">üìñ Example Scenario</h4>

                            <div class="space-y-3 mb-6">
                                <div class="flex justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                    <span>Opening Capital</span>
                                    <span class="font-mono font-bold">‚Ç¶30,000</span>
                                </div>
                                <div class="flex justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                    <span>Closing Capital</span>
                                    <span class="font-mono font-bold">‚Ç¶50,000</span>
                                </div>
                                <div class="flex justify-between p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border-l-4 border-green-500">
                                    <span class="font-semibold">Additional Capital (introduced in June)</span>
                                    <span class="font-mono font-bold">‚Ç¶10,000</span>
                                </div>
                                <div class="flex justify-between p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg">
                                    <span>Drawings</span>
                                    <span class="font-mono font-bold">‚Ç¶4,000</span>
                                </div>
                            </div>

                            <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4 mb-4">
                                <p class="text-sm font-semibold mb-2">ü§î Critical Thinking:</p>
                                <p class="text-sm">
                                    Capital increased by ‚Ç¶20,000 (from ‚Ç¶30k to ‚Ç¶50k).
                                    But ‚Ç¶10,000 came from the owner's pocket, NOT from profit!
                                </p>
                            </div>

                            <div class="bg-gradient-to-r from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 rounded-xl p-5">
                                <p class="font-semibold mb-3 text-center">Updated Formula:</p>
                                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 space-y-2 text-sm font-mono">
                                    <div class="flex justify-between">
                                        <span>Closing Capital</span>
                                        <span>‚Ç¶50,000</span>
                                    </div>
                                    <div class="flex justify-between text-gray-600 dark:text-gray-400">
                                        <span>Less: Opening Capital</span>
                                        <span>(‚Ç¶30,000)</span>
                                    </div>
                                    <div class="flex justify-between text-red-600 dark:text-red-400">
                                        <span>Less: Additional Capital</span>
                                        <span>(‚Ç¶10,000)</span>
                                    </div>
                                    <div class="border-t border-gray-300 dark:border-gray-600 pt-2"></div>
                                    <div class="flex justify-between">
                                        <span>Subtotal</span>
                                        <span>‚Ç¶10,000</span>
                                    </div>
                                    <div class="flex justify-between text-green-600 dark:text-green-400">
                                        <span>Add: Drawings</span>
                                        <span>‚Ç¶4,000</span>
                                    </div>
                                    <div class="border-t-2 border-primary pt-2 mt-2"></div>
                                    <div class="flex justify-between font-bold text-lg">
                                        <span>Net Profit</span>
                                        <span class="text-green-600 dark:text-green-400">‚Ç¶14,000</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-blue-50 dark:bg-blue-900/20 rounded-xl p-5 border-l-4 border-blue-500">
                            <p class="text-sm font-semibold mb-2 flex items-center gap-2">
                                <span>üí°</span> Key Principle:
                            </p>
                            <p class="text-sm">
                                We must <strong>subtract</strong> additional capital because it's NOT profit‚Äîit's money the owner put in from outside the business.
                            </p>
                        </div>
                    </div>
                `,
                validate: () => true
            },

            // SCREEN 7: Practice Question 2 (with Additional Capital)
            {
                id: 'practice2',
                title: '‚úçÔ∏è Practice: Additional Capital',
                content: `
                    <div class="space-y-6">
                        <div class="bg-primary/10 rounded-xl p-5 border-2 border-primary/30">
                            <h3 class="font-bold mb-2 flex items-center gap-2">
                                <span>üéØ</span> Challenge Question
                            </h3>
                            <p class="text-sm">Now let's include additional capital in your calculation:</p>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                            <h4 class="font-semibold mb-4">üìã Mr. Chidi's Business:</h4>
                            <ul class="text-sm space-y-2 mb-5">
                                <li class="flex justify-between p-2 bg-gray-50 dark:bg-gray-700 rounded">
                                    <span>Opening Capital:</span>
                                    <span class="font-mono font-bold">‚Ç¶80,000</span>
                                </li>
                                <li class="flex justify-between p-2 bg-gray-50 dark:bg-gray-700 rounded">
                                    <span>Closing Capital:</span>
                                    <span class="font-mono font-bold">‚Ç¶115,000</span>
                                </li>
                                <li class="flex justify-between p-2 bg-green-50 dark:bg-green-900/20 rounded border-l-4 border-green-500">
                                    <span>Additional Capital (introduced):</span>
                                    <span class="font-mono font-bold">‚Ç¶15,000</span>
                                </li>
                                <li class="flex justify-between p-2 bg-purple-50 dark:bg-purple-900/20 rounded">
                                    <span>Drawings:</span>
                                    <span class="font-mono font-bold">‚Ç¶12,000</span>
                                </li>
                            </ul>

                            <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4 mb-4">
                                <p class="text-sm font-semibold mb-2">‚ùì Calculate the Net Profit:</p>
                            </div>

                            <div class="space-y-3">
                                <label class="block">
                                    <span class="text-sm font-medium mb-2 block">üí≠ Your Working:</span>
                                    <textarea id="working2" rows="4" class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-700 rounded-lg border-2 border-gray-300 dark:border-gray-600 text-base" placeholder="Show your calculation steps..."></textarea>
                                </label>

                                <label class="block">
                                    <span class="text-sm font-medium mb-2 block">‚úçÔ∏è Net Profit:</span>
                                    <div class="flex gap-2">
                                        <span class="text-2xl">‚Ç¶</span>
                                        <input type="number" id="answer2" class="flex-1 px-4 py-3 bg-gray-50 dark:bg-gray-700 rounded-lg border-2 border-gray-300 dark:border-gray-600 text-base font-mono" placeholder="Enter amount...">
                                    </div>
                                </label>

                                <button id="checkAnswer2" class="w-full px-6 py-4 bg-gradient-to-r from-primary to-purple-500 text-white rounded-lg font-semibold hover:shadow-lg transition-all text-base">
                                    Check Answer ‚úì
                                </button>

                                <div id="feedback2" class="hidden"></div>
                            </div>
                        </div>

                        <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4">
                            <p class="text-xs">
                                üí° <strong>Remember:</strong> Subtract additional capital, then add drawings
                            </p>
                        </div>
                    </div>
                `,
                validate: () => {
                    const answer = parseFloat(document.getElementById('answer2').value);
                    return !isNaN(answer) && answer === 32000;
                },
                onMount: () => {
                    document.getElementById('checkAnswer2').addEventListener('click', () => {
                        const answer = parseFloat(document.getElementById('answer2').value);
                        const feedback = document.getElementById('feedback2');

                        if (isNaN(answer)) {
                            feedback.className = 'mt-4 p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border-l-4 border-yellow-500 animate-shake';
                            feedback.innerHTML = `
                                <p class="text-sm font-semibold">‚ö†Ô∏è Please enter a number</p>
                            `;
                            feedback.classList.remove('hidden');
                            return;
                        }

                        if (answer === 32000) {
                            feedback.className = 'mt-4 p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border-l-4 border-green-500 animate-celebrate';
                            feedback.innerHTML = `
                                <p class="text-sm font-semibold mb-2 flex items-center gap-2">
                                    <span class="text-2xl">üéâ</span> Perfect! Outstanding work!
                                </p>
                                <p class="text-xs mb-3">
                                    <strong>Correct Working:</strong><br>
                                    Closing Capital: ‚Ç¶115,000<br>
                                    Less: Opening Capital: (‚Ç¶80,000)<br>
                                    Less: Additional Capital: (‚Ç¶15,000)<br>
                                    Subtotal: ‚Ç¶20,000<br>
                                    Add: Drawings: ‚Ç¶12,000<br>
                                    <strong class="text-green-600 dark:text-green-400">Net Profit = ‚Ç¶32,000</strong>
                                </p>
                                <p class="text-xs text-green-700 dark:text-green-300">
                                    You're mastering this! Ready for the next concept? ‚Üí
                                </p>
                            `;
                            feedback.classList.remove('hidden');
                            createConfetti();
                            screenStates[currentScreen] = { completed: true };
                            document.getElementById('nextBtn').disabled = false;
                        } else {
                            feedback.className = 'mt-4 p-4 bg-red-50 dark:bg-red-900/20 rounded-lg border-l-4 border-red-500 animate-shake';
                            let hint = '';
                            if (answer === 47000) {
                                hint = '<p class="text-xs mt-2">üí° You added the additional capital instead of subtracting it!</p>';
                            } else if (answer === 20000) {
                                hint = '<p class="text-xs mt-2">üí° You forgot to add back the drawings!</p>';
                            }
                            feedback.innerHTML = `
                                <p class="text-sm font-semibold mb-1">‚ùå Not quite</p>
                                <p class="text-xs">Expected: ‚Ç¶32,000 | You entered: ‚Ç¶${answer.toLocaleString()}</p>
                                ${hint}
                                <p class="text-xs mt-2">Review the formula and try again!</p>
                            `;
                            feedback.classList.remove('hidden');
                        }
                    });

                    if (screenStates[currentScreen]?.completed) {
                        document.getElementById('nextBtn').disabled = false;
                    } else {
                        document.getElementById('nextBtn').disabled = true;
                    }
                }
            },

            // SCREEN 8: Single Entry Introduction
            {
                id: 'single-entry-intro',
                title: 'üìñ Single Entry System',
                content: `
                    <div class="space-y-6">
                        <div class="bg-gradient-to-r from-primary/20 to-purple-500/20 rounded-2xl p-6 border-2 border-primary/30">
                            <h3 class="text-xl font-bold mb-3 flex items-center gap-2">
                                <span>üîÑ</span> What's Different?
                            </h3>
                            <p class="text-base leading-relaxed">
                                <strong>Incomplete Records:</strong> Very little data‚Äîwe can only estimate profit<br>
                                <strong>Single Entry:</strong> More records available‚Äîwe CAN prepare full financial statements!
                            </p>
                        </div>

                        <div class="grid md:grid-cols-2 gap-4">
                            <div class="bg-red-50 dark:bg-red-900/20 rounded-xl p-5 border-l-4 border-red-500">
                                <h4 class="font-semibold mb-3 flex items-center gap-2">
                                    <span>‚ùå</span> Incomplete Records
                                </h4>
                                <ul class="text-sm space-y-2">
                                    <li>‚úó No transaction records</li>
                                    <li>‚úó Only opening/closing balances</li>
                                    <li>‚úó Can't prepare Trading Account</li>
                                    <li>‚úì Only estimate profit from capital change</li>
                                </ul>
                            </div>

                            <div class="bg-green-50 dark:bg-green-900/20 rounded-xl p-5 border-l-4 border-green-500">
                                <h4 class="font-semibold mb-3 flex items-center gap-2">
                                    <span>‚úÖ</span> Single Entry
                                </h4>
                                <ul class="text-sm space-y-2">
                                    <li>‚úì Cash book available</li>
                                    <li>‚úì Bank statements provided</li>
                                    <li>‚úì CAN prepare full P&L Account</li>
                                    <li>‚úì Convert to double-entry system</li>
                                </ul>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                            <h4 class="font-semibold mb-4 text-center">üîß The Conversion Process</h4>

                            <div class="space-y-3">
                                <div class="flex items-start gap-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                                    <span class="text-2xl flex-shrink-0">1Ô∏è‚É£</span>
                                    <div>
                                        <p class="font-semibold text-sm">Create Opening Statement of Affairs</p>
                                        <p class="text-xs text-gray-600 dark:text-gray-400">Calculate opening capital</p>
                                    </div>
                                </div>

                                <div class="flex items-start gap-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                                    <span class="text-2xl flex-shrink-0">2Ô∏è‚É£</span>
                                    <div>
                                        <p class="font-semibold text-sm">Open Ledger Accounts</p>
                                        <p class="text-xs text-gray-600 dark:text-gray-400">Set up T-accounts for all items</p>
                                    </div>
                                </div>

                                <div class="flex items-start gap-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                                    <span class="text-2xl flex-shrink-0">3Ô∏è‚É£</span>
                                    <div>
                                        <p class="font-semibold text-sm">Post Transactions</p>
                                        <p class="text-xs text-gray-600 dark:text-gray-400">Complete double-entry for each transaction</p>
                                    </div>
                                </div>

                                <div class="flex items-start gap-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                                    <span class="text-2xl flex-shrink-0">4Ô∏è‚É£</span>
                                    <div>
                                        <p class="font-semibold text-sm">Calculate Missing Figures</p>
                                        <p class="text-xs text-gray-600 dark:text-gray-400">Find sales/purchases from control accounts</p>
                                    </div>
                                </div>

                                <div class="flex items-start gap-3 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border-l-4 border-green-500">
                                    <span class="text-2xl flex-shrink-0">5Ô∏è‚É£</span>
                                    <div>
                                        <p class="font-semibold text-sm">Prepare Final Accounts</p>
                                        <p class="text-xs text-gray-600 dark:text-gray-400">Trading & P&L Account + Balance Sheet</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-xl p-5 border-l-4 border-yellow-500">
                            <p class="text-sm font-semibold mb-2 flex items-center gap-2">
                                <span>üéØ</span> Key Technique:
                            </p>
                            <p class="text-sm">
                                We use <strong>Control Accounts</strong> (Debtors & Creditors) to find the missing sales and purchases figures.
                                This is the "magic" of single entry conversion!
                            </p>
                        </div>
                    </div>
                `,
                validate: () => true
            },

            // SCREEN 9: Margin vs Markup
            {
                id: 'margin-markup',
                title: 'üìä Margin vs. Mark-up',
                content: `
                    <div class="space-y-6">
                        <div class="bg-primary/10 rounded-xl p-5 border-l-4 border-primary">
                            <h3 class="font-bold mb-2">üéØ Critical Concept:</h3>
                            <p class="text-sm">Often, you'll need to calculate sales or cost of goods using percentages. But which one to use?</p>
                        </div>

                        <div class="grid md:grid-cols-2 gap-4">
                            <div class="bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 rounded-xl p-5 border-2 border-blue-500/30">
                                <h4 class="font-semibold mb-3 flex items-center gap-2">
                                    <span>üìâ</span> Margin (Gross Profit %)
                                </h4>
                                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 mb-3">
                                    <p class="text-xs mb-2 text-gray-600 dark:text-gray-400">Formula:</p>
                                    <div class="formula p-3 rounded text-center">
                                        <p class="font-mono text-sm">Margin = Profit / Sales √ó 100%</p>
                                    </div>
                                </div>
                                <p class="text-xs mb-2"><strong>Example:</strong></p>
                                <p class="text-xs">Sale: ‚Ç¶100 | Profit: ‚Ç¶20</p>
                                <p class="text-xs font-bold mt-2">Margin = 20/100 = 20%</p>
                                <div class="bg-blue-100 dark:bg-blue-900/30 rounded p-2 mt-3">
                                    <p class="text-xs font-semibold">‚úì Based on SELLING PRICE</p>
                                </div>
                            </div>

                            <div class="bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-xl p-5 border-2 border-green-500/30">
                                <h4 class="font-semibold mb-3 flex items-center gap-2">
                                    <span>üìà</span> Mark-up
                                </h4>
                                <div class="bg-white dark:bg-gray-800 rounded-lg p-4 mb-3">
                                    <p class="text-xs mb-2 text-gray-600 dark:text-gray-400">Formula:</p>
                                    <div class="formula p-3 rounded text-center">
                                        <p class="font-mono text-sm">Mark-up = Profit / Cost √ó 100%</p>
                                    </div>
                                </div>
                                <p class="text-xs mb-2"><strong>Example:</strong></p>
                                <p class="text-xs">Cost: ‚Ç¶80 | Profit: ‚Ç¶20</p>
                                <p class="text-xs font-bold mt-2">Mark-up = 20/80 = 25%</p>
                                <div class="bg-green-100 dark:bg-green-900/30 rounded p-2 mt-3">
                                    <p class="text-xs font-semibold">‚úì Based on COST PRICE</p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                            <h4 class="font-semibold mb-4 text-center">üîÑ Converting Between Them</h4>

                            <div class="space-y-4">
                                <div class="bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4">
                                    <p class="text-sm font-semibold mb-2">Margin ‚Üí Mark-up:</p>
                                    <div class="formula p-3 rounded">
                                        <p class="font-mono text-xs">Mark-up = Margin / (100 - Margin) √ó 100%</p>
                                    </div>
                                    <p class="text-xs mt-2 text-gray-600 dark:text-gray-400">
                                        Example: 20% margin = 20/(100-20) √ó 100 = <strong>25% mark-up</strong>
                                    </p>
                                </div>

                                <div class="bg-orange-50 dark:bg-orange-900/20 rounded-lg p-4">
                                    <p class="text-sm font-semibold mb-2">Mark-up ‚Üí Margin:</p>
                                    <div class="formula p-3 rounded">
                                        <p class="font-mono text-xs">Margin = Mark-up / (100 + Mark-up) √ó 100%</p>
                                    </div>
                                    <p class="text-xs mt-2 text-gray-600 dark:text-gray-400">
                                        Example: 25% mark-up = 25/(100+25) √ó 100 = <strong>20% margin</strong>
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-red-50 dark:bg-red-900/20 rounded-xl p-5 border-l-4 border-red-500">
                            <p class="text-sm font-semibold mb-2 flex items-center gap-2">
                                <span>‚ö†Ô∏è</span> Common Mistake:
                            </p>
                            <p class="text-sm">
                                <strong>Never</strong> apply margin to cost, or mark-up to sales!
                                Always check which base (cost or sales) you should use.
                            </p>
                        </div>
                    </div>
                `,
                validate: () => true
            },

            // SCREEN 10: Margin/Markup Practice
            {
                id: 'margin-practice',
                title: '‚úçÔ∏è Practice: Margin & Mark-up',
                content: `
                    <div class="space-y-6">
                        <div class="bg-primary/10 rounded-xl p-5 border-2 border-primary/30">
                            <h3 class="font-bold mb-2 flex items-center gap-2">
                                <span>üéØ</span> Application Exercise
                            </h3>
                            <p class="text-sm">Let's apply margin and mark-up to find missing figures:</p>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                            <h4 class="font-semibold mb-4">üìã Question:</h4>
                            <p class="text-sm mb-4">
                                A trader sells goods at a <strong class="text-primary">mark-up of 25%</strong>.
                                During the year, his sales amounted to <strong>‚Ç¶250,000</strong>.
                            </p>

                            <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4 mb-4">
                                <p class="text-sm font-semibold mb-2">‚ùì Calculate:</p>
                                <p class="text-sm">What is the <strong>Cost of Goods Sold</strong>?</p>
                            </div>

                            <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 mb-4">
                                <p class="text-xs font-semibold mb-2">üí° Hint:</p>
                                <p class="text-xs">
                                    If mark-up is 25%, it means: Cost + 25% of Cost = Sales<br>
                                    Or: Cost √ó 1.25 = Sales<br>
                                    Therefore: Cost = Sales √∑ 1.25
                                </p>
                            </div>

                            <div class="space-y-3">
                                <label class="block">
                                    <span class="text-sm font-medium mb-2 block">üí≠ Your Working:</span>
                                    <textarea id="working3" rows="3" class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-700 rounded-lg border-2 border-gray-300 dark:border-gray-600 text-base" placeholder="Show your calculation..."></textarea>
                                </label>

                                <label class="block">
                                    <span class="text-sm font-medium mb-2 block">‚úçÔ∏è Cost of Goods Sold:</span>
                                    <div class="flex gap-2">
                                        <span class="text-2xl">‚Ç¶</span>
                                        <input type="number" id="answer3" class="flex-1 px-4 py-3 bg-gray-50 dark:bg-gray-700 rounded-lg border-2 border-gray-300 dark:border-gray-600 text-base font-mono" placeholder="Enter amount...">
                                    </div>
                                </label>

                                <button id="checkAnswer3" class="w-full px-6 py-4 bg-gradient-to-r from-primary to-purple-500 text-white rounded-lg font-semibold hover:shadow-lg transition-all text-base">
                                    Check Answer ‚úì
                                </button>

                                <div id="feedback3" class="hidden"></div>
                            </div>
                        </div>
                    </div>
                `,
                validate: () => {
                    const answer = parseFloat(document.getElementById('answer3').value);
                    return !isNaN(answer) && answer === 200000;
                },
                onMount: () => {
                    document.getElementById('checkAnswer3').addEventListener('click', () => {
                        const answer = parseFloat(document.getElementById('answer3').value);
                        const feedback = document.getElementById('feedback3');

                        if (isNaN(answer)) {
                            feedback.className = 'mt-4 p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border-l-4 border-yellow-500 animate-shake';
                            feedback.innerHTML = `<p class="text-sm font-semibold">‚ö†Ô∏è Please enter a number</p>`;
                            feedback.classList.remove('hidden');
                            return;
                        }

                        if (answer === 200000) {
                            feedback.className = 'mt-4 p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border-l-4 border-green-500 animate-celebrate';
                            feedback.innerHTML = `
                                <p class="text-sm font-semibold mb-2 flex items-center gap-2">
                                    <span class="text-2xl">üéâ</span> Brilliant! You got it!
                                </p>
                                <p class="text-xs mb-3">
                                    <strong>Working:</strong><br>
                                    Mark-up = 25% means Sales = Cost √ó 1.25<br>
                                    ‚Ç¶250,000 = Cost √ó 1.25<br>
                                    Cost = ‚Ç¶250,000 √∑ 1.25<br>
                                    <strong class="text-green-600 dark:text-green-400">Cost = ‚Ç¶200,000</strong><br>
                                    (Gross Profit = ‚Ç¶250,000 - ‚Ç¶200,000 = ‚Ç¶50,000)
                                </p>
                            `;
                            feedback.classList.remove('hidden');
                            createConfetti();
                            screenStates[currentScreen] = { completed: true };
                            document.getElementById('nextBtn').disabled = false;
                        } else {
                            feedback.className = 'mt-4 p-4 bg-red-50 dark:bg-red-900/20 rounded-lg border-l-4 border-red-500 animate-shake';
                            let hint = '';
                            if (answer === 312500) {
                                hint = '<p class="text-xs mt-2">üí° You multiplied by 1.25 instead of dividing!</p>';
                            } else if (answer === 50000) {
                                hint = '<p class="text-xs mt-2">üí° That\'s the gross profit, not the cost!</p>';
                            }
                            feedback.innerHTML = `
                                <p class="text-sm font-semibold mb-1">‚ùå Not quite</p>
                                <p class="text-xs">Expected: ‚Ç¶200,000 | You entered: ‚Ç¶${answer.toLocaleString()}</p>
                                ${hint}
                                <p class="text-xs mt-2">Remember: Sales = Cost √ó (1 + Mark-up%)</p>
                            `;
                            feedback.classList.remove('hidden');
                        }
                    });

                    if (screenStates[currentScreen]?.completed) {
                        document.getElementById('nextBtn').disabled = false;
                    } else {
                        document.getElementById('nextBtn').disabled = true;
                    }
                }
            },

            // SCREEN 11: Control Accounts Introduction
            {
                id: 'control-accounts',
                title: 'üéõÔ∏è Control Accounts: Finding Missing Figures',
                content: `
                    <div class="space-y-6">
                        <div class="bg-gradient-to-r from-primary/20 to-purple-500/20 rounded-2xl p-6 border-2 border-primary/30">
                            <h3 class="text-xl font-bold mb-3 flex items-center gap-2">
                                <span>üîç</span> The Detective Work
                            </h3>
                            <p class="text-base leading-relaxed">
                                In single entry, we often know <strong>cash received from debtors</strong> but NOT total <strong>sales</strong>.
                                Control accounts help us find these missing pieces!
                            </p>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                            <h4 class="font-semibold mb-4 text-center">üìä Debtors Control Account Structure</h4>

                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-4">
                                <table class="w-full text-sm">
                                    <thead>
                                        <tr class="border-b-2 border-gray-300 dark:border-gray-600">
                                            <th class="text-left py-2">Debit Side</th>
                                            <th class="text-right py-2">Credit Side</th>
                                        </tr>
                                    </thead>
                                    <tbody class="font-mono text-xs">
                                        <tr>
                                            <td class="py-2">Opening Balance (Debtors at start)</td>
                                            <td class="py-2 text-right">Cash Received</td>
                                        </tr>
                                        <tr>
                                            <td class="py-2 font-bold text-primary">Credit Sales (?)</td>
                                            <td class="py-2 text-right">Returns Inward</td>
                                        </tr>
                                        <tr>
                                            <td class="py-2"></td>
                                            <td class="py-2 text-right">Bad Debts</td>
                                        </tr>
                                        <tr>
                                            <td class="py-2"></td>
                                            <td class="py-2 text-right">Closing Balance</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4">
                                <p class="text-sm font-semibold mb-2">üîë The Formula:</p>
                                <div class="formula p-3 rounded text-xs">
                                    <p>Opening Balance + Sales = Cash + Returns + Bad Debts + Closing Balance</p>
                                    <p class="mt-2 font-bold text-primary">Sales = ?</p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                            <h4 class="font-semibold mb-4 text-center">üìä Creditors Control Account Structure</h4>

                            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-4">
                                <table class="w-full text-sm">
                                    <thead>
                                        <tr class="border-b-2 border-gray-300 dark:border-gray-600">
                                            <th class="text-left py-2">Debit Side</th>
                                            <th class="text-right py-2">Credit Side</th>
                                        </tr>
                                    </thead>
                                    <tbody class="font-mono text-xs">
                                        <tr>
                                            <td class="py-2">Cash Paid</td>
                                            <td class="py-2 text-right">Opening Balance</td>
                                        </tr>
                                        <tr>
                                            <td class="py-2">Returns Outward</td>
                                            <td class="py-2 text-right font-bold text-primary">Credit Purchases (?)</td>
                                        </tr>
                                        <tr>
                                            <td class="py-2">Closing Balance</td>
                                            <td class="py-2 text-right"></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div class="bg-green-50 dark:bg-green-900/20 rounded-lg p-4">
                                <p class="text-sm font-semibold mb-2">üîë The Formula:</p>
                                <div class="formula p-3 rounded text-xs">
                                    <p>Opening Balance + Purchases = Cash Paid + Returns + Closing Balance</p>
                                    <p class="mt-2 font-bold text-primary">Purchases = ?</p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-xl p-5 border-l-4 border-yellow-500">
                            <p class="text-sm font-semibold mb-2 flex items-center gap-2">
                                <span>üí°</span> Key Principle:
                            </p>
                            <p class="text-sm">
                                The <strong>balancing figure</strong> in the control account is the missing sales or purchases amount.
                                This is how we convert single entry to double entry!
                            </p>
                        </div>
                    </div>
                `,
                validate: () => true
            },

            // SCREEN 12: Control Account Practice
            {
                id: 'control-practice',
                title: '‚úçÔ∏è Practice: Finding Sales',
                content: `
                    <div class="space-y-6">
                        <div class="bg-primary/10 rounded-xl p-5 border-2 border-primary/30">
                            <h3 class="font-bold mb-2 flex items-center gap-2">
                                <span>üéØ</span> Debtors Control Account Challenge
                            </h3>
                            <p class="text-sm">Use the control account to find the missing sales figure:</p>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                            <h4 class="font-semibold mb-4">üìã Given Information:</h4>
                            <ul class="text-sm space-y-2 mb-5">
                                <li class="flex justify-between p-2 bg-gray-50 dark:bg-gray-700 rounded">
                                    <span>Opening Debtors (Jan 1):</span>
                                    <span class="font-mono font-bold">‚Ç¶50,000</span>
                                </li>
                                <li class="flex justify-between p-2 bg-gray-50 dark:bg-gray-700 rounded">
                                    <span>Closing Debtors (Dec 31):</span>
                                    <span class="font-mono font-bold">‚Ç¶65,000</span>
                                </li>
                                <li class="flex justify-between p-2 bg-blue-50 dark:bg-blue-900/20 rounded border-l-4 border-blue-500">
                                    <span>Cash received from customers:</span>
                                    <span class="font-mono font-bold">‚Ç¶320,000</span>
                                </li>
                                <li class="flex justify-between p-2 bg-gray-50 dark:bg-gray-700 rounded">
                                    <span>Bad debts written off:</span>
                                    <span class="font-mono font-bold">‚Ç¶5,000</span>
                                </li>
                                <li class="flex justify-between p-2 bg-gray-50 dark:bg-gray-700 rounded">
                                    <span>Returns from customers:</span>
                                    <span class="font-mono font-bold">‚Ç¶0</span>
                                </li>
                            </ul>

                            <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4 mb-4">
                                <p class="text-sm font-semibold mb-2">‚ùì Calculate:</p>
                                <p class="text-sm">What is the <strong>Credit Sales</strong> for the year?</p>
                            </div>

                            <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 mb-4">
                                <p class="text-xs font-semibold mb-2">üí° Approach:</p>
                                <p class="text-xs">
                                    Opening + Sales = Cash + Bad Debts + Closing<br>
                                    50,000 + Sales = 320,000 + 5,000 + 65,000<br>
                                    Sales = ?
                                </p>
                            </div>

                            <div class="space-y-3">
                                <label class="block">
                                    <span class="text-sm font-medium mb-2 block">üí≠ Your Working:</span>
                                    <textarea id="working4" rows="3" class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-700 rounded-lg border-2 border-gray-300 dark:border-gray-600 text-base" placeholder="Show your T-account or calculation..."></textarea>
                                </label>

                                <label class="block">
                                    <span class="text-sm font-medium mb-2 block">‚úçÔ∏è Credit Sales:</span>
                                    <div class="flex gap-2">
                                        <span class="text-2xl">‚Ç¶</span>
                                        <input type="number" id="answer4" class="flex-1 px-4 py-3 bg-gray-50 dark:bg-gray-700 rounded-lg border-2 border-gray-300 dark:border-gray-600 text-base font-mono" placeholder="Enter amount...">
                                    </div>
                                </label>

                                <button id="checkAnswer4" class="w-full px-6 py-4 bg-gradient-to-r from-primary to-purple-500 text-white rounded-lg font-semibold hover:shadow-lg transition-all text-base">
                                    Check Answer ‚úì
                                </button>

                                <div id="feedback4" class="hidden"></div>
                            </div>
                        </div>
                    </div>
                `,
                validate: () => {
                    const answer = parseFloat(document.getElementById('answer4').value);
                    return !isNaN(answer) && answer === 340000;
                },
                onMount: () => {
                    document.getElementById('checkAnswer4').addEventListener('click', () => {
                        const answer = parseFloat(document.getElementById('answer4').value);
                        const feedback = document.getElementById('feedback4');

                        if (isNaN(answer)) {
                            feedback.className = 'mt-4 p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border-l-4 border-yellow-500 animate-shake';
                            feedback.innerHTML = `<p class="text-sm font-semibold">‚ö†Ô∏è Please enter a number</p>`;
                            feedback.classList.remove('hidden');
                            return;
                        }

                        if (answer === 340000) {
                            feedback.className = 'mt-4 p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border-l-4 border-green-500 animate-celebrate';
                            feedback.innerHTML = `
                                <p class="text-sm font-semibold mb-2 flex items-center gap-2">
                                    <span class="text-2xl">üéâ</span> Perfect! You've mastered control accounts!
                                </p>
                                <p class="text-xs mb-3">
                                    <strong>Working:</strong><br>
                                    Opening Balance: ‚Ç¶50,000<br>
                                    + Credit Sales: <strong>‚Ç¶340,000</strong><br>
                                    = ‚Ç¶390,000<br><br>
                                    Cash Received: ‚Ç¶320,000<br>
                                    + Bad Debts: ‚Ç¶5,000<br>
                                    + Closing Balance: ‚Ç¶65,000<br>
                                    = ‚Ç¶390,000 ‚úì
                                </p>
                            `;
                            feedback.classList.remove('hidden');
                            createConfetti();
                            screenStates[currentScreen] = { completed: true };
                            document.getElementById('nextBtn').disabled = false;
                        } else {
                            feedback.className = 'mt-4 p-4 bg-red-50 dark:bg-red-900/20 rounded-lg border-l-4 border-red-500 animate-shake';
                            let hint = '';
                            if (answer === 335000) {
                                hint = '<p class="text-xs mt-2">üí° Did you forget to add the bad debts to the credit side?</p>';
                            } else if (answer === 15000) {
                                hint = '<p class="text-xs mt-2">üí° That\'s just the increase in debtors, not the total sales!</p>';
                            }
                            feedback.innerHTML = `
                                <p class="text-sm font-semibold mb-1">‚ùå Not quite</p>
                                <p class="text-xs">Expected: ‚Ç¶340,000 | You entered: ‚Ç¶${answer.toLocaleString()}</p>
                                ${hint}
                                <p class="text-xs mt-2">Try the T-account approach and balance both sides!</p>
                            `;
                            feedback.classList.remove('hidden');
                        }
                    });

                    if (screenStates[currentScreen]?.completed) {
                        document.getElementById('nextBtn').disabled = false;
                    } else {
                        document.getElementById('nextBtn').disabled = true;
                    }
                }
            },

            // SCREEN 13: Comprehensive Example
            {
                id: 'comprehensive',
                title: 'üéì Putting It All Together',
                content: `
                    <div class="space-y-6">
                        <div class="bg-gradient-to-r from-primary/20 to-purple-500/20 rounded-2xl p-6 border-2 border-primary/30">
                            <h3 class="text-xl font-bold mb-3 flex items-center gap-2">
                                <span>üéØ</span> Final Challenge
                            </h3>
                            <p class="text-base leading-relaxed">
                                Let's apply ALL the concepts together in one comprehensive problem!
                            </p>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                            <h4 class="font-semibold mb-4">üìã Scenario:</h4>
                            <p class="text-sm mb-4">
                                Mr. Tunde runs a retail business. He provides you with the following information for the year ended Dec 31, 2023:
                            </p>

                            <div class="space-y-3 mb-5">
                                <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-3">
                                    <p class="text-xs font-semibold mb-2 border-b border-gray-300 dark:border-gray-600 pb-1">Balance Sheet Items:</p>
                                    <div class="grid grid-cols-2 gap-2 text-xs">
                                        <div>
                                            <p class="text-gray-600 dark:text-gray-400">Opening Capital:</p>
                                            <p class="font-mono font-bold">‚Ç¶120,000</p>
                                        </div>
                                        <div>
                                            <p class="text-gray-600 dark:text-gray-400">Closing Assets:</p>
                                            <p class="font-mono font-bold">‚Ç¶180,000</p>
                                        </div>
                                        <div>
                                            <p class="text-gray-600 dark:text-gray-400">Closing Liabilities:</p>
                                            <p class="font-mono font-bold">‚Ç¶25,000</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3 border-l-4 border-blue-500">
                                    <p class="text-xs font-semibold mb-2">Additional Information:</p>
                                    <ul class="text-xs space-y-1">
                                        <li>‚Ä¢ Drawings during the year: <strong>‚Ç¶18,000</strong></li>
                                        <li>‚Ä¢ Additional capital introduced: <strong>‚Ç¶20,000</strong></li>
                                    </ul>
                                </div>
                            </div>

                            <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4 mb-4">
                                <p class="text-sm font-semibold mb-2">‚ùì Calculate the Net Profit for 2023:</p>
                            </div>

                            <div class="space-y-3">
                                <label class="block">
                                    <span class="text-sm font-medium mb-2 block">üí≠ Show Your Full Working:</span>
                                    <textarea id="working5" rows="5" class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-700 rounded-lg border-2 border-gray-300 dark:border-gray-600 text-base" placeholder="Calculate closing capital, then apply the profit formula..."></textarea>
                                </label>

                                <label class="block">
                                    <span class="text-sm font-medium mb-2 block">‚úçÔ∏è Net Profit:</span>
                                    <div class="flex gap-2">
                                        <span class="text-2xl">‚Ç¶</span>
                                        <input type="number" id="answer5" class="flex-1 px-4 py-3 bg-gray-50 dark:bg-gray-700 rounded-lg border-2 border-gray-300 dark:border-gray-600 text-base font-mono" placeholder="Enter amount...">
                                    </div>
                                </label>

                                <button id="checkAnswer5" class="w-full px-6 py-4 bg-gradient-to-r from-primary to-purple-500 text-white rounded-lg font-semibold hover:shadow-lg transition-all text-base">
                                    Check Answer ‚úì
                                </button>

                                <div id="feedback5" class="hidden"></div>
                            </div>
                        </div>

                        <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4">
                            <p class="text-xs">
                                üí° <strong>Steps:</strong><br>
                                1. Calculate closing capital (Assets - Liabilities)<br>
                                2. Apply formula: CC - OC - AC + D = Profit
                            </p>
                        </div>
                    </div>
                `,
                validate: () => {
                    const answer = parseFloat(document.getElementById('answer5').value);
                    return !isNaN(answer) && answer === 33000;
                },
                onMount: () => {
                    document.getElementById('checkAnswer5').addEventListener('click', () => {
                        const answer = parseFloat(document.getElementById('answer5').value);
                        const feedback = document.getElementById('feedback5');

                        if (isNaN(answer)) {
                            feedback.className = 'mt-4 p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border-l-4 border-yellow-500 animate-shake';
                            feedback.innerHTML = `<p class="text-sm font-semibold">‚ö†Ô∏è Please enter a number</p>`;
                            feedback.classList.remove('hidden');
                            return;
                        }

                        if (answer === 33000) {
                            feedback.className = 'mt-4 p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border-l-4 border-green-500 animate-celebrate';
                            feedback.innerHTML = `
                                <p class="text-sm font-semibold mb-2 flex items-center gap-2">
                                    <span class="text-2xl">üéâ</span> Outstanding! You've mastered the concept!
                                </p>
                                <p class="text-xs mb-3">
                                    <strong>Full Working:</strong><br>
                                    Closing Capital = Assets - Liabilities<br>
                                    = ‚Ç¶180,000 - ‚Ç¶25,000 = <strong>‚Ç¶155,000</strong><br><br>

                                    Closing Capital: ‚Ç¶155,000<br>
                                    Less: Opening Capital: (‚Ç¶120,000)<br>
                                    Less: Additional Capital: (‚Ç¶20,000)<br>
                                    = ‚Ç¶15,000<br>
                                    Add: Drawings: ‚Ç¶18,000<br>
                                    <strong class="text-green-600 dark:text-green-400">Net Profit = ‚Ç¶33,000 ‚úì</strong>
                                </p>
                            `;
                            feedback.classList.remove('hidden');
                            createConfetti();
                            screenStates[currentScreen] = { completed: true };
                            document.getElementById('nextBtn').disabled = false;
                        } else {
                            feedback.className = 'mt-4 p-4 bg-red-50 dark:bg-red-900/20 rounded-lg border-l-4 border-red-500 animate-shake';
                            let hint = '';
                            if (answer === 155000) {
                                hint = '<p class="text-xs mt-2">üí° That\'s the closing capital! Now apply the profit formula.</p>';
                            } else if (answer === 35000) {
                                hint = '<p class="text-xs mt-2">üí° Close! Check if you\'ve correctly accounted for additional capital.</p>';
                            } else if (answer === 15000) {
                                hint = '<p class="text-xs mt-2">üí° You forgot to add back the drawings!</p>';
                            }
                            feedback.innerHTML = `
                                <p class="text-sm font-semibold mb-1">‚ùå Not quite right</p>
                                <p class="text-xs">Expected: ‚Ç¶33,000 | You entered: ‚Ç¶${answer.toLocaleString()}</p>
                                ${hint}
                                <p class="text-xs mt-2">Review your calculations step by step!</p>
                            `;
                            feedback.classList.remove('hidden');
                        }
                    });

                    if (screenStates[currentScreen]?.completed) {
                        document.getElementById('nextBtn').disabled = false;
                    } else {
                        document.getElementById('nextBtn').disabled = true;
                    }
                }
            },

            // SCREEN 14: Summary & Key Takeaways
            {
                id: 'summary',
                title: 'üìö Key Takeaways & Summary',
                content: `
                    <div class="space-y-6">
                        <div class="text-center mb-6">
                            <div class="text-6xl mb-4 animate-bounce-subtle">üéì</div>
                            <h2 class="text-2xl font-bold mb-2 text-primary">Congratulations!</h2>
                            <p class="text-gray-600 dark:text-gray-400">You've completed the Incomplete Records module</p>
                        </div>

                        <div class="bg-gradient-to-br from-primary/10 to-purple-500/10 rounded-2xl p-6 border-2 border-primary/30">
                            <h3 class="font-bold text-lg mb-4 text-center">üéØ What You've Mastered</h3>

                            <div class="space-y-3">
                                <div class="bg-white dark:bg-gray-800 rounded-lg p-4">
                                    <p class="font-semibold mb-2 flex items-center gap-2">
                                        <span class="text-2xl">‚úÖ</span> Incomplete Records
                                    </p>
                                    <ul class="text-sm space-y-1 ml-9 list-disc">
                                        <li>Calculate profit from capital changes</li>
                                        <li>Apply the formula: CC - OC - AC + D = Profit</li>
                                        <li>Prepare statement of affairs</li>
                                    </ul>
                                </div>

                                <div class="bg-white dark:bg-gray-800 rounded-lg p-4">
                                    <p class="font-semibold mb-2 flex items-center gap-2">
                                        <span class="text-2xl">‚úÖ</span> Single Entry Conversion
                                    </p>
                                    <ul class="text-sm space-y-1 ml-9 list-disc">
                                        <li>Use control accounts to find missing figures</li>
                                        <li>Calculate sales from debtors account</li>
                                        <li>Calculate purchases from creditors account</li>
                                        <li>Prepare full financial statements</li>
                                    </ul>
                                </div>

                                <div class="bg-white dark:bg-gray-800 rounded-lg p-4">
                                    <p class="font-semibold mb-2 flex items-center gap-2">
                                        <span class="text-2xl">‚úÖ</span> Margin & Mark-up
                                    </p>
                                    <ul class="text-sm space-y-1 ml-9 list-disc">
                                        <li>Distinguish between margin (on sales) and mark-up (on cost)</li>
                                        <li>Convert between the two percentages</li>
                                        <li>Apply them to find missing sales/cost figures</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-xl p-5 border-l-4 border-yellow-500">
                            <p class="text-sm font-semibold mb-3 flex items-center gap-2">
                                <span>üß†</span> Key Formulas to Remember:
                            </p>
                            <div class="space-y-2 text-xs font-mono bg-white dark:bg-gray-800 rounded p-3">
                                <p><strong>1. Profit Formula:</strong></p>
                                <p class="ml-4">Profit = CC - OC - AC + D</p>
                                <p class="mt-3"><strong>2. Margin:</strong></p>
                                <p class="ml-4">Margin = Profit / Sales √ó 100%</p>
                                <p class="mt-3"><strong>3. Mark-up:</strong></p>
                                <p class="ml-4">Mark-up = Profit / Cost √ó 100%</p>
                                <p class="mt-3"><strong>4. Debtors Control:</strong></p>
                                <p class="ml-4">Opening + Sales = Cash + Bad Debts + Closing</p>
                            </div>
                        </div>

                        <div class="bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-xl p-6 border-2 border-green-500/30">
                            <h4 class="font-semibold mb-3 text-center flex items-center justify-center gap-2">
                                <span>üéØ</span> Exam Tips
                            </h4>
                            <ul class="text-sm space-y-2">
                                <li class="flex items-start gap-2">
                                    <span>üí°</span>
                                    <span><strong>Always</strong> identify whether it's incomplete records or single entry first</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span>üí°</span>
                                    <span>For incomplete records, calculate opening and closing capital carefully</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span>üí°</span>
                                    <span>In single entry, use T-accounts to find balancing figures systematically</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span>üí°</span>
                                    <span>Never apply margin to cost or mark-up to sales‚Äîcheck the base!</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span>üí°</span>
                                    <span>Show your working clearly‚Äîpartial marks are awarded</span>
                                </li>
                            </ul>
                        </div>

                        <div class="bg-blue-50 dark:bg-blue-900/20 rounded-xl p-5 text-center">
                            <p class="text-sm font-semibold mb-2">üöÄ Next Steps:</p>
                            <p class="text-sm text-gray-700 dark:text-gray-300">
                                Practice with past exam questions and work through the textbook examples.
                                Repetition is key to mastery!
                            </p>
                        </div>
                    </div>
                `,
                validate: () => true
            },

            // SCREEN 15: Final Celebration
            {
                id: 'completion',
                title: 'üéâ Module Complete!',
                content: `
                    <div class="space-y-6">
                        <div class="text-center mb-8">
                            <div class="text-8xl mb-4 animate-bounce-subtle">üèÜ</div>
                            <h2 class="text-3xl font-bold mb-3 bg-gradient-to-r from-primary to-purple-500 bg-clip-text text-transparent">
                                You Did It!
                            </h2>
                            <p class="text-xl text-gray-600 dark:text-gray-400">
                                Incomplete Records & Single Entry Mastered
                            </p>
                        </div>

                        <div class="bg-gradient-to-br from-primary/20 to-purple-500/20 rounded-2xl p-8 border-2 border-primary/30 text-center">
                            <p class="text-lg font-semibold mb-4">üéì Learning Achievement Unlocked</p>
                            <div class="grid grid-cols-3 gap-4 mb-6">
                                <div class="bg-white dark:bg-gray-800 rounded-lg p-4">
                                    <div class="text-3xl mb-2">‚úÖ</div>
                                    <p class="text-2xl font-bold text-primary">15</p>
                                    <p class="text-xs text-gray-600 dark:text-gray-400">Screens Completed</p>
                                </div>
                                <div class="bg-white dark:bg-gray-800 rounded-lg p-4">
                                    <div class="text-3xl mb-2">üéØ</div>
                                    <p class="text-2xl font-bold text-green-600">6</p>
                                    <p class="text-xs text-gray-600 dark:text-gray-400">Concepts Mastered</p>
                                </div>
                                <div class="bg-white dark:bg-gray-800 rounded-lg p-4">
                                    <div class="text-3xl mb-2">üí™</div>
                                    <p class="text-2xl font-bold text-purple-600">6</p>
                                    <p class="text-xs text-gray-600 dark:text-gray-400">Practice Questions</p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg">
                            <h3 class="font-bold mb-4 text-center">üß† Your Learning Journey</h3>
                            <div class="space-y-3 text-sm">
                                <div class="flex items-center gap-3 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                    <span class="text-2xl">‚úì</span>
                                    <span>Understood the difference between incomplete records and single entry</span>
                                </div>
                                <div class="flex items-center gap-3 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                    <span class="text-2xl">‚úì</span>
                                    <span>Mastered the capital change formula for profit calculation</span>
                                </div>
                                <div class="flex items-center gap-3 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                    <span class="text-2xl">‚úì</span>
                                    <span>Learned to use control accounts to find missing figures</span>
                                </div>
                                <div class="flex items-center gap-3 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                    <span class="text-2xl">‚úì</span>
                                    <span>Applied margin and mark-up calculations effectively</span>
                                </div>
                                <div class="flex items-center gap-3 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                    <span class="text-2xl">‚úì</span>
                                    <span>Practiced with real exam-style problems</span>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gradient-to-r from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 rounded-xl p-6 border-l-4 border-yellow-500">
                            <h3 class="font-bold mb-3 flex items-center gap-2">
                                <span>üí°</span> Keep Growing
                            </h3>
                            <p class="text-sm mb-4">
                                You've built a solid foundation! Here's how to continue your learning:
                            </p>
                            <ul class="text-sm space-y-2">
                                <li class="flex items-start gap-2">
                                    <span>üìñ</span>
                                    <span>Review the textbook examples (Illustrations 13.1, 13.4, 13.5)</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span>‚úçÔ∏è</span>
                                    <span>Practice with past WAEC/JAMB/NECO exam questions</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span>üîÑ</span>
                                    <span>Revisit this module anytime you need a refresher</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span>ü§ù</span>
                                    <span>Teach someone else‚Äîteaching solidifies learning!</span>
                                </li>
                            </ul>
                        </div>

                        <div class="bg-primary text-white rounded-2xl p-8 text-center">
                            <p class="text-2xl font-bold mb-3">üåü You're Ready!</p>
                            <p class="text-base opacity-90">
                                You now have the skills to tackle any incomplete records or single entry question in your exam.
                                Keep practicing, stay confident, and success will follow!
                            </p>
                            <p class="text-sm opacity-75 mt-4">
                                Remember: Small steps lead to big achievements. You've just proven that! üöÄ
                            </p>
                        </div>

                        <div class="text-center pt-4">
                            <button onclick="window.location.reload()" class="px-8 py-4 bg-gradient-to-r from-primary to-purple-500 text-white rounded-xl font-bold hover:shadow-xl transition-all text-base">
                                üîÑ Restart Course
                            </button>
                        </div>
                    </div>
                `,
                validate: () => true
            }
        ];

        // ==================== NAVIGATION FUNCTIONS ====================
        function renderScreen(index) {
            const screen = screens[index];
            const mainContent = document.getElementById('mainContent');

            // Fade out
            mainContent.style.opacity = '0';

            setTimeout(() => {
                // Update content
                mainContent.innerHTML = `
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold mb-2">${screen.title}</h2>
                        <div class="h-1 w-20 bg-gradient-to-r from-primary to-purple-500 rounded-full"></div>
                    </div>
                    ${screen.content}
                `;

                // Fade in
                mainContent.style.opacity = '1';

                // Call onMount if exists
                if (screen.onMount) {
                    screen.onMount();
                }

                // Update progress
                updateProgress();

                // Update navigation buttons
                updateNavButtons();

                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }, 150);
        }

        function updateProgress() {
            const progress = ((currentScreen + 1) / totalScreens) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressText').textContent = `Step ${currentScreen + 1} of ${totalScreens}`;
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
        }

        function updateNavButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');

            // Previous button
            prevBtn.disabled = currentScreen === 0;

            // Next button
            const screen = screens[currentScreen];
            if (screen.validate) {
                // For practice questions, disable next until validated
                if (['practice1', 'practice2', 'margin-practice', 'control-practice', 'comprehensive'].includes(screen.id)) {
                    nextBtn.disabled = !screenStates[currentScreen]?.completed;
                } else {
                    nextBtn.disabled = false;
                }
            } else {
                nextBtn.disabled = false;
            }

            // Change next button text on last screen
            if (currentScreen === totalScreens - 1) {
                nextBtn.textContent = 'üéâ Finish';
            } else {
                nextBtn.textContent = 'Next ‚Üí';
            }
        }

        // ==================== EVENT LISTENERS ====================
        document.getElementById('prevBtn').addEventListener('click', () => {
            if (currentScreen > 0) {
                currentScreen--;
                renderScreen(currentScreen);
            }
        });

        document.getElementById('nextBtn').addEventListener('click', () => {
            const screen = screens[currentScreen];

            if (currentScreen < totalScreens - 1) {
                currentScreen++;
                renderScreen(currentScreen);
            } else {
                // Final screen - show celebration
                createConfetti();
                showCustomAlert('üéâ Congratulations! You\'ve completed the entire module. You\'re now ready to ace your exams!', 'success');
            }
        });

        // ==================== INITIALIZE APP ====================
        document.addEventListener('DOMContentLoaded', () => {
            renderScreen(0);
        });
    </script>
</body>
</html>

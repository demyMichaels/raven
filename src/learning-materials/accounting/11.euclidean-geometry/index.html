<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geometry Explorer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        secondary: '#6366F1',
                        accent: '#EC4899',
                        success: '#10B981',
                        warning: '#F59E0B',
                        danger: '#EF4444',
                        info: '#3B82F6',
                    },
                    animation: {
                        'spin-slow': 'spin 10s linear infinite',
                        'bounce-slow': 'bounce 2s ease-in-out infinite',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                },
            },
        };
    </script>
    <style>
        /* Interactive elements */
        .draggable {
            cursor: grab;
            transition: r 0.2s, fill 0.2s;
        }
        .draggable:hover {
            r: 10;
            fill-opacity: 0.9;
        }
        .draggable:active {
            cursor: grabbing;
        }
        
        /* SVG line styles */
        .line-straight {
            stroke-width: 2;
        }
        .line-parallel {
            stroke-width: 2;
        }
        .line-perpendicular {
            stroke-width: 2;
        }
        .line-transversal {
            stroke-width: 2;
            stroke-dasharray: 5, 5;
        }
        .angle-arc {
            fill: none;
            stroke-width: 2;
        }
        
        /* Angle display */
        .angle-text {
            font-size: 12px;
            text-anchor: middle;
        }
        
        /* Control panel */
        .control-panel {
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        /* Dark mode slider */
        .dark-mode-slider {
            -webkit-appearance: none;
            appearance: none;
            height: 20px;
            width: 40px;
            border-radius: 10px;
            background: #CBD5E1;
            outline: none;
            position: relative;
        }
        
        .dark-mode-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #FFF;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .dark .dark-mode-slider {
            background: #475569;
        }
        
        .dark .dark-mode-slider::-webkit-slider-thumb {
            background: #5D5CDE;
        }
        
        /* Progress bar */
        .progress-ring-circle {
            transform-origin: center;
            transform: rotate(-90deg);
            transition: stroke-dashoffset 0.3s;
        }
        
        /* Tooltip styles */
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 10;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        
        /* Audio control */
        .audio-toggle {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
        }
        
        .audio-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .audio-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #CBD5E1;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 10px;
        }
        
        .audio-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .audio-slider {
            background-color: #5D5CDE;
        }
        
        input:focus + .audio-slider {
            box-shadow: 0 0 1px #5D5CDE;
        }
        
        input:checked + .audio-slider:before {
            -webkit-transform: translateX(20px);
            -ms-transform: translateX(20px);
            transform: translateX(20px);
        }
        
        /* Special constructions steps */
        .construction-step {
            transition: opacity 0.5s ease-in-out;
        }
        
        .construction-step.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        /* Canvas mode toggle */
        .toggle-tab {
            transition: all 0.3s ease;
        }

        /* Custom range slider */
        .custom-range {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #e2e8f0;
            outline: none;
        }
        
        .dark .custom-range {
            background: #475569;
        }
        
        .custom-range::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #5D5CDE;
            cursor: pointer;
        }
        
        .custom-range::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #5D5CDE;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen transition-colors duration-300">
    <!-- Audio Elements for Sound Effects -->
    <audio id="click-sound" preload="auto">
        <source src="data:audio/mp3;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFzb25pYVN0dWRpbwBURU5DAAAAHQAAA0xhdmY1OC4yOS4xMDAgKGxpYnZvcmJpcykAVERSTAAAADoAAAPVGVzdCBEUk0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABUUEUxAAAADQAAAzIwMjMtMDUtMDgAVElUMgAAAAoAAANDbGljayAAVFNTRQAAAA8AAANMYXZmNTguNDUuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV" 
             type="audio/mp3">
    </audio>
    <audio id="success-sound" preload="auto">
        <source src="data:audio/mp3;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFzb25pYVN0dWRpbwBURU5DAAAAHQAAA0xhdmY1OC4yOS4xMDAgKGxpYnZvcmJpcykAVERSTAAAADQAAAPVGVzdCBEUk0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVFBFMQAAAAoAAAMyMDIzAFRJVDIAAAASAAADU3VjY2VzcyBTb3VuZCAAVFNTRQAAAA8AAANMYXZmNTguNDUuMTAwAAAAAAAAAAAAAAD/80DEAAAACkgAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV" 
             type="audio/mp3">
    </audio>
    <audio id="error-sound" preload="auto">
        <source src="data:audio/mp3;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFzb25pYVN0dWRpbwBURU5DAAAAHQAAA0xhdmY1OC4yOS4xMDAgKGxpYnZvcmJpcykAVERSTAAAADQAAAPVGVzdCBEUk0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVFBFMQAAAAoAAAMyMDIzAFRJVDIAAAAQAAADRXJyb3IgU291bmQgIABUU1NFAAAADwAAA0xhdmY1OC40NS4xMDAAAAAAAAAAAAAAAA/zQMQAAABwSAAAAAAAJAeQAAAB/////////j8eTEFNRTMuMTAwAAAAAAAAAAJ////////zT//LUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUU/zkMQoAAAAUhAAAAAUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUU/8ADEMoAAADSAAAAABUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUU=" 
             type="audio/mp3">
    </audio>
    <audio id="angle-sound-30" preload="auto">
        <source src="data:audio/mp3;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFzb25pYVN0dWRpbwBURU5DAAAAHQAAA0xhdmY1OC4yOS4xMDAgKGxpYnZvcmJpcykAVERSTAAAADQAAAPVGVzdCBEUk0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVFBFMQAAAAoAAAMyMDIzAFRJVDIAAAAQAAADQW5nbGUgMzAgZGVnAABUU1NFAAAADwAAA0xhdmY1OC40NS4xMDAAAAAAAAAAAAAAAP9MxAAAABpIAAAAAAEjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/zAMQygAAA0gAAAAAVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV" 
             type="audio/mp3">
    </audio>
    <audio id="angle-sound-45" preload="auto">
        <source src="data:audio/mp3;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFzb25pYVN0dWRpbwBURU5DAAAAHQAAA0xhdmY1OC4yOS4xMDAgKGxpYnZvcmJpcykAVERSTAAAADIAAAPVGVzdCBEUk0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVFBFMQAAAAoAAAMyMDIzAFRJVDIAAAAOAAADQW5nbGUgNDUgAABUU1NFAAAADwAAA0xhdmY1OC40NS4xMDAAAAAAAAAAAAAAAP9MxAAAABpIAAAAAAEjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/zAMQygAAA0gAAAAAVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV" 
             type="audio/mp3">
    </audio>
    <audio id="angle-sound-60" preload="auto">
        <source src="data:audio/mp3;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFzb25pYVN0dWRpbwBURU5DAAAAHQAAA0xhdmY1OC4yOS4xMDAgKGxpYnZvcmJpcykAVERSTAAAADIAAAPVGVzdCBEUk0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVFBFMQAAAAoAAAMyMDIzAFRJVDIAAAAOAAADQW5nbGUgNjAgAABUU1NFAAAADwAAA0xhdmY1OC40NS4xMDAAAAAAAAAAAAAAAP9MxAAAABpIAAAAAAEjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/zAMQygAAA0gAAAAAVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV" 
             type="audio/mp3">
    </audio>
    <audio id="angle-sound-90" preload="auto">
        <source src="data:audio/mp3;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFzb25pYVN0dWRpbwBURU5DAAAAHQAAA0xhdmY1OC4yOS4xMDAgKGxpYnZvcmJpcykAVERSTAAAADIAAAPVGVzdCBEUk0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVFBFMQAAAAoAAAMyMDIzAFRJVDIAAAAOAAADQW5nbGUgOTAgAABUU1NFAAAADwAAA0xhdmY1OC40NS4xMDAAAAAAAAAAAAAAAP9MxAAAABpIAAAAAAEjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/zAMQygAAA0gAAAAAVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV" 
             type="audio/mp3">
    </audio>
    <audio id="drag-sound" preload="auto">
        <source src="data:audio/mp3;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFzb25pYVN0dWRpbwBURU5DAAAAHQAAA0xhdmY1OC4yOS4xMDAgKGxpYnZvcmJpcykAVERSTAAAADIAAAPVGVzdCBEUk0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVFBFMQAAAAoAAAMyMDIzAFRJVDIAAAAOAAADRHJhZyBTb3VuZAAATFNTRQAAAA8AAANMYXZmNTguNDUuMTAwAAAAAAAAAAAAAAD/80DEAAAACkgAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV" 
             type="audio/mp3">
    </audio>
    <audio id="complete-sound" preload="auto">
        <source src="data:audio/mp3;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFzb25pYVN0dWRpbwBURU5DAAAAHQAAA0xhdmY1OC4yOS4xMDAgKGxpYnZvcmJpcykAVERSTAAAADYAAAPVGVzdCBEUk0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVFBFMQAAAAoAAAMyMDIzAFRJVDIAAAAUAAADQ29tcGxldGUgU291bmQgAABUU1NFAAAADwAAA0xhdmY1OC40NS4xMDAAAAAAAAAAAAAAAP8zQsQAAAAaSAAAAAAAAVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV/8zDEMoAAANIAAAAAFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV" 
             type="audio/mp3">
    </audio>

    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="mb-8">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center mb-4 md:mb-0">
                    <svg class="w-10 h-10 text-primary mr-3" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="20" cy="20" r="18" stroke="currentColor" stroke-width="2" fill="none"/>
                        <line x1="20" y1="2" x2="20" y2="38" stroke="currentColor" stroke-width="2"/>
                        <line x1="2" y1="20" x2="38" y2="20" stroke="currentColor" stroke-width="2"/>
                        <path d="M20 20 L35 35" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <h1 class="text-3xl font-bold text-primary">Geometry Explorer</h1>
                </div>
                
                <div class="flex items-center space-x-6">
                    <!-- Audio toggle -->
                    <div class="flex items-center">
                        <label class="audio-toggle mr-2">
                            <input type="checkbox" id="audio-toggle" checked>
                            <span class="audio-slider"></span>
                        </label>
                        <span class="text-sm">Sound</span>
                    </div>
                    
                    <!-- Theme toggle -->
                    <div class="flex items-center">
                        <svg class="w-5 h-5 text-gray-500 dark:text-gray-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                        </svg>
                        <input type="range" min="0" max="1" value="0" class="dark-mode-slider" id="dark-mode-toggle">
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Navigation -->
        <nav class="mb-8">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-2 flex flex-wrap justify-center">
                <button id="tab-lines-angles" class="px-4 py-2 m-1 rounded-md bg-primary text-white tab-button">Lines & Angles</button>
                <button id="tab-polygons" class="px-4 py-2 m-1 rounded-md bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 tab-button">Polygons</button>
                <button id="tab-circle-theorems" class="px-4 py-2 m-1 rounded-md bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 tab-button">Circle Theorems</button>
                <button id="tab-special-angles" class="px-4 py-2 m-1 rounded-md bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 tab-button">Special Angle Constructions</button>
            </div>
        </nav>

        <!-- Content Sections -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden">
            <!-- Lines & Angles Section -->
            <section id="section-lines-angles" class="tab-content active">
                <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                    <h2 class="text-2xl font-bold text-primary">Lines & Angles Explorer</h2>
                    <p class="mt-2 text-gray-600 dark:text-gray-400">Identify different types of lines and angles by dragging the points below.</p>
                </div>
                
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- Left column - Interactive SVG -->
                        <div class="col-span-2 bg-gray-100 dark:bg-gray-900 rounded-lg p-4">
                            <div class="flex justify-center items-center mb-4">
                                <div class="relative">
                                    <svg id="lines-angles-svg" width="100%" height="400" viewBox="0 0 600 400" class="mx-auto">
                                        <!-- Elements will be dynamically drawn here -->
                                        <!-- Coordinate system -->
                                        <line x1="50" y1="200" x2="550" y2="200" stroke="#CBD5E1" stroke-width="1" stroke-dasharray="5,5"/>
                                        <line x1="300" y1="50" x2="300" y2="350" stroke="#CBD5E1" stroke-width="1" stroke-dasharray="5,5"/>
                                        
                                        <!-- Lines group -->
                                        <g id="lines-group">
                                            <!-- Base line -->
                                            <line id="base-line" x1="100" y1="200" x2="500" y2="200" stroke="#5D5CDE" stroke-width="2" class="line-straight"/>
                                            
                                            <!-- Movable line -->
                                            <line id="movable-line" x1="300" y1="100" x2="400" y2="300" stroke="#EC4899" stroke-width="2" class="line-straight"/>
                                            
                                            <!-- Reference points for angle measurement -->
                                            <circle id="angle-center" cx="300" cy="200" r="3" fill="#FFF" stroke="#333"/>
                                            
                                            <!-- Angle arc and label -->
                                            <path id="angle-arc" d="M 320,200 A 20,20 0 0,0 300,180" stroke="#10B981" fill="none" class="angle-arc"/>
                                            <text id="angle-text" x="330" y="180" class="angle-text" fill="currentColor">90°</text>
                                        </g>
                                        
                                        <!-- Interactive points -->
                                        <circle id="drag-point-1" cx="300" cy="100" r="8" fill="#EC4899" class="draggable" cursor="move"/>
                                        <circle id="drag-point-2" cx="400" cy="300" r="8" fill="#EC4899" class="draggable" cursor="move"/>
                                    </svg>
                                    
                                    <div id="angle-display" class="absolute top-4 right-4 bg-white dark:bg-gray-800 p-2 rounded-md shadow-md">
                                        <span class="font-bold text-primary">Angle: </span><span id="angle-value">90°</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex flex-wrap justify-center gap-2 mt-4">
                                <button id="btn-line-parallel" class="px-3 py-1 bg-primary text-white rounded-md hover:bg-opacity-90">Make Parallel</button>
                                <button id="btn-line-perpendicular" class="px-3 py-1 bg-primary text-white rounded-md hover:bg-opacity-90">Make Perpendicular</button>
                                <button id="btn-transversal" class="px-3 py-1 bg-primary text-white rounded-md hover:bg-opacity-90">Show Transversal</button>
                                <button id="btn-reset-lines" class="px-3 py-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white rounded-md hover:bg-gray-300 dark:hover:bg-gray-600">Reset</button>
                            </div>
                        </div>
                        
                        <!-- Right column - Information panel -->
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                            <h3 class="text-lg font-bold mb-3">Line & Angle Types</h3>
                            
                            <div id="line-info" class="mb-4">
                                <h4 class="font-medium text-primary">Current Line Relationship:</h4>
                                <p id="line-relationship" class="mt-1">Intersecting lines</p>
                                
                                <div class="mt-3">
                                    <div class="bg-white dark:bg-gray-700 p-3 rounded-md mb-2">
                                        <h5 class="font-medium text-sm">Parallel Lines</h5>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Lines that never intersect and maintain the same distance.</p>
                                    </div>
                                    
                                    <div class="bg-white dark:bg-gray-700 p-3 rounded-md mb-2">
                                        <h5 class="font-medium text-sm">Perpendicular Lines</h5>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Lines that intersect at a 90° angle.</p>
                                    </div>
                                    
                                    <div class="bg-white dark:bg-gray-700 p-3 rounded-md">
                                        <h5 class="font-medium text-sm">Transversal</h5>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">A line that intersects two or more lines.</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="angle-info">
                                <h4 class="font-medium text-primary">Current Angle Type:</h4>
                                <p id="angle-type" class="mt-1">Right angle (90°)</p>
                                
                                <div class="mt-3">
                                    <div class="bg-white dark:bg-gray-700 p-3 rounded-md mb-2">
                                        <h5 class="font-medium text-sm">Acute Angle</h5>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Less than 90° (e.g., 45°)</p>
                                    </div>
                                    
                                    <div class="bg-white dark:bg-gray-700 p-3 rounded-md mb-2">
                                        <h5 class="font-medium text-sm">Right Angle</h5>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Exactly 90°</p>
                                    </div>
                                    
                                    <div class="bg-white dark:bg-gray-700 p-3 rounded-md mb-2">
                                        <h5 class="font-medium text-sm">Obtuse Angle</h5>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Between 90° and 180° (e.g., 120°)</p>
                                    </div>
                                    
                                    <div class="bg-white dark:bg-gray-700 p-3 rounded-md">
                                        <h5 class="font-medium text-sm">Straight Angle</h5>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Exactly 180°</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Challenge section -->
                    <div class="mt-8 bg-gray-100 dark:bg-gray-900 p-4 rounded-lg">
                        <h3 class="text-xl font-bold mb-4">Angle Challenge</h3>
                        <p class="mb-4">Create the angle specified below by dragging the points:</p>
                        
                        <div id="angle-challenge" class="flex flex-col items-center">
                            <div id="challenge-instruction" class="mb-4 p-2 bg-primary bg-opacity-20 rounded-md text-primary dark:text-primary font-bold">
                                Create a 45° angle
                            </div>
                            
                            <div id="challenge-feedback" class="mb-4 p-3 hidden">
                                <!-- Feedback will appear here -->
                            </div>
                            
                            <button id="btn-check-angle" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-opacity-90">Check Angle</button>
                            <button id="btn-next-angle" class="px-4 py-2 bg-success text-white rounded-md hover:bg-opacity-90 mt-2 hidden">Next Challenge</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Polygons Section -->
            <section id="section-polygons" class="tab-content hidden">
                <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                    <h2 class="text-2xl font-bold text-primary">Polygon Playground</h2>
                    <p class="mt-2 text-gray-600 dark:text-gray-400">Explore different polygons and learn about their properties.</p>
                </div>
                
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- Left column - Interactive SVG -->
                        <div class="col-span-2 bg-gray-100 dark:bg-gray-900 rounded-lg p-4">
                            <div class="flex justify-center items-center mb-4">
                                <svg id="polygon-svg" width="100%" height="400" viewBox="0 0 600 400" class="mx-auto">
                                    <!-- Polygon will be drawn here -->
                                    <g id="polygon-group">
                                        <!-- Initial polygon (regular hexagon) -->
                                        <polygon id="poly-shape" points="300,50 450,125 450,275 300,350 150,275 150,125" 
                                                fill="rgba(93, 92, 222, 0.2)" stroke="#5D5CDE" stroke-width="2"/>
                                        
                                        <!-- Vertices -->
                                        <circle cx="300" cy="50" r="8" fill="#5D5CDE" class="draggable vertex" data-index="0"/>
                                        <circle cx="450" cy="125" r="8" fill="#5D5CDE" class="draggable vertex" data-index="1"/>
                                        <circle cx="450" cy="275" r="8" fill="#5D5CDE" class="draggable vertex" data-index="2"/>
                                        <circle cx="300" cy="350" r="8" fill="#5D5CDE" class="draggable vertex" data-index="3"/>
                                        <circle cx="150" cy="275" r="8" fill="#5D5CDE" class="draggable vertex" data-index="4"/>
                                        <circle cx="150" cy="125" r="8" fill="#5D5CDE" class="draggable vertex" data-index="5"/>
                                        
                                        <!-- Angle markers will be added dynamically -->
                                    </g>
                                </svg>
                            </div>
                            
                            <div class="flex flex-col sm:flex-row justify-center items-center gap-4 mt-4">
                                <div class="flex flex-wrap justify-center gap-2">
                                    <button id="btn-triangle" class="px-3 py-1 bg-primary text-white rounded-md hover:bg-opacity-90">Triangle</button>
                                    <button id="btn-quadrilateral" class="px-3 py-1 bg-primary text-white rounded-md hover:bg-opacity-90">Quadrilateral</button>
                                    <button id="btn-pentagon" class="px-3 py-1 bg-primary text-white rounded-md hover:bg-opacity-90">Pentagon</button>
                                    <button id="btn-hexagon" class="px-3 py-1 bg-primary text-white rounded-md hover:bg-opacity-90">Hexagon</button>
                                </div>
                                
                                <div class="flex flex-wrap justify-center gap-2">
                                    <button id="btn-regular" class="px-3 py-1 bg-secondary text-white rounded-md hover:bg-opacity-90">Make Regular</button>
                                    <button id="btn-show-angles" class="px-3 py-1 bg-secondary text-white rounded-md hover:bg-opacity-90">Show Angles</button>
                                </div>
                            </div>
                            
                            <div class="mt-4 bg-white dark:bg-gray-800 p-3 rounded-md shadow-sm">
                                <div class="flex flex-wrap justify-between">
                                    <div>
                                        <span class="font-medium">Sides: </span>
                                        <span id="poly-sides">6</span>
                                    </div>
                                    <div>
                                        <span class="font-medium">Interior Angle Sum: </span>
                                        <span id="poly-angle-sum">720°</span>
                                    </div>
                                    <div>
                                        <span class="font-medium">Regular Angle: </span>
                                        <span id="poly-regular-angle">120°</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Right column - Information panel -->
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                            <h3 class="text-lg font-bold mb-3">Polygon Properties</h3>
                            
                            <div id="polygon-info" class="mb-4">
                                <h4 class="font-medium text-primary">Current Polygon:</h4>
                                <p id="current-polygon" class="mt-1">Regular Hexagon</p>
                                
                                <div class="mt-3 space-y-3">
                                    <div class="bg-white dark:bg-gray-700 p-3 rounded-md">
                                        <h5 class="font-medium">Interior Angle Formula</h5>
                                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">The sum of interior angles in any polygon with 'n' sides:</p>
                                        <div class="font-math text-center text-lg my-2">(n - 2) × 180°</div>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Each interior angle in a regular polygon:</p>
                                        <div class="font-math text-center text-lg my-2">(n - 2) × 180° ÷ n</div>
                                    </div>
                                    
                                    <div class="bg-white dark:bg-gray-700 p-3 rounded-md">
                                        <h5 class="font-medium">Exterior Angle</h5>
                                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">The sum of exterior angles in any polygon is always 360°</p>
                                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Each exterior angle in a regular polygon:</p>
                                        <div class="font-math text-center text-lg my-2">360° ÷ n</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="polygon-challenge" class="mt-6 bg-gray-100 dark:bg-gray-900 p-3 rounded-md">
                                <h4 class="font-medium text-primary mb-2">Polygon Challenge</h4>
                                <p id="polygon-challenge-text" class="text-sm mb-3">Create a square by dragging the vertices to form a quadrilateral with four equal sides and four right angles.</p>
                                
                                <div id="polygon-challenge-feedback" class="mb-3 p-2 hidden rounded-md"></div>
                                
                                <div class="flex justify-center">
                                    <button id="btn-check-polygon" class="px-3 py-1 bg-primary text-white rounded-md hover:bg-opacity-90">Check Polygon</button>
                                    <button id="btn-next-polygon" class="ml-2 px-3 py-1 bg-success text-white rounded-md hover:bg-opacity-90 hidden">Next Challenge</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Circle Theorems Section -->
            <section id="section-circle-theorems" class="tab-content hidden">
                <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                    <h2 class="text-2xl font-bold text-primary">Circle Theorems Lab</h2>
                    <p class="mt-2 text-gray-600 dark:text-gray-400">Explore circle theorems and calculate angles in circles.</p>
                </div>
                
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- Left column - Interactive SVG -->
                        <div class="col-span-2 bg-gray-100 dark:bg-gray-900 rounded-lg p-4">
                            <div class="flex justify-center items-center mb-4">
                                <svg id="circle-svg" width="100%" height="400" viewBox="0 0 600 400" class="mx-auto">
                                    <!-- Circle elements will be drawn here -->
                                    <circle id="main-circle" cx="300" cy="200" r="150" fill="none" stroke="#5D5CDE" stroke-width="2"/>
                                    
                                    <!-- Initial construction for angle in semi-circle -->
                                    <g id="theorem-elements">
                                        <!-- Will be populated based on selected theorem -->
                                    </g>
                                    
                                    <!-- This group will contain draggable points -->
                                    <g id="circle-drag-points">
                                        <!-- Will be populated based on selected theorem -->
                                    </g>
                                    
                                    <!-- Angle measurements and labels -->
                                    <g id="circle-angles">
                                        <!-- Will be populated based on selected theorem -->
                                    </g>
                                </svg>
                            </div>
                            
                            <div class="flex flex-wrap justify-center gap-2 mt-4">
                                <button id="btn-angle-semicircle" class="px-3 py-1 bg-primary text-white rounded-md hover:bg-opacity-90">Angle in Semicircle</button>
                                <button id="btn-cyclic-quadrilateral" class="px-3 py-1 bg-primary text-white rounded-md hover:bg-opacity-90">Cyclic Quadrilateral</button>
                                <button id="btn-angles-same-arc" class="px-3 py-1 bg-primary text-white rounded-md hover:bg-opacity-90">Angles in Same Arc</button>
                                <button id="btn-angle-center" class="px-3 py-1 bg-primary text-white rounded-md hover:bg-opacity-90">Angle at Center</button>
                            </div>
                            
                            <div class="mt-4 bg-white dark:bg-gray-800 p-3 rounded-md shadow-sm">
                                <h4 id="theorem-title" class="font-medium text-primary">Angle in a Semicircle</h4>
                                <p id="theorem-description" class="text-sm mt-1">The angle in a semicircle is always 90° (a right angle).</p>
                            </div>
                        </div>
                        
                        <!-- Right column - Information panel -->
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                            <h3 class="text-lg font-bold mb-3">Circle Theorems</h3>
                            
                            <div class="space-y-4">
                                <div class="bg-white dark:bg-gray-700 p-3 rounded-md">
                                    <h4 class="font-medium">Angle in Semicircle</h4>
                                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">The angle in a semicircle is always a right angle (90°).</p>
                                </div>
                                
                                <div class="bg-white dark:bg-gray-700 p-3 rounded-md">
                                    <h4 class="font-medium">Cyclic Quadrilateral</h4>
                                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Opposite angles in a cyclic quadrilateral are supplementary (add up to 180°).</p>
                                </div>
                                
                                <div class="bg-white dark:bg-gray-700 p-3 rounded-md">
                                    <h4 class="font-medium">Angles in Same Arc</h4>
                                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Angles in the same segment of a circle are equal.</p>
                                </div>
                                
                                <div class="bg-white dark:bg-gray-700 p-3 rounded-md">
                                    <h4 class="font-medium">Angle at Center</h4>
                                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">The angle at the center is twice the angle at the circumference when they both subtend the same arc.</p>
                                </div>
                            </div>
                            
                            <div id="circle-calculator" class="mt-6 bg-gray-100 dark:bg-gray-900 p-3 rounded-md">
                                <h4 class="font-medium text-primary mb-2">Angle Calculator</h4>
                                
                                <div class="space-y-3">
                                    <div>
                                        <label for="angle-input" class="block text-sm font-medium">Known Angle:</label>
                                        <input type="number" id="angle-input" class="mt-1 block w-full p-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-base" placeholder="Enter angle in degrees">
                                    </div>
                                    
                                    <div>
                                        <label for="theorem-select" class="block text-sm font-medium">Apply Theorem:</label>
                                        <select id="theorem-select" class="mt-1 block w-full p-2 border border-gray-300 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 text-base">
                                            <option value="semicircle">Angle in Semicircle</option>
                                            <option value="cyclic">Cyclic Quadrilateral</option>
                                            <option value="same-arc">Angles in Same Arc</option>
                                            <option value="center">Angle at Center</option>
                                        </select>
                                    </div>
                                    
                                    <button id="btn-calculate-angle" class="w-full px-3 py-2 bg-primary text-white rounded-md hover:bg-opacity-90">Calculate</button>
                                    
                                    <div id="calculation-result" class="mt-2 p-2 bg-white dark:bg-gray-800 rounded-md hidden">
                                        <span class="font-medium">Result: </span>
                                        <span id="result-value" class="text-primary font-bold"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Challenge section -->
                    <div class="mt-8 bg-gray-100 dark:bg-gray-900 p-4 rounded-lg">
                        <h3 class="text-xl font-bold mb-4">Circle Theorem Challenge</h3>
                        
                        <div id="circle-challenge" class="flex flex-col items-center">
                            <div id="circle-challenge-question" class="mb-4 p-3 bg-primary bg-opacity-20 rounded-md text-center">
                                <p class="font-medium">If angle A is 40°, what is angle B in the diagram?</p>
                            </div>
                            
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4 w-full max-w-lg">
                                <button class="circle-answer px-4 py-2 bg-white dark:bg-gray-800 rounded-md border border-gray-300 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700" data-value="40">40°</button>
                                <button class="circle-answer px-4 py-2 bg-white dark:bg-gray-800 rounded-md border border-gray-300 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700" data-value="50">50°</button>
                                <button class="circle-answer px-4 py-2 bg-white dark:bg-gray-800 rounded-md border border-gray-300 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700" data-value="80">80°</button>
                                <button class="circle-answer px-4 py-2 bg-white dark:bg-gray-800 rounded-md border border-gray-300 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700" data-value="90">90°</button>
                            </div>
                            
                            <div id="circle-challenge-feedback" class="mb-4 p-3 hidden w-full max-w-lg">
                                <!-- Feedback will appear here -->
                            </div>
                            
                            <button id="btn-next-circle-challenge" class="px-4 py-2 bg-success text-white rounded-md hover:bg-opacity-90 hidden">Next Challenge</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Special Angle Constructions Section -->
            <section id="section-special-angles" class="tab-content hidden">
                <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                    <h2 class="text-2xl font-bold text-primary">Special Angle Constructions</h2>
                    <p class="mt-2 text-gray-600 dark:text-gray-400">Learn how to construct special angles like 30°, 45°, 60°, 75°, and 90°.</p>
                </div>
                
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- Left column - Interactive SVG -->
                        <div class="col-span-2 bg-gray-100 dark:bg-gray-900 rounded-lg p-4">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="font-bold text-lg" id="construction-title">Constructing a 90° Angle</h3>
                                <div class="flex items-center">
                                    <button id="btn-prev-step" class="px-2 py-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 mr-2 disabled:opacity-50" disabled>
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                        </svg>
                                    </button>
                                    <span id="step-counter" class="text-sm">Step 1 of 4</span>
                                    <button id="btn-next-step" class="px-2 py-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white rounded-md hover:bg-gray-300 dark:hover:bg-gray-600 ml-2">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="flex justify-center items-center">
                                <svg id="construction-svg" width="100%" height="400" viewBox="0 0 600 400" class="mx-auto">
                                    <!-- Construction elements will be drawn here -->
                                    <g id="construction-base">
                                        <!-- Base elements common to all constructions -->
                                        <line x1="100" y1="200" x2="500" y2="200" stroke="#5D5CDE" stroke-width="2" id="base-line"/>
                                        <circle cx="300" cy="200" r="5" fill="#5D5CDE" id="point-o"/>
                                        <text x="300" y="220" text-anchor="middle" class="angle-text" fill="currentColor">O</text>
                                    </g>
                                    
                                    <g id="construction-steps">
                                        <!-- Steps will be added dynamically -->
                                    </g>
                                    
                                    <g id="construction-labels">
                                        <!-- Angle labels will be added dynamically -->
                                    </g>
                                </svg>
                            </div>
                            
                            <div id="step-description" class="mt-4 bg-white dark:bg-gray-800 p-3 rounded-md shadow-sm">
                                <p>Place the compass point at O and draw an arc that intersects the base line at points A and B.</p>
                            </div>
                            
                            <div class="flex flex-wrap justify-center gap-2 mt-4">
                                <button id="btn-construct-30" class="px-3 py-1 bg-primary text-white rounded-md hover:bg-opacity-90">30° Angle</button>
                                <button id="btn-construct-45" class="px-3 py-1 bg-primary text-white rounded-md hover:bg-opacity-90">45° Angle</button>
                                <button id="btn-construct-60" class="px-3 py-1 bg-primary text-white rounded-md hover:bg-opacity-90">60° Angle</button>
                                <button id="btn-construct-90" class="px-3 py-1 bg-primary text-white rounded-md hover:bg-opacity-90">90° Angle</button>
                                <button id="btn-construct-bisect" class="px-3 py-1 bg-primary text-white rounded-md hover:bg-opacity-90">Bisect Angle</button>
                            </div>
                        </div>
                        
                        <!-- Right column - Information panel -->
                        <div class="bg-gray-50 dark:bg-gray-800 p-4 rounded-lg">
                            <h3 class="text-lg font-bold mb-3">Compass & Straightedge Constructions</h3>
                            
                            <div class="space-y-4">
                                <div class="bg-white dark:bg-gray-700 p-3 rounded-md">
                                    <h4 class="font-medium">Basic Constructions</h4>
                                    <ul class="mt-2 text-sm text-gray-600 dark:text-gray-400 list-disc list-inside space-y-1">
                                        <li>Copying a line segment</li>
                                        <li>Constructing a perpendicular bisector</li>
                                        <li>Constructing a perpendicular from a point</li>
                                        <li>Bisecting an angle</li>
                                        <li>Copying an angle</li>
                                    </ul>
                                </div>
                                
                                <div class="bg-white dark:bg-gray-700 p-3 rounded-md">
                                    <h4 class="font-medium">Special Angles</h4>
                                    <ul class="mt-2 text-sm text-gray-600 dark:text-gray-400 list-disc list-inside space-y-1">
                                        <li>30° - Half of 60°</li>
                                        <li>45° - Half of 90°</li>
                                        <li>60° - Equilateral triangle angle</li>
                                        <li>90° - Perpendicular lines</li>
                                        <li>75° - Combination of 30° and 45°</li>
                                    </ul>
                                </div>
                                
                                <div class="bg-white dark:bg-gray-700 p-3 rounded-md">
                                    <h4 class="font-medium">Complex Angles</h4>
                                    <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">
                                        More complex angles can be constructed by combining, adding, or subtracting basic angles:
                                    </p>
                                    <ul class="mt-2 text-sm text-gray-600 dark:text-gray-400 list-disc list-inside space-y-1">
                                        <li>15° = 45° - 30°</li>
                                        <li>75° = 30° + 45°</li>
                                        <li>120° = 60° + 60°</li>
                                        <li>135° = 90° + 45°</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <!-- Interactive practice -->
                            <div class="mt-6 bg-gray-100 dark:bg-gray-900 p-3 rounded-md">
                                <h4 class="font-medium text-primary mb-2">Knowledge Check</h4>
                                
                                <div id="angle-quiz" class="space-y-3">
                                    <p id="quiz-question" class="text-sm mb-3">Which of these angles can be constructed directly using a compass and straightedge?</p>
                                    
                                    <div class="space-y-2">
                                        <label class="flex items-center">
                                            <input type="radio" name="angle-quiz" class="mr-2" value="15">
                                            <span class="text-sm">15°</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="angle-quiz" class="mr-2" value="45">
                                            <span class="text-sm">45°</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="angle-quiz" class="mr-2" value="50">
                                            <span class="text-sm">50°</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="angle-quiz" class="mr-2" value="65">
                                            <span class="text-sm">65°</span>
                                        </label>
                                    </div>
                                    
                                    <button id="btn-check-quiz" class="w-full px-3 py-2 bg-primary text-white rounded-md hover:bg-opacity-90">Check Answer</button>
                                    
                                    <div id="quiz-feedback" class="mt-2 p-2 rounded-md hidden">
                                        <!-- Feedback will be shown here -->
                                    </div>
                                    
                                    <button id="btn-next-quiz" class="w-full px-3 py-2 bg-success text-white rounded-md hover:bg-opacity-90 hidden">Next Question</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Theme Toggle Logic
            const darkModeToggle = document.getElementById('dark-mode-toggle');
            
            // Set initial theme based on user preference
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
                darkModeToggle.value = 1;
            }
            
            // Toggle dark mode when toggle is clicked
            darkModeToggle.addEventListener('input', function() {
                if (this.value === "1") {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
                playSound('click-sound');
            });
            
            // Auto-detect system theme changes
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (event.matches) {
                    document.documentElement.classList.add('dark');
                    darkModeToggle.value = 1;
                } else {
                    document.documentElement.classList.remove('dark');
                    darkModeToggle.value = 0;
                }
            });
            
            // Audio toggle
            const audioToggle = document.getElementById('audio-toggle');
            let soundEnabled = audioToggle.checked;
            
            audioToggle.addEventListener('change', function() {
                soundEnabled = this.checked;
                // Play a test sound to confirm
                if (soundEnabled) {
                    playSound('click-sound');
                }
            });
            
            // Sound effect function
            function playSound(soundId) {
                if (soundEnabled) {
                    const sound = document.getElementById(soundId);
                    if (sound) {
                        sound.currentTime = 0;
                        sound.play().catch(e => console.log("Audio play error:", e));
                    }
                }
            }
            
            // Tab Navigation Logic
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // Remove active class from all tab buttons and content sections
                    tabButtons.forEach(btn => {
                        btn.classList.remove('bg-primary', 'text-white');
                        btn.classList.add('bg-gray-200', 'dark:bg-gray-700', 'hover:bg-gray-300', 'dark:hover:bg-gray-600');
                    });
                    
                    tabContents.forEach(content => {
                        content.classList.add('hidden');
                    });
                    
                    // Add active class to clicked tab button
                    this.classList.add('bg-primary', 'text-white');
                    this.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'hover:bg-gray-300', 'dark:hover:bg-gray-600');
                    
                    // Show corresponding content section
                    const tabId = this.id.replace('tab-', 'section-');
                    document.getElementById(tabId).classList.remove('hidden');
                    
                    playSound('click-sound');
                });
            });
            
            //////////////////////////////////////////
            // LINES & ANGLES SECTION
            //////////////////////////////////////////
            
            // Get SVG elements
            const linesAnglesSvg = document.getElementById('lines-angles-svg');
            const baseLine = document.getElementById('base-line');
            const movableLine = document.getElementById('movable-line');
            const angleArc = document.getElementById('angle-arc');
            const angleText = document.getElementById('angle-text');
            const angleValue = document.getElementById('angle-value');
            const angleType = document.getElementById('angle-type');
            const lineRelationship = document.getElementById('line-relationship');
            
            // Get interactive points
            const dragPoint1 = document.getElementById('drag-point-1');
            const dragPoint2 = document.getElementById('drag-point-2');
            const angleCenter = document.getElementById('angle-center');
            
            // Buttons
            const btnParallel = document.getElementById('btn-line-parallel');
            const btnPerpendicular = document.getElementById('btn-line-perpendicular');
            const btnTransversal = document.getElementById('btn-transversal');
            const btnResetLines = document.getElementById('btn-reset-lines');
            const btnCheckAngle = document.getElementById('btn-check-angle');
            const btnNextAngle = document.getElementById('btn-next-angle');
            
            // Dragging variables
            let isDragging = false;
            let selectedPoint = null;
            
            // Make points draggable
            [dragPoint1, dragPoint2].forEach(point => {
                point.addEventListener('mousedown', startDrag);
                point.addEventListener('touchstart', startDrag, { passive: false });
            });
            
            document.addEventListener('mousemove', drag);
            document.addEventListener('touchmove', drag, { passive: false });
            document.addEventListener('mouseup', endDrag);
            document.addEventListener('touchend', endDrag);
            
            function startDrag(e) {
                isDragging = true;
                selectedPoint = this;
                selectedPoint.setAttribute('r', '10'); // Enlarge the point when dragging
                playSound('click-sound');
                
                // Prevent default touch behavior to avoid scrolling
                if (e.type === 'touchstart') {
                    e.preventDefault();
                }
                
                e.stopPropagation();
            }
            
            function drag(e) {
                if (!isDragging || !selectedPoint) return;
                
                // Prevent default touch behavior to avoid scrolling
                if (e.type === 'touchmove') {
                    e.preventDefault();
                }
                
                // Get mouse/touch position relative to SVG
                const svgRect = linesAnglesSvg.getBoundingClientRect();
                let clientX, clientY;
                
                if (e.type === 'touchmove') {
                    clientX = e.touches[0].clientX;
                    clientY = e.touches[0].clientY;
                } else {
                    clientX = e.clientX;
                    clientY = e.clientY;
                }
                
                const x = clientX - svgRect.left;
                const y = clientY - svgRect.top;
                
                // Keep points within SVG bounds
                const boundedX = Math.max(50, Math.min(550, x));
                const boundedY = Math.max(50, Math.min(350, y));
                
                // Update point position
                selectedPoint.setAttribute('cx', boundedX);
                selectedPoint.setAttribute('cy', boundedY);
                
                // Update line position
                if (selectedPoint === dragPoint1) {
                    movableLine.setAttribute('x1', boundedX);
                    movableLine.setAttribute('y1', boundedY);
                } else if (selectedPoint === dragPoint2) {
                    movableLine.setAttribute('x2', boundedX);
                    movableLine.setAttribute('y2', boundedY);
                }
                
                // Update angle display
                updateAngleDisplay();
                
                // Play soft sound during drag
                if (Math.random() < 0.1) { // Limit how often the sound plays
                    playSound('drag-sound');
                }
            }
            
            function endDrag() {
                if (isDragging && selectedPoint) {
                    selectedPoint.setAttribute('r', '8'); // Reset point size
                    updateAngleDisplay(true); // Force final update with sound
                    selectedPoint = null;
                    isDragging = false;
                }
            }
            
            // Function to calculate and display angle
            function updateAngleDisplay(playAngleSound = false) {
                // Get coordinates
                const baseX1 = parseFloat(baseLine.getAttribute('x1'));
                const baseY1 = parseFloat(baseLine.getAttribute('y1'));
                const baseX2 = parseFloat(baseLine.getAttribute('x2'));
                const baseY2 = parseFloat(baseLine.getAttribute('y2'));
                const moveX1 = parseFloat(movableLine.getAttribute('x1'));
                const moveY1 = parseFloat(movableLine.getAttribute('y1'));
                const moveX2 = parseFloat(movableLine.getAttribute('x2'));
                const moveY2 = parseFloat(movableLine.getAttribute('y2'));
                
                // Calculate vectors
                const baseVectorX = baseX2 - baseX1;
                const baseVectorY = baseY2 - baseY1;
                const moveVectorX = moveX2 - moveX1;
                const moveVectorY = moveY2 - moveY1;
                
                // Calculate dot product
                const dotProduct = baseVectorX * moveVectorX + baseVectorY * moveVectorY;
                
                // Calculate magnitudes
                const baseMagnitude = Math.sqrt(baseVectorX * baseVectorX + baseVectorY * baseVectorY);
                const moveMagnitude = Math.sqrt(moveVectorX * moveVectorX + moveVectorY * moveVectorY);
                
                // Calculate angle in radians
                let angleRad = Math.acos(dotProduct / (baseMagnitude * moveMagnitude));
                
                // Convert to degrees
                let angleDeg = Math.round(angleRad * 180 / Math.PI);
                
                // Determine if angle is less than 90 or greater than 90
                const crossProduct = baseVectorX * moveVectorY - baseVectorY * moveVectorX;
                if (crossProduct > 0) {
                    angleDeg = 180 - angleDeg;
                }
                
                // Update angle display
                angleValue.textContent = angleDeg + '°';
                angleText.textContent = angleDeg + '°';
                
                // Update angle arc path
                const centerX = 300;
                const centerY = 200;
                const radius = 20;
                
                // Calculate points for arc
                const startAngleRad = 0; // Base line is horizontal
                const endAngleRad = crossProduct > 0 ? -angleRad : angleRad;
                
                const startX = centerX + radius;
                const startY = centerY;
                const endX = centerX + radius * Math.cos(endAngleRad);
                const endY = centerY + radius * Math.sin(endAngleRad);
                
                // Create arc path
                const largeArcFlag = angleDeg > 180 ? 1 : 0;
                const sweepFlag = crossProduct > 0 ? 0 : 1;
                
                const arcPath = `M ${startX},${startY} A ${radius},${radius} 0 ${largeArcFlag} ${sweepFlag} ${endX},${endY}`;
                angleArc.setAttribute('d', arcPath);
                
                // Position the angle text
                const textRadius = radius + 15;
                const textAngle = endAngleRad / 2;
                const textX = centerX + textRadius * Math.cos(textAngle);
                const textY = centerY + textRadius * Math.sin(textAngle);
                
                angleText.setAttribute('x', textX);
                angleText.setAttribute('y', textY);
                
                // Update angle type
                if (angleDeg < 90) {
                    angleType.textContent = `Acute angle (${angleDeg}°)`;
                } else if (angleDeg === 90) {
                    angleType.textContent = `Right angle (90°)`;
                } else if (angleDeg < 180) {
                    angleType.textContent = `Obtuse angle (${angleDeg}°)`;
                } else if (angleDeg === 180) {
                    angleType.textContent = `Straight angle (180°)`;
                } else {
                    angleType.textContent = `Reflex angle (${angleDeg}°)`;
                }
                
                // Update line relationship
                if (Math.abs(angleDeg - 90) < 2 || Math.abs(angleDeg - 270) < 2) {
                    lineRelationship.textContent = "Perpendicular lines";
                } else if (Math.abs(angleDeg - 0) < 2 || Math.abs(angleDeg - 180) < 2) {
                    lineRelationship.textContent = "Parallel lines";
                } else {
                    lineRelationship.textContent = "Intersecting lines";
                }
                
                // Play sound for specific angles
                if (playAngleSound) {
                    // Choose sound based on angle
                    if (Math.abs(angleDeg - 30) < 5) {
                        playSound('angle-sound-30');
                    } else if (Math.abs(angleDeg - 45) < 5) {
                        playSound('angle-sound-45');
                    } else if (Math.abs(angleDeg - 60) < 5) {
                        playSound('angle-sound-60');
                    } else if (Math.abs(angleDeg - 90) < 5) {
                        playSound('angle-sound-90');
                    }
                }
                
                return angleDeg;
            }
            
            // Button functions
            btnParallel.addEventListener('click', function() {
                // Adjust the movable line to be parallel with the base line
                const x1 = parseFloat(dragPoint1.getAttribute('cx'));
                const y1 = parseFloat(dragPoint1.getAttribute('cy'));
                
                // Set the second point to create a horizontal line
                dragPoint2.setAttribute('cx', x1 + 100);
                dragPoint2.setAttribute('cy', y1);
                
                // Update the line
                movableLine.setAttribute('x1', x1);
                movableLine.setAttribute('y1', y1);
                movableLine.setAttribute('x2', x1 + 100);
                movableLine.setAttribute('y2', y1);
                
                updateAngleDisplay(true);
                playSound('click-sound');
            });
            
            btnPerpendicular.addEventListener('click', function() {
                // Adjust the movable line to be perpendicular to the base line
                const x1 = parseFloat(dragPoint1.getAttribute('cx'));
                const y1 = parseFloat(dragPoint1.getAttribute('cy'));
                
                // Set the second point to create a vertical line
                dragPoint2.setAttribute('cx', x1);
                dragPoint2.setAttribute('cy', y1 + 100);
                
                // Update the line
                movableLine.setAttribute('x1', x1);
                movableLine.setAttribute('y1', y1);
                movableLine.setAttribute('x2', x1);
                movableLine.setAttribute('y2', y1 + 100);
                
                updateAngleDisplay(true);
                playSound('click-sound');
            });
            
            // Variable to track if transversal is shown
            let transversalShown = false;
            let transversalLine = null;
            
            btnTransversal.addEventListener('click', function() {
                if (!transversalShown) {
                    // Add a transversal line
                    transversalLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
                    transversalLine.setAttribute('x1', '200');
                    transversalLine.setAttribute('y1', '50');
                    transversalLine.setAttribute('x2', '400');
                    transversalLine.setAttribute('y2', '350');
                    transversalLine.setAttribute('stroke', '#F59E0B');
                    transversalLine.setAttribute('stroke-width', '2');
                    transversalLine.classList.add('line-transversal');
                    
                    document.getElementById('lines-group').appendChild(transversalLine);
                    
                    // Update button text
                    this.textContent = "Hide Transversal";
                    transversalShown = true;
                } else {
                    // Remove the transversal line
                    if (transversalLine) {
                        transversalLine.remove();
                        transversalLine = null;
                    }
                    
                    // Update button text
                    this.textContent = "Show Transversal";
                    transversalShown = false;
                }
                
                playSound('click-sound');
            });
            
            btnResetLines.addEventListener('click', function() {
                // Reset to initial positions
                dragPoint1.setAttribute('cx', '300');
                dragPoint1.setAttribute('cy', '100');
                dragPoint2.setAttribute('cx', '400');
                dragPoint2.setAttribute('cy', '300');
                
                movableLine.setAttribute('x1', '300');
                movableLine.setAttribute('y1', '100');
                movableLine.setAttribute('x2', '400');
                movableLine.setAttribute('y2', '300');
                
                // Remove transversal if present
                if (transversalShown && transversalLine) {
                    transversalLine.remove();
                    transversalLine = null;
                    transversalShown = false;
                    btnTransversal.textContent = "Show Transversal";
                }
                
                updateAngleDisplay(true);
                playSound('click-sound');
            });
            
            // Angle Challenge Logic
            const challengeAngles = [30, 45, 60, 90, 120, 135, 150, 180];
            let currentChallengeAngle = 45; // Initial challenge
            
            function setNewAngleChallenge() {
                // Pick a random angle from the list
                currentChallengeAngle = challengeAngles[Math.floor(Math.random() * challengeAngles.length)];
                document.getElementById('challenge-instruction').textContent = `Create a ${currentChallengeAngle}° angle`;
                
                // Hide feedback and next button
                document.getElementById('challenge-feedback').classList.add('hidden');
                btnNextAngle.classList.add('hidden');
                
                // Reset angle to encourage repositioning
                btnResetLines.click();
            }
            
            btnCheckAngle.addEventListener('click', function() {
                const currentAngle = updateAngleDisplay(true);
                const angleDifference = Math.abs(currentAngle - currentChallengeAngle);
                
                const feedbackElement = document.getElementById('challenge-feedback');
                feedbackElement.classList.remove('hidden');
                
                if (angleDifference <= 3) { // Allow 3 degrees of tolerance
                    feedbackElement.className = 'mb-4 p-3 bg-success bg-opacity-20 rounded-md text-success';
                    feedbackElement.innerHTML = `
                        <svg class="w-5 h-5 inline-block mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        Correct! You've created a ${currentAngle}° angle.
                    `;
                    btnNextAngle.classList.remove('hidden');
                    playSound('success-sound');
                } else {
                    feedbackElement.className = 'mb-4 p-3 bg-danger bg-opacity-20 rounded-md text-danger';
                    feedbackElement.innerHTML = `
                        <svg class="w-5 h-5 inline-block mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                        Not quite! Your angle is ${currentAngle}°, but you need ${currentChallengeAngle}°.
                    `;
                    playSound('error-sound');
                }
            });
            
            btnNextAngle.addEventListener('click', function() {
                setNewAngleChallenge();
                playSound('click-sound');
            });
            
            // Initialize first challenge
            setNewAngleChallenge();
            
            //////////////////////////////////////////
            // POLYGONS SECTION
            //////////////////////////////////////////
            
            // Get SVG elements
            const polygonSvg = document.getElementById('polygon-svg');
            const polyShape = document.getElementById('poly-shape');
            let vertices = Array.from(document.querySelectorAll('.vertex'));
            let vertexPositions = vertices.map(vertex => ({
                x: parseFloat(vertex.getAttribute('cx')),
                y: parseFloat(vertex.getAttribute('cy'))
            }));
            
            // Polygon info displays
            const polySides = document.getElementById('poly-sides');
            const polyAngleSum = document.getElementById('poly-angle-sum');
            const polyRegularAngle = document.getElementById('poly-regular-angle');
            const currentPolygon = document.getElementById('current-polygon');
            
            // Buttons
            const btnTriangle = document.getElementById('btn-triangle');
            const btnQuadrilateral = document.getElementById('btn-quadrilateral');
            const btnPentagon = document.getElementById('btn-pentagon');
            const btnHexagon = document.getElementById('btn-hexagon');
            const btnRegular = document.getElementById('btn-regular');
            const btnShowAngles = document.getElementById('btn-show-angles');
            
            // Vertex dragging functions
            vertices.forEach(vertex => {
                vertex.addEventListener('mousedown', startVertexDrag);
                vertex.addEventListener('touchstart', startVertexDrag, { passive: false });
            });
            
            function startVertexDrag(e) {
                isDragging = true;
                selectedPoint = this;
                selectedPoint.setAttribute('r', '10'); // Enlarge the vertex when dragging
                playSound('click-sound');
                
                // Prevent default touch behavior
                if (e.type === 'touchstart') {
                    e.preventDefault();
                }
                
                e.stopPropagation();
            }
            
            // Add event listeners for polygon drag
            document.addEventListener('mousemove', dragVertex);
            document.addEventListener('touchmove', dragVertex, { passive: false });
            document.addEventListener('mouseup', endVertexDrag);
            document.addEventListener('touchend', endVertexDrag);
            
            function dragVertex(e) {
                if (!isDragging || !selectedPoint || !selectedPoint.classList.contains('vertex')) return;
                
                // Prevent default touch behavior
                if (e.type === 'touchmove') {
                    e.preventDefault();
                }
                
                // Get mouse/touch position relative to SVG
                const svgRect = polygonSvg.getBoundingClientRect();
                let clientX, clientY;
                
                if (e.type === 'touchmove') {
                    clientX = e.touches[0].clientX;
                    clientY = e.touches[0].clientY;
                } else {
                    clientX = e.clientX;
                    clientY = e.clientY;
                }
                
                const x = clientX - svgRect.left;
                const y = clientY - svgRect.top;
                
                // Keep vertices within SVG bounds
                const boundedX = Math.max(50, Math.min(550, x));
                const boundedY = Math.max(50, Math.min(350, y));
                
                // Update vertex position
                selectedPoint.setAttribute('cx', boundedX);
                selectedPoint.setAttribute('cy', boundedY);
                
                // Get vertex index
                const vertexIndex = parseInt(selectedPoint.getAttribute('data-index'));
                
                // Update vertex positions array
                vertexPositions[vertexIndex] = { x: boundedX, y: boundedY };
                
                // Update polygon shape
                updatePolygonShape();
                
                // Play soft sound during drag occasionally
                if (Math.random() < 0.1) {
                    playSound('drag-sound');
                }
            }
            
            function endVertexDrag() {
                if (isDragging && selectedPoint && selectedPoint.classList.contains('vertex')) {
                    selectedPoint.setAttribute('r', '8'); // Reset vertex size
                    updatePolygonShape(true); // Update with sound
                    
                    // Update polygon description
                    updatePolygonDescription();
                    
                    selectedPoint = null;
                    isDragging = false;
                }
            }
            
            // Function to update polygon shape
            function updatePolygonShape(withSound = false) {
                // Create points string for polygon
                const points = vertexPositions
                    .slice(0, parseInt(polySides.textContent))
                    .map(pos => `${pos.x},${pos.y}`)
                    .join(' ');
                
                polyShape.setAttribute('points', points);
                
                // Update angle markers if they exist
                updateAngleMarkers();
                
                if (withSound) {
                    playSound('complete-sound');
                }
            }
            
            // Function to update angle markers
            let angleMarkers = [];
            
            function updateAngleMarkers() {
                // Remove existing markers
                angleMarkers.forEach(marker => marker.remove());
                angleMarkers = [];
                
                const showAngles = document.getElementById('btn-show-angles').classList.contains('active');
                if (!showAngles) return;
                
                const sides = parseInt(polySides.textContent);
                
                for (let i = 0; i < sides; i++) {
                    const prev = (i - 1 + sides) % sides;
                    const curr = i;
                    const next = (i + 1) % sides;
                    
                    const angle = calculateInteriorAngle(
                        vertexPositions[prev],
                        vertexPositions[curr],
                        vertexPositions[next]
                    );
                    
                    // Create angle arc
                    const arc = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    const cx = vertexPositions[curr].x;
                    const cy = vertexPositions[curr].y;
                    
                    // Calculate vectors
                    const v1x = vertexPositions[prev].x - cx;
                    const v1y = vertexPositions[prev].y - cy;
                    const v2x = vertexPositions[next].x - cx;
                    const v2y = vertexPositions[next].y - cy;
                    
                    // Normalize and scale for arc radius
                    const radius = 20;
                    const len1 = Math.sqrt(v1x * v1x + v1y * v1y);
                    const len2 = Math.sqrt(v2x * v2x + v2y * v2y);
                    
                    const p1x = cx + radius * v1x / len1;
                    const p1y = cy + radius * v1y / len1;
                    const p2x = cx + radius * v2x / len2;
                    const p2y = cy + radius * v2y / len2;
                    
                    // Determine arc flags
                    const largeArcFlag = angle > 180 ? 1 : 0;
                    const sweepFlag = 1; // Use 1 for interior angles
                    
                    arc.setAttribute('d', `M ${p1x} ${p1y} A ${radius} ${radius} 0 ${largeArcFlag} ${sweepFlag} ${p2x} ${p2y}`);
                    arc.setAttribute('fill', 'none');
                    arc.setAttribute('stroke', '#10B981');
                    arc.setAttribute('stroke-width', '2');
                    
                    // Add to SVG
                    document.getElementById('polygon-group').appendChild(arc);
                    angleMarkers.push(arc);
                    
                    // Add angle text
                    const textRadius = radius + 10;
                    const midAngleRad = Math.atan2((v1y + v2y)/2, (v1x + v2x)/2);
                    const textX = cx + textRadius * Math.cos(midAngleRad);
                    const textY = cy + textRadius * Math.sin(midAngleRad);
                    
                    const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                    text.setAttribute('x', textX);
                    text.setAttribute('y', textY);
                    text.setAttribute('text-anchor', 'middle');
                    text.setAttribute('font-size', '12');
                    text.setAttribute('fill', 'currentColor');
                    text.textContent = `${Math.round(angle)}°`;
                    
                    document.getElementById('polygon-group').appendChild(text);
                    angleMarkers.push(text);
                }
            }
            
            // Function to calculate interior angle
            function calculateInteriorAngle(p1, p2, p3) {
                // Vectors
                const v1x = p1.x - p2.x;
                const v1y = p1.y - p2.y;
                const v2x = p3.x - p2.x;
                const v2y = p3.y - p2.y;
                
                // Dot product
                const dotProduct = v1x * v2x + v1y * v2y;
                
                // Magnitudes
                const mag1 = Math.sqrt(v1x * v1x + v1y * v1y);
                const mag2 = Math.sqrt(v2x * v2x + v2y * v2y);
                
                // Cosine of angle
                const cosAngle = dotProduct / (mag1 * mag2);
                
                // Angle in degrees, clamped for numerical stability
                const angleRad = Math.acos(Math.max(-1, Math.min(1, cosAngle)));
                const angleDeg = 180 - (angleRad * 180 / Math.PI); // Interior angle
                
                return angleDeg;
            }
            
            // Function to generate regular polygon vertices
            function createRegularPolygon(sides, centerX = 300, centerY = 200, radius = 150) {
                const vertices = [];
                const angleStep = (2 * Math.PI) / sides;
                
                for (let i = 0; i < sides; i++) {
                    const angle = i * angleStep - Math.PI / 2; // Start from top
                    const x = centerX + radius * Math.cos(angle);
                    const y = centerY + radius * Math.sin(angle);
                    vertices.push({ x, y });
                }
                
                return vertices;
            }
            
            // Update the visual description of the polygon
            function updatePolygonDescription() {
                const sides = parseInt(polySides.textContent);
                
                // Check if it's a regular polygon (roughly)
                const isRegular = checkIfRegular();
                
                let typeName = "";
                
                switch (sides) {
                    case 3:
                        typeName = isRegular ? "Equilateral Triangle" : "Triangle";
                        break;
                    case 4:
                        if (isRegular) {
                            typeName = "Square";
                        } else if (checkIfRectangle()) {
                            typeName = "Rectangle";
                        } else {
                            typeName = "Quadrilateral";
                        }
                        break;
                    case 5:
                        typeName = isRegular ? "Regular Pentagon" : "Pentagon";
                        break;
                    case 6:
                        typeName = isRegular ? "Regular Hexagon" : "Hexagon";
                        break;
                    default:
                        typeName = isRegular ? `Regular ${sides}-gon` : `${sides}-sided Polygon`;
                }
                
                currentPolygon.textContent = typeName;
            }
            
            // Check if the polygon is approximately regular
            function checkIfRegular() {
                const sides = parseInt(polySides.textContent);
                const vertices = vertexPositions.slice(0, sides);
                
                // Check side lengths
                const sideLengths = [];
                for (let i = 0; i < sides; i++) {
                    const next = (i + 1) % sides;
                    const dx = vertices[next].x - vertices[i].x;
                    const dy = vertices[next].y - vertices[i].y;
                    sideLengths.push(Math.sqrt(dx * dx + dy * dy));
                }
                
                // Calculate average and check if all are within 10% tolerance
                const avgLength = sideLengths.reduce((sum, len) => sum + len, 0) / sides;
                const allSidesEqual = sideLengths.every(len => Math.abs(len - avgLength) / avgLength < 0.1);
                
                // Check interior angles
                const interiorAngles = [];
                for (let i = 0; i < sides; i++) {
                    const prev = (i - 1 + sides) % sides;
                    const curr = i;
                    const next = (i + 1) % sides;
                    interiorAngles.push(calculateInteriorAngle(vertices[prev], vertices[curr], vertices[next]));
                }
                
                // Calculate expected interior angle for regular polygon
                const expectedAngle = (sides - 2) * 180 / sides;
                const allAnglesEqual = interiorAngles.every(angle => 
                    Math.abs(angle - expectedAngle) < 10 // Allow 10 degrees tolerance
                );
                
                return allSidesEqual && allAnglesEqual;
            }
            
            // Check if the quadrilateral is a rectangle
            function checkIfRectangle() {
                if (parseInt(polySides.textContent) !== 4) return false;
                
                const vertices = vertexPositions.slice(0, 4);
                
                // Check for right angles (approximately 90 degrees)
                for (let i = 0; i < 4; i++) {
                    const prev = (i - 1 + 4) % 4;
                    const curr = i;
                    const next = (i + 1) % 4;
                    
                    const angle = calculateInteriorAngle(vertices[prev], vertices[curr], vertices[next]);
                    if (Math.abs(angle - 90) > 5) { // Allow 5 degrees tolerance
                        return false;
                    }
                }
                
                return true;
            }
            
            // Function to update polygon vertices
            function updatePolygonVertices(numSides) {
                // Update the displayed number of sides
                polySides.textContent = numSides;
                
                // Update the angle sum
                const angleSumValue = (numSides - 2) * 180;
                polyAngleSum.textContent = angleSumValue + '°';
                
                // Update regular angle
                const regularAngleValue = angleSumValue / numSides;
                polyRegularAngle.textContent = regularAngleValue + '°';
                
                // Show/hide vertices based on number of sides
                vertices.forEach((vertex, index) => {
                    if (index < numSides) {
                        vertex.style.display = 'block';
                    } else {
                        vertex.style.display = 'none';
                    }
                });
                
                // Update polygon shape
                updatePolygonShape();
                
                // Update polygon description
                updatePolygonDescription();
            }
            
            // Polygon shape buttons
            btnTriangle.addEventListener('click', () => {
                updatePolygonVertices(3);
                playSound('click-sound');
            });
            
            btnQuadrilateral.addEventListener('click', () => {
                updatePolygonVertices(4);
                playSound('click-sound');
            });
            
            btnPentagon.addEventListener('click', () => {
                updatePolygonVertices(5);
                playSound('click-sound');
            });
            
            btnHexagon.addEventListener('click', () => {
                updatePolygonVertices(6);
                playSound('click-sound');
            });
            
            // Make regular polygon
            btnRegular.addEventListener('click', () => {
                const sides = parseInt(polySides.textContent);
                vertexPositions = createRegularPolygon(sides);
                
                // Update vertex positions in the DOM
                vertices.forEach((vertex, index) => {
                    if (index < sides) {
                        vertex.setAttribute('cx', vertexPositions[index].x);
                        vertex.setAttribute('cy', vertexPositions[index].y);
                    }
                });
                
                updatePolygonShape(true);
                updatePolygonDescription();
                playSound('success-sound');
            });
            
            // Toggle angle display
            btnShowAngles.addEventListener('click', function() {
                this.classList.toggle('active');
                
                if (this.classList.contains('active')) {
                    this.textContent = "Hide Angles";
                    this.classList.remove('bg-secondary');
                    this.classList.add('bg-accent');
                } else {
                    this.textContent = "Show Angles";
                    this.classList.remove('bg-accent');
                    this.classList.add('bg-secondary');
                    
                    // Remove angle markers
                    angleMarkers.forEach(marker => marker.remove());
                    angleMarkers = [];
                }
                
                updatePolygonShape();
                playSound('click-sound');
            });
            
            // Polygon Challenge
            const polygonChallenges = [
                {
                    description: "Create a square by dragging the vertices to form a quadrilateral with four equal sides and four right angles.",
                    sides: 4,
                    checkFunction: function() {
                        return checkIfRectangle() && checkIfRegular();
                    }
                },
                {
                    description: "Create an equilateral triangle by making all three sides equal in length.",
                    sides: 3,
                    checkFunction: function() {
                        return checkIfRegular();
                    }
                },
                {
                    description: "Create a rectangle that is not a square.",
                    sides: 4,
                    checkFunction: function() {
                        return checkIfRectangle() && !checkIfRegular();
                    }
                }
            ];
            
            let currentPolygonChallenge = 0;
            
            function setPolygonChallenge(index) {
                const challenge = polygonChallenges[index];
                document.getElementById('polygon-challenge-text').textContent = challenge.description;
                
                // Set polygon to correct number of sides
                updatePolygonVertices(challenge.sides);
                
                // Hide feedback and next button
                document.getElementById('polygon-challenge-feedback').classList.add('hidden');
                document.getElementById('btn-next-polygon').classList.add('hidden');
            }
            
            document.getElementById('btn-check-polygon').addEventListener('click', function() {
                const challenge = polygonChallenges[currentPolygonChallenge];
                const isCorrect = challenge.checkFunction();
                
                const feedbackElement = document.getElementById('polygon-challenge-feedback');
                feedbackElement.classList.remove('hidden');
                
                if (isCorrect) {
                    feedbackElement.className = 'mb-3 p-2 bg-success bg-opacity-20 rounded-md text-success';
                    feedbackElement.textContent = "Correct! You've successfully created the requested polygon.";
                    document.getElementById('btn-next-polygon').classList.remove('hidden');
                    playSound('success-sound');
                } else {
                    feedbackElement.className = 'mb-3 p-2 bg-danger bg-opacity-20 rounded-md text-danger';
                    feedbackElement.textContent = "Not quite right. Try adjusting the vertices to match the requirements.";
                    playSound('error-sound');
                }
            });
            
            document.getElementById('btn-next-polygon').addEventListener('click', function() {
                currentPolygonChallenge = (currentPolygonChallenge + 1) % polygonChallenges.length;
                setPolygonChallenge(currentPolygonChallenge);
                playSound('click-sound');
            });
            
            // Initialize polygon challenge
            setPolygonChallenge(currentPolygonChallenge);
            
            //////////////////////////////////////////
            // CIRCLE THEOREMS SECTION
            //////////////////////////////////////////
            
            const circleSvg = document.getElementById('circle-svg');
            const mainCircle = document.getElementById('main-circle');
            const theoremElements = document.getElementById('theorem-elements');
            const circleDragPoints = document.getElementById('circle-drag-points');
            const circleAngles = document.getElementById('circle-angles');
            
            // Button references
            const btnAngleSemicircle = document.getElementById('btn-angle-semicircle');
            const btnCyclicQuadrilateral = document.getElementById('btn-cyclic-quadrilateral');
            const btnAnglesSameArc = document.getElementById('btn-angles-same-arc');
            const btnAngleCenter = document.getElementById('btn-angle-center');
            
            // Circle theorem buttons
            btnAngleSemicircle.addEventListener('click', function() {
                setupAngleInSemicircle();
                playSound('click-sound');
            });
            
            btnCyclicQuadrilateral.addEventListener('click', function() {
                setupCyclicQuadrilateral();
                playSound('click-sound');
            });
            
            btnAnglesSameArc.addEventListener('click', function() {
                setupAnglesSameArc();
                playSound('click-sound');
            });
            
            btnAngleCenter.addEventListener('click', function() {
                setupAngleAtCenter();
                playSound('click-sound');
            });
            
            // Variables to track current draggable points
            let currentCirclePoints = [];
            
            // Setup functions for each theorem
            function setupAngleInSemicircle() {
                // Clear previous elements
                theoremElements.innerHTML = '';
                circleDragPoints.innerHTML = '';
                circleAngles.innerHTML = '';
                
                // Update theorem info
                document.getElementById('theorem-title').textContent = "Angle in a Semicircle";
                document.getElementById('theorem-description').textContent = 
                    "The angle in a semicircle is always 90° (a right angle).";
                
                // Create diameter
                const diameter = document.createElementNS("http://www.w3.org/2000/svg", "line");
                diameter.setAttribute('x1', '150');
                diameter.setAttribute('y1', '200');
                diameter.setAttribute('x2', '450');
                diameter.setAttribute('y2', '200');
                diameter.setAttribute('stroke', '#5D5CDE');
                diameter.setAttribute('stroke-width', '2');
                theoremElements.appendChild(diameter);
                
                // Create point C on the circle
                const pointC = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                pointC.setAttribute('cx', '300');
                pointC.setAttribute('cy', '50');
                pointC.setAttribute('r', '8');
                pointC.setAttribute('fill', '#EC4899');
                pointC.classList.add('draggable', 'circle-point');
                pointC.id = 'point-c';
                circleDragPoints.appendChild(pointC);
                
                // Create triangle lines
                const lineAC = document.createElementNS("http://www.w3.org/2000/svg", "line");
                lineAC.setAttribute('x1', '150');
                lineAC.setAttribute('y1', '200');
                lineAC.setAttribute('x2', '300');
                lineAC.setAttribute('y2', '50');
                lineAC.setAttribute('stroke', '#10B981');
                lineAC.setAttribute('stroke-width', '2');
                lineAC.id = 'line-ac';
                theoremElements.appendChild(lineAC);
                
                const lineBC = document.createElementNS("http://www.w3.org/2000/svg", "line");
                lineBC.setAttribute('x1', '450');
                lineBC.setAttribute('y1', '200');
                lineBC.setAttribute('x2', '300');
                lineBC.setAttribute('y2', '50');
                lineBC.setAttribute('stroke', '#10B981');
                lineBC.setAttribute('stroke-width', '2');
                lineBC.id = 'line-bc';
                theoremElements.appendChild(lineBC);
                
                // Add fixed points A and B
                const pointA = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                pointA.setAttribute('cx', '150');
                pointA.setAttribute('cy', '200');
                pointA.setAttribute('r', '8');
                pointA.setAttribute('fill', '#3B82F6');
                theoremElements.appendChild(pointA);
                
                const pointB = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                pointB.setAttribute('cx', '450');
                pointB.setAttribute('cy', '200');
                pointB.setAttribute('r', '8');
                pointB.setAttribute('fill', '#3B82F6');
                theoremElements.appendChild(pointB);
                
                // Add labels
                const labelA = document.createElementNS("http://www.w3.org/2000/svg", "text");
                labelA.setAttribute('x', '140');
                labelA.setAttribute('y', '220');
                labelA.setAttribute('fill', 'currentColor');
                labelA.setAttribute('font-size', '16');
                labelA.textContent = 'A';
                theoremElements.appendChild(labelA);
                
                const labelB = document.createElementNS("http://www.w3.org/2000/svg", "text");
                labelB.setAttribute('x', '460');
                labelB.setAttribute('y', '220');
                labelB.setAttribute('fill', 'currentColor');
                labelB.setAttribute('font-size', '16');
                labelB.textContent = 'B';
                theoremElements.appendChild(labelB);
                
                const labelC = document.createElementNS("http://www.w3.org/2000/svg", "text");
                labelC.setAttribute('x', '300');
                labelC.setAttribute('y', '40');
                labelC.setAttribute('fill', 'currentColor');
                labelC.setAttribute('font-size', '16');
                labelC.textContent = 'C';
                labelC.id = 'label-c';
                theoremElements.appendChild(labelC);
                
                // Add angle arc and label
                const angleArc = document.createElementNS("http://www.w3.org/2000/svg", "path");
                angleArc.setAttribute('d', 'M 280,50 A 20,20 0 0,0 300,70');
                angleArc.setAttribute('fill', 'none');
                angleArc.setAttribute('stroke', '#10B981');
                angleArc.setAttribute('stroke-width', '2');
                angleArc.id = 'angle-arc';
                circleAngles.appendChild(angleArc);
                
                const angleLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
                angleLabel.setAttribute('x', '290');
                angleLabel.setAttribute('y', '60');
                angleLabel.setAttribute('fill', 'currentColor');
                angleLabel.setAttribute('font-size', '14');
                angleLabel.setAttribute('font-weight', 'bold');
                angleLabel.textContent = '90°';
                angleLabel.id = 'angle-label';
                circleAngles.appendChild(angleLabel);
                
                // Store current points for dragging
                currentCirclePoints = [pointC];
                
                // Make point C draggable on the circle
                pointC.addEventListener('mousedown', startCirclePointDrag);
                pointC.addEventListener('touchstart', startCirclePointDrag, { passive: false });
                
                // Initial update
                updateAngleInSemicircle();
            }
            
            function setupCyclicQuadrilateral() {
                // Clear previous elements
                theoremElements.innerHTML = '';
                circleDragPoints.innerHTML = '';
                circleAngles.innerHTML = '';
                
                // Update theorem info
                document.getElementById('theorem-title').textContent = "Cyclic Quadrilateral";
                document.getElementById('theorem-description').textContent = 
                    "Opposite angles in a cyclic quadrilateral are supplementary (add up to 180°).";
                
                // Create cyclic quadrilateral
                const points = [
                    { x: 300, y: 50 },   // A - top
                    { x: 450, y: 200 },  // B - right
                    { x: 300, y: 350 },  // C - bottom
                    { x: 150, y: 200 }   // D - left
                ];
                
                // Create polygon
                const quadrilateral = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
                quadrilateral.setAttribute('points', points.map(p => `${p.x},${p.y}`).join(' '));
                quadrilateral.setAttribute('fill', 'rgba(93, 92, 222, 0.2)');
                quadrilateral.setAttribute('stroke', '#5D5CDE');
                quadrilateral.setAttribute('stroke-width', '2');
                quadrilateral.id = 'quad-shape';
                theoremElements.appendChild(quadrilateral);
                
                // Create draggable vertices
                for (let i = 0; i < points.length; i++) {
                    const point = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                    point.setAttribute('cx', points[i].x);
                    point.setAttribute('cy', points[i].y);
                    point.setAttribute('r', '8');
                    point.setAttribute('fill', '#EC4899');
                    point.classList.add('draggable', 'circle-point');
                    point.setAttribute('data-index', i);
                    point.id = `point-${String.fromCharCode(65 + i)}`; // A, B, C, D
                    
                    // Add label
                    const label = document.createElementNS("http://www.w3.org/2000/svg", "text");
                    label.setAttribute('x', points[i].x + (i === 1 ? 15 : i === 3 ? -15 : 0));
                    label.setAttribute('y', points[i].y + (i === 0 ? -10 : i === 2 ? 20 : 5));
                    label.setAttribute('fill', 'currentColor');
                    label.setAttribute('font-size', '16');
                    label.setAttribute('text-anchor', i === 1 ? 'start' : i === 3 ? 'end' : 'middle');
                    label.textContent = String.fromCharCode(65 + i); // A, B, C, D
                    label.id = `label-${String.fromCharCode(65 + i)}`;
                    
                    circleDragPoints.appendChild(point);
                    theoremElements.appendChild(label);
                    
                    // Add to active points
                    currentCirclePoints.push(point);
                    
                    // Make draggable
                    point.addEventListener('mousedown', startCirclePointDrag);
                    point.addEventListener('touchstart', startCirclePointDrag, { passive: false });
                }
                
                // Add angle arcs and labels for all four corners
                for (let i = 0; i < 4; i++) {
                    const prev = (i + 3) % 4; // Previous point
                    const curr = i;           // Current point (vertex)
                    const next = (i + 1) % 4; // Next point
                    
                    // Add angle arc
                    const angleArc = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    // Will be updated in the update function
                    angleArc.setAttribute('fill', 'none');
                    angleArc.setAttribute('stroke', '#10B981');
                    angleArc.setAttribute('stroke-width', '2');
                    angleArc.id = `angle-arc-${String.fromCharCode(65 + i)}`;
                    circleAngles.appendChild(angleArc);
                    
                    // Add angle label
                    const angleLabel = document.createElementNS("http://www.w3.org/2000/svg", "text");
                    // Position will be updated in the update function
                    angleLabel.setAttribute('fill', 'currentColor');
                    angleLabel.setAttribute('font-size', '14');
                    angleLabel.setAttribute('font-weight', 'bold');
                    angleLabel.id = `angle-label-${String.fromCharCode(65 + i)}`;
                    circleAngles.appendChild(angleLabel);
                }
                
                // Initial update
                updateCyclicQuadrilateral();
            }
            
            function setupAnglesSameArc() {
                // Clear previous elements
                theoremElements.innerHTML = '';
                circleDragPoints.innerHTML = '';
                circleAngles.innerHTML = '';
                
                // Update theorem info
                document.getElementById('theorem-title').textContent = "Angles in the Same Arc";
                document.getElementById('theorem-description').textContent = 
                    "Angles in the same segment of a circle are equal.";
                
                // Create fixed arc endpoints
                const arcStart = { x: 150, y: 200 }; // A
                const arcEnd = { x: 450, y: 200 };   // B
                
                // Create arc chord
                const chord = document.createElementNS("http://www.w3.org/2000/svg", "line");
                chord.setAttribute('x1', arcStart.x);
                chord.setAttribute('y1', arcStart.y);
                chord.setAttribute('x2', arcEnd.x);
                chord.setAttribute('y2', arcEnd.y);
                chord.setAttribute('stroke', '#5D5CDE');
                chord.setAttribute('stroke-width', '2');
                chord.id = 'chord-ab';
                theoremElements.appendChild(chord);
                
                // Create fixed points A and B
                const pointA = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                pointA.setAttribute('cx', arcStart.x);
                pointA.setAttribute('cy', arcStart.y);
                pointA.setAttribute('r', '8');
                pointA.setAttribute('fill', '#3B82F6');
                theoremElements.appendChild(pointA);
                
                const pointB = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                pointB.setAttribute('cx', arcEnd.x);
                pointB.setAttribute('cy', arcEnd.y);
                pointB.setAttribute('r', '8');
                pointB.setAttribute('fill', '#3B82F6');
                theoremElements.appendChild(pointB);
                
                // Add labels for A and B
                const labelA = document.createElementNS("http://www.w3.org/2000/svg", "text");
                labelA.setAttribute('x', arcStart.x - 15);
                labelA.setAttribute('y', arcStart.y + 5);
                labelA.setAttribute('fill', 'currentColor');
                labelA.setAttribute('font-size', '16');
                labelA.textContent = 'A';
                theoremElements.appendChild(labelA);
                
                const labelB = document.createElementNS("http://www.w3.org/2000/svg", "text");
                labelB.setAttribute('x', arcEnd.x + 15);
                labelB.setAttribute('y', arcEnd.y + 5);
                labelB.setAttribute('fill', 'currentColor');
                labelB.setAttribute('font-size', '16');
                labelB.textContent = 'B';
                theoremElements.appendChild(labelB);
                
                // Create draggable points C and D on the upper semicircle
                const pointC = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                pointC.setAttribute('cx', '250');
                pointC.setAttribute('cy', '100');
                pointC.setAttribute('r', '8');
                pointC.setAttribute('fill', '#EC4899');
                pointC.classList.add('draggable', 'circle-point');
                pointC.id = 'point-c';
                circleDragPoints.appendChild(pointC);
                
                const pointD = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                pointD.setAttribute('cx', '350');
                pointD.setAttribute('cy', '100');
                pointD.setAttribute('r', '8');
                pointD.setAttribute('fill', '#EC4899');
                pointD.classList.add('draggable', 'circle-point');
                pointD.id = 'point-d';
                circleDragPoints.appendChild(pointD);
                
                // Create lines from points to arc endpoints
                const lineAC = document.createElementNS("http://www.w3.org/2000/svg", "line");
                lineAC.setAttribute('x1', arcStart.x);
                lineAC.setAttribute('y1', arcStart.y);
                lineAC.setAttribute('x2', '250');
                lineAC.setAttribute('y2', '100');
                lineAC.setAttribute('stroke', '#10B981');
                lineAC.setAttribute('stroke-width', '2');
                lineAC.id = 'line-ac';
                theoremElements.appendChild(lineAC);
                
                const lineBC = document.createElementNS("http://www.w3.org/2000/svg", "line");
                lineBC.setAttribute('x1', arcEnd.x);
                lineBC.setAttribute('y1', arcEnd.y);
                lineBC.setAttribute('x2', '250');
                lineBC.setAttribute('y2', '100');
                lineBC.setAttribute('stroke', '#10B981');
                lineBC.setAttribute('stroke-width', '2');
                lineBC.id = 'line-bc';
                theoremElements.appendChild(lineBC);
                
                const lineAD = document.createElementNS("http://www.w3.org/2000/svg", "line");
                lineAD.setAttribute('x1', arcStart.x);
                lineAD.setAttribute('y1', arcStart.y);
                lineAD.setAttribute('x2', '350');
                lineAD.setAttribute('y2', '100');
                lineAD.setAttribute('stroke', '#F59E0B');
                lineAD.setAttribute('stroke-width', '2');
                lineAD.id = 'line-ad';
                theoremElements.appendChild(lineAD);
                
                const lineBD = document.createElementNS("http://www.w3.org/2000/svg", "line");
                lineBD.setAttribute('x1', arcEnd.x);
                lineBD.setAttribute('y1', arcEnd.y);
                lineBD.setAttribute('x2', '350');
                lineBD.setAttribute('y2', '100');
                lineBD.setAttribute('stroke', '#F59E0B');
                lineBD.setAttribute('stroke-width', '2');
                lineBD.id = 'line-bd';
                theoremElements.appendChild(lineBD);
                
                // Add labels for C and D
                const labelC = document.createElementNS("http://www.w3.org/2000/svg", "text");
                labelC.setAttribute('x', '250');
                labelC.setAttribute('y', '90');
                labelC.setAttribute('fill', 'currentColor');
                labelC.setAttribute('font-size', '16');
                labelC.textContent = 'C';
                labelC.id = 'label-c';
                theoremElements.appendChild(labelC);
                
                const labelD = document.createElementNS("http://www.w3.org/2000/svg", "text");
                labelD.setAttribute('x', '350');
                labelD.setAttribute('y', '90');
                labelD.setAttribute('fill', 'currentColor');
                labelD.setAttribute('font-size', '16');
                labelD.textContent = 'D';
                labelD.id = 'label-d';
                theoremElements.appendChild(labelD);
                
                // Add angle arcs and labels
                const angleArcC = document.createElementNS("http://www.w3.org/2000/svg", "path");
                angleArcC.setAttribute('fill', 'none');
                angleArcC.setAttribute('stroke', '#10B981');
                angleArcC.setAttribute('stroke-width', '2');
                angleArcC.id = 'angle-arc-c';
                circleAngles.appendChild(angleArcC);
                
                const angleLabelC = document.createElementNS("http://www.w3.org/2000/svg", "text");
                angleLabelC.setAttribute('fill', 'currentColor');
                angleLabelC.setAttribute('font-size', '14');
                angleLabelC.setAttribute('font-weight', 'bold');
                angleLabelC.id = 'angle-label-c';
                circleAngles.appendChild(angleLabelC);
                
                const angleArcD = document.createElementNS("http://www.w3.org/2000/svg", "path");
                angleArcD.setAttribute('fill', 'none');
                angleArcD.setAttribute('stroke', '#F59E0B');
                angleArcD.setAttribute('stroke-width', '2');
                angleArcD.id = 'angle-arc-d';
                circleAngles.appendChild(angleArcD);
                
                const angleLabelD = document.createElementNS("http://www.w3.org/2000/svg", "text");
                angleLabelD.setAttribute('fill', 'currentColor');
                angleLabelD.setAttribute('font-size', '14');
                angleLabelD.setAttribute('font-weight', 'bold');
                angleLabelD.id = 'angle-label-d';
                circleAngles.appendChild(angleLabelD);
                
                // Store current points for dragging
                currentCirclePoints = [pointC, pointD];
                
                // Make points draggable
                pointC.addEventListener('mousedown', startCirclePointDrag);
                pointC.addEventListener('touchstart', startCirclePointDrag, { passive: false });
                pointD.addEventListener('mousedown', startCirclePointDrag);
                pointD.addEventListener('touchstart', startCirclePointDrag, { passive: false });
                
                // Initial update
                updateAnglesSameArc();
            }
            
            function setupAngleAtCenter() {
                // Clear previous elements
                theoremElements.innerHTML = '';
                circleDragPoints.innerHTML = '';
                circleAngles.innerHTML = '';
                
                // Update theorem info
                document.getElementById('theorem-title').textContent = "Angle at Center";
                document.getElementById('theorem-description').textContent = 
                    "The angle at the center is twice the angle at the circumference when they both subtend the same arc.";
                
                // Create center point O
                const centerPoint = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                centerPoint.setAttribute('cx', '300');
                centerPoint.setAttribute('cy', '200');
                centerPoint.setAttribute('r', '8');
                centerPoint.setAttribute('fill', '#3B82F6');
                theoremElements.appendChild(centerPoint);
                
                // Create arc endpoints A and B
                const pointA = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                pointA.setAttribute('cx', '450');
                pointA.setAttribute('cy', '200');
                pointA.setAttribute('r', '8');
                pointA.setAttribute('fill', '#EC4899');
                pointA.classList.add('draggable', 'circle-point');
                pointA.id = 'point-a';
                circleDragPoints.appendChild(pointA);
                
                const pointB = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                pointB.setAttribute('cx', '375');
                pointB.setAttribute('cy', '325');
                pointB.setAttribute('r', '8');
                pointB.setAttribute('fill', '#EC4899');
                pointB.classList.add('draggable', 'circle-point');
                pointB.id = 'point-b';
                circleDragPoints.appendChild(pointB);
                
                // Create point P on the circumference for comparison
                const pointP = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                pointP.setAttribute('cx', '150');
                pointP.setAttribute('cy', '200');
                pointP.setAttribute('r', '8');
                pointP.setAttribute('fill', '#EC4899');
                pointP.classList.add('draggable', 'circle-point');
                pointP.id = 'point-p';
                circleDragPoints.appendChild(pointP);
                
                // Create lines from center to points
                const lineOA = document.createElementNS("http://www.w3.org/2000/svg", "line");
                lineOA.setAttribute('x1', '300');
                lineOA.setAttribute('y1', '200');
                lineOA.setAttribute('x2', '450');
                lineOA.setAttribute('y2', '200');
                lineOA.setAttribute('stroke', '#10B981');
                lineOA.setAttribute('stroke-width', '2');
                lineOA.id = 'line-oa';
                theoremElements.appendChild(lineOA);
                
                const lineOB = document.createElementNS("http://www.w3.org/2000/svg", "line");
                lineOB.setAttribute('x1', '300');
                lineOB.setAttribute('y1', '200');
                lineOB.setAttribute('x2', '375');
                lineOB.setAttribute('y2', '325');
                lineOB.setAttribute('stroke', '#10B981');
                lineOB.setAttribute('stroke-width', '2');
                lineOB.id = 'line-ob';
                theoremElements.appendChild(lineOB);
                
                // Create lines from P to A and B
                const linePA = document.createElementNS("http://www.w3.org/2000/svg", "line");
                linePA.setAttribute('x1', '150');
                linePA.setAttribute('y1', '200');
                linePA.setAttribute('x2', '450');
                linePA.setAttribute('y2', '200');
                linePA.setAttribute('stroke', '#F59E0B');
                linePA.setAttribute('stroke-width', '2');
                linePA.id = 'line-pa';
                theoremElements.appendChild(linePA);
                
                const linePB = document.createElementNS("http://www.w3.org/2000/svg", "line");
                linePB.setAttribute('x1', '150');
                linePB.setAttribute('y1', '200');
                linePB.setAttribute('x2', '375');
                linePB.setAttribute('y2', '325');
                linePB.setAttribute('stroke', '#F59E0B');
                linePB.setAttribute('stroke-width', '2');
                linePB.id = 'line-pb';
                theoremElements.appendChild(linePB);
                
                // Add labels
                const labelO = document.createElementNS("http://www.w3.org/2000/svg", "text");
                labelO.setAttribute('x', '290');
                labelO.setAttribute('y', '190');
                labelO.setAttribute('fill', 'currentColor');
                labelO.setAttribute('font-size', '16');
                labelO.textContent = 'O';
                theoremElements.appendChild(labelO);
                
                const labelA = document.createElementNS("http://www.w3.org/2000/svg", "text");
                labelA.setAttribute('x', '460');
                labelA.setAttribute('y', '205');
                labelA.setAttribute('fill', 'currentColor');
                labelA.setAttribute('font-size', '16');
                labelA.textContent = 'A';
                labelA.id = 'label-a';
                theoremElements.appendChild(labelA);
                
                const labelB = document.createElementNS("http://www.w3.org/2000/svg", "text");
                labelB.setAttribute('x', '385');
                labelB.setAttribute('y', '335');
                labelB.setAttribute('fill', 'currentColor');
                labelB.setAttribute('font-size', '16');
                labelB.textContent = 'B';
                labelB.id = 'label-b';
                theoremElements.appendChild(labelB);
                
                const labelP = document.createElementNS("http://www.w3.org/2000/svg", "text");
                labelP.setAttribute('x', '140');
                labelP.setAttribute('y', '205');
                labelP.setAttribute('fill', 'currentColor');
                labelP.setAttribute('font-size', '16');
                labelP.textContent = 'P';
                labelP.id = 'label-p';
                theoremElements.appendChild(labelP);
                
                // Add angle arcs and labels for center angle
                const angleArcO = document.createElementNS("http://www.w3.org/2000/svg", "path");
                angleArcO.setAttribute('fill', 'none');
                angleArcO.setAttribute('stroke', '#10B981');
                angleArcO.setAttribute('stroke-width', '2');
                angleArcO.id = 'angle-arc-o';
                circleAngles.appendChild(angleArcO);
                
                const angleLabelO = document.createElementNS("http://www.w3.org/2000/svg", "text");
                angleLabelO.setAttribute('fill', 'currentColor');
                angleLabelO.setAttribute('font-size', '14');
                angleLabelO.setAttribute('font-weight', 'bold');
                angleLabelO.id = 'angle-label-o';
                circleAngles.appendChild(angleLabelO);
                
                // Add angle arcs and labels for circumference angle
                const angleArcP = document.createElementNS("http://www.w3.org/2000/svg", "path");
                angleArcP.setAttribute('fill', 'none');
                angleArcP.setAttribute('stroke', '#F59E0B');
                angleArcP.setAttribute('stroke-width', '2');
                angleArcP.id = 'angle-arc-p';
                circleAngles.appendChild(angleArcP);
                
                const angleLabelP = document.createElementNS("http://www.w3.org/2000/svg", "text");
                angleLabelP.setAttribute('fill', 'currentColor');
                angleLabelP.setAttribute('font-size', '14');
                angleLabelP.setAttribute('font-weight', 'bold');
                angleLabelP.id = 'angle-label-p';
                circleAngles.appendChild(angleLabelP);
                
                // Add relationship text
                const relationText = document.createElementNS("http://www.w3.org/2000/svg", "text");
                relationText.setAttribute('x', '300');
                relationText.setAttribute('y', '30');
                relationText.setAttribute('text-anchor', 'middle');
                relationText.setAttribute('fill', 'currentColor');
                relationText.setAttribute('font-size', '16');
                relationText.setAttribute('font-weight', 'bold');
                relationText.id = 'relation-text';
                circleAngles.appendChild(relationText);
                
                // Store current points for dragging
                currentCirclePoints = [pointA, pointB, pointP];
                
                // Make points draggable
                pointA.addEventListener('mousedown', startCirclePointDrag);
                pointA.addEventListener('touchstart', startCirclePointDrag, { passive: false });
                pointB.addEventListener('mousedown', startCirclePointDrag);
                pointB.addEventListener('touchstart', startCirclePointDrag, { passive: false });
                pointP.addEventListener('mousedown', startCirclePointDrag);
                pointP.addEventListener('touchstart', startCirclePointDrag, { passive: false });
                
                // Initial update
                updateAngleAtCenter();
            }
            
            // Dragging functions for circle points
            function startCirclePointDrag(e) {
                isDragging = true;
                selectedPoint = this;
                selectedPoint.setAttribute('r', '10'); // Enlarge the point when dragging
                playSound('click-sound');
                
                // Prevent default touch behavior
                if (e.type === 'touchstart') {
                    e.preventDefault();
                }
                
                e.stopPropagation();
            }
            
            document.addEventListener('mousemove', dragCirclePoint);
            document.addEventListener('touchmove', dragCirclePoint, { passive: false });
            document.addEventListener('mouseup', endCirclePointDrag);
            document.addEventListener('touchend', endCirclePointDrag);
            
            function dragCirclePoint(e) {
                if (!isDragging || !selectedPoint || !selectedPoint.classList.contains('circle-point')) return;
                
                // Prevent default touch behavior
                if (e.type === 'touchmove') {
                    e.preventDefault();
                }
                
                // Get mouse/touch position relative to SVG
                const svgRect = circleSvg.getBoundingClientRect();
                let clientX, clientY;
                
                if (e.type === 'touchmove') {
                    clientX = e.touches[0].clientX;
                    clientY = e.touches[0].clientY;
                } else {
                    clientX = e.clientX;
                    clientY = e.clientY;
                }
                
                const x = clientX - svgRect.left;
                const y = clientY - svgRect.top;
                
                // Circle center and radius
                const centerX = 300;
                const centerY = 200;
                const radius = 150;
                
                // Calculate angle from center to mouse position
                const dx = x - centerX;
                const dy = y - centerY;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                // Project point onto circle
                const scaleFactor = radius / distance;
                const circleX = centerX + dx * scaleFactor;
                const circleY = centerY + dy * scaleFactor;
                
                // Update point position
                selectedPoint.setAttribute('cx', circleX);
                selectedPoint.setAttribute('cy', circleY);
                
                // Update the theorem visuals based on the active theorem
                if (document.getElementById('theorem-title').textContent === "Angle in a Semicircle") {
                    updateAngleInSemicircle();
                } else if (document.getElementById('theorem-title').textContent === "Cyclic Quadrilateral") {
                    updateCyclicQuadrilateral();
                } else if (document.getElementById('theorem-title').textContent === "Angles in the Same Arc") {
                    updateAnglesSameArc();
                } else if (document.getElementById('theorem-title').textContent === "Angle at Center") {
                    updateAngleAtCenter();
                }
                
                // Play soft sound during drag occasionally
                if (Math.random() < 0.1) {
                    playSound('drag-sound');
                }
            }
            
            function endCirclePointDrag() {
                if (isDragging && selectedPoint && selectedPoint.classList.contains('circle-point')) {
                    selectedPoint.setAttribute('r', '8'); // Reset point size
                    
                    // Final update with sound
                    if (document.getElementById('theorem-title').textContent === "Angle in a Semicircle") {
                        updateAngleInSemicircle(true);
                    } else if (document.getElementById('theorem-title').textContent === "Cyclic Quadrilateral") {
                        updateCyclicQuadrilateral(true);
                    } else if (document.getElementById('theorem-title').textContent === "Angles in the Same Arc") {
                        updateAnglesSameArc(true);
                    } else if (document.getElementById('theorem-title').textContent === "Angle at Center") {
                        updateAngleAtCenter(true);
                    }
                    
                    selectedPoint = null;
                    isDragging = false;
                }
            }
            
            // Update functions for each theorem
            function updateAngleInSemicircle(playSound = false) {
                const pointC = document.getElementById('point-c');
                const lineAC = document.getElementById('line-ac');
                const lineBC = document.getElementById('line-bc');
                const labelC = document.getElementById('label-c');
                const angleArc = document.getElementById('angle-arc');
                const angleLabel = document.getElementById('angle-label');
                
                const cx = parseFloat(pointC.getAttribute('cx'));
                const cy = parseFloat(pointC.getAttribute('cy'));
                
                // Update lines
                lineAC.setAttribute('x2', cx);
                lineAC.setAttribute('y2', cy);
                lineBC.setAttribute('x2', cx);
                lineBC.setAttribute('y2', cy);
                
                // Update label position
                labelC.setAttribute('x', cx);
                labelC.setAttribute('y', cy - 10);
                
                // Calculate angle
                const ax = 150, ay = 200; // Point A coordinates
                const bx = 450, by = 200; // Point B coordinates
                
                // Calculate vectors
                const v1x = ax - cx;
                const v1y = ay - cy;
                const v2x = bx - cx;
                const v2y = by - cy;
                
                // Calculate dot product
                const dotProduct = v1x * v2x + v1y * v2y;
                
                // Calculate magnitudes
                const mag1 = Math.sqrt(v1x * v1x + v1y * v1y);
                const mag2 = Math.sqrt(v2x * v2x + v2y * v2y);
                
                // Calculate angle in radians
                const angleRad = Math.acos(dotProduct / (mag1 * mag2));
                
                // Convert to degrees
                const angleDeg = Math.round(angleRad * 180 / Math.PI);
                
                // Update angle display
                angleLabel.textContent = angleDeg + '°';
                
                // Update angle arc path
                const radius = 20;
                const startAngle = Math.atan2(v1y, v1x);
                const endAngle = Math.atan2(v2y, v2x);
                
                // Calculate start and end points for the arc
                const startX = cx + radius * Math.cos(startAngle);
                const startY = cy + radius * Math.sin(startAngle);
                const endX = cx + radius * Math.cos(endAngle);
                const endY = cy + radius * Math.sin(endAngle);
                
                // Determine sweep flag
                const sweep = 1; // For interior angle
                
                // Create arc path
                const arcPath = `M ${startX},${startY} A ${radius},${radius} 0 0,${sweep} ${endX},${endY}`;
                angleArc.setAttribute('d', arcPath);
                
                // Position angle label
                const midAngle = (startAngle + endAngle) / 2;
                const labelRadius = radius + 15;
                const labelX = cx + labelRadius * Math.cos(midAngle);
                const labelY = cy + labelRadius * Math.sin(midAngle);
                
                angleLabel.setAttribute('x', labelX);
                angleLabel.setAttribute('y', labelY);
                
                // Highlight if angle is close to 90 degrees
                if (Math.abs(angleDeg - 90) < 3) {
                    angleLabel.setAttribute('fill', '#10B981');
                    if (playSound) {
                        window.playSound('success-sound');
                    }
                } else {
                    angleLabel.setAttribute('fill', 'currentColor');
                }
            }
            
            function updateCyclicQuadrilateral(playSound = false) {
                // Get all four points
                const points = [];
                for (let i = 0; i < 4; i++) {
                    const point = document.getElementById(`point-${String.fromCharCode(65 + i)}`);
                    points.push({
                        x: parseFloat(point.getAttribute('cx')),
                        y: parseFloat(point.getAttribute('cy'))
                    });
                }
                
                // Update polygon
                const quadShape = document.getElementById('quad-shape');
                quadShape.setAttribute('points', points.map(p => `${p.x},${p.y}`).join(' '));
                
                // Update labels
                for (let i = 0; i < 4; i++) {
                    const label = document.getElementById(`label-${String.fromCharCode(65 + i)}`);
                    const offsetX = i === 1 ? 15 : i === 3 ? -15 : 0;
                    const offsetY = i === 0 ? -10 : i === 2 ? 20 : 5;
                    label.setAttribute('x', points[i].x + offsetX);
                    label.setAttribute('y', points[i].y + offsetY);
                }
                
                // Calculate and update angles for all four vertices
                const angles = [];
                for (let i = 0; i < 4; i++) {
                    const prev = (i + 3) % 4; // Previous point
                    const curr = i;           // Current point (vertex)
                    const next = (i + 1) % 4; // Next point
                    
                    // Calculate vectors
                    const v1x = points[prev].x - points[curr].x;
                    const v1y = points[prev].y - points[curr].y;
                    const v2x = points[next].x - points[curr].x;
                    const v2y = points[next].y - points[curr].y;
                    
                    // Calculate dot product
                    const dotProduct = v1x * v2x + v1y * v2y;
                    
                    // Calculate magnitudes
                    const mag1 = Math.sqrt(v1x * v1x + v1y * v1y);
                    const mag2 = Math.sqrt(v2x * v2x + v2y * v2y);
                    
                    // Calculate angle in radians
                    const cosAngle = dotProduct / (mag1 * mag2);
                    const angleRad = Math.acos(Math.max(-1, Math.min(1, cosAngle))); // Clamp to avoid numerical issues
                    
                    // Convert to degrees
                    const angleDeg = Math.round(angleRad * 180 / Math.PI);
                    angles.push(angleDeg);
                    
                    // Update angle arc
                    const angleArc = document.getElementById(`angle-arc-${String.fromCharCode(65 + i)}`);
                    const angleLabel = document.getElementById(`angle-label-${String.fromCharCode(65 + i)}`);
                    
                    // Calculate start and end angles
                    const startAngle = Math.atan2(v1y, v1x);
                    const endAngle = Math.atan2(v2y, v2x);
                    
                    // Draw angle arc
                    const radius = 20;
                    const startX = points[curr].x + radius * Math.cos(startAngle);
                    const startY = points[curr].y + radius * Math.sin(startAngle);
                    const endX = points[curr].x + radius * Math.cos(endAngle);
                    const endY = points[curr].y + radius * Math.sin(endAngle);
                    
                    // Determine sweep flag for interior angle
                    const sweep = 1; // For interior angle
                    
                    // Create arc path
                    const arcPath = `M ${startX},${startY} A ${radius},${radius} 0 0,${sweep} ${endX},${endY}`;
                    angleArc.setAttribute('d', arcPath);
                    
                    // Position angle label
                    const midAngle = (startAngle + endAngle) / 2;
                    const labelRadius = radius + 15;
                    const labelX = points[curr].x + labelRadius * Math.cos(midAngle);
                    const labelY = points[curr].y + labelRadius * Math.sin(midAngle);
                    
                    angleLabel.setAttribute('x', labelX);
                    angleLabel.setAttribute('y', labelY);
                    angleLabel.textContent = angleDeg + '°';
                }
                
                // Check if opposite angles sum to 180° (with tolerance)
                const oppositeSumA = angles[0] + angles[2];
                const oppositeSumB = angles[1] + angles[3];
                
                // Highlight if property holds
                if (Math.abs(oppositeSumA - 180) < 5 && Math.abs(oppositeSumB - 180) < 5) {
                    document.getElementById('angle-label-A').setAttribute('fill', '#10B981');
                    document.getElementById('angle-label-C').setAttribute('fill', '#10B981');
                    document.getElementById('angle-label-B').setAttribute('fill', '#10B981');
                    document.getElementById('angle-label-D').setAttribute('fill', '#10B981');
                    
                    if (playSound) {
                        window.playSound('success-sound');
                    }
                } else {
                    document.getElementById('angle-label-A').setAttribute('fill', 'currentColor');
                    document.getElementById('angle-label-C').setAttribute('fill', 'currentColor');
                    document.getElementById('angle-label-B').setAttribute('fill', 'currentColor');
                    document.getElementById('angle-label-D').setAttribute('fill', 'currentColor');
                }
            }
            
            function updateAnglesSameArc(playSound = false) {
                // Fixed points
                const pointA = { x: 150, y: 200 };
                const pointB = { x: 450, y: 200 };
                
                // Get movable points
                const pointC = document.getElementById('point-c');
                const pointD = document.getElementById('point-d');
                
                const cx = parseFloat(pointC.getAttribute('cx'));
                const cy = parseFloat(pointC.getAttribute('cy'));
                const dx = parseFloat(pointD.getAttribute('cx'));
                const dy = parseFloat(pointD.getAttribute('cy'));
                
                // Update lines
                const lineAC = document.getElementById('line-ac');
                const lineBC = document.getElementById('line-bc');
                const lineAD = document.getElementById('line-ad');
                const lineBD = document.getElementById('line-bd');
                
                lineAC.setAttribute('x2', cx);
                lineAC.setAttribute('y2', cy);
                lineBC.setAttribute('x2', cx);
                lineBC.setAttribute('y2', cy);
                lineAD.setAttribute('x2', dx);
                lineAD.setAttribute('y2', dy);
                lineBD.setAttribute('x2', dx);
                lineBD.setAttribute('y2', dy);
                
                // Update labels
                const labelC = document.getElementById('label-c');
                const labelD = document.getElementById('label-d');
                
                labelC.setAttribute('x', cx);
                labelC.setAttribute('y', cy - 10);
                labelD.setAttribute('x', dx);
                labelD.setAttribute('y', dy - 10);
                
                // Calculate angle at C
                const v1cx = pointA.x - cx;
                const v1cy = pointA.y - cy;
                const v2cx = pointB.x - cx;
                const v2cy = pointB.y - cy;
                
                const dotC = v1cx * v2cx + v1cy * v2cy;
                const magC1 = Math.sqrt(v1cx * v1cx + v1cy * v1cy);
                const magC2 = Math.sqrt(v2cx * v2cx + v2cy * v2cy);
                
                const angleRadC = Math.acos(dotC / (magC1 * magC2));
                const angleDegC = Math.round(angleRadC * 180 / Math.PI);
                
                // Calculate angle at D
                const v1dx = pointA.x - dx;
                const v1dy = pointA.y - dy;
                const v2dx = pointB.x - dx;
                const v2dy = pointB.y - dy;
                
                const dotD = v1dx * v2dx + v1dy * v2dy;
                const magD1 = Math.sqrt(v1dx * v1dx + v1dy * v1dy);
                const magD2 = Math.sqrt(v2dx * v2dx + v2dy * v2dy);
                
                const angleRadD = Math.acos(dotD / (magD1 * magD2));
                const angleDegD = Math.round(angleRadD * 180 / Math.PI);
                
                // Update angle arcs and labels
                const angleArcC = document.getElementById('angle-arc-c');
                const angleLabelC = document.getElementById('angle-label-c');
                const angleArcD = document.getElementById('angle-arc-d');
                const angleLabelD = document.getElementById('angle-label-d');
                
                // Angle arc for C
                const radiusC = 20;
                const startAngleC = Math.atan2(v1cy, v1cx);
                const endAngleC = Math.atan2(v2cy, v2cx);
                
                const startXC = cx + radiusC * Math.cos(startAngleC);
                const startYC = cy + radiusC * Math.sin(startAngleC);
                const endXC = cx + radiusC * Math.cos(endAngleC);
                const endYC = cy + radiusC * Math.sin(endAngleC);
                
                const sweepC = 1; // For interior angle
                const arcPathC = `M ${startXC},${startYC} A ${radiusC},${radiusC} 0 0,${sweepC} ${endXC},${endYC}`;
                angleArcC.setAttribute('d', arcPathC);
                
                // Position angle label C
                const midAngleC = (startAngleC + endAngleC) / 2;
                const labelRadiusC = radiusC + 15;
                const labelXC = cx + labelRadiusC * Math.cos(midAngleC);
                const labelYC = cy + labelRadiusC * Math.sin(midAngleC);
                
                angleLabelC.setAttribute('x', labelXC);
                angleLabelC.setAttribute('y', labelYC);
                angleLabelC.textContent = angleDegC + '°';
                
                // Angle arc for D
                const radiusD = 20;
                const startAngleD = Math.atan2(v1dy, v1dx);
                const endAngleD = Math.atan2(v2dy, v2dx);
                
                const startXD = dx + radiusD * Math.cos(startAngleD);
                const startYD = dy + radiusD * Math.sin(startAngleD);
                const endXD = dx + radiusD * Math.cos(endAngleD);
                const endYD = dy + radiusD * Math.sin(endAngleD);
                
                const sweepD = 1; // For interior angle
                const arcPathD = `M ${startXD},${startYD} A ${radiusD},${radiusD} 0 0,${sweepD} ${endXD},${endYD}`;
                angleArcD.setAttribute('d', arcPathD);
                
                // Position angle label D
                const midAngleD = (startAngleD + endAngleD) / 2;
                const labelRadiusD = radiusD + 15;
                const labelXD = dx + labelRadiusD * Math.cos(midAngleD);
                const labelYD = dy + labelRadiusD * Math.sin(midAngleD);
                
                angleLabelD.setAttribute('x', labelXD);
                angleLabelD.setAttribute('y', labelYD);
                angleLabelD.textContent = angleDegD + '°';
                
                // Highlight if angles are approximately equal
                if (Math.abs(angleDegC - angleDegD) < 3) {
                    angleLabelC.setAttribute('fill', '#10B981');
                    angleLabelD.setAttribute('fill', '#10B981');
                    
                    if (playSound) {
                        window.playSound('success-sound');
                    }
                } else {
                    angleLabelC.setAttribute('fill', 'currentColor');
                    angleLabelD.setAttribute('fill', 'currentColor');
                }
            }
            
            function updateAngleAtCenter(playSound = false) {
                const center = { x: 300, y: 200 };
                
                // Get movable points
                const pointA = document.getElementById('point-a');
                const pointB = document.getElementById('point-b');
                const pointP = document.getElementById('point-p');
                
                const ax = parseFloat(pointA.getAttribute('cx'));
                const ay = parseFloat(pointA.getAttribute('cy'));
                const bx = parseFloat(pointB.getAttribute('cx'));
                const by = parseFloat(pointB.getAttribute('cy'));
                const px = parseFloat(pointP.getAttribute('cx'));
                const py = parseFloat(pointP.getAttribute('cy'));
                
                // Update lines
                const lineOA = document.getElementById('line-oa');
                const lineOB = document.getElementById('line-ob');
                const linePA = document.getElementById('line-pa');
                const linePB = document.getElementById('line-pb');
                
                lineOA.setAttribute('x2', ax);
                lineOA.setAttribute('y2', ay);
                lineOB.setAttribute('x2', bx);
                lineOB.setAttribute('y2', by);
                linePA.setAttribute('x1', px);
                linePA.setAttribute('y1', py);
                linePA.setAttribute('x2', ax);
                linePA.setAttribute('y2', ay);
                linePB.setAttribute('x1', px);
                linePB.setAttribute('y1', py);
                linePB.setAttribute('x2', bx);
                linePB.setAttribute('y2', by);
                
                // Update labels
                const labelA = document.getElementById('label-a');
                const labelB = document.getElementById('label-b');
                const labelP = document.getElementById('label-p');
                
                labelA.setAttribute('x', ax + 10);
                labelA.setAttribute('y', ay + 5);
                labelB.setAttribute('x', bx + 10);
                labelB.setAttribute('y', by + 5);
                labelP.setAttribute('x', px - 15);
                labelP.setAttribute('y', py + 5);
                
                // Calculate angle at center O
                const v1ox = ax - center.x;
                const v1oy = ay - center.y;
                const v2ox = bx - center.x;
                const v2oy = by - center.y;
                
                const dotO = v1ox * v2ox + v1oy * v2oy;
                const magO1 = Math.sqrt(v1ox * v1ox + v1oy * v1oy);
                const magO2 = Math.sqrt(v2ox * v2ox + v2oy * v2oy);
                
                const angleRadO = Math.acos(dotO / (magO1 * magO2));
                const angleDegO = Math.round(angleRadO * 180 / Math.PI);
                
                // Calculate angle at circumference point P
                const v1px = ax - px;
                const v1py = ay - py;
                const v2px = bx - px;
                const v2py = by - py;
                
                const dotP = v1px * v2px + v1py * v2py;
                const magP1 = Math.sqrt(v1px * v1px + v1py * v1py);
                const magP2 = Math.sqrt(v2px * v2px + v2py * v2py);
                
                const angleRadP = Math.acos(dotP / (magP1 * magP2));
                const angleDegP = Math.round(angleRadP * 180 / Math.PI);
                
                // Update angle arcs and labels
                const angleArcO = document.getElementById('angle-arc-o');
                const angleLabelO = document.getElementById('angle-label-o');
                const angleArcP = document.getElementById('angle-arc-p');
                const angleLabelP = document.getElementById('angle-label-p');
                const relationText = document.getElementById('relation-text');
                
                // Angle arc for O
                const radiusO = 25;
                const startAngleO = Math.atan2(v1oy, v1ox);
                const endAngleO = Math.atan2(v2oy, v2ox);
                
                const startXO = center.x + radiusO * Math.cos(startAngleO);
                const startYO = center.y + radiusO * Math.sin(startAngleO);
                const endXO = center.x + radiusO * Math.cos(endAngleO);
                const endYO = center.y + radiusO * Math.sin(endAngleO);
                
                const sweepO = 1; // For interior angle
                const arcPathO = `M ${startXO},${startYO} A ${radiusO},${radiusO} 0 0,${sweepO} ${endXO},${endYO}`;
                angleArcO.setAttribute('d', arcPathO);
                
                // Position angle label O
                const midAngleO = (startAngleO + endAngleO) / 2;
                const labelRadiusO = radiusO + 15;
                const labelXO = center.x + labelRadiusO * Math.cos(midAngleO);
                const labelYO = center.y + labelRadiusO * Math.sin(midAngleO);
                
                angleLabelO.setAttribute('x', labelXO);
                angleLabelO.setAttribute('y', labelYO);
                angleLabelO.textContent = angleDegO + '°';
                
                // Angle arc for P
                const radiusP = 20;
                const startAngleP = Math.atan2(v1py, v1px);
                const endAngleP = Math.atan2(v2py, v2px);
                
                const startXP = px + radiusP * Math.cos(startAngleP);
                const startYP = py + radiusP * Math.sin(startAngleP);
                const endXP = px + radiusP * Math.cos(endAngleP);
                const endYP = py + radiusP * Math.sin(endAngleP);
                
                const sweepP = 1; // For interior angle
                const arcPathP = `M ${startXP},${startYP} A ${radiusP},${radiusP} 0 0,${sweepP} ${endXP},${endYP}`;
                angleArcP.setAttribute('d', arcPathP);
                
                // Position angle label P
                const midAngleP = (startAngleP + endAngleP) / 2;
                const labelRadiusP = radiusP + 15;
                const labelXP = px + labelRadiusP * Math.cos(midAngleP);
                const labelYP = py + labelRadiusP * Math.sin(midAngleP);
                
                angleLabelP.setAttribute('x', labelXP);
                angleLabelP.setAttribute('y', labelYP);
                angleLabelP.textContent = angleDegP + '°';
                
                // Update relationship text and highlight if theorem holds
                relationText.textContent = `Angle at center (${angleDegO}°) ≈ 2 × Angle at circumference (${angleDegP}°)`;
                
                if (Math.abs(angleDegO - 2 * angleDegP) < 5) {
                    angleLabelO.setAttribute('fill', '#10B981');
                    angleLabelP.setAttribute('fill', '#10B981');
                    relationText.setAttribute('fill', '#10B981');
                    
                    if (playSound) {
                        window.playSound('success-sound');
                    }
                } else {
                    angleLabelO.setAttribute('fill', 'currentColor');
                    angleLabelP.setAttribute('fill', 'currentColor');
                    relationText.setAttribute('fill', 'currentColor');
                }
            }
            
            // Circle Theorem Angle Calculator
            document.getElementById('btn-calculate-angle').addEventListener('click', function() {
                const knownAngle = parseFloat(document.getElementById('angle-input').value);
                const theorem = document.getElementById('theorem-select').value;
                const resultElement = document.getElementById('result-value');
                const resultDisplay = document.getElementById('calculation-result');
                
                if (isNaN(knownAngle)) {
                    alert('Please enter a valid angle value.');
                    return;
                }
                
                let result;
                
                switch (theorem) {
                    case 'semicircle':
                        result = 90;
                        break;
                    case 'cyclic':
                        result = 180 - knownAngle;
                        break;
                    case 'same-arc':
                        result = knownAngle;
                        break;
                    case 'center':
                        result = knownAngle / 2;
                        break;
                    default:
                        result = 0;
                }
                
                resultValue.textContent = result + '°';
                resultDisplay.classList.remove('hidden');
                playSound('success-sound');
            });
            
            // Circle Theorem Challenge
            const circleTheorems = [
                {
                    title: "Angle in a Semicircle",
                    question: "If angle BAC is inscribed in a semicircle, what is the measure of the angle?",
                    answers: [
                        { value: 45, text: "45°" },
                        { value: 60, text: "60°" },
                        { value: 90, text: "90°" },
                        { value: 180, text: "180°" }
                    ],
                    correctAnswer: 90,
                    explanation: "The angle inscribed in a semicircle is always a right angle (90°)."
                },
                {
                    title: "Cyclic Quadrilateral",
                    question: "In a cyclic quadrilateral, if one angle is 70°, what is the measure of the opposite angle?",
                    answers: [
                        { value: 70, text: "70°" },
                        { value: 110, text: "110°" },
                        { value: 180, text: "180°" },
                        { value: 290, text: "290°" }
                    ],
                    correctAnswer: 110,
                    explanation: "Opposite angles in a cyclic quadrilateral are supplementary, meaning they sum to 180°. So 180° - 70° = 110°."
                },
                {
                    title: "Angles in Same Arc",
                    question: "If two angles are inscribed in the same arc of a circle and one measures 35°, what is the measure of the other angle?",
                    answers: [
                        { value: 35, text: "35°" },
                        { value: 55, text: "55°" },
                        { value: 145, text: "145°" },
                        { value: 180, text: "180°" }
                    ],
                    correctAnswer: 35,
                    explanation: "Angles in the same segment of a circle are equal. Therefore, both angles measure 35°."
                },
                {
                    title: "Angle at Center",
                    question: "If an angle at the center of a circle is 120°, what is the measure of the corresponding angle at the circumference?",
                    answers: [
                        { value: 30, text: "30°" },
                        { value: 60, text: "60°" },
                        { value: 90, text: "90°" },
                        { value: 120, text: "120°" }
                    ],
                    correctAnswer: 60,
                    explanation: "The angle at the center is twice the angle at the circumference when they subtend the same arc. So 120° ÷ 2 = 60°."
                }
            ];
            
            let currentCircleChallenge = 0;
            
            function setCircleChallenge(index) {
                const challenge = circleTheorems[index];
                
                // Update question
                document.getElementById('circle-challenge-question').innerHTML = `
                    <p class="font-medium">${challenge.title}</p>
                    <p class="mt-2">${challenge.question}</p>
                `;
                
                // Update answer buttons
                const answerButtons = document.querySelectorAll('.circle-answer');
                challenge.answers.forEach((answer, i) => {
                    answerButtons[i].textContent = answer.text;
                    answerButtons[i].dataset.value = answer.value;
                });
                
                // Hide feedback and next button
                document.getElementById('circle-challenge-feedback').classList.add('hidden');
                document.getElementById('btn-next-circle-challenge').classList.add('hidden');
                
                // Setup the corresponding theorem visual
                switch (challenge.title) {
                    case "Angle in a Semicircle":
                        btnAngleSemicircle.click();
                        break;
                    case "Cyclic Quadrilateral":
                        btnCyclicQuadrilateral.click();
                        break;
                    case "Angles in Same Arc":
                        btnAnglesSameArc.click();
                        break;
                    case "Angle at Center":
                        btnAngleCenter.click();
                        break;
                }
            }
            
            // Add event listeners to answer buttons
            document.querySelectorAll('.circle-answer').forEach(button => {
                button.addEventListener('click', function() {
                    const selectedValue = parseInt(this.dataset.value);
                    const challenge = circleTheorems[currentCircleChallenge];
                    const isCorrect = selectedValue === challenge.correctAnswer;
                    
                    const feedbackElement = document.getElementById('circle-challenge-feedback');
                    feedbackElement.classList.remove('hidden');
                    
                    // Highlight buttons
                    document.querySelectorAll('.circle-answer').forEach(btn => {
                        const value = parseInt(btn.dataset.value);
                        if (value === challenge.correctAnswer) {
                            btn.classList.add('bg-success', 'text-white');
                            btn.classList.remove('bg-white', 'dark:bg-gray-800');
                        } else if (value === selectedValue && !isCorrect) {
                            btn.classList.add('bg-danger', 'text-white');
                            btn.classList.remove('bg-white', 'dark:bg-gray-800');
                        }
                        btn.disabled = true;
                    });
                    
                    // Show feedback
                    if (isCorrect) {
                        feedbackElement.className = 'mb-4 p-3 bg-success bg-opacity-20 rounded-md text-success';
                        feedbackElement.innerHTML = `
                            <svg class="w-5 h-5 inline-block mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                            Correct! ${challenge.explanation}
                        `;
                        playSound('success-sound');
                    } else {
                        feedbackElement.className = 'mb-4 p-3 bg-danger bg-opacity-20 rounded-md text-danger';
                        feedbackElement.innerHTML = `
                            <svg class="w-5 h-5 inline-block mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                            Incorrect. ${challenge.explanation}
                        `;
                        playSound('error-sound');
                    }
                    
                    // Show next button
                    document.getElementById('btn-next-circle-challenge').classList.remove('hidden');
                });
            });
            
            // Next circle challenge button
            document.getElementById('btn-next-circle-challenge').addEventListener('click', function() {
                currentCircleChallenge = (currentCircleChallenge + 1) % circleTheorems.length;
                setCircleChallenge(currentCircleChallenge);
                
                // Reset button styles
                document.querySelectorAll('.circle-answer').forEach(btn => {
                    btn.classList.remove('bg-success', 'bg-danger', 'text-white');
                    btn.classList.add('bg-white', 'dark:bg-gray-800');
                    btn.disabled = false;
                });
                
                playSound('click-sound');
            });
            
            // Initialize the circle challenge
            setCircleChallenge(currentCircleChallenge);
            
            // Initialize the first circle theorem
            setupAngleInSemicircle();
            
            //////////////////////////////////////////
            // SPECIAL ANGLE CONSTRUCTIONS SECTION
            //////////////////////////////////////////
            
            // Construction step data
            const constructions = {
                '30': {
                    title: "Constructing a 30° Angle",
                    steps: [
                        {
                            description: "Place the compass point at O and draw an arc that intersects the base line at point A.",
                            svgElements: [
                                {
                                    type: "circle",
                                    attrs: { cx: 300, cy: 200, r: 100, fill: "none", stroke: "#10B981", "stroke-width": 1, "stroke-dasharray": "5,5" }
                                },
                                {
                                    type: "circle",
                                    attrs: { cx: 400, cy: 200, r: 5, fill: "#10B981" }
                                },
                                {
                                    type: "text",
                                    attrs: { x: 400, y: 220, "text-anchor": "middle", "font-size": 16, fill: "currentColor" },
                                    text: "A"
                                }
                            ]
                        },
                        {
                            description: "Without changing the compass width, place the point at A and draw an arc that intersects the first arc at point B.",
                            svgElements: [
                                {
                                    type: "circle",
                                    attrs: { cx: 400, cy: 200, r: 100, fill: "none", stroke: "#F59E0B", "stroke-width": 1, "stroke-dasharray": "5,5" }
                                },
                                {
                                    type: "circle",
                                    attrs: { cx: 350, cy: 113, r: 5, fill: "#F59E0B" }
                                },
                                {
                                    type: "text",
                                    attrs: { x: 350, y: 100, "text-anchor": "middle", "font-size": 16, fill: "currentColor" },
                                    text: "B"
                                }
                            ]
                        },
                        {
                            description: "Place the compass point at A and draw an arc with radius AB to create point C on the base line.",
                            svgElements: [
                                {
                                    type: "circle",
                                    attrs: { cx: 400, cy: 200, r: 87, fill: "none", stroke: "#EC4899", "stroke-width": 1, "stroke-dasharray": "5,5" }
                                },
                                {
                                    type: "circle",
                                    attrs: { cx: 313, cy: 200, r: 5, fill: "#EC4899" }
                                },
                                {
                                    type: "text",
                                    attrs: { x: 313, y: 220, "text-anchor": "middle", "font-size": 16, fill: "currentColor" },
                                    text: "C"
                                }
                            ]
                        },
                        {
                            description: "Draw a line from O through B. This creates a 60° angle with the base line. Bisect this angle to get a 30° angle.",
                            svgElements: [
                                {
                                    type: "line",
                                    attrs: { x1: 300, y1: 200, x2: 350, y2: 113, stroke: "#3B82F6", "stroke-width": 2 }
                                },
                                {
                                    type: "line",
                                    attrs: { x1: 300, y1: 200, x2: 320, y2: 182, stroke: "#10B981", "stroke-width": 2 }
                                },
                                {
                                    type: "path",
                                    attrs: { d: "M 320,190 A 15,15 0 0,0 310,200", fill: "none", stroke: "#10B981", "stroke-width": 2 }
                                },
                                {
                                    type: "text",
                                    attrs: { x: 320, y: 180, "text-anchor": "middle", "font-size": 14, fill: "#10B981" },
                                    text: "30°"
                                },
                                {
                                    type: "path",
                                    attrs: { d: "M 330,170 A 30,30 0 0,0 310,200", fill: "none", stroke: "#3B82F6", "stroke-width": 1 }
                                },
                                {
                                    type: "text",
                                    attrs: { x: 340, y: 160, "text-anchor": "middle", "font-size": 14, fill: "#3B82F6" },
                                    text: "60°"
                                }
                            ]
                        }
                    ]
                },
                '45': {
                    title: "Constructing a 45° Angle",
                    steps: [
                        {
                            description: "Place the compass point at O and draw an arc that intersects the base line at point A.",
                            svgElements: [
                                {
                                    type: "circle",
                                    attrs: { cx: 300, cy: 200, r: 100, fill: "none", stroke: "#10B981", "stroke-width": 1, "stroke-dasharray": "5,5" }
                                },
                                {
                                    type: "circle",
                                    attrs: { cx: 400, cy: 200, r: 5, fill: "#10B981" }
                                },
                                {
                                    type: "text",
                                    attrs: { x: 400, y: 220, "text-anchor": "middle", "font-size": 16, fill: "currentColor" },
                                    text: "A"
                                }
                            ]
                        },
                        {
                            description: "With the same radius, place the compass point at A and draw an arc that intersects the first arc at point B.",
                            svgElements: [
                                {
                                    type: "circle",
                                    attrs: { cx: 400, cy: 200, r: 100, fill: "none", stroke: "#F59E0B", "stroke-width": 1, "stroke-dasharray": "5,5" }
                                },
                                {
                                    type: "circle",
                                    attrs: { cx: 350, cy: 113, r: 5, fill: "#F59E0B" }
                                },
                                {
                                    type: "text",
                                    attrs: { x: 350, y: 100, "text-anchor": "middle", "font-size": 16, fill: "currentColor" },
                                    text: "B"
                                }
                            ]
                        },
                        {
                            description: "Draw a line from O through B. This creates a 60° angle with the base line.",
                            svgElements: [
                                {
                                    type: "line",
                                    attrs: { x1: 300, y1: 200, x2: 350, y2: 113, stroke: "#3B82F6", "stroke-width": 2 }
                                },
                                {
                                    type: "path",
                                    attrs: { d: "M 330,170 A 30,30 0 0,0 310,200", fill: "none", stroke: "#3B82F6", "stroke-width": 1 }
                                },
                                {
                                    type: "text",
                                    attrs: { x: 340, y: 160, "text-anchor": "middle", "font-size": 14, fill: "#3B82F6" },
                                    text: "60°"
                                }
                            ]
                        },
                        {
                            description: "Place the compass at O and draw a perpendicular line upward. Bisect the angle between this perpendicular and the 60° line to get a 45° angle.",
                            svgElements: [
                                {
                                    type: "line",
                                    attrs: { x1: 300, y1: 200, x2: 300, y2: 100, stroke: "#EC4899", "stroke-width": 2 }
                                },
                                {
                                    type: "line",
                                    attrs: { x1: 300, y1: 200, x2: 335, y2: 150, stroke: "#10B981", "stroke-width": 2 }
                                },
                                {
                                    type: "path",
                                    attrs: { d: "M 320,175 A 20,20 0 0,0 300,180", fill: "none", stroke: "#10B981", "stroke-width": 2 }
                                },
                                {
                                    type: "text",
                                    attrs: { x: 325, y: 165, "text-anchor": "middle", "font-size": 14, fill: "#10B981" },
                                    text: "45°"
                                },
                                {
                                    type: "path",
                                    attrs: { d: "M 310,170 A 15,15 0 0,0 300,180", fill: "none", stroke: "#EC4899", "stroke-width": 1 }
                                },
                                {
                                    type: "text",
                                    attrs: { x: 295, y: 170, "text-anchor": "middle", "font-size": 14, fill: "#EC4899" },
                                    text: "90°"
                                }
                            ]
                        }
                    ]
                },
                '60': {
                    title: "Constructing a 60° Angle",
                    steps: [
                        {
                            description: "Place the compass point at O and draw an arc that intersects the base line at point A.",
                            svgElements: [
                                {
                                    type: "circle",
                                    attrs: { cx: 300, cy: 200, r: 100, fill: "none", stroke: "#10B981", "stroke-width": 1, "stroke-dasharray": "5,5" }
                                },
                                {
                                    type: "circle",
                                    attrs: { cx: 400, cy: 200, r: 5, fill: "#10B981" }
                                },
                                {
                                    type: "text",
                                    attrs: { x: 400, y: 220, "text-anchor": "middle", "font-size": 16, fill: "currentColor" },
                                    text: "A"
                                }
                            ]
                        },
                        {
                            description: "Without changing the compass width, place the point at A and draw an arc that intersects the first arc at point B.",
                            svgElements: [
                                {
                                    type: "circle",
                                    attrs: { cx: 400, cy: 200, r: 100, fill: "none", stroke: "#F59E0B", "stroke-width": 1, "stroke-dasharray": "5,5" }
                                },
                                {
                                    type: "circle",
                                    attrs: { cx: 350, cy: 113, r: 5, fill: "#F59E0B" }
                                },
                                {
                                    type: "text",
                                    attrs: { x: 350, y: 100, "text-anchor": "middle", "font-size": 16, fill: "currentColor" },
                                    text: "B"
                                }
                            ]
                        },
                        {
                            description: "Draw a line from O through point B.",
                            svgElements: [
                                {
                                    type: "line",
                                    attrs: { x1: 300, y1: 200, x2: 350, y2: 113, stroke: "#10B981", "stroke-width": 2 }
                                }
                            ]
                        },
                        {
                            description: "The angle formed between the base line and this new line is 60°.",
                            svgElements: [
                                {
                                    type: "path",
                                    attrs: { d: "M 330,170 A 30,30 0 0,0 310,200", fill: "none", stroke: "#10B981", "stroke-width": 2 }
                                },
                                {
                                    type: "text",
                                    attrs: { x: 335, y: 165, "text-anchor": "middle", "font-size": 14, fill: "#10B981" },
                                    text: "60°"
                                }
                            ]
                        }
                    ]
                },
                '90': {
                    title: "Constructing a 90° Angle (Perpendicular Line)",
                    steps: [
                        {
                            description: "Place the compass point at O and draw an arc that intersects the base line at points A and B.",
                            svgElements: [
                                {
                                    type: "circle",
                                    attrs: { cx: 300, cy: 200, r: 100, fill: "none", stroke: "#10B981", "stroke-width": 1, "stroke-dasharray": "5,5" }
                                },
                                {
                                    type: "circle",
                                    attrs: { cx: 200, cy: 200, r: 5, fill: "#10B981" }
                                },
                                {
                                    type: "text",
                                    attrs: { x: 200, y: 220, "text-anchor": "middle", "font-size": 16, fill: "currentColor" },
                                    text: "A"
                                },
                                {
                                    type: "circle",
                                    attrs: { cx: 400, cy: 200, r: 5, fill: "#10B981" }
                                },
                                {
                                    type: "text",
                                    attrs: { x: 400, y: 220, "text-anchor": "middle", "font-size": 16, fill: "currentColor" },
                                    text: "B"
                                }
                            ]
                        },
                        {
                            description: "With the same radius or larger, place the compass at point A and draw an arc above the base line.",
                            svgElements: [
                                {
                                    type: "circle",
                                    attrs: { cx: 200, cy: 200, r: 120, fill: "none", stroke: "#F59E0B", "stroke-width": 1, "stroke-dasharray": "5,5" }
                                }
                            ]
                        },
                        {
                            description: "With the same radius, place the compass at point B and draw an arc that intersects the previous arc at point C.",
                            svgElements: [
                                {
                                    type: "circle",
                                    attrs: { cx: 400, cy: 200, r: 120, fill: "none", stroke: "#EC4899", "stroke-width": 1, "stroke-dasharray": "5,5" }
                                },
                                {
                                    type: "circle",
                                    attrs: { cx: 300, cy: 95, r: 5, fill: "#EC4899" }
                                },
                                {
                                    type: "text",
                                    attrs: { x: 300, y: 85, "text-anchor": "middle", "font-size": 16, fill: "currentColor" },
                                    text: "C"
                                }
                            ]
                        },
                        {
                            description: "Draw a line from O through point C. This line is perpendicular to the base line, creating a 90° angle.",
                            svgElements: [
                                {
                                    type: "line",
                                    attrs: { x1: 300, y1: 200, x2: 300, y2: 95, stroke: "#10B981", "stroke-width": 2 }
                                },
                                {
                                    type: "path",
                                    attrs: { d: "M 310,190 A 15,15 0 0,0 300,180", fill: "none", stroke: "#10B981", "stroke-width": 2 }
                                },
                                {
                                    type: "text",
                                    attrs: { x: 315, y: 185, "text-anchor": "middle", "font-size": 14, fill: "#10B981" },
                                    text: "90°"
                                }
                            ]
                        }
                    ]
                },
                'bisect': {
                    title: "Bisecting an Angle",
                    steps: [
                        {
                            description: "Start with an angle formed by two lines meeting at point O.",
                            svgElements: [
                                {
                                    type: "line",
                                    attrs: { x1: 300, y1: 200, x2: 450, y2: 150, stroke: "#3B82F6", "stroke-width": 2 }
                                },
                                {
                                    type: "line",
                                    attrs: { x1: 300, y1: 200, x2: 400, y2: 50, stroke: "#3B82F6", "stroke-width": 2 }
                                },
                                {
                                    type: "path",
                                    attrs: { d: "M 340,100 A 40,40 0 0,0 370,170", fill: "none", stroke: "#3B82F6", "stroke-width": 1 }
                                },
                                {
                                    type: "text",
                                    attrs: { x: 370, y: 130, "text-anchor": "middle", "font-size": 14, fill: "#3B82F6" },
                                    text: "α"
                                }
                            ]
                        },
                        {
                            description: "Place the compass point at O and draw an arc that intersects both lines at points A and B.",
                            svgElements: [
                                {
                                    type: "circle",
                                    attrs: { cx: 300, cy: 200, r: 80, fill: "none", stroke: "#10B981", "stroke-width": 1, "stroke-dasharray": "5,5" }
                                },
                                {
                                    type: "circle",
                                    attrs: { cx: 360, cy: 140, r: 5, fill: "#10B981" }
                                },
                                {
                                    type: "text",
                                    attrs: { x: 350, y: 130, "text-anchor": "middle", "font-size": 16, fill: "currentColor" },
                                    text: "A"
                                },
                                {
                                    type: "circle",
                                    attrs: { cx: 345, cy: 120, r: 5, fill: "#10B981" }
                                },
                                {
                                    type: "text",
                                    attrs: { x: 335, y: 110, "text-anchor": "middle", "font-size": 16, fill: "currentColor" },
                                    text: "B"
                                }
                            ]
                        },
                        {
                            description: "With the same radius, place the compass at point A and draw an arc in the interior of the angle.",
                            svgElements: [
                                {
                                    type: "circle",
                                    attrs: { cx: 360, cy: 140, r: 50, fill: "none", stroke: "#F59E0B", "stroke-width": 1, "stroke-dasharray": "5,5" }
                                }
                            ]
                        },
                        {
                            description: "With the same radius, place the compass at point B and draw an arc that intersects the previous arc at point C.",
                            svgElements: [
                                {
                                    type: "circle",
                                    attrs: { cx: 345, cy: 120, r: 50, fill: "none", stroke: "#EC4899", "stroke-width": 1, "stroke-dasharray": "5,5" }
                                },
                                {
                                    type: "circle",
                                    attrs: { cx: 325, cy: 140, r: 5, fill: "#EC4899" }
                                },
                                {
                                    type: "text",
                                    attrs: { x: 325, y: 150, "text-anchor": "middle", "font-size": 16, fill: "currentColor" },
                                    text: "C"
                                }
                            ]
                        },
                        {
                            description: "Draw a line from O through point C. This line bisects the original angle.",
                            svgElements: [
                                {
                                    type: "line",
                                    attrs: { x1: 300, y1: 200, x2: 325, y2: 140, stroke: "#10B981", "stroke-width": 2 }
                                },
                                {
                                    type: "path",
                                    attrs: { d: "M 325,120 A 30,30 0 0,0 345,145", fill: "none", stroke: "#10B981", "stroke-width": 1 }
                                },
                                {
                                    type: "text",
                                    attrs: { x: 345, y: 125, "text-anchor": "middle", "font-size": 14, fill: "#10B981" },
                                    text: "α/2"
                                },
                                {
                                    type: "path",
                                    attrs: { d: "M 335,165 A 30,30 0 0,0 325,120", fill: "none", stroke: "#10B981", "stroke-width": 1 }
                                },
                                {
                                    type: "text",
                                    attrs: { x: 315, y: 165, "text-anchor": "middle", "font-size": 14, fill: "#10B981" },
                                    text: "α/2"
                                }
                            ]
                        }
                    ]
                }
            };
            
            // Variables for construction steps
            let currentConstruction = '90';
            let currentStep = 0;
            
            // Get DOM elements
            const constructionSvg = document.getElementById('construction-svg');
            const constructionSteps = document.getElementById('construction-steps');
            const constructionTitle = document.getElementById('construction-title');
            const stepDescription = document.getElementById('step-description');
            const stepCounter = document.getElementById('step-counter');
            const btnPrevStep = document.getElementById('btn-prev-step');
            const btnNextStep = document.getElementById('btn-next-step');
            
            // Button references
            const btnConstruct30 = document.getElementById('btn-construct-30');
            const btnConstruct45 = document.getElementById('btn-construct-45');
            const btnConstruct60 = document.getElementById('btn-construct-60');
            const btnConstruct90 = document.getElementById('btn-construct-90');
            const btnConstructBisect = document.getElementById('btn-construct-bisect');
            
            // Construction button click handlers
            btnConstruct30.addEventListener('click', function() {
                setupConstruction('30');
                playSound('click-sound');
            });
            
            btnConstruct45.addEventListener('click', function() {
                setupConstruction('45');
                playSound('click-sound');
            });
            
            btnConstruct60.addEventListener('click', function() {
                setupConstruction('60');
                playSound('click-sound');
            });
            
            btnConstruct90.addEventListener('click', function() {
                setupConstruction('90');
                playSound('click-sound');
            });
            
            btnConstructBisect.addEventListener('click', function() {
                setupConstruction('bisect');
                playSound('click-sound');
            });
            
            // Step navigation
            btnPrevStep.addEventListener('click', function() {
                if (currentStep > 0) {
                    currentStep--;
                    updateConstructionStep();
                    playSound('click-sound');
                }
            });
            
            btnNextStep.addEventListener('click', function() {
                if (currentStep < constructions[currentConstruction].steps.length - 1) {
                    currentStep++;
                    updateConstructionStep();
                    playSound('click-sound');
                }
            });
            
            // Function to set up construction
            function setupConstruction(constructionType) {
                currentConstruction = constructionType;
                currentStep = 0;
                
                const construction = constructions[constructionType];
                constructionTitle.textContent = construction.title;
                
                updateConstructionStep();
            }
            
            // Function to update construction step
            function updateConstructionStep() {
                const construction = constructions[currentConstruction];
                const steps = construction.steps;
                const step = steps[currentStep];
                
                // Update step description
                stepDescription.textContent = step.description;
                
                // Update step counter
                stepCounter.textContent = `Step ${currentStep + 1} of ${steps.length}`;
                
                // Update navigation buttons
                btnPrevStep.disabled = currentStep === 0;
                btnNextStep.disabled = currentStep === steps.length - 1;
                
                // Clear construction steps
                constructionSteps.innerHTML = '';
                
                // Add elements for current step and all previous steps
                for (let i = 0; i <= currentStep; i++) {
                    const stepElements = steps[i].svgElements;
                    for (const el of stepElements) {
                        const element = document.createElementNS("http://www.w3.org/2000/svg", el.type);
                        
                        // Set attributes
                        for (const [key, value] of Object.entries(el.attrs)) {
                            element.setAttribute(key, value);
                        }
                        
                        // Set text content if applicable
                        if (el.type === 'text' && el.text) {
                            element.textContent = el.text;
                        }
                        
                        constructionSteps.appendChild(element);
                    }
                }
                
                // Play sound if it's the last step
                if (currentStep === steps.length - 1) {
                    playSound('complete-sound');
                }
            }
            
            // Special Angles Quiz
            const quizQuestions = [
                {
                    question: "Which of these angles can be constructed directly using a compass and straightedge?",
                    options: ["10°", "30°", "50°", "80°"],
                    correctAnswer: "30°"
                },
                {
                    question: "Which construction sequence is correctly ordered?",
                    options: [
                        "90° → 45° → 22.5°",
                        "60° → 90° → 30°",
                        "45° → 90° → 180°",
                        "30° → 45° → 60°"
                    ],
                    correctAnswer: "90° → 45° → 22.5°"
                },
                {
                    question: "How would you construct a 75° angle using basic constructions?",
                    options: [
                        "Bisect a 150° angle",
                        "Add 30° and 45° angles",
                        "Trisect a 225° angle",
                        "Subtract 15° from 90°"
                    ],
                    correctAnswer: "Add 30° and 45° angles"
                },
                {
                    question: "Which angle construction requires an equilateral triangle?",
                    options: ["30°", "45°", "60°", "90°"],
                    correctAnswer: "60°"
                }
            ];
            
            let currentQuizQuestion = 0;
            
            function setQuizQuestion(index) {
                const question = quizQuestions[index];
                document.getElementById('quiz-question').textContent = question.question;
                
                // Clear previous selections
                const radioButtons = document.querySelectorAll('input[name="angle-quiz"]');
                radioButtons.forEach(radio => {
                    radio.checked = false;
                    radio.parentElement.querySelector('span').textContent = radio.value; // Reset label text
                });
                
                // Set new options
                radioButtons.forEach((radio, i) => {
                    radio.value = i;
                    radio.parentElement.querySelector('span').textContent = question.options[i];
                });
                
                // Hide feedback and next button
                document.getElementById('quiz-feedback').classList.add('hidden');
                document.getElementById('btn-next-quiz').classList.add('hidden');
            }
            
            document.getElementById('btn-check-quiz').addEventListener('click', function() {
                const selectedOption = document.querySelector('input[name="angle-quiz"]:checked');
                if (!selectedOption) {
                    alert("Please select an answer!");
                    return;
                }
                
                const question = quizQuestions[currentQuizQuestion];
                const selectedIndex = parseInt(selectedOption.value);
                const selectedAnswer = question.options[selectedIndex];
                const isCorrect = selectedAnswer === question.correctAnswer;
                
                const feedbackElement = document.getElementById('quiz-feedback');
                feedbackElement.classList.remove('hidden');
                
                if (isCorrect) {
                    feedbackElement.className = 'mt-2 p-2 bg-success bg-opacity-20 rounded-md text-success';
                    feedbackElement.textContent = `Correct! ${question.correctAnswer} is right.`;
                    document.getElementById('btn-next-quiz').classList.remove('hidden');
                    playSound('success-sound');
                } else {
                    feedbackElement.className = 'mt-2 p-2 bg-danger bg-opacity-20 rounded-md text-danger';
                    feedbackElement.textContent = `Incorrect. The correct answer is ${question.correctAnswer}.`;
                    playSound('error-sound');
                    
                    // Still show next button after incorrect answer
                    document.getElementById('btn-next-quiz').classList.remove('hidden');
                }
                
                // Disable radio buttons
                document.querySelectorAll('input[name="angle-quiz"]').forEach(radio => {
                    radio.disabled = true;
                });
                
                // Disable check button
                this.disabled = true;
            });
            
            document.getElementById('btn-next-quiz').addEventListener('click', function() {
                currentQuizQuestion = (currentQuizQuestion + 1) % quizQuestions.length;
                setQuizQuestion(currentQuizQuestion);
                
                // Enable radio buttons and check button
                document.querySelectorAll('input[name="angle-quiz"]').forEach(radio => {
                    radio.disabled = false;
                });
                document.getElementById('btn-check-quiz').disabled = false;
                
                playSound('click-sound');
            });
            
            // Initialize with 90° construction
            setupConstruction('90');
            
            // Initialize the quiz
            setQuizQuestion(currentQuizQuestion);
        });
    </script>
</body>
</html>

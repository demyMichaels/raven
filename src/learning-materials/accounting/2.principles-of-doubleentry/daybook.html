<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accounting Day Books Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                    }
                }
            }
        }

        // Check for dark mode preference
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>
    <style>
        .table-container {
            overflow-x: auto;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .ledger-entry {
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .calendar-day {
            transition: all 0.2s;
        }
        .calendar-day:hover:not(.day-selected):not(.day-disabled) {
            background-color: #e5e7eb;
        }
        .dark .calendar-day:hover:not(.day-selected):not(.day-disabled) {
            background-color: #374151;
        }
        .day-selected {
            background-color: #5D5CDE;
            color: white;
        }
        .day-disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .closing-animation {
            animation: closingFlash 1.5s;
        }
        @keyframes closingFlash {
            0% { background-color: transparent; }
            50% { background-color: rgba(93, 92, 222, 0.2); }
            100% { background-color: transparent; }
        }
        .alert-animation {
            animation: alertPulse 1s;
        }
        @keyframes alertPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold mb-2 text-center text-primary">Accounting Day Books Simulator</h1>
        <p class="text-center mb-6">Learn by doing: Record transactions, track time, and close the books!</p>

        <!-- Current Date Display -->
        <div class="flex flex-col md:flex-row justify-between items-center gap-4 mb-6 bg-gray-100 dark:bg-gray-800 p-4 rounded-lg">
            <div class="flex flex-col items-center md:items-start">
                <h2 class="text-lg font-semibold">Current Date</h2>
                <div class="text-xl font-bold text-primary" id="current-date">January 1, 2023</div>
                <div class="text-sm" id="period-status">Month 1 of Accounting Period</div>
            </div>

            <div class="flex gap-2">
                <button id="calendar-btn" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition">
                    <span>ðŸ“…</span> Calendar
                </button>
                <button id="advance-day-btn" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-opacity-90 transition">
                    Advance Day â†’
                </button>
            </div>
        </div>

        <!-- Calendar Modal (hidden by default) -->
        <div id="calendar-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
            <div class="bg-white dark:bg-gray-800 p-6 rounded-lg max-w-md w-full">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">Select Date</h3>
                    <button id="close-calendar" class="text-2xl">&times;</button>
                </div>
                
                <div class="mb-4 flex justify-between items-center">
                    <button id="prev-month" class="px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded">â—€</button>
                    <div id="calendar-month" class="text-lg font-semibold">January 2023</div>
                    <button id="next-month" class="px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded">â–¶</button>
                </div>
                
                <div class="grid grid-cols-7 gap-1 mb-4 text-center">
                    <div class="font-medium">Sun</div>
                    <div class="font-medium">Mon</div>
                    <div class="font-medium">Tue</div>
                    <div class="font-medium">Wed</div>
                    <div class="font-medium">Thu</div>
                    <div class="font-medium">Fri</div>
                    <div class="font-medium">Sat</div>
                </div>
                
                <div id="calendar-days" class="grid grid-cols-7 gap-1 mb-4">
                    <!-- Calendar days will be inserted here -->
                </div>
                
                <div class="flex justify-end">
                    <button id="select-date" class="px-4 py-2 bg-primary text-white rounded">Select Date</button>
                </div>
            </div>
        </div>

        <!-- Close Books Modal (hidden by default) -->
        <div id="close-books-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
            <div class="bg-white dark:bg-gray-800 p-6 rounded-lg max-w-md w-full">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">Close Books for Period</h3>
                    <button class="close-modal text-2xl">&times;</button>
                </div>
                
                <p class="mb-4">At the end of an accounting period, all day book totals are posted to the general ledger to complete the double entry system.</p>
                
                <div id="closing-summary" class="mb-4 p-3 bg-gray-100 dark:bg-gray-700 rounded">
                    <!-- Closing summary will be inserted here -->
                </div>
                
                <div class="flex justify-end gap-2">
                    <button class="close-modal px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded">Cancel</button>
                    <button id="confirm-close-books" class="px-4 py-2 bg-primary text-white rounded">Close Books</button>
                </div>
            </div>
        </div>

        <!-- Main Tabs -->
        <div class="mb-4 border-b border-gray-200 dark:border-gray-700">
            <ul class="flex flex-wrap -mb-px text-sm font-medium text-center">
                <li class="mr-2">
                    <a href="#" class="tab-link inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:border-gray-300 dark:hover:border-gray-600 active" data-tab="dashboard">Dashboard</a>
                </li>
                <li class="mr-2">
                    <a href="#" class="tab-link inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:border-gray-300 dark:hover:border-gray-600" data-tab="sales">Sales Day Book</a>
                </li>
                <li class="mr-2">
                    <a href="#" class="tab-link inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:border-gray-300 dark:hover:border-gray-600" data-tab="purchases">Purchases Day Book</a>
                </li>
                <li class="mr-2">
                    <a href="#" class="tab-link inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:border-gray-300 dark:hover:border-gray-600" data-tab="returns-inward">Returns Inward</a>
                </li>
                <li class="mr-2">
                    <a href="#" class="tab-link inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:border-gray-300 dark:hover:border-gray-600" data-tab="returns-outward">Returns Outward</a>
                </li>
                <li>
                    <a href="#" class="tab-link inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:border-gray-300 dark:hover:border-gray-600" data-tab="ledger">General Ledger</a>
                </li>
            </ul>
        </div>

        <!-- Dashboard Tab Content -->
        <div id="dashboard" class="tab-content active">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div class="bg-gray-100 dark:bg-gray-800 p-6 rounded-lg">
                    <h2 class="text-xl font-bold mb-4">Accounting Period</h2>
                    <div class="flex justify-between items-center mb-4">
                        <div>
                            <p class="font-semibold">Current Period: <span id="current-period">January 2023</span></p>
                            <p class="text-sm">Status: <span id="period-indicator" class="font-medium text-green-600 dark:text-green-400">Open</span></p>
                        </div>
                        <button id="close-books-btn" class="px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 transition">
                            Close Books
                        </button>
                    </div>
                    <div id="period-history" class="mt-4 text-sm">
                        <h3 class="font-semibold mb-2">Period History</h3>
                        <div class="bg-white dark:bg-gray-700 p-3 rounded max-h-32 overflow-y-auto">
                            <p class="text-gray-500 dark:text-gray-400 italic">No closed periods yet</p>
                        </div>
                    </div>
                </div>

                <div class="bg-gray-100 dark:bg-gray-800 p-6 rounded-lg">
                    <h2 class="text-xl font-bold mb-4">Current Period Summary</h2>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span>Sales:</span>
                            <span class="font-semibold" id="sales-summary">$0.00</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Purchases:</span>
                            <span class="font-semibold" id="purchases-summary">$0.00</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Returns Inward:</span>
                            <span class="font-semibold" id="returns-inward-summary">$0.00</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Returns Outward:</span>
                            <span class="font-semibold" id="returns-outward-summary">$0.00</span>
                        </div>
                        <div class="border-t border-gray-300 dark:border-gray-600 pt-2 flex justify-between font-bold">
                            <span>Net Sales:</span>
                            <span id="net-sales-summary">$0.00</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-gray-100 dark:bg-gray-800 p-6 rounded-lg mb-6">
                <h2 class="text-xl font-bold mb-4">Quick Transaction</h2>
                <form id="quick-transaction-form" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block mb-1 font-medium">Transaction Type</label>
                            <select id="transaction-type" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-base">
                                <option value="sales">Credit Sale</option>
                                <option value="purchases">Credit Purchase</option>
                                <option value="returns-inward">Returns from Customer</option>
                                <option value="returns-outward">Returns to Supplier</option>
                            </select>
                        </div>
                        <div>
                            <label class="block mb-1 font-medium">Date</label>
                            <div id="transaction-date" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
                                <!-- Current date will be displayed here -->
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block mb-1 font-medium" id="party-label">Customer Name</label>
                            <input type="text" id="party-name" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-base" placeholder="Enter name">
                        </div>
                        <div>
                            <label class="block mb-1 font-medium">Amount ($)</label>
                            <input type="number" id="transaction-amount" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-base" min="0.01" step="0.01" placeholder="0.00">
                        </div>
                    </div>

                    <div>
                        <label class="block mb-1 font-medium">Description</label>
                        <input type="text" id="transaction-description" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-base" placeholder="Enter description">
                    </div>

                    <div class="flex justify-end">
                        <button type="submit" class="px-6 py-2 bg-primary text-white rounded-lg hover:bg-opacity-90 transition">
                            Record Transaction
                        </button>
                    </div>
                </form>
            </div>

            <div class="bg-gray-100 dark:bg-gray-800 p-6 rounded-lg">
                <h2 class="text-xl font-bold mb-4">Recent Transactions</h2>
                <div class="table-container">
                    <table class="w-full min-w-full text-sm">
                        <thead>
                            <tr class="bg-gray-200 dark:bg-gray-700">
                                <th class="text-left p-2">Date</th>
                                <th class="text-left p-2">Type</th>
                                <th class="text-left p-2">Name</th>
                                <th class="text-left p-2">Description</th>
                                <th class="text-right p-2">Amount</th>
                            </tr>
                        </thead>
                        <tbody id="recent-transactions">
                            <tr>
                                <td colspan="5" class="p-4 text-center text-gray-500 dark:text-gray-400 italic">No transactions yet</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Sales Day Book Tab Content -->
        <div id="sales" class="tab-content">
            <div class="mb-6 bg-gray-100 dark:bg-gray-800 p-4 rounded-lg">
                <h2 class="text-xl font-bold mb-2">Sales Day Book (Credit Sales)</h2>
                <p class="mb-2">Record all sales made on credit to customers. These transactions will be posted to the General Ledger at the end of the accounting period.</p>
                <div class="flex items-center justify-between">
                    <div>
                        <span class="font-semibold">Current Period Total:</span>
                        <span id="sales-total" class="font-bold ml-2">$0.00</span>
                    </div>
                    <button id="add-sales-btn" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-opacity-90 transition">
                        Add New Sale
                    </button>
                </div>
            </div>

            <div class="bg-white dark:bg-gray-800 rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700">
                <div class="table-container">
                    <table class="w-full min-w-full text-sm">
                        <thead>
                            <tr class="bg-gray-100 dark:bg-gray-700">
                                <th class="text-left p-3">Date</th>
                                <th class="text-left p-3">Customer Name</th>
                                <th class="text-left p-3">Description</th>
                                <th class="text-right p-3">Amount ($)</th>
                                <th class="text-center p-3">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="sales-entries">
                            <tr>
                                <td colspan="5" class="p-4 text-center text-gray-500 dark:text-gray-400 italic">No sales recorded yet</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Purchases Day Book Tab Content -->
        <div id="purchases" class="tab-content">
            <div class="mb-6 bg-gray-100 dark:bg-gray-800 p-4 rounded-lg">
                <h2 class="text-xl font-bold mb-2">Purchases Day Book (Credit Purchases)</h2>
                <p class="mb-2">Record all purchases made on credit from suppliers. These transactions will be posted to the General Ledger at the end of the accounting period.</p>
                <div class="flex items-center justify-between">
                    <div>
                        <span class="font-semibold">Current Period Total:</span>
                        <span id="purchases-total" class="font-bold ml-2">$0.00</span>
                    </div>
                    <button id="add-purchases-btn" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-opacity-90 transition">
                        Add New Purchase
                    </button>
                </div>
            </div>

            <div class="bg-white dark:bg-gray-800 rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700">
                <div class="table-container">
                    <table class="w-full min-w-full text-sm">
                        <thead>
                            <tr class="bg-gray-100 dark:bg-gray-700">
                                <th class="text-left p-3">Date</th>
                                <th class="text-left p-3">Supplier Name</th>
                                <th class="text-left p-3">Description</th>
                                <th class="text-right p-3">Amount ($)</th>
                                <th class="text-center p-3">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="purchases-entries">
                            <tr>
                                <td colspan="5" class="p-4 text-center text-gray-500 dark:text-gray-400 italic">No purchases recorded yet</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Returns Inward Day Book Tab Content -->
        <div id="returns-inward" class="tab-content">
            <div class="mb-6 bg-gray-100 dark:bg-gray-800 p-4 rounded-lg">
                <h2 class="text-xl font-bold mb-2">Returns Inward Day Book (Sales Returns)</h2>
                <p class="mb-2">Record goods returned by customers. These transactions will be posted to the General Ledger at the end of the accounting period.</p>
                <div class="flex items-center justify-between">
                    <div>
                        <span class="font-semibold">Current Period Total:</span>
                        <span id="returns-inward-total" class="font-bold ml-2">$0.00</span>
                    </div>
                    <button id="add-returns-inward-btn" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-opacity-90 transition">
                        Add New Return
                    </button>
                </div>
            </div>

            <div class="bg-white dark:bg-gray-800 rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700">
                <div class="table-container">
                    <table class="w-full min-w-full text-sm">
                        <thead>
                            <tr class="bg-gray-100 dark:bg-gray-700">
                                <th class="text-left p-3">Date</th>
                                <th class="text-left p-3">Customer Name</th>
                                <th class="text-left p-3">Description</th>
                                <th class="text-right p-3">Amount ($)</th>
                                <th class="text-center p-3">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="returns-inward-entries">
                            <tr>
                                <td colspan="5" class="p-4 text-center text-gray-500 dark:text-gray-400 italic">No returns recorded yet</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Returns Outward Day Book Tab Content -->
        <div id="returns-outward" class="tab-content">
            <div class="mb-6 bg-gray-100 dark:bg-gray-800 p-4 rounded-lg">
                <h2 class="text-xl font-bold mb-2">Returns Outward Day Book (Purchases Returns)</h2>
                <p class="mb-2">Record goods returned to suppliers. These transactions will be posted to the General Ledger at the end of the accounting period.</p>
                <div class="flex items-center justify-between">
                    <div>
                        <span class="font-semibold">Current Period Total:</span>
                        <span id="returns-outward-total" class="font-bold ml-2">$0.00</span>
                    </div>
                    <button id="add-returns-outward-btn" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-opacity-90 transition">
                        Add New Return
                    </button>
                </div>
            </div>

            <div class="bg-white dark:bg-gray-800 rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700">
                <div class="table-container">
                    <table class="w-full min-w-full text-sm">
                        <thead>
                            <tr class="bg-gray-100 dark:bg-gray-700">
                                <th class="text-left p-3">Date</th>
                                <th class="text-left p-3">Supplier Name</th>
                                <th class="text-left p-3">Description</th>
                                <th class="text-right p-3">Amount ($)</th>
                                <th class="text-center p-3">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="returns-outward-entries">
                            <tr>
                                <td colspan="5" class="p-4 text-center text-gray-500 dark:text-gray-400 italic">No returns recorded yet</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- General Ledger Tab Content -->
        <div id="ledger" class="tab-content">
            <div class="mb-6 bg-gray-100 dark:bg-gray-800 p-4 rounded-lg">
                <h2 class="text-xl font-bold mb-2">General Ledger</h2>
                <p class="mb-2">The double-entry accounting system. Day book totals are posted here at the end of each accounting period.</p>
                <div class="mt-2 grid grid-cols-1 md:grid-cols-4 gap-3">
                    <a href="#" class="ledger-account p-3 bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 hover:border-primary dark:hover:border-primary transition" data-account="sales">
                        <div class="font-semibold">Sales Account</div>
                        <div class="text-sm text-gray-500 dark:text-gray-400">Credit balance</div>
                    </a>
                    <a href="#" class="ledger-account p-3 bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 hover:border-primary dark:hover:border-primary transition" data-account="purchases">
                        <div class="font-semibold">Purchases Account</div>
                        <div class="text-sm text-gray-500 dark:text-gray-400">Debit balance</div>
                    </a>
                    <a href="#" class="ledger-account p-3 bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 hover:border-primary dark:hover:border-primary transition" data-account="returns-inward">
                        <div class="font-semibold">Returns Inward Account</div>
                        <div class="text-sm text-gray-500 dark:text-gray-400">Debit balance</div>
                    </a>
                    <a href="#" class="ledger-account p-3 bg-white dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 hover:border-primary dark:hover:border-primary transition" data-account="returns-outward">
                        <div class="font-semibold">Returns Outward Account</div>
                        <div class="text-sm text-gray-500 dark:text-gray-400">Credit balance</div>
                    </a>
                </div>
            </div>

            <div id="ledger-account-view" class="bg-white dark:bg-gray-800 rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700 hidden">
                <div class="bg-gray-100 dark:bg-gray-700 p-3 flex justify-between items-center">
                    <h3 id="ledger-account-title" class="font-bold text-lg">Account</h3>
                    <button id="back-to-accounts" class="px-3 py-1 bg-gray-200 dark:bg-gray-600 rounded hover:bg-gray-300 dark:hover:bg-gray-500">
                        Back to Accounts
                    </button>
                </div>
                
                <div class="table-container">
                    <table class="w-full min-w-full">
                        <thead>
                            <tr class="bg-gray-200 dark:bg-gray-700 text-sm">
                                <th class="p-3 text-left" colspan="2">Debit</th>
                                <th class="p-3 text-left" colspan="2">Credit</th>
                            </tr>
                            <tr class="bg-gray-100 dark:bg-gray-800 text-sm">
                                <th class="p-3 text-left">Date</th>
                                <th class="p-3 text-right">Amount ($)</th>
                                <th class="p-3 text-left">Date</th>
                                <th class="p-3 text-right">Amount ($)</th>
                            </tr>
                        </thead>
                        <tbody id="ledger-entries">
                            <tr>
                                <td colspan="4" class="p-4 text-center text-gray-500 dark:text-gray-400 italic">No entries yet</td>
                            </tr>
                        </tbody>
                        <tfoot id="ledger-account-totals" class="font-bold">
                            <tr class="bg-gray-100 dark:bg-gray-700">
                                <td class="p-3 text-right">Total:</td>
                                <td id="debit-total" class="p-3 text-right">$0.00</td>
                                <td class="p-3 text-right">Total:</td>
                                <td id="credit-total" class="p-3 text-right">$0.00</td>
                            </tr>
                            <tr class="bg-gray-200 dark:bg-gray-600">
                                <td colspan="3" class="p-3 text-right">Balance:</td>
                                <td id="account-balance" class="p-3 text-right">$0.00</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>

        <!-- Alert Component -->
        <div id="alert" class="fixed bottom-4 right-4 max-w-sm w-full bg-green-100 dark:bg-green-800 border-l-4 border-green-500 text-green-700 dark:text-green-200 p-4 rounded shadow-md hidden">
            <div class="flex items-center">
                <div class="py-1">
                    <svg class="h-6 w-6 mr-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </div>
                <div>
                    <p id="alert-message" class="font-bold"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Application State
        const state = {
            currentDate: new Date(2023, 0, 1), // Start on January 1, 2023
            selectedDate: new Date(2023, 0, 1),
            calendarMonth: 0,
            calendarYear: 2023,
            accounting: {
                currentPeriod: 'January 2023',
                periodStatus: 'open',
                transactions: [],
                dayBooks: {
                    sales: [],
                    purchases: [],
                    returnsInward: [],
                    returnsOutward: []
                },
                ledger: {
                    sales: [],
                    purchases: [],
                    returnsInward: [],
                    returnsOutward: []
                },
                closedPeriods: []
            }
        };

        // Helper Functions
        function formatCurrency(amount) {
            return '$' + parseFloat(amount).toFixed(2);
        }

        function formatDate(date) {
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }

        function updateCurrentDate() {
            document.getElementById('current-date').textContent = formatDate(state.currentDate);
            
            // Calculate which month of the accounting period we're in
            const startMonth = 0; // January (0-indexed)
            const currentMonth = state.currentDate.getMonth();
            const monthDiff = (currentMonth - startMonth + 12) % 12 + 1;
            document.getElementById('period-status').textContent = `Month ${monthDiff} of Accounting Period`;
            
            // Update the transaction form date
            document.getElementById('transaction-date').textContent = formatDate(state.currentDate);
        }

        function calculateTotals() {
            const salesTotal = state.accounting.dayBooks.sales.reduce((sum, item) => sum + parseFloat(item.amount), 0);
            const purchasesTotal = state.accounting.dayBooks.purchases.reduce((sum, item) => sum + parseFloat(item.amount), 0);
            const returnsInwardTotal = state.accounting.dayBooks.returnsInward.reduce((sum, item) => sum + parseFloat(item.amount), 0);
            const returnsOutwardTotal = state.accounting.dayBooks.returnsOutward.reduce((sum, item) => sum + parseFloat(item.amount), 0);
            
            const netSales = salesTotal - returnsInwardTotal;
            
            // Update dashboard summary
            document.getElementById('sales-summary').textContent = formatCurrency(salesTotal);
            document.getElementById('purchases-summary').textContent = formatCurrency(purchasesTotal);
            document.getElementById('returns-inward-summary').textContent = formatCurrency(returnsInwardTotal);
            document.getElementById('returns-outward-summary').textContent = formatCurrency(returnsOutwardTotal);
            document.getElementById('net-sales-summary').textContent = formatCurrency(netSales);
            
            // Update day book totals
            document.getElementById('sales-total').textContent = formatCurrency(salesTotal);
            document.getElementById('purchases-total').textContent = formatCurrency(purchasesTotal);
            document.getElementById('returns-inward-total').textContent = formatCurrency(returnsInwardTotal);
            document.getElementById('returns-outward-total').textContent = formatCurrency(returnsOutwardTotal);
            
            return {
                salesTotal,
                purchasesTotal,
                returnsInwardTotal,
                returnsOutwardTotal,
                netSales
            };
        }

        function showAlert(message, type = 'success') {
            const alert = document.getElementById('alert');
            const alertMessage = document.getElementById('alert-message');
            
            alert.className = 'fixed bottom-4 right-4 max-w-sm w-full p-4 rounded shadow-md alert-animation';
            
            if (type === 'success') {
                alert.classList.add('bg-green-100', 'dark:bg-green-800', 'border-l-4', 'border-green-500', 'text-green-700', 'dark:text-green-200');
            } else if (type === 'error') {
                alert.classList.add('bg-red-100', 'dark:bg-red-800', 'border-l-4', 'border-red-500', 'text-red-700', 'dark:text-red-200');
            } else if (type === 'info') {
                alert.classList.add('bg-blue-100', 'dark:bg-blue-800', 'border-l-4', 'border-blue-500', 'text-blue-700', 'dark:text-blue-200');
            } else if (type === 'warning') {
                alert.classList.add('bg-yellow-100', 'dark:bg-yellow-800', 'border-l-4', 'border-yellow-500', 'text-yellow-700', 'dark:text-yellow-200');
            }
            
            alertMessage.textContent = message;
            alert.classList.remove('hidden');
            
            setTimeout(() => {
                alert.classList.add('hidden');
            }, 3000);
        }

        // Tab Navigation
        document.querySelectorAll('.tab-link').forEach(tab => {
            tab.addEventListener('click', (e) => {
                e.preventDefault();
                
                // Remove active class from all tabs
                document.querySelectorAll('.tab-link').forEach(t => t.classList.remove('active', 'border-primary', 'text-primary'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                
                // Add active class to clicked tab
                tab.classList.add('active', 'border-primary', 'text-primary');
                
                // Show corresponding content
                const tabId = tab.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
                
                // Reset ledger account view
                if (tabId === 'ledger') {
                    document.getElementById('ledger-account-view').classList.add('hidden');
                }
            });
        });

        // Calendar Functionality
        function renderCalendar() {
            const calendarDays = document.getElementById('calendar-days');
            const monthYear = document.getElementById('calendar-month');
            
            // Clear previous calendar
            calendarDays.innerHTML = '';
            
            // Update month/year display
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            monthYear.textContent = `${monthNames[state.calendarMonth]} ${state.calendarYear}`;
            
            // Get first day of month and number of days
            const firstDay = new Date(state.calendarYear, state.calendarMonth, 1).getDay();
            const daysInMonth = new Date(state.calendarYear, state.calendarMonth + 1, 0).getDate();
            
            // Add empty cells for days before first of month
            for (let i = 0; i < firstDay; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'p-2 text-center';
                calendarDays.appendChild(emptyCell);
            }
            
            // Add days of month
            for (let i = 1; i <= daysInMonth; i++) {
                const dayCell = document.createElement('div');
                dayCell.className = 'calendar-day p-2 text-center cursor-pointer rounded';
                dayCell.textContent = i;
                
                // Check if this date is today's date
                const calDate = new Date(state.calendarYear, state.calendarMonth, i);
                const today = new Date();
                
                // Check if this is the selected date
                if (state.selectedDate && 
                    calDate.getDate() === state.selectedDate.getDate() && 
                    calDate.getMonth() === state.selectedDate.getMonth() && 
                    calDate.getFullYear() === state.selectedDate.getFullYear()) {
                    dayCell.classList.add('day-selected');
                }
                
                // Disable future dates
                if (calDate > today) {
                    dayCell.classList.add('day-disabled');
                } else {
                    dayCell.addEventListener('click', () => {
                        // Remove selected class from any previously selected day
                        document.querySelectorAll('.calendar-day').forEach(day => {
                            day.classList.remove('day-selected');
                        });
                        
                        // Add selected class to clicked day
                        dayCell.classList.add('day-selected');
                        
                        // Update selected date
                        state.selectedDate = new Date(state.calendarYear, state.calendarMonth, i);
                    });
                }
                
                calendarDays.appendChild(dayCell);
            }
        }

        // Calendar event handlers
        document.getElementById('calendar-btn').addEventListener('click', () => {
            // Reset calendar to current date month/year
            state.calendarMonth = state.currentDate.getMonth();
            state.calendarYear = state.currentDate.getFullYear();
            state.selectedDate = new Date(state.currentDate);
            
            renderCalendar();
            document.getElementById('calendar-modal').classList.remove('hidden');
        });
        
        document.getElementById('close-calendar').addEventListener('click', () => {
            document.getElementById('calendar-modal').classList.add('hidden');
        });
        
        document.getElementById('prev-month').addEventListener('click', () => {
            state.calendarMonth--;
            if (state.calendarMonth < 0) {
                state.calendarMonth = 11;
                state.calendarYear--;
            }
            renderCalendar();
        });
        
        document.getElementById('next-month').addEventListener('click', () => {
            const today = new Date();
            const nextMonth = new Date(state.calendarYear, state.calendarMonth + 1, 1);
            
            // Only allow advancing to future months up to current month
            if (nextMonth <= today) {
                state.calendarMonth++;
                if (state.calendarMonth > 11) {
                    state.calendarMonth = 0;
                    state.calendarYear++;
                }
                renderCalendar();
            }
        });
        
        document.getElementById('select-date').addEventListener('click', () => {
            if (state.selectedDate) {
                state.currentDate = new Date(state.selectedDate);
                updateCurrentDate();
                document.getElementById('calendar-modal').classList.add('hidden');
                showAlert('Date updated to ' + formatDate(state.currentDate), 'info');
            }
        });

        // Advance day button
        document.getElementById('advance-day-btn').addEventListener('click', () => {
            const tomorrow = new Date(state.currentDate);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            // Check if tomorrow is in the future
            const today = new Date();
            if (tomorrow > today) {
                showAlert("Can't advance to future dates", 'error');
                return;
            }
            
            state.currentDate = tomorrow;
            updateCurrentDate();
            showAlert('Advanced to ' + formatDate(state.currentDate), 'info');
        });

        // Transaction Type Change Handler
        document.getElementById('transaction-type').addEventListener('change', function() {
            const partyLabel = document.getElementById('party-label');
            
            if (this.value === 'sales' || this.value === 'returns-inward') {
                partyLabel.textContent = 'Customer Name';
            } else {
                partyLabel.textContent = 'Supplier Name';
            }
        });

        // Transaction Form Handler
        document.getElementById('quick-transaction-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const type = document.getElementById('transaction-type').value;
            const partyName = document.getElementById('party-name').value.trim();
            const amount = document.getElementById('transaction-amount').value;
            const description = document.getElementById('transaction-description').value.trim();
            
            if (!partyName) {
                showAlert('Please enter a name', 'error');
                return;
            }
            
            if (!amount || parseFloat(amount) <= 0) {
                showAlert('Please enter a valid amount', 'error');
                return;
            }
            
            const transaction = {
                id: Date.now().toString(),
                date: new Date(state.currentDate),
                formattedDate: formatDate(state.currentDate),
                type,
                partyName,
                amount: parseFloat(amount),
                description: description || '(No description)'
            };
            
            // Add to transactions array
            state.accounting.transactions.push(transaction);
            
            // Add to appropriate day book
            switch (type) {
                case 'sales':
                    state.accounting.dayBooks.sales.push(transaction);
                    break;
                case 'purchases':
                    state.accounting.dayBooks.purchases.push(transaction);
                    break;
                case 'returns-inward':
                    state.accounting.dayBooks.returnsInward.push(transaction);
                    break;
                case 'returns-outward':
                    state.accounting.dayBooks.returnsOutward.push(transaction);
                    break;
            }
            
            // Update UI
            updateTransactionsUI();
            calculateTotals();
            
            // Reset form
            this.reset();
            document.getElementById('transaction-date').textContent = formatDate(state.currentDate);
            document.getElementById('party-label').textContent = 'Customer Name';
            
            showAlert('Transaction recorded successfully!', 'success');
        });

        // Add Transaction Buttons
        document.getElementById('add-sales-btn').addEventListener('click', () => {
            document.getElementById('transaction-type').value = 'sales';
            document.getElementById('party-label').textContent = 'Customer Name';
            document.querySelectorAll('.tab-link')[0].click(); // Switch to dashboard
            document.getElementById('party-name').focus();
        });
        
        document.getElementById('add-purchases-btn').addEventListener('click', () => {
            document.getElementById('transaction-type').value = 'purchases';
            document.getElementById('party-label').textContent = 'Supplier Name';
            document.querySelectorAll('.tab-link')[0].click(); // Switch to dashboard
            document.getElementById('party-name').focus();
        });
        
        document.getElementById('add-returns-inward-btn').addEventListener('click', () => {
            document.getElementById('transaction-type').value = 'returns-inward';
            document.getElementById('party-label').textContent = 'Customer Name';
            document.querySelectorAll('.tab-link')[0].click(); // Switch to dashboard
            document.getElementById('party-name').focus();
        });
        
        document.getElementById('add-returns-outward-btn').addEventListener('click', () => {
            document.getElementById('transaction-type').value = 'returns-outward';
            document.getElementById('party-label').textContent = 'Supplier Name';
            document.querySelectorAll('.tab-link')[0].click(); // Switch to dashboard
            document.getElementById('party-name').focus();
        });

        // Update Transactions UI
        function updateTransactionsUI() {
            // Update Recent Transactions
            const recentTxContainer = document.getElementById('recent-transactions');
            const transactions = [...state.accounting.transactions].sort((a, b) => b.date - a.date).slice(0, 5);
            
            if (transactions.length > 0) {
                const html = transactions.map(tx => `
                    <tr class="border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800">
                        <td class="p-2">${tx.formattedDate}</td>
                        <td class="p-2">${getTransactionTypeName(tx.type)}</td>
                        <td class="p-2">${tx.partyName}</td>
                        <td class="p-2">${tx.description}</td>
                        <td class="p-2 text-right">${formatCurrency(tx.amount)}</td>
                    </tr>
                `).join('');
                
                recentTxContainer.innerHTML = html;
            } else {
                recentTxContainer.innerHTML = `
                    <tr>
                        <td colspan="5" class="p-4 text-center text-gray-500 dark:text-gray-400 italic">No transactions yet</td>
                    </tr>
                `;
            }
            
            // Update Sales Day Book
            updateDayBookEntries('sales-entries', state.accounting.dayBooks.sales);
            
            // Update Purchases Day Book
            updateDayBookEntries('purchases-entries', state.accounting.dayBooks.purchases);
            
            // Update Returns Inward Day Book
            updateDayBookEntries('returns-inward-entries', state.accounting.dayBooks.returnsInward);
            
            // Update Returns Outward Day Book
            updateDayBookEntries('returns-outward-entries', state.accounting.dayBooks.returnsOutward);
        }

        function getTransactionTypeName(type) {
            switch (type) {
                case 'sales': return 'Credit Sale';
                case 'purchases': return 'Credit Purchase';
                case 'returns-inward': return 'Returns from Customer';
                case 'returns-outward': return 'Returns to Supplier';
                default: return type;
            }
        }

        function updateDayBookEntries(elementId, entries) {
            const container = document.getElementById(elementId);
            const sortedEntries = [...entries].sort((a, b) => b.date - a.date);
            
            if (sortedEntries.length > 0) {
                const html = sortedEntries.map(entry => `
                    <tr class="border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800">
                        <td class="p-3">${entry.formattedDate}</td>
                        <td class="p-3">${entry.partyName}</td>
                        <td class="p-3">${entry.description}</td>
                        <td class="p-3 text-right">${formatCurrency(entry.amount)}</td>
                        <td class="p-3 text-center">
                            <button class="delete-entry px-2 py-1 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-200 rounded hover:bg-red-200 dark:hover:bg-red-800" data-id="${entry.id}" data-type="${entry.type}">
                                Delete
                            </button>
                        </td>
                    </tr>
                `).join('');
                
                container.innerHTML = html;
                
                // Add event listeners for delete buttons
                container.querySelectorAll('.delete-entry').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = this.getAttribute('data-id');
                        const type = this.getAttribute('data-type');
                        deleteTransaction(id, type);
                    });
                });
                
            } else {
                container.innerHTML = `
                    <tr>
                        <td colspan="5" class="p-4 text-center text-gray-500 dark:text-gray-400 italic">No entries recorded yet</td>
                    </tr>
                `;
            }
        }

        function deleteTransaction(id, type) {
            // Remove from transactions array
            state.accounting.transactions = state.accounting.transactions.filter(tx => tx.id !== id);
            
            // Remove from appropriate day book
            switch (type) {
                case 'sales':
                    state.accounting.dayBooks.sales = state.accounting.dayBooks.sales.filter(tx => tx.id !== id);
                    break;
                case 'purchases':
                    state.accounting.dayBooks.purchases = state.accounting.dayBooks.purchases.filter(tx => tx.id !== id);
                    break;
                case 'returns-inward':
                    state.accounting.dayBooks.returnsInward = state.accounting.dayBooks.returnsInward.filter(tx => tx.id !== id);
                    break;
                case 'returns-outward':
                    state.accounting.dayBooks.returnsOutward = state.accounting.dayBooks.returnsOutward.filter(tx => tx.id !== id);
                    break;
            }
            
            // Update UI
            updateTransactionsUI();
            calculateTotals();
            
            showAlert('Transaction deleted', 'info');
        }

        // Ledger Account View Handlers
        document.querySelectorAll('.ledger-account').forEach(account => {
            account.addEventListener('click', function(e) {
                e.preventDefault();
                
                const accountType = this.getAttribute('data-account');
                
                // Update title
                const accountNames = {
                    'sales': 'Sales Account',
                    'purchases': 'Purchases Account',
                    'returns-inward': 'Returns Inward Account',
                    'returns-outward': 'Returns Outward Account'
                };
                
                document.getElementById('ledger-account-title').textContent = accountNames[accountType];
                
                // Show ledger entries
                showLedgerAccount(accountType);
                
                // Show the ledger account view
                document.getElementById('ledger-account-view').classList.remove('hidden');
            });
        });
        
        document.getElementById('back-to-accounts').addEventListener('click', () => {
            document.getElementById('ledger-account-view').classList.add('hidden');
        });

        function showLedgerAccount(accountType) {
            const entriesContainer = document.getElementById('ledger-entries');
            const entries = state.accounting.ledger[accountType];
            
            // Sort entries by date
            const sortedEntries = [...entries].sort((a, b) => a.date - b.date);
            
            if (sortedEntries.length > 0) {
                // Format based on account type
                let html = '';
                let debitTotal = 0;
                let creditTotal = 0;
                
                if (accountType === 'sales') {
                    // Sales (Credit entries)
                    html = sortedEntries.map(entry => {
                        creditTotal += entry.amount;
                        return `
                            <tr class="border-b border-gray-200 dark:border-gray-700">
                                <td class="p-3"></td>
                                <td class="p-3 text-right"></td>
                                <td class="p-3">${entry.formattedDate}</td>
                                <td class="p-3 text-right">${formatCurrency(entry.amount)}</td>
                            </tr>
                        `;
                    }).join('');
                } else if (accountType === 'purchases') {
                    // Purchases (Debit entries)
                    html = sortedEntries.map(entry => {
                        debitTotal += entry.amount;
                        return `
                            <tr class="border-b border-gray-200 dark:border-gray-700">
                                <td class="p-3">${entry.formattedDate}</td>
                                <td class="p-3 text-right">${formatCurrency(entry.amount)}</td>
                                <td class="p-3"></td>
                                <td class="p-3 text-right"></td>
                            </tr>
                        `;
                    }).join('');
                } else if (accountType === 'returns-inward') {
                    // Returns Inward (Debit entries)
                    html = sortedEntries.map(entry => {
                        debitTotal += entry.amount;
                        return `
                            <tr class="border-b border-gray-200 dark:border-gray-700">
                                <td class="p-3">${entry.formattedDate}</td>
                                <td class="p-3 text-right">${formatCurrency(entry.amount)}</td>
                                <td class="p-3"></td>
                                <td class="p-3 text-right"></td>
                            </tr>
                        `;
                    }).join('');
                } else if (accountType === 'returns-outward') {
                    // Returns Outward (Credit entries)
                    html = sortedEntries.map(entry => {
                        creditTotal += entry.amount;
                        return `
                            <tr class="border-b border-gray-200 dark:border-gray-700">
                                <td class="p-3"></td>
                                <td class="p-3 text-right"></td>
                                <td class="p-3">${entry.formattedDate}</td>
                                <td class="p-3 text-right">${formatCurrency(entry.amount)}</td>
                            </tr>
                        `;
                    }).join('');
                }
                
                entriesContainer.innerHTML = html;
                
                // Update totals
                document.getElementById('debit-total').textContent = formatCurrency(debitTotal);
                document.getElementById('credit-total').textContent = formatCurrency(creditTotal);
                
                // Calculate balance
                let balance = 0;
                
                if (accountType === 'sales' || accountType === 'returns-outward') {
                    // Credit accounts (Credit - Debit)
                    balance = creditTotal - debitTotal;
                    document.getElementById('account-balance').textContent = formatCurrency(balance) + ' Cr';
                } else {
                    // Debit accounts (Debit - Credit)
                    balance = debitTotal - creditTotal;
                    document.getElementById('account-balance').textContent = formatCurrency(balance) + ' Dr';
                }
                
            } else {
                entriesContainer.innerHTML = `
                    <tr>
                        <td colspan="4" class="p-4 text-center text-gray-500 dark:text-gray-400 italic">No entries yet</td>
                    </tr>
                `;
                
                // Reset totals
                document.getElementById('debit-total').textContent = formatCurrency(0);
                document.getElementById('credit-total').textContent = formatCurrency(0);
                document.getElementById('account-balance').textContent = formatCurrency(0);
            }
        }

        // Close Books Functionality
        document.getElementById('close-books-btn').addEventListener('click', function() {
            const { salesTotal, purchasesTotal, returnsInwardTotal, returnsOutwardTotal } = calculateTotals();
            
            // Check if there are any transactions to post
            if (state.accounting.transactions.length === 0) {
                showAlert('No transactions to post to the ledger', 'warning');
                return;
            }
            
            // Prepare summary for modal
            const closingSummary = document.getElementById('closing-summary');
            closingSummary.innerHTML = `
                <div class="space-y-2">
                    <div class="font-semibold">Period: ${state.accounting.currentPeriod}</div>
                    <div class="flex justify-between"><span>Sales:</span> <span>${formatCurrency(salesTotal)}</span></div>
                    <div class="flex justify-between"><span>Purchases:</span> <span>${formatCurrency(purchasesTotal)}</span></div>
                    <div class="flex justify-between"><span>Returns Inward:</span> <span>${formatCurrency(returnsInwardTotal)}</span></div>
                    <div class="flex justify-between"><span>Returns Outward:</span> <span>${formatCurrency(returnsOutwardTotal)}</span></div>
                </div>
            `;
            
            // Show close books modal
            document.getElementById('close-books-modal').classList.remove('hidden');
        });
        
        document.querySelectorAll('.close-modal').forEach(btn => {
            btn.addEventListener('click', () => {
                document.getElementById('close-books-modal').classList.add('hidden');
            });
        });
        
        document.getElementById('confirm-close-books').addEventListener('click', function() {
            // Create ledger entries from day book totals
            const salesTotal = state.accounting.dayBooks.sales.reduce((sum, item) => sum + parseFloat(item.amount), 0);
            const purchasesTotal = state.accounting.dayBooks.purchases.reduce((sum, item) => sum + parseFloat(item.amount), 0);
            const returnsInwardTotal = state.accounting.dayBooks.returnsInward.reduce((sum, item) => sum + parseFloat(item.amount), 0);
            const returnsOutwardTotal = state.accounting.dayBooks.returnsOutward.reduce((sum, item) => sum + parseFloat(item.amount), 0);
            
            const periodEndDate = new Date(state.currentDate);
            
            // Only post if there are transactions
            if (salesTotal > 0) {
                state.accounting.ledger.sales.push({
                    date: periodEndDate,
                    formattedDate: formatDate(periodEndDate),
                    description: `End of Period: ${state.accounting.currentPeriod}`,
                    amount: salesTotal
                });
            }
            
            if (purchasesTotal > 0) {
                state.accounting.ledger.purchases.push({
                    date: periodEndDate,
                    formattedDate: formatDate(periodEndDate),
                    description: `End of Period: ${state.accounting.currentPeriod}`,
                    amount: purchasesTotal
                });
            }
            
            if (returnsInwardTotal > 0) {
                state.accounting.ledger.returnsInward.push({
                    date: periodEndDate,
                    formattedDate: formatDate(periodEndDate),
                    description: `End of Period: ${state.accounting.currentPeriod}`,
                    amount: returnsInwardTotal
                });
            }
            
            if (returnsOutwardTotal > 0) {
                state.accounting.ledger.returnsOutward.push({
                    date: periodEndDate,
                    formattedDate: formatDate(periodEndDate),
                    description: `End of Period: ${state.accounting.currentPeriod}`,
                    amount: returnsOutwardTotal
                });
            }
            
            // Save closed period data
            state.accounting.closedPeriods.push({
                period: state.accounting.currentPeriod,
                closeDate: formatDate(periodEndDate),
                salesTotal,
                purchasesTotal,
                returnsInwardTotal,
                returnsOutwardTotal,
                netSales: salesTotal - returnsInwardTotal
            });
            
            // Update period history UI
            updatePeriodHistory();
            
            // Clear day books for new period
            state.accounting.dayBooks.sales = [];
            state.accounting.dayBooks.purchases = [];
            state.accounting.dayBooks.returnsInward = [];
            state.accounting.dayBooks.returnsOutward = [];
            
            // Clear transactions list
            state.accounting.transactions = [];
            
            // Set new period based on current date
            const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            const newPeriod = `${months[state.currentDate.getMonth()]} ${state.currentDate.getFullYear()}`;
            state.accounting.currentPeriod = newPeriod;
            document.getElementById('current-period').textContent = newPeriod;
            
            // Update UI
            updateTransactionsUI();
            calculateTotals();
            
            // Hide modal
            document.getElementById('close-books-modal').classList.add('hidden');
            
            // Add animations to show ledger entries
            document.querySelectorAll('.ledger-account').forEach(el => {
                el.classList.add('closing-animation');
                setTimeout(() => {
                    el.classList.remove('closing-animation');
                }, 1500);
            });
            
            showAlert('Books closed successfully! All day book totals have been posted to the general ledger.', 'success');
        });

        function updatePeriodHistory() {
            const historyContainer = document.getElementById('period-history');
            const history = document.createElement('div');
            history.className = 'bg-white dark:bg-gray-700 p-3 rounded max-h-32 overflow-y-auto';
            
            if (state.accounting.closedPeriods.length > 0) {
                const historyHtml = state.accounting.closedPeriods.map(period => `
                    <div class="mb-2 pb-2 border-b border-gray-200 dark:border-gray-600">
                        <div class="flex justify-between">
                            <span class="font-semibold">${period.period}</span>
                            <span>Closed on ${period.closeDate}</span>
                        </div>
                        <div class="text-sm">Net Sales: ${formatCurrency(period.netSales)}</div>
                    </div>
                `).join('');
                
                history.innerHTML = historyHtml;
            } else {
                history.innerHTML = `<p class="text-gray-500 dark:text-gray-400 italic">No closed periods yet</p>`;
            }
            
            historyContainer.innerHTML = '';
            historyContainer.appendChild(document.createElement('h3')).textContent = 'Period History';
            historyContainer.lastChild.className = 'font-semibold mb-2';
            historyContainer.appendChild(history);
        }

        // Initialize Application
        updateCurrentDate();
        updateTransactionsUI();
        calculateTotals();

        // Example transactions to help students understand
        function addExampleTransactions() {
            const examples = [
                {
                    type: 'sales',
                    partyName: 'ABC Company',
                    amount: 1500,
                    description: 'Office furniture'
                },
                {
                    type: 'purchases',
                    partyName: 'XYZ Suppliers',
                    amount: 800,
                    description: 'Inventory items'
                },
                {
                    type: 'sales',
                    partyName: 'Smith & Co',
                    amount: 2200,
                    description: 'Computer equipment'
                },
                {
                    type: 'returns-inward',
                    partyName: 'ABC Company',
                    amount: 300,
                    description: 'Damaged furniture'
                }
            ];
            
            // Spread examples over a few days
            examples.forEach((example, index) => {
                const txDate = new Date(state.currentDate);
                txDate.setDate(txDate.getDate() - (index + 1)); // Going back in time
                
                const transaction = {
                    id: Date.now().toString() + index,
                    date: new Date(txDate),
                    formattedDate: formatDate(txDate),
                    type: example.type,
                    partyName: example.partyName,
                    amount: example.amount,
                    description: example.description
                };
                
                // Add to transactions array
                state.accounting.transactions.push(transaction);
                
                // Add to appropriate day book
                switch (example.type) {
                    case 'sales':
                        state.accounting.dayBooks.sales.push(transaction);
                        break;
                    case 'purchases':
                        state.accounting.dayBooks.purchases.push(transaction);
                        break;
                    case 'returns-inward':
                        state.accounting.dayBooks.returnsInward.push(transaction);
                        break;
                    case 'returns-outward':
                        state.accounting.dayBooks.returnsOutward.push(transaction);
                        break;
                }
            });
            
            updateTransactionsUI();
            calculateTotals();
        }
        
        // Add example transactions
        addExampleTransactions();
    </script>
</body>
</html>

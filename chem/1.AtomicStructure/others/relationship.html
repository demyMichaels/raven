<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quantum Love: Relationship Guide to Orbitals</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700;800;900&family=DM+Sans:wght@300;400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
  --bg-primary: #110b14;
  --bg-secondary: #1a1020;
  --bg-card: #1e1428;
  --bg-card-hover: #271a33;
  --text-primary: #f0e6f6;
  --text-secondary: #a090b0;
  --text-muted: #6a5a7a;
  --accent-rose: #ff4d6d;
  --accent-pink: #ff85a1;
  --accent-lavender: #c77dff;
  --accent-gold: #ffd166;
  --accent-mint: #72efdd;
  --accent-blue: #7eb8da;
  --accent-peach: #ffb4a2;
  --border-color: #2a1e3a;
  --glow-rose: 0 0 25px rgba(255,77,109,0.25);
  --glow-lavender: 0 0 25px rgba(199,125,255,0.25);
  --bf-color: #7eb8da;
  --gf-color: #ff85a1;
  --casual: #72efdd;
  --serious: #c77dff;
  --committed: #ffd166;
}

html.dark {}

html:not(.dark) {
  --bg-primary: #fdf6f0;
  --bg-secondary: #ffffff;
  --bg-card: #ffffff;
  --bg-card-hover: #fef9f5;
  --text-primary: #2d1b36;
  --text-secondary: #6b5070;
  --text-muted: #b0a0b8;
  --border-color: #ead8ee;
  --glow-rose: 0 0 18px rgba(255,77,109,0.12);
  --glow-lavender: 0 0 18px rgba(199,125,255,0.12);
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'DM Sans', sans-serif;
  background: var(--bg-primary);
  color: var(--text-primary);
  overflow-x: hidden;
  line-height: 1.6;
}

::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: var(--bg-primary); }
::-webkit-scrollbar-thumb { background: var(--text-muted); border-radius: 3px; }

.bg-hearts {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background-image:
    radial-gradient(circle at 20% 30%, rgba(255,77,109,0.04) 0%, transparent 50%),
    radial-gradient(circle at 80% 70%, rgba(199,125,255,0.04) 0%, transparent 50%),
    radial-gradient(circle at 50% 50%, rgba(255,133,161,0.02) 0%, transparent 60%);
  pointer-events: none;
  z-index: 0;
}

html:not(.dark) .bg-hearts {
  background-image:
    radial-gradient(circle at 20% 30%, rgba(255,77,109,0.05) 0%, transparent 50%),
    radial-gradient(circle at 80% 70%, rgba(199,125,255,0.05) 0%, transparent 50%);
}

.container {
  max-width: 1100px;
  margin: 0 auto;
  padding: 0 20px;
  position: relative;
  z-index: 1;
}

/* Hero */
.hero {
  text-align: center;
  padding: 50px 20px 30px;
  position: relative;
}

.hero-badge {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: rgba(255,77,109,0.08);
  border: 1px solid rgba(255,77,109,0.2);
  padding: 6px 16px;
  border-radius: 30px;
  font-family: 'Space Mono', monospace;
  font-size: 12px;
  color: var(--accent-rose);
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-bottom: 20px;
  animation: fadeIn 0.8s ease;
}

html:not(.dark) .hero-badge {
  background: rgba(255,77,109,0.06);
  border-color: rgba(255,77,109,0.2);
}

.hero h1 {
  font-family: 'Playfair Display', serif;
  font-size: clamp(32px, 6vw, 56px);
  font-weight: 800;
  letter-spacing: -1px;
  line-height: 1.1;
  margin-bottom: 16px;
  animation: fadeIn 0.8s ease 0.1s both;
}

.hero h1 .gradient-text {
  background: linear-gradient(135deg, var(--accent-rose), var(--accent-lavender));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.hero p {
  font-size: clamp(15px, 2.5vw, 18px);
  color: var(--text-secondary);
  max-width: 680px;
  margin: 0 auto;
  font-weight: 300;
  animation: fadeIn 0.8s ease 0.2s both;
}

/* Navigation tabs */
.nav-tabs {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 8px;
  padding: 10px 20px 30px;
  position: sticky;
  top: 0;
  z-index: 100;
  background: var(--bg-primary);
}

.nav-tabs::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0; right: 0;
  height: 20px;
  background: linear-gradient(to bottom, var(--bg-primary), transparent);
  pointer-events: none;
}

.nav-tab {
  padding: 10px 20px;
  border: 1px solid var(--border-color);
  border-radius: 12px;
  background: var(--bg-card);
  color: var(--text-secondary);
  font-family: 'DM Sans', sans-serif;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s ease;
  white-space: nowrap;
}

.nav-tab:hover {
  border-color: var(--accent-rose);
  color: var(--text-primary);
}

.nav-tab.active {
  background: linear-gradient(135deg, rgba(255,77,109,0.12), rgba(199,125,255,0.08));
  border-color: var(--accent-rose);
  color: var(--accent-rose);
  box-shadow: var(--glow-rose);
}

html:not(.dark) .nav-tab.active {
  color: #cc2244;
}

/* Sections */
.section {
  display: none;
  animation: fadeIn 0.5s ease;
  padding-bottom: 60px;
}

.section.active { display: block; }

.section-title {
  font-family: 'Playfair Display', serif;
  font-size: 28px;
  font-weight: 700;
  margin-bottom: 8px;
}

.section-subtitle {
  color: var(--text-secondary);
  margin-bottom: 30px;
  font-weight: 300;
}

/* Cards */
.card {
  background: var(--bg-card);
  border: 1px solid var(--border-color);
  border-radius: 16px;
  padding: 24px;
  margin-bottom: 20px;
  transition: all 0.3s ease;
}

.card:hover {
  border-color: rgba(255,77,109,0.2);
  background: var(--bg-card-hover);
}

/* Canvas containers */
.canvas-container {
  position: relative;
  width: 100%;
  max-width: 500px;
  margin: 0 auto;
  aspect-ratio: 1;
  border-radius: 16px;
  overflow: hidden;
  background: radial-gradient(circle at center, rgba(255,77,109,0.03), transparent 70%);
}

.canvas-container canvas {
  width: 100%;
  height: 100%;
  display: block;
}

/* Analogy Boxes */
.analogy-box {
  background: linear-gradient(135deg, rgba(255,77,109,0.06), rgba(199,125,255,0.06));
  border: 1px solid rgba(255,77,109,0.15);
  border-radius: 14px;
  padding: 18px 22px;
  margin: 16px 0;
  font-size: 14px;
  color: var(--text-secondary);
  position: relative;
  overflow: hidden;
}

.analogy-box::before {
  content: '\1F495';
  position: absolute;
  top: 10px;
  right: 14px;
  font-size: 18px;
  opacity: 0.5;
}

.analogy-box strong {
  color: var(--accent-rose);
}

.analogy-label {
  display: inline-block;
  font-family: 'Space Mono', monospace;
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 1.5px;
  color: var(--accent-lavender);
  margin-bottom: 6px;
}

/* QN Grid */
.qn-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 16px;
  margin-bottom: 30px;
}

.qn-card {
  background: var(--bg-card);
  border: 1px solid var(--border-color);
  border-radius: 16px;
  padding: 24px;
  text-align: center;
  transition: all 0.3s ease;
  cursor: pointer;
  position: relative;
  overflow: hidden;
}

.qn-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 3px;
  border-radius: 16px 16px 0 0;
}

.qn-card[data-qn="n"]::before { background: var(--accent-rose); }
.qn-card[data-qn="l"]::before { background: var(--accent-lavender); }
.qn-card[data-qn="ml"]::before { background: var(--accent-gold); }
.qn-card[data-qn="s"]::before { background: var(--accent-mint); }

.qn-card:hover {
  transform: translateY(-4px);
  border-color: rgba(255,77,109,0.3);
}

.qn-card.selected {
  border-color: var(--accent-rose);
  box-shadow: var(--glow-rose);
}

.qn-symbol {
  font-size: 32px;
  margin-bottom: 4px;
}

.qn-card[data-qn="n"] .qn-symbol { color: var(--accent-rose); }
.qn-card[data-qn="l"] .qn-symbol { color: var(--accent-lavender); }
.qn-card[data-qn="ml"] .qn-symbol { color: var(--accent-gold); }
.qn-card[data-qn="s"] .qn-symbol { color: var(--accent-mint); }

.qn-name {
  font-family: 'Playfair Display', serif;
  font-size: 15px;
  font-weight: 600;
  margin-bottom: 6px;
}

.qn-desc {
  font-size: 12px;
  color: var(--text-secondary);
}

.qn-analogy {
  font-size: 11px;
  color: var(--accent-peach);
  margin-top: 6px;
  font-style: italic;
}

.qn-detail-panel {
  background: var(--bg-card);
  border: 1px solid var(--border-color);
  border-radius: 16px;
  padding: 30px;
  margin-top: 20px;
  display: none;
}

.qn-detail-panel.active { display: block; }

.qn-detail-panel h3 {
  font-family: 'Playfair Display', serif;
  font-size: 22px;
  margin-bottom: 12px;
}

.qn-detail-panel p {
  color: var(--text-secondary);
  margin-bottom: 12px;
  font-size: 15px;
}

.qn-values {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-top: 16px;
}

.qn-value-chip {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 50px;
  padding: 8px 16px;
  border-radius: 10px;
  font-family: 'Space Mono', monospace;
  font-size: 14px;
  font-weight: 700;
  border: 1px solid var(--border-color);
  background: var(--bg-secondary);
  transition: all 0.3s ease;
}

/* Orbital Shapes Section */
.orbital-selector {
  display: flex;
  justify-content: center;
  gap: 12px;
  flex-wrap: wrap;
  margin-bottom: 24px;
}

.orbital-btn {
  width: 64px;
  height: 64px;
  border-radius: 14px;
  border: 2px solid var(--border-color);
  background: var(--bg-card);
  color: var(--text-secondary);
  font-family: 'Space Mono', monospace;
  font-size: 18px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  gap: 2px;
}

.orbital-btn .btn-emoji {
  font-size: 14px;
  font-family: 'DM Sans', sans-serif;
}

.orbital-btn:hover { transform: scale(1.08); }

.orbital-btn.active-s {
  border-color: var(--accent-rose);
  color: var(--accent-rose);
  background: rgba(255,77,109,0.1);
  box-shadow: 0 0 20px rgba(255,77,109,0.2);
}

.orbital-btn.active-p {
  border-color: var(--accent-lavender);
  color: var(--accent-lavender);
  background: rgba(199,125,255,0.1);
  box-shadow: 0 0 20px rgba(199,125,255,0.2);
}

.orbital-btn.active-d {
  border-color: var(--accent-gold);
  color: var(--accent-gold);
  background: rgba(255,209,102,0.1);
  box-shadow: 0 0 20px rgba(255,209,102,0.2);
}

.orbital-info-box {
  text-align: center;
  margin-bottom: 20px;
  padding: 16px;
  border-radius: 12px;
  background: var(--bg-card);
  border: 1px solid var(--border-color);
}

.orbital-info-box .orbital-label {
  font-family: 'Playfair Display', serif;
  font-size: 22px;
  font-weight: 700;
  margin-bottom: 4px;
}

.orbital-info-box .orbital-meta {
  font-size: 13px;
  color: var(--text-secondary);
}

/* Prob controls */
.prob-controls {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 16px;
  flex-wrap: wrap;
  margin-bottom: 20px;
}

.prob-controls label {
  font-size: 14px;
  color: var(--text-secondary);
}

.prob-controls input[type="range"] {
  width: 200px;
  accent-color: var(--accent-rose);
}

/* Table Section */
.quantum-table-wrapper {
  overflow-x: auto;
  border-radius: 16px;
  border: 1px solid var(--border-color);
}

.quantum-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
}

.quantum-table th {
  background: var(--bg-card);
  padding: 14px 12px;
  text-align: center;
  font-weight: 600;
  font-size: 12px;
  letter-spacing: 0.5px;
  border-bottom: 2px solid var(--border-color);
  position: sticky;
  top: 0;
  white-space: nowrap;
}

.quantum-table td {
  padding: 12px;
  text-align: center;
  border-bottom: 1px solid var(--border-color);
  font-family: 'Space Mono', monospace;
  font-size: 13px;
  transition: all 0.2s ease;
}

.quantum-table tr:hover td {
  background: var(--bg-card-hover);
}

.quantum-table .stage-1 td:first-child { border-left: 3px solid var(--casual); }
.quantum-table .stage-2 td:first-child { border-left: 3px solid var(--serious); }
.quantum-table .stage-3 td:first-child { border-left: 3px solid var(--committed); }

.table-highlight {
  background: rgba(255,77,109,0.08) !important;
  color: var(--accent-rose) !important;
}

/* Spin Section */
.spin-demo {
  display: flex;
  justify-content: center;
  gap: 60px;
  flex-wrap: wrap;
  margin: 30px 0;
}

.spin-box {
  text-align: center;
}

.spin-canvas-wrap {
  width: 160px;
  height: 160px;
  margin: 0 auto 12px;
}

.spin-canvas-wrap canvas {
  width: 100%;
  height: 100%;
}

.spin-label {
  font-family: 'Playfair Display', serif;
  font-size: 18px;
  font-weight: 700;
}

.spin-label.bf { color: var(--bf-color); }
.spin-label.gf { color: var(--gf-color); }

/* Shells Section */
.shell-viewer {
  position: relative;
  width: 100%;
  max-width: 500px;
  aspect-ratio: 1;
  margin: 0 auto 20px;
}

.shell-viewer canvas {
  width: 100%;
  height: 100%;
}

.shell-controls {
  display: flex;
  justify-content: center;
  gap: 12px;
  margin-bottom: 20px;
}

.shell-btn {
  padding: 12px 24px;
  border-radius: 12px;
  border: 2px solid var(--border-color);
  background: var(--bg-card);
  color: var(--text-secondary);
  font-family: 'DM Sans', sans-serif;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.shell-btn:hover { transform: scale(1.05); }
.shell-btn.active-1 { border-color: var(--casual); color: var(--casual); background: rgba(114,239,221,0.08); }
.shell-btn.active-2 { border-color: var(--serious); color: var(--serious); background: rgba(199,125,255,0.08); }
.shell-btn.active-3 { border-color: var(--committed); color: var(--committed); background: rgba(255,209,102,0.08); }

.shell-info {
  text-align: center;
  padding: 20px;
  border-radius: 12px;
  background: var(--bg-card);
  border: 1px solid var(--border-color);
}

.shell-info h3 {
  font-family: 'Playfair Display', serif;
  font-size: 22px;
  margin-bottom: 6px;
}

.shell-info p {
  color: var(--text-secondary);
  font-size: 14px;
}

/* Energy Diagram */
.energy-diagram {
  position: relative;
  width: 100%;
  max-width: 400px;
  margin: 20px auto;
}

.energy-level {
  display: flex;
  align-items: center;
  gap: 16px;
  margin-bottom: 14px;
  padding: 10px 16px;
  border-radius: 10px;
  border: 1px solid var(--border-color);
  background: var(--bg-card);
  transition: all 0.3s ease;
  cursor: pointer;
}

.energy-level:hover {
  border-color: rgba(255,77,109,0.3);
}

.energy-level.highlighted {
  border-color: var(--accent-rose);
  box-shadow: var(--glow-rose);
}

.energy-bar {
  height: 4px;
  border-radius: 2px;
  flex: 1;
}

.energy-label {
  font-family: 'Space Mono', monospace;
  font-size: 14px;
  font-weight: 700;
  min-width: 30px;
}

.energy-electrons {
  font-size: 12px;
  color: var(--text-secondary);
  min-width: 60px;
  text-align: right;
}

/* Notation display */
.notation-display {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  font-family: 'Space Mono', monospace;
  font-size: 36px;
  font-weight: 700;
  margin: 20px 0;
  padding: 20px;
  border-radius: 12px;
  background: var(--bg-card);
  border: 1px solid var(--border-color);
}

.notation-n { color: var(--accent-rose); }
.notation-l { color: var(--accent-lavender); }
.notation-ml { color: var(--accent-gold); }

/* Keyframes */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(12px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Footer */
.footer-note {
  text-align: center;
  padding: 30px 20px;
  color: var(--text-muted);
  font-size: 12px;
  border-top: 1px solid var(--border-color);
  margin-top: 40px;
}

/* Responsive */
@media (max-width: 600px) {
  .hero { padding: 30px 16px 20px; }
  .nav-tabs { gap: 6px; padding: 8px 12px 20px; }
  .nav-tab { padding: 8px 14px; font-size: 12px; }
  .qn-grid { grid-template-columns: 1fr 1fr; gap: 10px; }
  .qn-card { padding: 16px; }
  .qn-symbol { font-size: 26px; }
  .spin-demo { gap: 30px; }
  .card { padding: 16px; }
  .orbital-btn { width: 52px; height: 52px; font-size: 15px; }
  .quantum-table { font-size: 12px; }
  .quantum-table th, .quantum-table td { padding: 8px 6px; }
  .notation-display { font-size: 28px; padding: 14px; }
}

/* Couple badge */
.couple-badge {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 3px 10px;
  border-radius: 20px;
  font-size: 11px;
  font-weight: 600;
}

.couple-badge.bf {
  background: rgba(126,184,218,0.12);
  color: var(--bf-color);
  border: 1px solid rgba(126,184,218,0.25);
}

.couple-badge.gf {
  background: rgba(255,133,161,0.12);
  color: var(--gf-color);
  border: 1px solid rgba(255,133,161,0.25);
}

/* Versus divider */
.vs-divider {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 16px;
  margin: 20px 0;
  color: var(--text-muted);
  font-family: 'Playfair Display', serif;
  font-size: 14px;
  font-style: italic;
}

.vs-divider::before,
.vs-divider::after {
  content: '';
  flex: 1;
  height: 1px;
  background: linear-gradient(to right, transparent, var(--border-color), transparent);
}
</style>
</head>
<body>
<div class="bg-hearts"></div>

<div class="container">
  <!-- Hero -->
  <div class="hero">
    <div class="hero-badge"><i class="fas fa-heart"></i> Quantum Chemistry + Romance</div>
    <h1>The <span class="gradient-text">Relationship</span> Guide to Atomic Orbitals</h1>
    <p>Understanding where electrons live is like understanding where couples hang out. Let's use boyfriend-girlfriend dynamics to explore quantum numbers, orbital shapes, and more.</p>
  </div>

  <!-- Navigation -->
  <div class="nav-tabs" id="navTabs">
    <button class="nav-tab active" data-section="quantum-numbers"><i class="fas fa-hashtag"></i> The 4 Rules</button>
    <button class="nav-tab" data-section="orbital-shapes"><i class="fas fa-shapes"></i> Hangout Zones</button>
    <button class="nav-tab" data-section="shells"><i class="fas fa-circle-notch"></i> Relationship Stage</button>
    <button class="nav-tab" data-section="spin"><i class="fas fa-sync-alt"></i> BF vs GF</button>
    <button class="nav-tab" data-section="table"><i class="fas fa-table"></i> Cheat Sheet</button>
  </div>

  <!-- Section 1: Quantum Numbers as Relationship Rules -->
  <div class="section active" id="quantum-numbers">
    <div class="container">
      <h2 class="section-title">The 4 Rules of Quantum Relationships</h2>
      <p class="section-subtitle">Every electron (person in a couple) is described by 4 numbers — like a dating profile. Tap a card to learn more.</p>

      <div class="analogy-box">
        <div class="analogy-label">The Big Analogy</div>
        Think of an <strong>atom as an apartment building</strong>. Each couple (pair of electrons) needs a unique unit. The 4 quantum numbers are like the <strong>floor, apartment type, room number, and which partner</strong> you're describing — no two people can share the exact same address!
      </div>

      <div class="qn-grid">
        <div class="qn-card selected" data-qn="n" onclick="selectQN('n')">
          <div class="qn-symbol">&#x1F3E2;</div>
          <div class="qn-name">n — The Floor</div>
          <div class="qn-desc">Which floor of the building?</div>
          <div class="qn-analogy">= Relationship stage</div>
        </div>
        <div class="qn-card" data-qn="l" onclick="selectQN('l')">
          <div class="qn-symbol">&#x1F3E0;</div>
          <div class="qn-name">&#x2113; — Apartment Type</div>
          <div class="qn-desc">Studio, 1-bed, 2-bed?</div>
          <div class="qn-analogy">= Date activity type</div>
        </div>
        <div class="qn-card" data-qn="ml" onclick="selectQN('ml')">
          <div class="qn-symbol">&#x1F6AA;</div>
          <div class="qn-name">m<sub>&#x2113;</sub> — Room Number</div>
          <div class="qn-desc">Which specific unit?</div>
          <div class="qn-analogy">= Favorite hangout spot</div>
        </div>
        <div class="qn-card" data-qn="s" onclick="selectQN('s')">
          <div class="qn-symbol">&#x1F491;</div>
          <div class="qn-name">m<sub>s</sub> — Which Partner</div>
          <div class="qn-desc">Boyfriend or Girlfriend?</div>
          <div class="qn-analogy">= Spin up or down</div>
        </div>
      </div>

      <!-- Detail panels -->
      <div class="qn-detail-panel active" id="qn-detail-n">
        <h3 style="color:var(--accent-rose)">&#x1F3E2; n — The Floor (Principal Quantum Number)</h3>
        <p><strong>Real physics:</strong> Determines the <em>energy level</em> and how <em>far</em> the electron is from the nucleus.</p>
        <div class="analogy-box">
          <div class="analogy-label">Relationship Analogy</div>
          Think of <strong>n as the relationship stage</strong>. Floor 1 = just started dating (close to home, low energy). Floor 2 = getting serious (more space, more options). Floor 3 = fully committed (biggest apartments, most room). <strong>Higher floors = more energy to maintain, but way more space for activities.</strong>
        </div>
        <p style="font-size:13px;color:var(--text-muted)">Allowed values: 1, 2, 3, 4… (you keep moving up!)</p>
        <div class="qn-values" id="qn-values-n"></div>
      </div>

      <div class="qn-detail-panel" id="qn-detail-l">
        <h3 style="color:var(--accent-lavender)">&#x1F3E0; &#x2113; — Apartment Type (Angular Momentum)</h3>
        <p><strong>Real physics:</strong> Determines the <em>shape</em> of the orbital. Ranges from 0 to n−1.</p>
        <div class="analogy-box">
          <div class="analogy-label">Relationship Analogy</div>
          The apartment type is like <strong>what kind of date you go on</strong>. On Floor 1, there's only a <strong>studio (s = cozy night in)</strong>. Floor 2 adds a <strong>1-bedroom (p = dinner date with direction)</strong>. Floor 3 also gets a <strong>2-bedroom (d = double date, more complex)</strong>. As your relationship grows, you unlock more date types!
        </div>
        <p style="font-size:13px;color:var(--text-muted)">s (&#x2113;=0) = Studio · p (&#x2113;=1) = 1-Bed · d (&#x2113;=2) = 2-Bed · f (&#x2113;=3) = Penthouse</p>
        <div class="qn-values" id="qn-values-l"></div>
      </div>

      <div class="qn-detail-panel" id="qn-detail-ml">
        <h3 style="color:var(--accent-gold)">&#x1F6AA; m<sub>&#x2113;</sub> — Room Number (Magnetic Quantum Number)</h3>
        <p><strong>Real physics:</strong> Determines the <em>orientation</em> of the orbital in 3D space. Values from −&#x2113; to +&#x2113;.</p>
        <div class="analogy-box">
          <div class="analogy-label">Relationship Analogy</div>
          On any given floor, each apartment type has <strong>specific units</strong>. A studio has just 1 room. But a 1-bed apartment (p) comes in <strong>3 orientations: facing east, west, or south</strong> — like having 3 favorite date spots (the caf&eacute;, the park, or the cinema). The 2-bed (d) has 5 possible units. More complex apartment = more room numbers!
        </div>
        <p style="font-size:13px;color:var(--text-muted)">s → 1 room · p → 3 rooms · d → 5 rooms · f → 7 rooms</p>
        <div class="qn-values" id="qn-values-ml"></div>
      </div>

      <div class="qn-detail-panel" id="qn-detail-s">
        <h3 style="color:var(--accent-mint)">&#x1F491; m<sub>s</sub> — Which Partner (Spin Quantum Number)</h3>
        <p><strong>Real physics:</strong> Describes the <em>intrinsic spin</em> of the electron. Only two values: +½ or −½.</p>
        <div class="analogy-box">
          <div class="analogy-label">Relationship Analogy</div>
          Every apartment unit holds exactly <strong>one couple — a boyfriend (+½) and a girlfriend (−½)</strong>. That's the max occupancy! This is why each orbital holds exactly 2 electrons. If one partner is already there, only one more with the <strong>opposite role</strong> can move in. This is the <strong>Pauli Exclusion Principle</strong> — no identical roommates allowed.
        </div>
        <p style="font-size:13px;color:var(--text-muted)">+½ = Boyfriend (↑) · −½ = Girlfriend (↓) · Always a pair!</p>
        <div class="qn-values" id="qn-values-s"></div>
      </div>

      <!-- Interactive builder -->
      <div class="card" style="margin-top:30px">
        <h3 style="margin-bottom:12px"><i class="fas fa-sliders-h" style="color:var(--accent-rose)"></i> &nbsp;Build a Couple's Address</h3>
        <p style="font-size:14px;color:var(--text-secondary);margin-bottom:20px">Choose a floor, apartment type, room, and partner to create a unique quantum "address" for someone in the building.</p>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:16px">
          <div>
            <label style="font-size:13px;color:var(--text-muted);margin-bottom:4px;display:block">&#x1F3E2; Floor (n)</label>
            <select id="builder-n" onchange="updateBuilder()" style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border-color);background:var(--bg-secondary);color:var(--text-primary);font-size:16px;font-family:'Space Mono',monospace">
              <option value="1">1 — New Couple</option>
              <option value="2">2 — Getting Serious</option>
              <option value="3" selected>3 — Committed</option>
            </select>
          </div>
          <div>
            <label style="font-size:13px;color:var(--text-muted);margin-bottom:4px;display:block">&#x1F3E0; Apt Type (&#x2113;)</label>
            <select id="builder-l" onchange="updateBuilder()" style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border-color);background:var(--bg-secondary);color:var(--text-primary);font-size:16px;font-family:'Space Mono',monospace"></select>
          </div>
          <div>
            <label style="font-size:13px;color:var(--text-muted);margin-bottom:4px;display:block">&#x1F6AA; Room (m<sub>&#x2113;</sub>)</label>
            <select id="builder-ml" onchange="updateBuilder()" style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border-color);background:var(--bg-secondary);color:var(--text-primary);font-size:16px;font-family:'Space Mono',monospace"></select>
          </div>
          <div>
            <label style="font-size:13px;color:var(--text-muted);margin-bottom:4px;display:block">&#x1F491; Partner (m<sub>s</sub>)</label>
            <select id="builder-s" style="width:100%;padding:10px;border-radius:8px;border:1px solid var(--border-color);background:var(--bg-secondary);color:var(--text-primary);font-size:16px;font-family:'Space Mono',monospace">
              <option value="+1/2">+½ Boyfriend ↑</option>
              <option value="-1/2">−½ Girlfriend ↓</option>
            </select>
          </div>
        </div>
        <div class="notation-display" id="notation-display">
          <span class="notation-n">3</span><span class="notation-l">d</span><span class="notation-ml" style="font-size:16px;opacity:0.6">(room 0)</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Section 2: Orbital Shapes as Hangout Zones -->
  <div class="section" id="orbital-shapes">
    <div class="container">
      <h2 class="section-title">Hangout Zones</h2>
      <p class="section-subtitle">Where will you most likely find the couple? The orbital shape shows the probability cloud — their favorite spots.</p>

      <div class="analogy-box">
        <div class="analogy-label">The Hangout Analogy</div>
        If you tracked where a couple spends their time over a month, you'd get a <strong>heat map of their favorite spots</strong>. That's exactly what an orbital shape is — a probability cloud showing where you're most likely to find the electron. The denser the cloud, the more often they're there!
      </div>

      <div class="orbital-selector" id="orbitalSelector">
        <button class="orbital-btn active-s" data-orbital="1s" onclick="selectOrbital('1s')"><span>1s</span><span class="btn-emoji">&#x1F3E0;</span></button>
        <button class="orbital-btn" data-orbital="2s" onclick="selectOrbital('2s')"><span>2s</span><span class="btn-emoji">&#x1F3E1;</span></button>
        <button class="orbital-btn" data-orbital="2p" onclick="selectOrbital('2p')"><span>2p</span><span class="btn-emoji">&#x1F37D;</span></button>
        <button class="orbital-btn" data-orbital="3s" onclick="selectOrbital('3s')"><span>3s</span><span class="btn-emoji">&#x1F3D8;</span></button>
        <button class="orbital-btn" data-orbital="3p" onclick="selectOrbital('3p')"><span>3p</span><span class="btn-emoji">&#x1F3AD;</span></button>
        <button class="orbital-btn" data-orbital="3d" onclick="selectOrbital('3d')"><span>3d</span><span class="btn-emoji">&#x1F3AA;</span></button>
      </div>

      <div class="orbital-info-box" id="orbitalInfoBox">
        <div class="orbital-label" id="orbitalLabel" style="color:var(--accent-rose)">1s — The Cozy Nest</div>
        <div class="orbital-meta" id="orbitalMeta">Floor 1 · Studio apartment · 1 room · Max 1 couple</div>
      </div>

      <div class="canvas-container">
        <canvas id="orbitalCanvas"></canvas>
      </div>

      <div class="prob-controls" style="margin-top:16px">
        <label>How often they're spotted:</label>
        <input type="range" id="densitySlider" min="100" max="2000" value="800" oninput="updateOrbitalDensity()">
        <span id="densityValue" style="font-family:'Space Mono',monospace;font-size:13px;color:var(--accent-rose)">800</span>
      </div>

      <div class="card" style="margin-top:20px">
        <h3 style="margin-bottom:8px"><i class="fas fa-lightbulb" style="color:var(--accent-gold)"></i> &nbsp;Love Insight</h3>
        <p style="font-size:14px;color:var(--text-secondary)" id="orbitalInsight">
          The 1s couple is like brand-new sweethearts — they're always near home (the nucleus), equally likely to be in any direction. Their hangout zone is a perfect sphere. Aww, they just want to be close to the center of it all!
        </p>
      </div>
    </div>
  </div>

  <!-- Section 3: Shells & Energy as Relationship Stages -->
  <div class="section" id="shells">
    <div class="container">
      <h2 class="section-title">Relationship Stages &amp; Energy</h2>
      <p class="section-subtitle">Higher floors = more serious relationship. More energy, more space, more couple options.</p>

      <div class="analogy-box">
        <div class="analogy-label">The Stage Analogy</div>
        <strong>Stage 1 (Casual Dating)</strong> — Close to home, just one cozy studio. <strong>Stage 2 (Getting Serious)</strong> — More room, dinner dates unlock! <strong>Stage 3 (Committed)</strong> — Full access to studios, dinners, AND double-dates. Each stage takes more energy to maintain but supports more couples.
      </div>

      <div class="shell-controls">
        <button class="shell-btn active-1" data-shell="1" onclick="selectShell(1)">Stage 1 &#x1F49A;</button>
        <button class="shell-btn" data-shell="2" onclick="selectShell(2)">Stage 2 &#x1F49C;</button>
        <button class="shell-btn" data-shell="3" onclick="selectShell(3)">Stage 3 &#x1F49B;</button>
      </div>

      <div class="shell-viewer">
        <canvas id="shellCanvas"></canvas>
      </div>

      <div class="shell-info" id="shellInfo">
        <h3 style="color:var(--casual)">Stage 1 — Casual Dating</h3>
        <p>Apartments: <strong>1s</strong> (studio only)</p>
        <p>Max couples: <strong>1</strong> (2 people)</p>
      </div>

      <h3 style="margin:30px 0 16px;font-family:'Playfair Display',serif">Energy Required per Date Type</h3>
      <div class="energy-diagram" id="energyDiagram"></div>
    </div>
  </div>

  <!-- Section 4: Electron Spin as BF vs GF -->
  <div class="section" id="spin">
    <div class="container">
      <h2 class="section-title">Boyfriend vs. Girlfriend</h2>
      <p class="section-subtitle">Every orbital (apartment) can hold exactly 2 electrons — one "spin up" (BF) and one "spin down" (GF). They're always a complementary pair.</p>

      <div class="analogy-box">
        <div class="analogy-label">The Partner Analogy</div>
        Electron spin is like the <strong>two roles in a couple</strong>. The boyfriend (+½, spin up) and the girlfriend (−½, spin down) are fundamentally the same type of particle — both electrons — but they spin in <strong>opposite directions</strong>. An apartment can only hold one of each. You can't have two boyfriends or two girlfriends in the same orbital (sorry, quantum rules)!
      </div>

      <div class="spin-demo">
        <div class="spin-box">
          <div class="spin-canvas-wrap"><canvas id="spinUpCanvas"></canvas></div>
          <div class="spin-label bf">+½ Boyfriend ↑</div>
          <p style="font-size:13px;color:var(--text-secondary);margin-top:4px">Counterclockwise spin</p>
        </div>
        <div class="spin-box">
          <div class="spin-canvas-wrap"><canvas id="spinDownCanvas"></canvas></div>
          <div class="spin-label gf">−½ Girlfriend ↓</div>
          <p style="font-size:13px;color:var(--text-secondary);margin-top:4px">Clockwise spin</p>
        </div>
      </div>

      <div class="card">
        <h3 style="margin-bottom:8px"><i class="fas fa-ban" style="color:var(--accent-rose)"></i> &nbsp;Pauli Exclusion Principle (The "No Clone" Rule)</h3>
        <p style="font-size:14px;color:var(--text-secondary)">
          <strong>No two people in the building can have the exact same address.</strong> Since each apartment is defined by (Floor, Type, Room), the only thing that can differ between two people in the same room is their role. One must be the BF (+½) and one must be the GF (−½). That's why every orbital holds <strong>max 2 electrons</strong> — one couple, always complementary.
        </p>
      </div>

      <div class="card" style="margin-top:16px">
        <h3 style="margin-bottom:12px"><i class="fas fa-building" style="color:var(--accent-lavender)"></i> &nbsp;Apartment Occupancy Diagram</h3>
        <p style="font-size:14px;color:var(--text-secondary);margin-bottom:6px">Carbon (6 people in the building). See how couples fill rooms — BF first, then GF joins:</p>
        <p style="font-size:12px;color:var(--text-muted);margin-bottom:16px">Hund's Rule: spread out before pairing — like how couples prefer different rooms before doubling up!</p>
        <div id="boxDiagram" style="display:flex;flex-wrap:wrap;gap:20px;justify-content:center"></div>
      </div>
    </div>
  </div>

  <!-- Section 5: Quantum Table -->
  <div class="section" id="table">
    <div class="container">
      <h2 class="section-title">The Complete Cheat Sheet</h2>
      <p class="section-subtitle">All valid quantum "addresses" for Floors 1–3. Hover over a row to highlight it.</p>

      <div class="analogy-box">
        <div class="analogy-label">Reading the Table</div>
        Each row shows a <strong>type of apartment</strong> on a given floor. The "Rooms" column tells you how many units of that type exist, and "Max People" is the total capacity (rooms × 2 per couple). Together, they give every possible address in the quantum apartment building!
      </div>

      <div class="quantum-table-wrapper">
        <table class="quantum-table" id="quantumTable">
          <thead>
            <tr>
              <th>&#x1F3E2; Floor (n)</th>
              <th>&#x1F3E0; Type (&#x2113;)</th>
              <th>Name</th>
              <th>&#x1F6AA; Rooms (m<sub>&#x2113;</sub>)</th>
              <th># Apts</th>
              <th>Max People</th>
            </tr>
          </thead>
          <tbody id="quantumTableBody"></tbody>
        </table>
      </div>

      <div class="card" style="margin-top:20px">
        <h3 style="margin-bottom:8px"><i class="fas fa-calculator" style="color:var(--accent-lavender)"></i> &nbsp;Quick Building Codes</h3>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-top:12px">
          <div style="padding:12px;border-radius:10px;background:var(--bg-secondary);border:1px solid var(--border-color)">
            <div style="font-family:'Space Mono',monospace;font-size:15px;color:var(--accent-rose);margin-bottom:4px">&#x2113; = 0 to n − 1</div>
            <div style="font-size:12px;color:var(--text-secondary)">Higher floor = more apt types</div>
          </div>
          <div style="padding:12px;border-radius:10px;background:var(--bg-secondary);border:1px solid var(--border-color)">
            <div style="font-family:'Space Mono',monospace;font-size:15px;color:var(--accent-lavender);margin-bottom:4px">m<sub>&#x2113;</sub> = −&#x2113; to +&#x2113;</div>
            <div style="font-size:12px;color:var(--text-secondary)">More complex apt = more rooms</div>
          </div>
          <div style="padding:12px;border-radius:10px;background:var(--bg-secondary);border:1px solid var(--border-color)">
            <div style="font-family:'Space Mono',monospace;font-size:15px;color:var(--accent-gold);margin-bottom:4px">2(2&#x2113; + 1) people</div>
            <div style="font-size:12px;color:var(--text-secondary)">Max per apartment type</div>
          </div>
          <div style="padding:12px;border-radius:10px;background:var(--bg-secondary);border:1px solid var(--border-color)">
            <div style="font-family:'Space Mono',monospace;font-size:15px;color:var(--accent-mint);margin-bottom:4px">2n² total</div>
            <div style="font-size:12px;color:var(--text-secondary)">Max people per floor</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="footer-note">
  Quantum Love: The Relationship Guide to Orbitals · Because chemistry is about connections &#x1F495;
</div>

<script>
/* ===== Dark Mode Detection ===== */
if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
  document.documentElement.classList.add('dark');
}
window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(event) {
  if (event.matches) {
    document.documentElement.classList.add('dark');
  } else {
    document.documentElement.classList.remove('dark');
  }
});

/* ===== Navigation ===== */
document.querySelectorAll('.nav-tab').forEach(function(tab) {
  tab.addEventListener('click', function() {
    document.querySelectorAll('.nav-tab').forEach(function(t) { t.classList.remove('active'); });
    document.querySelectorAll('.section').forEach(function(s) { s.classList.remove('active'); });
    tab.classList.add('active');
    var target = document.getElementById(tab.dataset.section);
    if (target) target.classList.add('active');
    initCurrentSection();
  });
});

function initCurrentSection() {
  var activeEl = document.querySelector('.section.active');
  if (!activeEl) return;
  var id = activeEl.id;
  if (id === 'orbital-shapes') initOrbitalCanvas();
  if (id === 'shells') initShellCanvas();
  if (id === 'spin') initSpinCanvases();
}

/* ===== Quantum Number Cards ===== */
function selectQN(qn) {
  document.querySelectorAll('.qn-card').forEach(function(c) { c.classList.remove('selected'); });
  document.querySelector('.qn-card[data-qn="' + qn + '"]').classList.add('selected');
  document.querySelectorAll('.qn-detail-panel').forEach(function(p) { p.classList.remove('active'); });
  var panel = document.getElementById('qn-detail-' + qn);
  if (panel) panel.classList.add('active');
}

function buildQNValues() {
  var nContainer = document.getElementById('qn-values-n');
  var nLabels = ['1 \u2014 First Date', '2 \u2014 Dating', '3 \u2014 Serious', '4 \u2014 Soulmates'];
  nLabels.forEach(function(v) {
    var chip = document.createElement('div');
    chip.className = 'qn-value-chip';
    chip.textContent = v;
    chip.style.color = 'var(--accent-rose)';
    chip.style.fontSize = '12px';
    nContainer.appendChild(chip);
  });

  var lContainer = document.getElementById('qn-values-l');
  var lLabels = ['0 (s) Studio', '1 (p) 1-Bed', '2 (d) 2-Bed', '3 (f) Penthouse'];
  lLabels.forEach(function(v) {
    var chip = document.createElement('div');
    chip.className = 'qn-value-chip';
    chip.textContent = v;
    chip.style.color = 'var(--accent-lavender)';
    chip.style.fontSize = '12px';
    lContainer.appendChild(chip);
  });

  var mlContainer = document.getElementById('qn-values-ml');
  [-3,-2,-1,0,1,2,3].forEach(function(v) {
    var chip = document.createElement('div');
    chip.className = 'qn-value-chip';
    chip.textContent = 'Room ' + (v > 0 ? '+' : '') + v;
    chip.style.color = 'var(--accent-gold)';
    chip.style.fontSize = '12px';
    mlContainer.appendChild(chip);
  });

  var sContainer = document.getElementById('qn-values-s');
  ['+\u00BD BF \u2191', '\u2212\u00BD GF \u2193'].forEach(function(v) {
    var chip = document.createElement('div');
    chip.className = 'qn-value-chip';
    chip.textContent = v;
    chip.style.color = 'var(--accent-mint)';
    chip.style.fontSize = '12px';
    sContainer.appendChild(chip);
  });
}
buildQNValues();

/* ===== Builder ===== */
var lLetters = ['s','p','d','f'];
var lNames = ['Studio', '1-Bed', '2-Bed', 'Penthouse'];

function updateBuilder() {
  var n = parseInt(document.getElementById('builder-n').value);
  var lSelect = document.getElementById('builder-l');
  var mlSelect = document.getElementById('builder-ml');

  var prevL = parseInt(lSelect.value) || 0;
  lSelect.innerHTML = '';
  for (var i = 0; i < n; i++) {
    var opt = document.createElement('option');
    opt.value = i;
    opt.textContent = i + ' (' + lLetters[i] + ') ' + lNames[i];
    lSelect.appendChild(opt);
  }
  if (prevL < n) lSelect.value = prevL;

  var l = parseInt(lSelect.value);
  var prevMl = parseInt(mlSelect.value) || 0;
  mlSelect.innerHTML = '';
  for (var m = -l; m <= l; m++) {
    var opt2 = document.createElement('option');
    opt2.value = m;
    opt2.textContent = 'Room ' + (m > 0 ? '+' : '') + m;
    mlSelect.appendChild(opt2);
  }
  if (prevMl >= -l && prevMl <= l) mlSelect.value = prevMl;

  var finalL = parseInt(lSelect.value);
  var finalMl = parseInt(mlSelect.value);
  var display = document.getElementById('notation-display');
  display.innerHTML =
    '<span class="notation-n">' + n + '</span>' +
    '<span class="notation-l">' + lLetters[finalL] + '</span>' +
    '<span class="notation-ml" style="font-size:16px;opacity:0.6">(room ' + (finalMl > 0 ? '+' : '') + finalMl + ')</span>';
}
updateBuilder();

/* ===== Orbital Shapes Canvas ===== */
var currentOrbital = '1s';
var orbitalParticles = [];
var orbitalAnimId = null;
var particleDensity = 800;

var orbitalData = {
  '1s': {
    name:'1s \u2014 The Cozy Nest', color:'#ff4d6d', n:1, l:0,
    meta:'Floor 1 \u00B7 Studio apartment \u00B7 1 room \u00B7 Max 1 couple',
    insight:'The 1s couple is like brand-new sweethearts \u2014 they\u2019re always near home (the nucleus), equally likely to be found in any direction. Their hangout zone is a perfect sphere. They just want to be close to the center of it all! In physics terms, it\u2019s the lowest-energy, most tightly-bound orbital.'
  },
  '2s': {
    name:'2s \u2014 The Bigger Nest', color:'#ff85a1', n:2, l:0,
    meta:'Floor 2 \u00B7 Studio (larger) \u00B7 1 room \u00B7 Max 1 couple',
    insight:'The 2s couple is more established \u2014 they still hang out everywhere equally (spherical), but they\u2019ve expanded their territory. There\u2019s a \u201Cno-go zone\u201D ring (a radial node) where they\u2019re never found, like a neighborhood they\u2019ve outgrown. More space, same cozy vibes!'
  },
  '2p': {
    name:'2p \u2014 The Dinner Date', color:'#c77dff', n:2, l:1,
    meta:'Floor 2 \u00B7 1-Bedroom \u00B7 3 rooms (x, y, z) \u00B7 Max 3 couples',
    insight:'The p-orbital couple has a clear direction \u2014 they\u2019re the dinner-date type, always heading to a specific spot. The dumbbell shape means they split their time between two favorite places (lobes) with a no-man\u2019s-land in between. Three orientations = three different date-night routes!'
  },
  '3s': {
    name:'3s \u2014 The Expanded Nest', color:'#ffb4a2', n:3, l:0,
    meta:'Floor 3 \u00B7 Studio (largest) \u00B7 1 room \u00B7 Max 1 couple',
    insight:'The 3s couple has been together so long, they\u2019ve explored the whole city! Still spherical (no preferred direction), but with TWO no-go rings \u2014 like neighborhoods they used to frequent but have moved beyond. Their world keeps getting bigger.'
  },
  '3p': {
    name:'3p \u2014 The Grand Date', color:'#c77dff', n:3, l:1,
    meta:'Floor 3 \u00B7 1-Bedroom (larger) \u00B7 3 rooms \u00B7 Max 3 couples',
    insight:'Like 2p but bigger and fancier! This couple still loves directional date nights, but now they range further and have an extra no-go zone in each lobe. They\u2019ve upgraded from the local bistro to a destination restaurant!'
  },
  '3d': {
    name:'3d \u2014 The Double Date', color:'#ffd166', n:3, l:2,
    meta:'Floor 3 \u00B7 2-Bedroom \u00B7 5 rooms \u00B7 Max 5 couples',
    insight:'The d-orbital is the complex double-date setup! Four lobes (cloverleaf pattern) mean this couple has FOUR favorite hangout quadrants. With 5 possible orientations, there are lots of ways to arrange group activities. These unlock in serious relationships (Floor 3+) and are crucial in transition metal chemistry!'
  }
};

function selectOrbital(name) {
  currentOrbital = name;
  document.querySelectorAll('.orbital-btn').forEach(function(b) {
    b.className = 'orbital-btn';
  });
  var btn = document.querySelector('.orbital-btn[data-orbital="' + name + '"]');
  var data = orbitalData[name];
  var activeClass = 'active-' + lLetters[data.l];
  btn.classList.add(activeClass);

  document.getElementById('orbitalLabel').textContent = data.name;
  document.getElementById('orbitalLabel').style.color = data.color;
  document.getElementById('orbitalMeta').textContent = data.meta;
  document.getElementById('orbitalInsight').textContent = data.insight;
  initOrbitalCanvas();
}

function generateOrbitalParticles(name, count, w, h) {
  var particles = [];
  var cx = w / 2;
  var cy = h / 2;
  var scale = Math.min(w, h) * 0.4;
  var data = orbitalData[name];
  var n = data.n;
  var l = data.l;

  for (var i = 0; i < count; i++) {
    var r, prob, px, py, pz;
    var attempts = 0;

    do {
      r = Math.random() * n * 1.2;
      var theta = Math.random() * Math.PI * 2;
      var phi = Math.random() * Math.PI;

      px = r * Math.sin(phi) * Math.cos(theta);
      py = r * Math.sin(phi) * Math.sin(theta);
      pz = r * Math.cos(phi);

      if (l === 0) {
        var radialPart = Math.exp(-r / n) * laguerreApprox(r, n);
        prob = radialPart * radialPart;
      } else if (l === 1) {
        var radialPart2 = r * Math.exp(-r / n) * laguerreApprox(r, n);
        var angularPart = pz / (r + 0.001);
        prob = radialPart2 * radialPart2 * angularPart * angularPart;
      } else {
        var radialPart3 = r * r * Math.exp(-r / n);
        var angularPart2 = px * py / ((r * r) + 0.001);
        prob = radialPart3 * radialPart3 * angularPart2 * angularPart2 * 20;
      }

      attempts++;
    } while (Math.random() > prob * 5 && attempts < 50);

    var depth = 1 / (1 + pz * 0.1);
    var finalX = cx + px * scale * 0.5 * depth;
    var finalY = cy + py * scale * 0.5 * depth;

    var size = (0.5 + Math.random() * 2) * depth;
    var alpha = (0.3 + prob * 3) * depth;
    alpha = Math.min(alpha, 0.9);

    particles.push({
      x: finalX, y: finalY,
      baseX: finalX, baseY: finalY,
      size: size,
      alpha: alpha,
      phase: Math.random() * Math.PI * 2,
      speed: 0.5 + Math.random() * 1.5,
      drift: 0.3 + Math.random() * 1,
      isBf: Math.random() > 0.5
    });
  }
  return particles;
}

function laguerreApprox(r, n) {
  if (n === 1) return 1;
  if (n === 2) return 1 - r / 2;
  if (n === 3) return 1 - 2 * r / 3 + 2 * r * r / 27;
  return 1;
}

function initOrbitalCanvas() {
  if (orbitalAnimId) cancelAnimationFrame(orbitalAnimId);
  var canvas = document.getElementById('orbitalCanvas');
  if (!canvas) return;
  var rect = canvas.parentElement.getBoundingClientRect();
  var dpr = window.devicePixelRatio || 1;
  canvas.width = rect.width * dpr;
  canvas.height = rect.height * dpr;
  orbitalParticles = generateOrbitalParticles(currentOrbital, particleDensity, canvas.width, canvas.height);
  animateOrbital();
}

function animateOrbital() {
  var canvas = document.getElementById('orbitalCanvas');
  if (!canvas) return;
  var ctx = canvas.getContext('2d');
  var w = canvas.width;
  var h = canvas.height;
  var time = performance.now() * 0.001;

  ctx.clearRect(0, 0, w, h);

  var cx = w / 2;
  var cy = h / 2;

  // Draw heart-shaped nucleus glow
  var nucleusGrad = ctx.createRadialGradient(cx, cy, 0, cx, cy, 30);
  nucleusGrad.addColorStop(0, 'rgba(255,255,255,0.9)');
  nucleusGrad.addColorStop(0.3, 'rgba(255,120,150,0.6)');
  nucleusGrad.addColorStop(1, 'rgba(255,120,150,0)');
  ctx.fillStyle = nucleusGrad;
  ctx.beginPath();
  ctx.arc(cx, cy, 30, 0, Math.PI * 2);
  ctx.fill();

  // Nucleus dot
  ctx.fillStyle = '#fff';
  ctx.beginPath();
  ctx.arc(cx, cy, 4, 0, Math.PI * 2);
  ctx.fill();

  // Draw particles — BFs in blue, GFs in pink
  for (var i = 0; i < orbitalParticles.length; i++) {
    var p = orbitalParticles[i];
    var dx = Math.sin(time * p.speed + p.phase) * p.drift;
    var dy = Math.cos(time * p.speed * 0.7 + p.phase) * p.drift;

    var ppx = p.baseX + dx;
    var ppy = p.baseY + dy;

    var flickerAlpha = p.alpha * (0.6 + 0.4 * Math.sin(time * 2 + p.phase));

    var color = p.isBf ? '126,184,218' : '255,133,161';
    ctx.fillStyle = 'rgba(' + color + ',' + flickerAlpha + ')';
    ctx.beginPath();
    ctx.arc(ppx, ppy, p.size, 0, Math.PI * 2);
    ctx.fill();
  }

  orbitalAnimId = requestAnimationFrame(animateOrbital);
}

function updateOrbitalDensity() {
  particleDensity = parseInt(document.getElementById('densitySlider').value);
  document.getElementById('densityValue').textContent = particleDensity;
  initOrbitalCanvas();
}

/* ===== Shell Visualization ===== */
var currentShell = 1;
var shellAnimId = null;

var shellDataMap = {
  1: {color:'#72efdd', label:'Stage 1 \u2014 Casual Dating', orbitals:'1s (Studio)', maxE:2, maxCouples:1},
  2: {color:'#c77dff', label:'Stage 2 \u2014 Getting Serious', orbitals:'2s + 2p (Studio + 1-Bed)', maxE:8, maxCouples:4},
  3: {color:'#ffd166', label:'Stage 3 \u2014 Committed', orbitals:'3s + 3p + 3d (All types)', maxE:18, maxCouples:9}
};

function selectShell(n) {
  currentShell = n;
  document.querySelectorAll('.shell-btn').forEach(function(b) { b.className = 'shell-btn'; });
  document.querySelector('.shell-btn[data-shell="' + n + '"]').classList.add('active-' + n);

  var data = shellDataMap[n];
  var info = document.getElementById('shellInfo');
  info.innerHTML = '<h3 style="color:' + data.color + '">' + data.label + '</h3>' +
    '<p>Apartments: <strong>' + data.orbitals + '</strong></p>' +
    '<p>Max couples: <strong>' + data.maxCouples + '</strong> (' + data.maxE + ' people total = 2\u00D7' + n + '\u00B2)</p>';

  initShellCanvas();
  updateEnergyDiagram();
}

function initShellCanvas() {
  if (shellAnimId) cancelAnimationFrame(shellAnimId);
  var canvas = document.getElementById('shellCanvas');
  if (!canvas) return;
  var rect = canvas.parentElement.getBoundingClientRect();
  var dpr = window.devicePixelRatio || 1;
  canvas.width = rect.width * dpr;
  canvas.height = rect.height * dpr;
  animateShells();
}

function animateShells() {
  var canvas = document.getElementById('shellCanvas');
  if (!canvas) return;
  var ctx = canvas.getContext('2d');
  var w = canvas.width;
  var h = canvas.height;
  var cx = w / 2;
  var cy = h / 2;
  var time = performance.now() * 0.001;
  var maxR = Math.min(w, h) * 0.42;

  ctx.clearRect(0, 0, w, h);

  var shellColors = ['#72efdd', '#c77dff', '#ffd166'];
  var electronCounts = [[2], [2, 6], [2, 6, 10]];

  for (var s = 0; s < currentShell; s++) {
    var radius = maxR * (s + 1) / 3.5;
    var color = shellColors[s];
    var isCurrent = s === currentShell - 1;

    // Shell ring
    ctx.beginPath();
    ctx.arc(cx, cy, radius, 0, Math.PI * 2);
    ctx.strokeStyle = color;
    ctx.globalAlpha = isCurrent ? 0.5 : 0.15;
    ctx.lineWidth = isCurrent ? 2 : 1;
    ctx.setLineDash(isCurrent ? [] : [4, 4]);
    ctx.stroke();
    ctx.setLineDash([]);
    ctx.globalAlpha = 1;

    // Shell label
    ctx.fillStyle = color;
    ctx.globalAlpha = isCurrent ? 1 : 0.4;
    ctx.font = (isCurrent ? 'bold ' : '') + '13px "Space Mono", monospace';
    ctx.textAlign = 'center';
    ctx.fillText('Stage ' + (s + 1), cx + radius + 30, cy - 8);
    ctx.globalAlpha = 1;

    // Draw electron pairs on this shell
    var subshells = electronCounts[s];
    var totalE = 0;
    for (var j = 0; j < subshells.length; j++) totalE += subshells[j];

    for (var e = 0; e < totalE; e++) {
      var angle = (e / totalE) * Math.PI * 2 + time * (0.3 + s * 0.15) * (s % 2 === 0 ? 1 : -1);
      var wobble = Math.sin(time * 2 + e) * 3;
      var ex = cx + (radius + wobble) * Math.cos(angle);
      var ey = cy + (radius + wobble) * Math.sin(angle);

      var isBf = e % 2 === 0;
      var dotColor = isBf ? '#7eb8da' : '#ff85a1';

      // Glow
      var eGrad = ctx.createRadialGradient(ex, ey, 0, ex, ey, 10);
      eGrad.addColorStop(0, dotColor);
      eGrad.addColorStop(1, 'rgba(0,0,0,0)');
      ctx.fillStyle = eGrad;
      ctx.globalAlpha = isCurrent ? 0.6 : 0.15;
      ctx.beginPath();
      ctx.arc(ex, ey, 10, 0, Math.PI * 2);
      ctx.fill();

      // Dot
      ctx.fillStyle = '#fff';
      ctx.globalAlpha = isCurrent ? 1 : 0.3;
      ctx.beginPath();
      ctx.arc(ex, ey, 3, 0, Math.PI * 2);
      ctx.fill();
      ctx.globalAlpha = 1;
    }
  }

  // Nucleus
  var nGrad = ctx.createRadialGradient(cx, cy, 0, cx, cy, 20);
  nGrad.addColorStop(0, 'rgba(255,255,255,0.9)');
  nGrad.addColorStop(0.5, 'rgba(255,120,150,0.5)');
  nGrad.addColorStop(1, 'rgba(255,120,150,0)');
  ctx.fillStyle = nGrad;
  ctx.beginPath();
  ctx.arc(cx, cy, 20, 0, Math.PI * 2);
  ctx.fill();

  ctx.fillStyle = '#fff';
  ctx.beginPath();
  ctx.arc(cx, cy, 5, 0, Math.PI * 2);
  ctx.fill();

  ctx.font = 'bold 11px "Space Mono", monospace';
  ctx.fillStyle = 'rgba(255,255,255,0.7)';
  ctx.textAlign = 'center';
  ctx.fillText('home', cx, cy + 22);

  shellAnimId = requestAnimationFrame(animateShells);
}

function updateEnergyDiagram() {
  var container = document.getElementById('energyDiagram');
  container.innerHTML = '';

  var levels = [
    {label:'1s', analogy:'Studio cozy night', color:'#72efdd', e:2, shell:1, width:20},
    {label:'2s', analogy:'Studio movie night', color:'#c77dff', e:2, shell:2, width:30},
    {label:'2p', analogy:'Dinner date', color:'#c77dff', e:6, shell:2, width:50},
    {label:'3s', analogy:'Weekend getaway', color:'#ffd166', e:2, shell:3, width:40},
    {label:'3p', analogy:'Fancy outing', color:'#ffd166', e:6, shell:3, width:60},
    {label:'3d', analogy:'Double date night', color:'#ffd166', e:10, shell:3, width:80}
  ];

  levels.reverse().forEach(function(lv) {
    var div = document.createElement('div');
    div.className = 'energy-level' + (lv.shell === currentShell ? ' highlighted' : '');
    div.innerHTML =
      '<span class="energy-label" style="color:' + lv.color + '">' + lv.label + '</span>' +
      '<div class="energy-bar" style="background:' + lv.color + ';width:' + lv.width + '%"></div>' +
      '<span class="energy-electrons">' + (lv.e / 2) + ' couple' + (lv.e > 2 ? 's' : '') + '</span>';
    container.appendChild(div);
  });
}

/* ===== Spin Canvases ===== */
var spinAnimId = null;

function initSpinCanvases() {
  if (spinAnimId) cancelAnimationFrame(spinAnimId);
  var canvases = ['spinUpCanvas', 'spinDownCanvas'];

  canvases.forEach(function(id) {
    var canvas = document.getElementById(id);
    if (!canvas) return;
    var rect = canvas.parentElement.getBoundingClientRect();
    var dpr = window.devicePixelRatio || 1;
    canvas.width = rect.width * dpr;
    canvas.height = rect.height * dpr;
  });

  animateSpin();
}

function animateSpin() {
  var time = performance.now() * 0.001;
  drawSpinElectron('spinUpCanvas', time, 1, '#7eb8da');
  drawSpinElectron('spinDownCanvas', time, -1, '#ff85a1');
  spinAnimId = requestAnimationFrame(animateSpin);
}

function drawSpinElectron(canvasId, time, direction, color) {
  var canvas = document.getElementById(canvasId);
  if (!canvas) return;
  var ctx = canvas.getContext('2d');
  var w = canvas.width;
  var h = canvas.height;
  var cx = w / 2;
  var cy = h / 2;
  var r = Math.min(w, h) * 0.3;

  ctx.clearRect(0, 0, w, h);

  var angle = time * 2 * direction;

  // Draw axis
  ctx.beginPath();
  ctx.moveTo(cx, cy - r - 15);
  ctx.lineTo(cx, cy + r + 15);
  ctx.strokeStyle = 'rgba(255,255,255,0.1)';
  ctx.lineWidth = 1;
  ctx.setLineDash([3, 3]);
  ctx.stroke();
  ctx.setLineDash([]);

  // Arrow
  var arrowY = direction > 0 ? cy - r - 15 : cy + r + 15;
  var arrowDir = direction > 0 ? 1 : -1;
  ctx.beginPath();
  ctx.moveTo(cx, arrowY);
  ctx.lineTo(cx - 6, arrowY + 10 * arrowDir);
  ctx.lineTo(cx + 6, arrowY + 10 * arrowDir);
  ctx.closePath();
  ctx.fillStyle = color;
  ctx.globalAlpha = 0.8;
  ctx.fill();
  ctx.globalAlpha = 1;

  // Draw rotation trail
  ctx.beginPath();
  ctx.ellipse(cx, cy, r, r * 0.35, 0, 0, Math.PI * 2);
  ctx.strokeStyle = color;
  ctx.globalAlpha = 0.15;
  ctx.lineWidth = 2;
  ctx.stroke();
  ctx.globalAlpha = 1;

  // Trail segments
  var segments = 30;
  for (var i = 0; i < segments; i++) {
    var a1 = angle + (i / segments) * Math.PI * 2;
    var a2 = angle + ((i + 1) / segments) * Math.PI * 2;
    var alpha = (segments - i) / segments * 0.6;

    ctx.beginPath();
    ctx.moveTo(cx + r * Math.cos(a1), cy + r * 0.35 * Math.sin(a1));
    ctx.lineTo(cx + r * Math.cos(a2), cy + r * 0.35 * Math.sin(a2));
    ctx.strokeStyle = color;
    ctx.globalAlpha = alpha;
    ctx.lineWidth = 3;
    ctx.stroke();
  }
  ctx.globalAlpha = 1;

  // Electron sphere
  var ex = cx + r * Math.cos(angle);
  var ey = cy + r * 0.35 * Math.sin(angle);

  var eGrad = ctx.createRadialGradient(ex, ey, 0, ex, ey, 14);
  eGrad.addColorStop(0, '#ffffff');
  eGrad.addColorStop(0.4, color);
  eGrad.addColorStop(1, 'rgba(0,0,0,0)');
  ctx.fillStyle = eGrad;
  ctx.beginPath();
  ctx.arc(ex, ey, 14, 0, Math.PI * 2);
  ctx.fill();

  ctx.fillStyle = '#fff';
  ctx.beginPath();
  ctx.arc(ex, ey, 5, 0, Math.PI * 2);
  ctx.fill();

  // Label on the electron
  ctx.font = 'bold 9px "DM Sans", sans-serif';
  ctx.fillStyle = direction > 0 ? '#1a3a5a' : '#5a1a2a';
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText(direction > 0 ? 'BF' : 'GF', ex, ey);
}

/* ===== Box Diagram (Carbon) ===== */
function buildBoxDiagram() {
  var container = document.getElementById('boxDiagram');
  var orbitals = [
    {label:'1s', electrons:2, color:'#ff4d6d'},
    {label:'2s', electrons:2, color:'#c77dff'},
    {label:'2p\u2093', electrons:1, color:'#c77dff'},
    {label:'2p\u1D67', electrons:1, color:'#c77dff'},
    {label:'2p\u1D63', electrons:0, color:'#c77dff'}
  ];

  orbitals.forEach(function(orb) {
    var box = document.createElement('div');
    box.style.cssText = 'text-align:center;';

    var square = document.createElement('div');
    square.style.cssText = 'width:60px;height:60px;border:2px solid ' + orb.color + ';border-radius:10px;display:flex;align-items:center;justify-content:center;gap:2px;margin:0 auto 6px;background:rgba(0,0,0,0.2);';

    if (orb.electrons >= 1) {
      var up = document.createElement('span');
      up.textContent = '\u2191';
      up.title = 'Boyfriend';
      up.style.cssText = 'font-size:22px;color:#7eb8da;';
      square.appendChild(up);
    }
    if (orb.electrons >= 2) {
      var down = document.createElement('span');
      down.textContent = '\u2193';
      down.title = 'Girlfriend';
      down.style.cssText = 'font-size:22px;color:#ff85a1;';
      square.appendChild(down);
    }
    if (orb.electrons === 0) {
      var empty = document.createElement('span');
      empty.textContent = '\u2014';
      empty.style.cssText = 'font-size:16px;color:var(--text-muted);opacity:0.3;';
      square.appendChild(empty);
    }

    var label = document.createElement('div');
    label.textContent = orb.label;
    label.style.cssText = 'font-family:"Space Mono",monospace;font-size:11px;color:' + orb.color + ';';

    var sublabel = document.createElement('div');
    sublabel.style.cssText = 'font-size:9px;color:var(--text-muted);margin-top:2px;';
    if (orb.electrons === 2) {
      sublabel.textContent = 'BF + GF';
    } else if (orb.electrons === 1) {
      sublabel.textContent = 'BF only';
    } else {
      sublabel.textContent = 'vacant';
    }

    box.appendChild(square);
    box.appendChild(label);
    box.appendChild(sublabel);
    container.appendChild(box);
  });
}
buildBoxDiagram();

/* ===== Quantum Table ===== */
function buildQuantumTable() {
  var tbody = document.getElementById('quantumTableBody');
  var tableData = [
    {n:1, l:0, letter:'s (Studio)', ml:'0', orbitals:1, maxE:2},
    {n:2, l:0, letter:'s (Studio)', ml:'0', orbitals:1, maxE:2},
    {n:2, l:1, letter:'p (1-Bed)', ml:'-1, 0, +1', orbitals:3, maxE:6},
    {n:3, l:0, letter:'s (Studio)', ml:'0', orbitals:1, maxE:2},
    {n:3, l:1, letter:'p (1-Bed)', ml:'-1, 0, +1', orbitals:3, maxE:6},
    {n:3, l:2, letter:'d (2-Bed)', ml:'-2, -1, 0, +1, +2', orbitals:5, maxE:10}
  ];

  tableData.forEach(function(row) {
    var tr = document.createElement('tr');
    tr.className = 'stage-' + row.n;

    tr.innerHTML =
      '<td style="font-weight:700;color:' + ['','var(--casual)','var(--serious)','var(--committed)'][row.n] + '">' + row.n + '</td>' +
      '<td>' + row.l + '</td>' +
      '<td style="font-weight:700;font-size:11px">' + row.letter + '</td>' +
      '<td>' + row.ml + '</td>' +
      '<td>' + row.orbitals + '</td>' +
      '<td style="font-weight:700">' + row.maxE + '</td>';

    tr.addEventListener('mouseenter', function() {
      tr.querySelectorAll('td').forEach(function(td) { td.classList.add('table-highlight'); });
    });
    tr.addEventListener('mouseleave', function() {
      tr.querySelectorAll('td').forEach(function(td) { td.classList.remove('table-highlight'); });
    });

    tbody.appendChild(tr);
  });
}
buildQuantumTable();

/* ===== Energy Diagram Init ===== */
updateEnergyDiagram();

/* ===== Resize Handler ===== */
var resizeTimeout;
window.addEventListener('resize', function() {
  clearTimeout(resizeTimeout);
  resizeTimeout = setTimeout(function() {
    initCurrentSection();
  }, 200);
});

/* ===== Init first section ===== */
initCurrentSection();
</script>
</body>
</html>
